"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[9262],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return m}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),p=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=p(e.components);return r.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=p(n),m=a,g=d["".concat(l,".").concat(m)]||d[m]||u[m]||o;return n?r.createElement(g,i(i({ref:t},c),{},{components:n})):r.createElement(g,i({ref:t},c))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,i=new Array(o);i[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var p=2;p<o;p++)i[p]=n[p];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},6425:function(e,t,n){n.r(t),n.d(t,{assets:function(){return c},contentTitle:function(){return l},default:function(){return m},frontMatter:function(){return s},metadata:function(){return p},toc:function(){return u}});var r=n(7462),a=n(3366),o=(n(7294),n(3905)),i=["components"],s={slug:"type-kinds-intro",title:'Introducing Type "Kinds"',author:"CG/SQL Team",author_title:"Maintainer of CG/SQL",author_url:"https://github.com/facebookincubator",author_image_url:"https://avatars2.githubusercontent.com/u/69631?s=200&v=4",tags:["facebook","cg-sql"]},l=void 0,p={permalink:"/blog/type-kinds-intro",editUrl:"https://github.com/facebookincubator/CG-SQL/edit/master/website/blog/blog/2021-01-20-type-kinds-intro.md",source:"@site/blog/2021-01-20-type-kinds-intro.md",title:'Introducing Type "Kinds"',description:'Further adding to the type calculus of the CQL language we introduced the ability to encode the "kind" of primitive types.  This',date:"2021-01-20T00:00:00.000Z",formattedDate:"January 20, 2021",tags:[{label:"facebook",permalink:"/blog/tags/facebook"},{label:"cg-sql",permalink:"/blog/tags/cg-sql"}],readingTime:2.38,truncated:!1,authors:[{name:"CG/SQL Team",title:"Maintainer of CG/SQL",url:"https://github.com/facebookincubator",imageURL:"https://avatars2.githubusercontent.com/u/69631?s=200&v=4"}],frontMatter:{slug:"type-kinds-intro",title:'Introducing Type "Kinds"',author:"CG/SQL Team",author_title:"Maintainer of CG/SQL",author_url:"https://github.com/facebookincubator",author_image_url:"https://avatars2.githubusercontent.com/u/69631?s=200&v=4",tags:["facebook","cg-sql"]},prevItem:{title:"Change in No-Result Semantics",permalink:"/blog/free-empty-results"},nextItem:{title:"Introducing Named Types",permalink:"/blog/named-types-into"}},c={authorsImageUrls:[void 0]},u=[],d={toc:u};function m(e){var t=e.components,n=(0,a.Z)(e,i);return(0,o.kt)("wrapper",(0,r.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,'Further adding to the type calculus of the CQL language we introduced the ability to encode the "kind" of primitive types.  This\ncan be used in a number of ways -- like "units" for natural things and like a "type" for synthetic keys and other such.  It\'s easier\nto illustrate by example.'),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"declare job_id type long<job_id>;\ndeclare person_id type long<person_id>;\n\ndeclare j job_id;\ndecalre p person_id;\n\nset p := j;  -- this is an error\n")),(0,o.kt)("p",null,"With the above in place, other expressions like  ",(0,o.kt)("inlineCode",{parentName:"p"},"p == j")," would also produce errors as these ",(0,o.kt)("inlineCode",{parentName:"p"},"long"),' values are no longer type compatible.  This is\na great way to add enforcement to your schema and procedures.  Likewise you can use these annotations to add "units" to your data types.  e.g.'),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"declare meters type real<meters>;\ndeclare grams type real<grams>;\n\ndeclare m meters;\ndeclare g grams;\n")),(0,o.kt)("p",null,"Variables of type ",(0,o.kt)("inlineCode",{parentName:"p"},"grams")," (e.g. ",(0,o.kt)("inlineCode",{parentName:"p"},"g"),") are not compatible with variables of type ",(0,o.kt)("inlineCode",{parentName:"p"},"meters")," (e.g. ",(0,o.kt)("inlineCode",{parentName:"p"},"m"),") even though both are ",(0,o.kt)("inlineCode",{parentName:"p"},"real"),"."),(0,o.kt)("p",null,"Likewise, attemping to insert ",(0,o.kt)("inlineCode",{parentName:"p"},"grams")," into a column that is typed to ",(0,o.kt)("inlineCode",{parentName:"p"},"meters")," will give errors.  Of course SQLite doesn't know about any of this\nso all the ",(0,o.kt)("inlineCode",{parentName:"p"},"<>")," stuff is removed in the generated SQL.  This is just about type enforcement at compile time."),(0,o.kt)("p",null,"Enumerations like:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"declare enum surface integer (paper, canvas);\ndeclare enum writer integer (pen, paper, brush);\n")),(0,o.kt)("p",null,"enable this:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"declare s surface;                  -- s is now of type integer<surface>\ndeclare w writer;                   -- w is now of type integer<writer>\nset s := surface.paper;             -- ok\nset s := writer.pen;                -- error\nset w := writer.pencil;             -- ok\ncase when s == w then 1 else 0 end; -- error (w/s not comparable)\nset w := s;                         -- error again\n")),(0,o.kt)("p",null,"additionally in DML/DDL:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"create table draw_action(\n  w writer,\n  s surface\n);\n\ninsert into draw_action values(w, s); -- ok\ninsert into draw_action values(s, w); -- error!\n")),(0,o.kt)("p",null,"So the type kinds can be quite helpful when dealing with loose variables."),(0,o.kt)("p",null,"The notion of specific types was added to the language nearly two years ago to support the ",(0,o.kt)("inlineCode",{parentName:"p"},"object")," type because there was a great desire\nto prevent ",(0,o.kt)("inlineCode",{parentName:"p"},"object<dictionary>")," being assigned from ",(0,o.kt)("inlineCode",{parentName:"p"},"object<list>"),' but this "type kind", whether it\'s with units (e.g. "meters", "grams")\nor a type name (e.g. "job_id") adds a lot of high value type checking.'),(0,o.kt)("p",null,"The kind can be added, stripped, or changed with a ",(0,o.kt)("inlineCode",{parentName:"p"},"cast"),' operation and the type system allows a constant or variable with no kind (e.g. "1")\nto mix and match with any kind so long as the base type is compatible as usual.  So you get the most value by using the specific type\nconsistently but you won\'t go insane adding test cases that use constants for instance.'),(0,o.kt)("p",null,"As of this writing the expression kinds are checked for compatibility everywhere plus or minus bugs.  There are extensive tests."))}m.isMDXComponent=!0}}]);