<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.65">
<title data-react-helmet="true">Part 4: Testing | CG/SQL</title><meta data-react-helmet="true" name="docsearch:version" content="current,latest"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Part 4: Testing | CG/SQL"><meta data-react-helmet="true" name="description" content="&lt;!---"><meta data-react-helmet="true" property="og:description" content="&lt;!---"><meta data-react-helmet="true" property="og:url" content="https://cgsql.dev/cql-guide/int04"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://cgsql.dev/cql-guide/int04"><link rel="stylesheet" href="/styles.efe3e8f9.css">
<link rel="preload" href="/styles.e051d180.js" as="script">
<link rel="preload" href="/runtime~main.437f1a60.js" as="script">
<link rel="preload" href="/main.33884f03.js" as="script">
<link rel="preload" href="/1.afa1d247.js" as="script">
<link rel="preload" href="/2.04c65c4b.js" as="script">
<link rel="preload" href="/3.6ea9af44.js" as="script">
<link rel="preload" href="/1be78505.dbdcc56f.js" as="script">
<link rel="preload" href="/88.6f2dbc41.js" as="script">
<link rel="preload" href="/5456faf3.734d4a1e.js" as="script">
<link rel="preload" href="/17896441.e5a5b6db.js" as="script">
<link rel="preload" href="/6d0bd9b3.c9a4f2a1.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><strong class="navbar__title">CG/SQL</strong></a><a class="navbar__item navbar__link" href="/docs/introduction">Docs</a><a class="navbar__item navbar__link" href="/cql-guide/ch01">CQL Guide</a><a class="navbar__item navbar__link" href="/cql-guide/int01">CQL Internals</a><a class="navbar__item navbar__link" href="/program-diagram">Railroad Diagram</a><a class="navbar__item navbar__link" href="/json-diagram">Railroad Diagram: JSON</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebookincubator/CG-SQL" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><strong class="navbar__title">CG/SQL</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/introduction">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/cql-guide/ch01">CQL Guide</a></li><li class="menu__list-item"><a class="menu__link" href="/cql-guide/int01">CQL Internals</a></li><li class="menu__list-item"><a class="menu__link" href="/program-diagram">Railroad Diagram</a></li><li class="menu__list-item"><a class="menu__link" href="/json-diagram">Railroad Diagram: JSON</a></li><li class="menu__list-item"><a class="menu__link" href="/blog">Blog</a></li><li class="menu__list-item"><a href="https://github.com/facebookincubator/CG-SQL" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">CQL Guide</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/ch01">Chapter 1: Introduction</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/ch02">Chapter 2: Using Data</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/ch03">Chapter 3: Expressions, Literals, Nullability, Sensitivity</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/ch04">Chapter 4: Procedures, Functions, and Control Flow</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/ch05">Chapter 5: Types of Cursors, OUT and OUT UNION, and FETCH flavors</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/ch06">Chapter 6: Calling Procedures Defined Elsewhere</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/ch07">Chapter 7: CQL Result Sets</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/ch08">Chapter 8: Functions</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/ch09">Chapter 9: Statements Summary and Error Checking</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/ch10">Chapter 10: Schema Management Features</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/ch11">Chapter 11: Previous Schema Validation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/ch12">Chapter 12: Testability Features</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/ch13">Chapter 13: JSON Output</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/ch14">Chapter 14: CQL Query Fragments</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Appendix</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/x1">Appendix 1: Command Line Options</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/x2">Appendix 2: CQL Grammar</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/x3">Appendix 3: Control Directives</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/x4">Appendix 4: CQL Error Codes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/x5">Appendix 5: JSON Schema Grammar</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/x6">Appendix 6: CQL In 20 Minutes</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/x7">Appendix 7: CQL Anti-patterns</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/x8">Appendix 8: CQL Best Practices</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/cql-guide/x9">Appendix 9: Using the CQL Amalgam</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">CQL Internals</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/cql-guide/int01">Part 1: Lexing, Parsing, and the AST</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/cql-guide/int02">Part 2: Semantic Analysis</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/cql-guide/int03">Part 3: C Code Generation</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/cql-guide/int04">Part 4: Testing</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">Part 4: Testing</h1></header><div class="markdown"><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="preface"></a>Preface<a aria-hidden="true" tabindex="-1" class="hash-link" href="#preface" title="Direct link to heading">#</a></h3><p>Part 4 continues with a discussion of the essentials testing frameworks for the CQL compiler.
As in the previous sections, the goal here is not to go over every detail but rather to give
a sense of how testing happens in general -- the core strategies and implementation choices --
so that when reading the tests you will have an idea how it all hangs together. To accomplish
this, various key tools will be explained in detail as well as selected examples of their use.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="testing"></a>Testing<a aria-hidden="true" tabindex="-1" class="hash-link" href="#testing" title="Direct link to heading">#</a></h2><p>There are several types of tests in the system, all of which are launched by the <code>test.sh</code>
script which builds the compiler and does a full test pass, there are well over 3000 tests
as of this writing.  Broadly these are in these few categories:</p><ul><li><p><strong>parse tests</strong> : these are in <code>test.sql</code></p><ul><li>the test script verifies that the compiler can parse this file with no errors</li><li>the parse pass echoes what it read in normalized form, this is compared against a reference copy and any differences are noted</li><li>differences can be accepted by using the <code>ok.sh</code> script</li><li>verification here is very light and in fact much of parsing is actually tested in the next pass</li></ul></li><li><p><strong>semantic tests</strong> : these are in <code>sem_test.sql</code></p><ul><li>the file has no parse errors but it has MANY semantic errors, nearly every such error in fact</li><li>semantic analysis is run with the <code>--test</code> flag which produces AST fragments and echoed CQL</li><li>the test file includes patterns which either must appear, or must not appear, in the output to pass the test</li><li>the AST includes full type information, so virtually anything about the semantic results can be, and is, verified</li><li>many tests are designed to exercise the parser as well, ensuring that the correct AST was built and then analyzed<ul><li>e.g. operator precedence can be verified here</li><li>the AST echoing logic can also be verified here, e.g. placement of parenthesis in the echoed output</li></ul></li><li>any semantic rewrites can be verified here because the rewritten form is emitted in the test output, not the original input</li><li>all other operations that happen during the semantic pass (e.g. constant evaluation) are also tested here</li><li>the full semantic output is also normalized (e.g. removing line numbers) and is compared against a reference copy, any differences are noted</li><li>differences can be accepted by using the <code>ok.sh</code> script</li><li>there are additional files to test different modes like &quot;previous schema&quot; validation (q.v.) as well as dev mode and the schema migrator, the files in this family are: <code>sem_test.sql</code>, <code>sem_test_dev.sql</code>, <code>sem_test_migrate.sql</code>, <code>sem_test_prev.sql</code></li></ul></li><li><p><strong>code gen tests</strong> : the basic test in this family is <code>cg_test.sql</code> which has the C codegen tests</p><ul><li>these test files do pattern matching just like the semantic case except the codegen output is checked rather than the AST</li><li>the test output is normalized and checked against a reference, just like the semantic tests</li><li>there is generally no need to check for errors in test output because all errors are detected during semantic analysis</li><li>there are MANY tests in this family, at least one for each of the various generators:<ul><li><code>cg_test.sql</code>, <code>cg_test_assembly_query.sql</code>, <code>cg_test_base_fragment.sql</code>, <code>cg_test_base_java_fragment.sql</code>, <code>cg_test_c_type_getters.sql</code>, <code>cg_test_extension_fragment.sql</code>, <code>cg_test_extension_java_fragment.sql</code>, <code>cg_test_generate_copy.sql</code>, <code>cg_test_generated_from.sql</code>, <code>cg_test_json_schema.sql</code>, <code>cg_test_no_result_set.sql</code>, <code>cg_test_out_object.sql</code>, <code>cg_test_out_union.sql</code>, <code>cg_test_prev_invalid.sql</code>, <code>cg_test_query_plan.sql</code>, <code>cg_test_schema_upgrade.sql</code>, <code>cg_test_single_proc_not_nullable.sql</code>, <code>cg_test_single_proc_nullable.sql</code>, <code>cg_test_suppressed.sql</code>, <code>cg_test_test_helpers.sql</code>, <code>cg_test_with_object.sql</code>,</li></ul></li></ul></li><li><p><strong>run tests</strong> : the main run test creatively named <code>run_test.sql</code></p><ul><li>this test code is compiled and excuted</li><li>the test contains expectations like any other unit test</li><li>it has CQL parts and C parts, the C parts test the C API to the procedures, plus do initial setup</li><li>these test include uses of all CQL features and all of the CQL runtime features</li><li>the schema upgrader tests are arguably &quot;run tests&quot; as well in that they run the code but they have a much different verification strategy</li></ul></li><li><p><strong>unit test</strong> : the compiler supports the <code>--run_unit_tests</code> flag</p><ul><li>this causes the compile to self-test certain of its helper functions that are otherwise difficult to test</li><li>mostly this is buffers that need to be growable to but in practice only grow with huge input files</li><li>other exotic cases that would be hard to reliability hit in some other fashion are covered by this code</li></ul></li></ul><p>Test coverage is maintained at 100% line coverage (sometimes there are a few
hours when it drops to 99.9% or something like that but this never lasts).
Branch coverage is not especially targetted but is nonethless quite high. To
see the true branch coverage you have to build the compiler with the asserts
(Contract and Invariant) off.  Last time it was measured, it was well over 80%.</p><p>To start the tests you should run <code>test.sh</code>, this launches <code>common/test_common.sh</code> to do the work.
This structure allows anyone to make their own harness that launches the common test passes and adds
their own extra tests, or passes in additional flags.  <code>test.sh</code> itself uses <code>make</code> to
build the compiler.</p><p>To get the coverage report, use <code>cov.sh</code> which in turn launches <code>test.sh</code> with suitable flags
and then assembles the coverage report using <code>gcovr</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="parse-tests"></a>Parse Tests<a aria-hidden="true" tabindex="-1" class="hash-link" href="#parse-tests" title="Direct link to heading">#</a></h3><p>Looking at <code>test/test_common.sh</code> we find the source for the most basic test.  This is entirely
unremarkable stuff.</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function-name function" style="color:rgb(130, 170, 255)">basic_test</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;--------------------------------- STAGE 2 -- BASIC PARSING TEST&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">echo</span><span class="token plain"> running </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;</span><span class="token string variable" style="color:rgb(191, 199, 213)">${TEST_DIR}</span><span class="token string" style="color:rgb(195, 232, 141)">/test.sql&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">${CQL}</span><span class="token plain"> --dev --in </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;</span><span class="token string variable" style="color:rgb(191, 199, 213)">${TEST_DIR}</span><span class="token string" style="color:rgb(195, 232, 141)">/test.sql&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;</span><span class="token string variable" style="color:rgb(191, 199, 213)">${OUT_DIR}</span><span class="token string" style="color:rgb(195, 232, 141)">/test.out&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">echo</span><span class="token plain"> basic parsing </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">test</span><span class="token plain"> failed</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   failed</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">fi</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;  computing diffs (empty if none)&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  on_diff_exit test.out</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><ul><li>it&#x27;s &quot;STAGE 2&quot; because &quot;STAGE 1&quot; was the build</li><li>all it tries to do is run the compiler over <code>test/test.sql</code></li><li>if there are errors the test fails</li><li>if there are any differences between <code>test.out</code> and <code>test.out.ref</code> the test fails</li></ul><p>That&#x27;s it.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="sematic-tests"></a>Sematic Tests<a aria-hidden="true" tabindex="-1" class="hash-link" href="#sematic-tests" title="Direct link to heading">#</a></h3><p>The semantic tests are not much different but this is where the pattern matching comes in.</p><p>First let&#x27;s look at the shell script:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function-name function" style="color:rgb(130, 170, 255)">semantic_test</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;--------------------------------- STAGE 4 -- SEMANTIC ANALYSIS TEST&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">echo</span><span class="token plain"> running semantic analysis </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">test</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token plain"> sem_check --sem --print --dev --in </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;</span><span class="token string variable" style="color:rgb(191, 199, 213)">${TEST_DIR}</span><span class="token string" style="color:rgb(195, 232, 141)">/sem_test.sql&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;</span><span class="token string variable" style="color:rgb(191, 199, 213)">${OUT_DIR}</span><span class="token string" style="color:rgb(195, 232, 141)">/sem_test.out&quot;</span><span class="token plain"> </span><span class="token operator file-descriptor important" style="color:rgb(137, 221, 255)">2</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;</span><span class="token string variable" style="color:rgb(191, 199, 213)">${OUT_DIR}</span><span class="token string" style="color:rgb(195, 232, 141)">/sem_test.err&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;CQL semantic analysis returned unexpected error code&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token function" style="color:rgb(130, 170, 255)">cat</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;</span><span class="token string variable" style="color:rgb(191, 199, 213)">${OUT_DIR}</span><span class="token string" style="color:rgb(195, 232, 141)">/sem_test.err&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     failed</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">fi</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">echo</span><span class="token plain"> validating output trees</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;</span><span class="token string variable" style="color:rgb(191, 199, 213)">${OUT_DIR}</span><span class="token string" style="color:rgb(195, 232, 141)">/cql-verify&quot;</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;</span><span class="token string variable" style="color:rgb(191, 199, 213)">${TEST_DIR}</span><span class="token string" style="color:rgb(195, 232, 141)">/sem_test.sql&quot;</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;</span><span class="token string variable" style="color:rgb(191, 199, 213)">${OUT_DIR}</span><span class="token string" style="color:rgb(195, 232, 141)">/sem_test.out&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">echo</span><span class="token plain"> failed verification</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    failed</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">fi</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">echo</span><span class="token plain"> running dev semantic analysis </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">test</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">. same thing again </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> sem_test_dev.sql</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;  computing diffs (empty if none)&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  on_diff_exit sem_test.out</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  on_diff_exit sem_test.err</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">. same thing again </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> sem_test_dev.out and .err</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><p>There are basically 3 steps:</p><ul><li>run the compiler over <code>test/sem_test.sql</code><ul><li>fail if this generates no errors (yes you read that right, see below)</li></ul></li><li>do the pattern matching on the output to ensure the patterns match (discussed below)<ul><li>fail if the output is not consistent with the patterns</li></ul></li><li>compare the reference output for the AST and the errors<ul><li>fail if there are any differences</li></ul></li></ul><p>In the first step the compiler MUST produce an error code, let&#x27;s look at <code>sem_check</code> to see why:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-bash codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function-name function" style="color:rgb(130, 170, 255)">sem_check</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token variable" style="color:rgb(191, 199, 213)">${CQL}</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;</span><span class="token string variable" style="color:rgb(191, 199, 213)">$@</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;</span><span class="token string variable" style="color:rgb(191, 199, 213)">$?</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;</span><span class="token plain"> -ne </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;1&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;All semantic analysis checks have errors in the test&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;the normal return code is &quot;1&quot; -- any other return code is bad news&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;A return code of zero indicates we reported success in the face of errors&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;A return code other than 1 indicates an unexpected fatal error of some type&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token builtin class-name" style="color:rgb(255, 203, 107)">return</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">fi</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div></div></div><p>In short <code>sem_test.sql</code> is FULL of semantic errors, that&#x27;s part of the test.  If the compiler
reports success something is <em>seriously</em> wrong.</p><p>In the next phase we&#x27;re doing to do some pattern matching, let&#x27;s look at a couple of examples
to illustrate how this works.  The program <code>tester</code> actually does all this and that program
is itself written in (mostly) CQL which is cute.</p><p>Here&#x27;s a very simple example:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- TEST: we&#x27;ll be using printf in lots of places in the tests as an external proc</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- + {declare_proc_no_check_stmt}: ok</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- - Error</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> printf </span><span class="token keyword" style="font-style:italic">NO</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">CHECK</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>The code under test is of course <code>DECLARE PROCEDURE printf NO CHECK</code>.  The patterns happen
immediately before this code.  Let&#x27;s look at each line:</p><ul><li><code>-- TEST: etc.</code> : this is just a comment, it means nothing and serves no purpose other than documentation</li><li><code>-- + {declare_proc_no_check_stmt}: ok</code> : the comment stats with <code>&quot; + &quot;</code>, this is a trigger<ul><li>the test output from the statement under test must include indicated text</li><li>this happens to be the text for the AST of <code>declare_proc_no_check_stmt</code> after semantic success</li><li>there is no type info hence the <code>ok</code> designation (recall <code>SEM_TYPE_OK</code>)</li></ul></li><li><code>-- Error</code> : the comment starts with <code>&quot; - &quot;</code>, this is a trigger<ul><li>the test output from the statement under test must NOT include indicated text</li><li>in this case that means no reported erros</li></ul></li></ul><p>Easy enough.  Now does this happen?</p><p>The test output includes:</p><ul><li>text like &quot;The statement ending at line XXXX&quot; where XXXX is appropriate line number</li><li>an echo of the statement that was analyzed (after any rewrites)</li><li>the AST of that statement including semantic type info that was computed</li></ul><p>Using the value of XXXX the tester searches the test file in this case <code>sem_test.sql</code>, it
extracts the test patterns that happen AFTER the previous XXXX value for the previous statement
and up to the indicated line number.  This is The Price Is Right algorithm where you
read up to the designated lines without going over.</p><p>Each pattern is matched, or not matched, using the SQL <code>LIKE</code> or <code>NOT LIKE</code> operator.  In case
of errors the tester writes out the actual output and the expected patterns having all this information
handy.</p><p>The line numbers are all changed to literally &quot;XXXX&quot; after this pass so that the difference in
later passes is not a cascade of of trivial line number changes in otherwise identical output.</p><p>Let&#x27;s look at another example:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-sql codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- TEST: create a table using type discrimation: kinds</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- + {create_table_stmt}: with_kind: { id: integer&lt;some_key&gt;, cost: real&lt;dollars&gt;, value: real&lt;dollars&gt; }</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- + {col_def}: id: integer&lt;some_key&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- + {col_def}: cost: real&lt;dollars&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- + {col_def}: value: real&lt;dollars&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- - Error</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> with_kind</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">some_key</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cost </span><span class="token keyword" style="font-style:italic">real</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">dollars</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">value</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">real</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">dollars</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div></div></div><p>This reads pretty easily now:</p><ul><li><code>{create_table_stmt}</code> : the struct type of the table must be an exact match for what is expected</li><li><code>{col_def}</code> : there are 3 different <code>{col_def}</code> nodes, one for each column</li><li><code>- Error</code> : there are no reported errors</li></ul><p>So there are no errors reported nor are there any in the AST.  At least the part of the AST that was
checked.  The AST actually had other stuff too but it&#x27;s normal to just test the &quot;essential&quot; stuff.
There are many tests that try many variations and we don&#x27;t want to check every fact in every case
of every test.</p><p>If you want to see the whole AST output for this, it&#x27;s easy enough.  It&#x27;s sitting in <code>sem_test.out.ref</code></p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">The statement ending at line XXXX</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">CREATE TABLE with_kind(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  id INTEGER&lt;some_key&gt;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  cost REAL&lt;dollars&gt;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  value REAL&lt;dollars&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {create_table_stmt}: with_kind: { id: integer&lt;some_key&gt;, cost: real&lt;dollars&gt;, value: real&lt;dollars&gt; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | {create_table_name_flags}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | | {table_flags_attrs}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | | | {int 0}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | | {name with_kind}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  | {col_key_list}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    | {col_def}: id: integer&lt;some_key&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    | | {col_def_type_attrs}: ok</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    |   | {col_def_name_type}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    |     | {name id}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    |     | {type_int}: integer&lt;some_key&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    |       | {name some_key}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    | {col_key_list}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      | {col_def}: cost: real&lt;dollars&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      | | {col_def_type_attrs}: ok</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      |   | {col_def_name_type}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      |     | {name cost}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      |     | {type_real}: real&lt;dollars&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      |       | {name dollars}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      | {col_key_list}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        | {col_def}: value: real&lt;dollars&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          | {col_def_type_attrs}: ok</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            | {col_def_name_type}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              | {name value}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">              | {type_real}: real&lt;dollars&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                | {name dollars}</span></div></div></div></div></div><p>As you can see there was potentially a lot more than could have been verified but those view key lines were
selected because their correctness really implies the rest.  In fact just the <code>{create_table_stmt}</code> line
really was enough to know that everthing was fine.</p><p>Let&#x27;s look at one more example, this time on that is checking for errors.  Many tests check for
errors because correctly reporting errors is the primary job of <code>sem.c</code>.  It&#x27;s fair to say that
there are more tests for error cases than there are for correct cases because there are a lot
more ways to write code incorrectly than correctly.  Here&#x27;s the test:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-SQL codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- TEST: join with bogus ON expression type</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- + Error % expected numeric expression &#x27;ON&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- +1 Error</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- + {select_stmt}: err</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- + {on}: err</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">select * from foo</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">inner join bar as T2 on &#x27;v&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">where &#x27;w&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">having &#x27;x&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">limit &#x27;y&#x27;;</span></div></div></div></div></div><ul><li><code>+ Error % expected numeric expression &#x27;ON&#x27;</code> : there must be a reported Error message with the indicated error text</li><li><code>+1 Error</code> : this indicates that there must be <em>exactly</em> 1 match for the pattern &quot;Error&quot; (i.e. exactly one error)<ul><li>note that there are several problems with the test statement but error processing is supposed to stop after the first</li></ul></li><li><code>-- + {on}: err</code> : verifies that the ON clause was marked as being in error</li><li><code>-- + {select_stmt}: err</code> : verifies that the error correctly propogated up to the top level statement</li></ul><p>Note that the patterns can be in any order and every pattern is matched against the whole input so for instance:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- + {on}: err</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- + {on}: err</span></div></div></div></div></div><p>The above does not imply that there are two such <code>{on}</code> nodes.  The second line will match the same text as the first.
To to enforce that there were exactly two matches you use:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-undefined codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">-- +2 {on}: err</span></div></div></div></div></div><p>There is no syntax for &quot;at least two matches&quot; though one could easily be added.  So far it hasn&#x27;t been especially
necessary.</p><p>As we&#x27;ll see this simple pattern is used in many other tests.  All that is required for it work is output with
lines of the form &quot;The statement ending at line XXXX&quot;</p><p>The <code>sem_test_dev.sql</code> test file is a set of tests that are run with the <code>--dev</code> flag passed to CQL.  This
is the mode where certain statements that are prohibited in production code are verified.  This file is
very small indeed and the exact prohibitions are left as an exercise to the reader.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="code-generation-tests"></a>Code Generation Tests<a aria-hidden="true" tabindex="-1" class="hash-link" href="#code-generation-tests" title="Direct link to heading">#</a></h3><p>[Examples to come but the short answer is that it&#x27;s just like the semantic tests except we&#x27;re scanning
codegen instead of an AST.  The same patterns work in the same way for the same reason]</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="run-tests"></a>Run Tests<a aria-hidden="true" tabindex="-1" class="hash-link" href="#run-tests" title="Direct link to heading">#</a></h3><p>Coming soon.</p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"></div><div class="col text--right"><em><small>Last updated on <time datetime="2021-08-29T20:56:59.000Z" class="docLastUpdatedAt_217_">8/29/2021</time> by <strong>Rico Mariani</strong></small></em></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/cql-guide/int03"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Part 3: C Code Generation</div></a></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#preface" class="table-of-contents__link">Preface</a></li><li><a href="#testing" class="table-of-contents__link">Testing</a><ul><li><a href="#parse-tests" class="table-of-contents__link">Parse Tests</a></li><li><a href="#sematic-tests" class="table-of-contents__link">Sematic Tests</a></li><li><a href="#code-generation-tests" class="table-of-contents__link">Code Generation Tests</a></li><li><a href="#run-tests" class="table-of-contents__link">Run Tests</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Learn</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/introduction">Getting Started</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://www.youtube.com/channel/UC2lTapw2Um90sZpGQVaynEg" target="_blank" rel="noopener noreferrer" class="footer__link-item">Youtube</a></li><li class="footer__item"><a href="https://twitter.com/fbOpenSource" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebookincubator/CG-SQL" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Legal</h4><ul class="footer__items"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy</a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms</a></li></ul></div></div><div class="text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com" target="_blank" rel="noopener noreferrer" class="footerLogoLink_1zJy"><img class="footer__logo" alt="Facebook Open Source Logo" src="/img/oss_logo.png"></a></div><div>Copyright Â© 2021 Facebook, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.e051d180.js"></script>
<script src="/runtime~main.437f1a60.js"></script>
<script src="/main.33884f03.js"></script>
<script src="/1.afa1d247.js"></script>
<script src="/2.04c65c4b.js"></script>
<script src="/3.6ea9af44.js"></script>
<script src="/1be78505.dbdcc56f.js"></script>
<script src="/88.6f2dbc41.js"></script>
<script src="/5456faf3.734d4a1e.js"></script>
<script src="/17896441.e5a5b6db.js"></script>
<script src="/6d0bd9b3.c9a4f2a1.js"></script>
</body>
</html>