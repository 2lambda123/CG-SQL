<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-cql-guide docs-doc-id-generated/guide">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.20">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="CG/SQL RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="CG/SQL Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-44373548-49","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><title data-rh="true">guide | CG/SQL</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://cgsql.dev/cql-guide/generated/guide"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-cql-guide-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-cql-guide-current"><meta data-rh="true" property="og:title" content="guide | CG/SQL"><meta data-rh="true" name="description" content="Chapter 1: Introduction"><meta data-rh="true" property="og:description" content="Chapter 1: Introduction"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://cgsql.dev/cql-guide/generated/guide"><link data-rh="true" rel="alternate" href="https://cgsql.dev/cql-guide/generated/guide" hreflang="en"><link data-rh="true" rel="alternate" href="https://cgsql.dev/cql-guide/generated/guide" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.7db86f2e.css">
<link rel="preload" href="/assets/js/runtime~main.07cf15f3.js" as="script">
<link rel="preload" href="/assets/js/main.79429da8.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><div class="announcementBar_IbjG" style="background-color:#20232a;color:#fff" role="banner"><div class="announcementBarContent_KsVm">Support Ukraine 🇺🇦 <a target="_blank" rel="noopener noreferrer" href="https://opensource.fb.com/support-ukraine"> Help Provide Humanitarian Aid to Ukraine</a>.</div></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><b class="navbar__title text--truncate">CG/SQL</b></a><a class="navbar__item navbar__link" href="/docs/introduction">Docs</a><a class="navbar__item navbar__link" href="/cql-guide/ch01">CQL Guide</a><a class="navbar__item navbar__link" href="/cql-guide/int01">CQL Internals</a><a class="navbar__item navbar__link" href="/program-diagram">Railroad Diagram</a><a class="navbar__item navbar__link" href="/json-diagram">Railroad Diagram: JSON</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/facebookincubator/CG-SQL" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_S7eR colorModeToggle_vKtC"><button class="clean-btn toggleButton_rCf9 toggleButtonDisabled_Pu9x" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_dLyj"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docsWrapper_mKqt"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><div class="docPage_ualW"><main class="docMainContainer_uL0j docMainContainerEnhanced_oQfM"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="docItemContainer_vinB"><article><div class="tocCollapsible_bZGK theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_l22C">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>guide</h1></header><h2 class="anchor anchorWithStickyNavbar_mojV" id="chapter-1-introduction">Chapter 1: Introduction<a class="hash-link" href="#chapter-1-introduction" title="Direct link to heading">​</a></h2><p>CQL was designed as a precompiled addition to the SQLite runtime system.  SQLite lacks
stored procedures, but has a rich C runtime interface that allows you to create any kind
of control flow mixed with any SQL operations that you might need.  However, SQLite&#x27;s programming
interface is both verbose and error-prone in that small changes in SQL statements can require
significant swizzling of the C code that calls them. Additionally, many of the SQLite runtime functions have error codes
which must be strictly checked to ensure correct behavior.  In practice, it&#x27;s easy to get some or all of this wrong.</p><p>CQL simplifies this situation by providing a high level SQL language not unlike the stored procedure
forms that are available in client/server SQL solutions and lowering that language to &quot;The C you could
have written to do that job using the normal SQLite interfaces.&quot;</p><p>As a result, the C generated is generally very approachable but now the source language does not suffer from
brittleness due to query or table changes and CQL always generates correct column indices, nullability
checks, error checks, and the other miscellany needed to use SQLite correctly.</p><p>CQL is also strongly typed, whereas SQLite is very forgiving with regard to what operations
are allowed on which data.  Strict type checking is much more reasonable given CQL&#x27;s compiled programming model.</p><blockquote><p>NOTE: CQL was created to help solve problems in the building of Meta Platforms&#x27;s Messenger application, but this
content is free from references to Messenger. The CQL code generation here is done in the simplest mode with the
fewest runtime dependencies allowed for illustration.</p></blockquote><h3 class="anchor anchorWithStickyNavbar_mojV" id="getting-started">Getting Started<a class="hash-link" href="#getting-started" title="Direct link to heading">​</a></h3><p>Before starting this tutorial, make sure you have built the <code>cql</code> executable first in <a href="https://cgsql.dev/docs/building" target="_blank" rel="noopener noreferrer">Building CG/SQL</a>.</p><p>The &quot;Hello World&quot; program rendered in CQL looks like this:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockTitle_YYkX">hello.sql</div><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- needed to allow vararg calls to C functions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">procedure</span><span class="token plain"> printf </span><span class="token keyword" style="font-style:italic">no</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">check</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> hello</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Hello, world\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This very nearly works exactly as written but we&#x27;ll need a little bit of glue to wire it all up.</p><p>First, assuming you have <a href="https://cgsql.dev/docs/building" target="_blank" rel="noopener noreferrer">built</a> <code>cql</code>, you should have the power to do this:</p><div class="language-bash codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-bash codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ cql --in hello.sql --cg hello.h hello.c</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This will produce the C output files <code>hello.c</code> and <code>hello.h</code> which can be readily compiled.</p><p>However, hello.c will not have a <code>main</code> -- rather it will have a function like this:</p><div class="language-c codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockTitle_YYkX">hello.c</div><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-c codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">hello</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">void</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The declaration of this function can be found in <code>hello.h</code>.</p><blockquote><p>Note: hello.h tries to include <a href="https://github.com/facebookincubator/CG-SQL/blob/main/sources/cqlrt.h" target="_blank" rel="noopener noreferrer"><code>cqlrt.h</code></a>. To
avoid configuring include paths for the compiler, you might keep <code>cqlrt.h</code> in the same directory as the examples and
avoid that complication. Otherwise you must make arrangements for the compiler to be able to find <code>cqlrt.h</code> either by
adding it to an <code>INCLUDE</code> path or by adding some <code>-I</code> options to help the compiler find the source.</p></blockquote><p>That <code>hello</code> function is not quite adequate to get a running program, which brings us to the next step in
getting things running.  Typically you have some kind of client program that will execute the procedures you
create in CQL.  Let&#x27;s create a simple one in a file we&#x27;ll creatively name <code>main.c</code>.</p><p>A very simple CQL main might look like this:</p><div class="language-c codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockTitle_YYkX">main.c</div><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-c codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;stdlib.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(195, 232, 141)">&quot;hello.h&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> argc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">char</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">argv</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token function" style="color:rgb(130, 170, 255)">hello</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now we should be able to do the following:</p><div class="language-bash codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-bash codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ cc -o hello main.c hello.c</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ ./hello</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Hello, world</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Congratulations, you&#x27;ve printed <code>&quot;Hello, world&quot;</code> with CG/SQL!</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="why-did-this-work">Why did this work?<a class="hash-link" href="#why-did-this-work" title="Direct link to heading">​</a></h3><p>A number of things are going on even in this simple program that are worth discussing:</p><ul><li>the procedure <code>hello</code> had no arguments, and did not use the database<ul><li>therefore its type signature when compiled will be simply <code>void hello(void);</code> so we know how to call it</li><li>you can see the declaration for yourself by examining the <code>hello.c</code> or <code>hello.h</code></li></ul></li><li>since nobody used a database we didn&#x27;t need to initialize one</li><li>since there are no actual uses of SQLite we didn&#x27;t need to provide that library</li><li>for the same reason we didn&#x27;t need to include a reference to the CQL runtime</li><li>the function <code>printf</code> was declared &quot;no check&quot;, so calling it creates a regular C call using whatever arguments are provided, in this case a string</li><li>the <code>printf</code> function is declared in <code>stdio.h</code> which is pulled in by <code>cqlrt.h</code>, which appears in <code>hello.c</code>, so it will be available to call in the generated C code</li><li>CQL allows string literals with double quotes, and those literals may have most C escape sequences in them, so the &quot;\n&quot; bit works<ul><li>Normal SQL string literals (also supported) use single quotes and do not allow, or need escape characters other than <code>&#x27;&#x27;</code> to mean one single quote</li></ul></li></ul><p>All of these facts put together mean that the normal, simple linkage rules result in an executable that prints
the string &quot;Hello, world&quot; and then a newline.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="variables-and-arithmetic">Variables and Arithmetic<a class="hash-link" href="#variables-and-arithmetic" title="Direct link to heading">​</a></h3><p>Borrowing once again from examples in &quot;The C Programming Language&quot;, it&#x27;s possible to do significant control flow in CQL without reference to databases.  The following program illustrates a variety of concepts:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- needed to allow vararg calls to C functions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">procedure</span><span class="token plain"> printf </span><span class="token keyword" style="font-style:italic">no</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">check</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- print a conversion table  for temperatures from 0 to 300</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> conversions</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> fahr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> celsius </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> lower</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> upper</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> step </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> lower :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">   </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* lower limit of range */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> upper :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">300</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* upper limit of range */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> step :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">20</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">   </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* step size */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> fahr :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> lower</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">while</span><span class="token plain"> fahr </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;=</span><span class="token plain"> upper</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> celsius :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">fahr </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">32</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">9</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;%d\t%d\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> fahr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> celsius</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> fahr :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> fahr </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> step</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You may notice that both the SQL style <code>--</code> line prefix comments and the C style <code>/* */</code> forms <!-- -->[note you haven&#x27;t used the second for of comment style yet]<!-- -->
are acceptable comment forms. Indeed, it&#x27;s actually quite normal to pass CQL source through the C pre-processor before giving
it to the CQL compiler, thereby gaining <code>#define</code> and <code>#include</code> as well as other pre-processing options
like token pasting in addition to the aforementioned comment forms.  More on this later.</p><p>Like C, in CQL all variables must be declared before they are used.  They remain in scope until the end of the
procedure in which they are declared, or they are global scoped if they are declared outside of any procedure.  The
declarations announce the names and types of the local variables.   Importantly, variables stay in scope for the whole
procedure even if they are declared within a nested <code>begin</code> and <code>end</code> block.</p><p>The most basic types are the scalar or &quot;unitary&quot; types (as they are referred to in the compiler)</p><table><thead><tr><th>type</th><th>aliases</th><th>notes</th></tr></thead><tbody><tr><td><code>integer</code></td><td>int</td><td>a 32 bit integer</td></tr><tr><td><code>long</code></td><td>long integer</td><td>a 64 bit integer</td></tr><tr><td><code>bool</code></td><td>boolean</td><td>an 8 bit integer, normalized to 0/1</td></tr><tr><td><code>real</code></td><td>n/a</td><td>a C double</td></tr><tr><td><code>text</code></td><td>n/a</td><td>an immutable string reference</td></tr><tr><td><code>blob</code></td><td>n/a</td><td>an immutable blob reference</td></tr><tr><td><code>object</code></td><td>n/a</td><td>an object reference</td></tr></tbody></table><p>Note: SQLite makes no distinction between integer storage and long integer storage, but the declarations
tell CQL whether it should use the SQLite methods for binding and reading 64-bit or 32-bit quantities
when using the variable or column so declared.</p><p>There will be more notes on these types later, but importantly, all keywords and names in CQL
are case insensitive just like in the underlying SQL language.   Additionally all of the
above may be combined with <code>not null</code> to indicate that a <code>null</code> value may not be stored
in that variable (as in the example).  When generating the C code, the case used in the declaration
becomes the canonical case of the variable and all other cases are converted to that in the emitted
code.  As a result the C remains case sensitively correct.</p><p>The size of the reference types is machine dependent, whatever the local pointer size is.  The
non-reference types use machine independent declarations like <code>int32_t</code> to get exactly the desired
sizes in a portable fashion.</p><p>All variables of a reference type are set to <code>NULL</code> when they are declared,
including those that are declared <code>NOT NULL</code>. For this reason, all nonnull
reference variables must be initialized (i.e., assigned a value) before anything
is allowed to read from them. This is not the case for nonnull variables of a
non-reference type, however: They are automatically assigned an initial value of
0, and thus may be read from at any point.</p><p>The programs execution begins with three assignments:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> lower :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> upper :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">300</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> step :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">20</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This initializes the variables just like in the isomorphic C code.  Statements are seperated by semicolons,
just like in C.</p><p>The table is then printed using a <code>while</code> loop</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">while</span><span class="token plain"> fahr </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;=</span><span class="token plain"> upper</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This has the usual meaning, with the statements in the <code>begin/end</code> block being executed repeatedly
until the condition becomes false.</p><p>The body of a <code>begin/end</code> block such as the one in the <code>while</code> statement can contain one or more statements.</p><p>The typical computation of Celsius temperature ensues with this code:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> celsius :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">fahr </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">32</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">9</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;%d\t%d\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> fahr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> celsius</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> fahr :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> fahr </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> step</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This computes the celsuis and then prints it out, moving on to the next entry in the table.</p><p>Importantly, the CQL compiler uses the normal SQLite order of operations, which is NOT the C order of operations.
As a result, the compiler may need to add parentheses in the C output to get the correct order; or it may remove
some parentheses because they are not needed in the C order even though they were in the SQL order.</p><p>The <code>printf</code> call operates as before, with the <code>fahr</code> and <code>celsius</code> variables being passed on to the C runtime library
for formatting, unchanged.</p><p>NOTE: when calling unknown foreign functions like <code>printf</code> string literals are simply passed right through unchanged
as C string literals. No CQL string object is created.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="basic-conversion-rules">Basic Conversion Rules<a class="hash-link" href="#basic-conversion-rules" title="Direct link to heading">​</a></h3><p>As a rule, CQL does not perform its own conversions, leaving that instead to the C compiler.  An exception
to this is that boolean expressions are normalized to a 0 or 1 result before they are stored.</p><p>However, even with no explicit conversions, there are compatibility checks to ensure that letting the C compiler
do the conversions will result in something sensible.  The following list summarizes the essential facts/rules as
they might be applied when performing a <code>+</code> operation.</p><ul><li>the numeric types are bool, int, long, real</li><li>non-numeric types cannot be combined with numerics, e.g. 1 + &#x27;x&#x27; always yields an error</li><li>any numeric type combined with itself yields the same type</li><li>bool combined with int yields int</li><li>bool or int combined with long yields long</li><li>bool, int, or long combined with real yields real</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="preprocessing-features">Preprocessing Features<a class="hash-link" href="#preprocessing-features" title="Direct link to heading">​</a></h3><p>CQL does not include its own pre-processor but it is designed to consume the output of the C pre-processor.  To do this, you can either write the output of the pre-processor to a temporary file and read it into CQL as usual or you can set up a pipeline something like this:</p><div class="language-bash codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-bash codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ cc -x c -E your_program.sql </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> cql --cg your_program.h your_program.c</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The above causes the C compiler to invoke only the pre-processor <code>-E</code> and to treat the input as though it were C code <code>-x c</code> even though it is in a <code>.sql</code> file. Later examples will assume that you have configured CQL to be used with the C pre-processor as above.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="chapter-2-using-data">Chapter 2: Using Data<a class="hash-link" href="#chapter-2-using-data" title="Direct link to heading">​</a></h2><p>The point of using CQL is to facilitate access to a SQLite database so we&#x27;ll switch gears to a slightly more complicated setup.  We&#x27;ll
still keep things fairly simple but let&#x27;s start to use some database features.  Note: it is not the intent of this tutorial to also be
a primer for the SQLite programming language which is so ably documented on <a href="https://sqlite.org/" target="_blank" rel="noopener noreferrer">https://sqlite.org/</a>.  Please refer to that site for details
on the meaning of the SQL statements used here if you are new to SQL.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="a-sample-program">A Sample Program<a class="hash-link" href="#a-sample-program" title="Direct link to heading">​</a></h3><p>Suppose we have the following program:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockTitle_YYkX">hello.sql</div><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- needed to allow vararg calls to C functions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">procedure</span><span class="token plain"> printf </span><span class="token keyword" style="font-style:italic">no</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">check</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> my_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">t </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> hello</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> my_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">values</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Hello, world\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> t </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> t :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> my_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;%s&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>That looks like an interesting little baby program and it appears as though it would once again print that most famous of salutations, &quot;Hello, world&quot;.</p><p>Well, it doesn&#x27;t.  At least, not yet.  Let&#x27;s walk through the various things that are going to go wrong as this will teach us everything we need to know about activating CQL from some environment of your choice.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="providing-a-suitable-database">Providing a Suitable Database<a class="hash-link" href="#providing-a-suitable-database" title="Direct link to heading">​</a></h3><p>CQL is just a compiler, it doesn&#x27;t know how the code it creates will be provisioned any more than say clang does.
It creates functions with predictable signatures so that they can be called from C just as easily as the SQLite API
itself, and using the same currency.  Our new version of <code>hello</code> now requires a database handle because it performs
database operations.  Also there are now opportunities for the database operations to fail, and so <code>hello</code> now provides a
return code.</p><p>A new minimal <code>main</code> program might look something like this:</p><div class="language-c codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockTitle_YYkX">main.c</div><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-c codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;stdlib.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;sqlite3.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(195, 232, 141)">&quot;hello.h&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> argc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">char</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">argv</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  sqlite3 </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">db</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> rc </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">sqlite3_open</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;:memory:&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">db</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">rc </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> SQLITE_OK</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">exit</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* not exactly world class error handling but that isn&#x27;t the point */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  rc </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">hello</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">db</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">rc </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> SQLITE_OK</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">exit</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">sqlite3_close</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">db</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If we re-run CQL and look in the <code>hello.h</code> output file we&#x27;ll see that the declaration of the <code>hello</code> function is now:</p><div class="language-c codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockTitle_YYkX">hello.h</div><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-c codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">extern</span><span class="token plain"> CQL_WARN_UNUSED cql_code </span><span class="token function" style="color:rgb(130, 170, 255)">hello</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sqlite3 </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">_Nonnull _db_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This indicates that the database is used and a SQLite return code is provided.  We&#x27;re nearly there.  If you attempt
to build the program as before there will be several link-time errors due to missing functions.  Typically these
are resolved by providing the SQLite library to the command line and also adding the CQL runtime.
The new command line looks something like this:</p><div class="language-bash codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-bash codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ cc -o hello main.c hello.c cqlrt.c -lsqlite3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ ./hello</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Hello, world</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The cql runtime can be anywhere you want it to be, and of course the usual C separate compilation methods
can be applied. More on that later.</p><p>But actually, that program doesn&#x27;t quite work yet.  If you run it, you&#x27;ll get an error result code, not the message
&quot;Hello, world&quot;.</p><p>Let&#x27;s talk about the final missing bit.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="declaring-schema">Declaring Schema<a class="hash-link" href="#declaring-schema" title="Direct link to heading">​</a></h3><p>In CQL a loose piece of Data Definition Language (henceforth DDL) does not actually create or drop anything.
In most CQL programs the normal situation is that &quot;something&quot; has already created the database and put some
data in it.  You need to tell the CQL compiler about the schema so that it knows what the tables are and what to
expect to find in those tables.  This is because typically you&#x27;re reconnecting to some sort of existing database.
So, in CQL, loose DDL simply <em>declares</em> schema, it does not create it.  To create schema you have to put the DDL
into a procedure you can run.  If you do that, then the DDL still serves a declaration, but also the schema will be
created when the procedure is executed.</p><p>We need to change our program a tiny bit.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockTitle_YYkX">hello.sql</div><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- needed to allow vararg calls to C functions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">procedure</span><span class="token plain"> printf </span><span class="token keyword" style="font-style:italic">no</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">check</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> hello</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> my_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">t </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> my_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">values</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Hello, world\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> t </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> t :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> my_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;%s&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">drop</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> my_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If we rebuild the program, it will now behave as expected.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="explaining-the-new-hello-world">Explaining The New Hello World<a class="hash-link" href="#explaining-the-new-hello-world" title="Direct link to heading">​</a></h3><p>Let&#x27;s go over every important line of the new program, starting from main.</p><div class="language-c codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-c codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> rc </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">sqlite3_open</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;:memory:&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">db</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This statement gives us an empty, private, in-memory only database to work with.  This is the simplest case
and it&#x27;s still very useful.  The <code>sqlite_open</code> and <code>sqlite_open_v2</code> functions can be used to create a variety of
databases per the SQLite documentation.</p><p>We&#x27;ll need such a database to use our procedure, and we use it in the call here:</p><div class="language-c codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-c codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">rc </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">hello</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">db</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This provides a valid db handle to our procedure.  Note that the procedure doesn&#x27;t know what database it is
supposed to operate on, it expects to be handed a suitable database on a silver platter.  In fact any given proc
could be used with various databases at various times.  Just like SQLite, CQL does not enforce any particular
database setup; it does what you tell it to.</p><p>When <code>hello</code> runs we begin with</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> my_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">t </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This will create the <code>my_data</code> table with a single column <code>t</code>, of type <code>text not null</code>.  That will work because
we know we&#x27;re going to call this with a fresh/empty database.  More typically you might do <code>create table if not exists ...</code> or otherwise have a general attach/create phase or something to that effect.  We&#x27;ll dispense with that here.</p><p>Next we&#x27;ll run the insert statement:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> my_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">values</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Hello, world\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This will add a single row to the table.  Note that we have again used double quotes, meaning that this is a C string literal.  This is highly convenient given the escape sequences.  Normally SQLite text has the newlines directly embedded in it; that practice isn&#x27;t very compiler friendly, hence the alternative.</p><p>Next we declare a local variable to hold our data:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> t </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Then, we can read back our data:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> t :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> my_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This form of database reading has very limited usability but it does work for this case and it is illustrative.
The presence of <code>(select ...)</code> indicates to the CQL compiler that the parenthesized expression should be given to
SQLite for evaluation according to the SQLite rules.  The expression is statically checked at compile time to
ensure that it has exactly one result column. In this case the <code>*</code> is just column <code>t</code>, and actually it would have
been clearer to use <code>t</code> directly here but then there wouldn&#x27;t be a reason to talk about <code>*</code> and multiple columns.
At run time, the <code>select</code> query must return exactly one row or an error code will be returned.  It&#x27;s not uncommon
to see <code>(select ... limit 1)</code> to force the issue.  But that still leaves the possibility of zero rows, which would
be an error.  We&#x27;ll talk about more flexible ways to read from the database later.</p><blockquote><p>You can declare a variable and assign it in one step with the <code>LET</code> keyword, e.g.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">let t :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> my_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The code would normally be written in this way but for discussion purposes, these examples continue to avoid <code>LET</code>.</p></blockquote><p>At this point it seems wise to bring up the unusual expression evaluation properties of CQL.
CQL is by necessity a two-headed beast.  On the one side there is a rich expression evaluation language for
working with local variables. <!-- -->[What about the other side?]<!-- --> Those expressions are compiled into C logic that emulates the behavior of SQLite
on the data.  It provides complex expression constructs such as <code>IN</code> and <code>CASE</code> but it is ultimately evaluated by C
execution.  Alternately, anything that is inside of a piece of SQL is necessarily evaluated by SQLite itself.
To make this clearer let&#x27;s change the example a little bit before we move on.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> t :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;__&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">||</span><span class="token plain">t</span><span class="token operator" style="color:rgb(137, 221, 255)">||</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27; &#x27;</span><span class="token operator" style="color:rgb(137, 221, 255)">||</span><span class="token number" style="color:rgb(247, 140, 108)">1.234</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> my_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This is a somewhat silly example but it illustrates some important things:</p><ul><li>even though SQLite doesn&#x27;t support double quotes, that&#x27;s no problem because CQL will convert the expression into single quotes with the correct escape values as a matter of course during compilation</li><li>the <code>||</code> concatenation operator is evaluated by SQLite</li><li>you can mix and match both kinds of string literals, they will all be the single quote variety by the time SQLite sees them</li><li>the <code>||</code> operator has lots of complex formatting conversions (such as converting real values to strings)</li><li>in fact the conversions are so subtle as to be impossible to emulate in loose C code with any economy, so, like a few other operators, <code>||</code> is only supported in the SQLite context</li></ul><p>Returning now to our code as written, we see something very familiar:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;%s&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note that we&#x27;ve used the single quote syntax here for no good reason other than illustration. There are no escape
sequences here so either form would do the job. Importantly, the string literal will not create a string object as before
but the text variable <code>t</code> is of course a string reference.  Before it can be used in a call to an un-declared function it
must be converted into a temporary C string.  This might require allocation in general, that allocation is automatically
managed.</p><p>Also, note that CQL assumes that calls to &quot;no check&quot; functions should be emitted as written.  In this way you can use
<code>printf</code> even though CQL knows nothing about it.</p><p>Lastly we have:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">drop</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> my_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This is not strictly necessary because the database is in memory anyway and the program is about to exit but there
it is for illustration.</p><p>Now the Data Manipulation Language (i.e. insert and select here; and henceforth DML) and the DDL might fail for various reasons.  If that happens the proc will <code>goto</code> a cleanup handler and return the failed return code instead of running the rest of the code.  Any temporary memory allocations will be freed and any pending
SQLite statements will be finalized.  More on that later when we discuss error handling.</p><p>With that we have a much more complicated program that prints &quot;Hello, world&quot;</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="introducing-cursors">Introducing Cursors<a class="hash-link" href="#introducing-cursors" title="Direct link to heading">​</a></h3><p>In order to read data with reasonable flexibility, we need a more powerful construction.
Let&#x27;s change our example again and start using some database features.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">procedure</span><span class="token plain"> printf </span><span class="token keyword" style="font-style:italic">no</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">check</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> hello</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> my_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pos </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">primary</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    txt </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> my_data </span><span class="token keyword" style="font-style:italic">values</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;World&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> my_data </span><span class="token keyword" style="font-style:italic">values</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;Hello&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> my_data </span><span class="token keyword" style="font-style:italic">values</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;There&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> my_data </span><span class="token keyword" style="font-style:italic">order</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">by</span><span class="token plain"> pos</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">loop</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;%d: %s\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">pos</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">txt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">close</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">drop</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> my_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Reviewing the essential parts of the above.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> my_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  pos </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">primary</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  txt </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The table now includes a position column to give us some ordering.  That is the primary key.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> my_data </span><span class="token keyword" style="font-style:italic">values</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;World&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The insert statements provide both columns, not in the printed order.  The insert form where the columns are not
specified indicates that all the columns will be present, in order; this is more economical to type.  CQL will generate errors at compile time if there are any missing columns or if any of the values are not type compatible with the indicated column.</p><p>The most important change is here:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> my_data </span><span class="token keyword" style="font-style:italic">order</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">by</span><span class="token plain"> pos</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We&#x27;ve created a non-scalar variable <code>C</code>, a cursor over the indicated result set.  The results will be ordered by <code>pos</code>.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">loop</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This loop will run until there are no results left (it might not run at all if there are zero rows, that is not an error).
The <code>FETCH</code> construct allows you to specify target variables, but if you do not do so, then a synthetic structure is
automatically created to capture the projection of the <code>select</code>.  In this case the columns are <code>pos</code> and <code>txt</code>.
The automatically created storage exactly matches the type of the columns in the select list which could itself be tricky to calculate
if the <code>select</code> is complex.  In this case the <code>select</code> is quite simple and the columns of the result directly match the schema for <code>my_data</code>.
An integer and a string reference.  Both not null.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;%d: %s\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">pos</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">txt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The storage for the cursor is given the same names as the columns of the projection of the select, in this case the columns were not renamed so <code>pos</code> and <code>txt</code> are the fields in the cursor.
Double quotes were used in the format string to get the newline in there easily.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">close</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The cursor is automatically released at the end of the procedure but in this case we&#x27;d like to release it before the
<code>drop table</code> happens so there is an explicit <code>close</code>. This is frequently elided in favor of the automatic cleanup.
There is an <code>open</code> cursor statement as well but it doesn&#x27;t do anything.  It&#x27;s there because many systems have that
construct and it does balance the <code>close</code>.</p><p>If you compile and run this program, you&#x27;ll get this output:</p><div class="language-bash codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-bash codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ cc -x c -E hello.sql </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> cql --cg hello.h hello.c</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ cc -o hello main.c hello.c cqlrt.c -lsqlite3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ ./hello</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain">: Hello</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain">: There</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain">: World</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>So the data was inserted and then sorted.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="going-crazy">Going Crazy<a class="hash-link" href="#going-crazy" title="Direct link to heading">​</a></h3><p>We&#x27;ve only scratched the surface of what SQLite can do and most DML constructs are supported by CQL.
This includes common table expressions, and even recursive versions of the same. But remember, when it
comes to DML, the CQL compiler only has to validate the types and figure out what the result shape will be --
SQLite always does all the heavy lifting of evaluation. All of this means with remarkably little additional code,
the example below from the SQLite documentation can be turned into a CQL stored proc using the constructs
we have defined above.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- needed to allow vararg calls to C functions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">procedure</span><span class="token plain"> printf </span><span class="token keyword" style="font-style:italic">no</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">check</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> mandelbrot</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- this is basically one giant select statement</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">with</span><span class="token plain"> recursive</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- x from -2.0 to +1.2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      xaxis</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">2.0</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">union</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">all</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0.05</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> xaxis </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1.2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- y from -1.0 to +1.0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      yaxis</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">1.0</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">union</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">all</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> y </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0.1</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> yaxis </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> y </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1.0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      m</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">iter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> cx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> cy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- initial seed iteration count 0, at each of the points in the above grid</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> iter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> x cx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> y cy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0.0</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0.0</span><span class="token plain"> y </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> xaxis</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> yaxis</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">union</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">all</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- the next point is always iter +1, same (x,y) and the next iteration of z^2 + c</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> iter</span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> iter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> cx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> cy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> x</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">x</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">y</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">y </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> cx x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2.0</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">x</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">y </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> cy y </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> m</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- stop condition, the point has escaped OR iteration count &gt; 28</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">m</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">x</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">m</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">x </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> m</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">y</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">m</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">4.0</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">and</span><span class="token plain"> m</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">iter </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">28</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      m2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">iter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> cx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> cy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- find the last iteration for any given point to get that count</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">max</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">iter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> cx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> cy </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> m </span><span class="token keyword" style="font-style:italic">group</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">by</span><span class="token plain"> cx</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> cy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- convert the iteration count to a printable character, grouping by line</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> group_concat</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">substr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot; .+*#&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">min</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">iter</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token number" style="color:rgb(247, 140, 108)">7</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> m2 </span><span class="token keyword" style="font-style:italic">group</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">by</span><span class="token plain"> cy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- group all the lines together</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> rtrim</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> line </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- slurp out the data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">loop</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;%s\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">line</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This code uses all kinds of SQLite features to produce this text:</p><div class="language-bash codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-bash codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                   </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#*..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">+</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">####+.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.+</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">####....   +</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                           </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">##+*##########+.++++</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                          .+.</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">##################+.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.+</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">###################+.+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#.....*#####################+.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">             </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.+</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#######++#######################.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">+*</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">################################.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#############################################...</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">+*</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">################################.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">             </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.+</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#######++#######################.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#.....*#####################+.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.+</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">###################+.+</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                          .+.</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">##################+.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                           </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">##+*##########+.++++</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">.+</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">####....   +</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token plain">+</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">####+.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                   </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#*..</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token punctuation" style="color:rgb(199, 146, 234)">..</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                    +.</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Which probably doesn&#x27;t come up very often but it does illustrate several things:</p><ul><li><code>WITH RECURSIVE</code> actually provides a full lambda calculus so arbitrary computation is possible</li><li>You can use <code>WITH RECURSIVE</code> to create table expressions that are sequences of numbers easily, with no reference to any real data</li></ul><p>Note:</p><ul><li>A working version of this code can be found in the <code>sources/demo</code> directory of CG/SQL project.</li><li>Additional demo code is available in <a href="https://cgsql.dev/cql-guide/x10" target="_blank" rel="noopener noreferrer">Appendix 10</a>.</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="chapter-3-expressions-literals-nullability-sensitivity">Chapter 3: Expressions, Literals, Nullability, Sensitivity<a class="hash-link" href="#chapter-3-expressions-literals-nullability-sensitivity" title="Direct link to heading">​</a></h2><p>Until this point we&#x27;ve only discussed simple kinds of expressions as well as variables and table columns marked with <code>NOT NULL</code>. These are indeed the easiest types for CQL to work with as they tend to correspond most directly to the types known to C.  However,
SQL provides for many more types of expressions as well as nullable types and these require handling in any language that purports to be like SQL.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="expression-examples">Expression Examples<a class="hash-link" href="#expression-examples" title="Direct link to heading">​</a></h3><p>The usual arithmetic operators apply in CQL:</p><p>Example expressions (these are all true)</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">(1 + 2) * 3 == 9</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">1 + 2 * 3 == 7</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">6 / 3 == 2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">7 - 5 == 2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">6 % 5 == 1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">5 / 2.5 == 2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">7 &amp; 3 == 2 | 1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">1 &lt;&lt; 2 == 4</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>However, before going any further it&#x27;s important to note that CQL is inherently a two-headed beast.  Expressions are either evaluated by transpiling to C (like the predicate of an IF statement, or a variable assignment) or by sending them to SQLIte for evaluation (like expressions inside a <code>SELECT</code> statement or the <code>WHERE</code> part of a <code>DELETE</code>).</p><p>CQL evaluation rules are designed to be as similar as possible but some variance is inevitable because evaluation is done in two fundamentally different ways.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="operator-precedence">Operator Precedence<a class="hash-link" href="#operator-precedence" title="Direct link to heading">​</a></h3><p>The operator precedence rules in CQL are as follows; the top-most rule binds the most loosely and the bottom-most rule binds the most tightly:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">ASSIGNMENT:     :=</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">LOGICAL_OR:     OR</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">LOGICAL_AND:    AND</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">LOGICAL_NOT:    NOT</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">EQUALITY:       = == != &lt;&gt;  IS [NOT], [NOT] IN, [NOT] LIKE,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                [NOT] MATCH, [NOT] GLOB, [NOT] BETWEEN</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">INEQUALITY:     &lt;  &lt;=  &gt;  &gt;=</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">BINARY:         &lt;&lt; &gt;&gt; &amp; |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ADDITION:       + -</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">MULTIPLICATION: * / %</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">CONCAT:         ||</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">COLLATE:        COLLATE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">UNARY:          ~  -</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The above rules are <strong>not</strong> the same as C&#x27;s operator precedence rules! Instead,
CQL follows SQLite&#x27;s rules. Parentheses are emitted in the C output as needed to
force that order.</p><p><strong>NOTE:</strong> CQL emits minimal parentheses in all outputs. Different parentheses
are often needed for SQL output as opposed to C output.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="order-of-evaluation">Order of Evaluation<a class="hash-link" href="#order-of-evaluation" title="Direct link to heading">​</a></h3><p>In contrast to C, CQL guarantees a left-to-right order of evaluation for
arguments. This applies both to arguments provided to the operators mentioned in
the previous section as well as arguments provided to procedures.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="variables-columns-basic-types-and-nullability">Variables, Columns, Basic Types and Nullability<a class="hash-link" href="#variables-columns-basic-types-and-nullability" title="Direct link to heading">​</a></h3><p>CQL needs type information for both variables in the code and columns in the database.
Like SQL, CQL allows variables to hold a NULL value and just as in SQL the absence
of <code>NOT NULL</code> implies that <code>NULL</code> is a legal value. Consider these examples:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- real code should use better names than this :)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> all_the_nullables</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  i1 </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  b1 </span><span class="token keyword" style="font-style:italic">bool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  l1 long</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  r1 </span><span class="token keyword" style="font-style:italic">real</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  t1 </span><span class="token keyword" style="font-style:italic">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  bl1 </span><span class="token keyword" style="font-style:italic">blob</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> i2 </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> b2 </span><span class="token keyword" style="font-style:italic">bool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> l2 long</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> r2 </span><span class="token keyword" style="font-style:italic">real</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> t2 </span><span class="token keyword" style="font-style:italic">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> bl2 </span><span class="token keyword" style="font-style:italic">blob</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>ALL of <code>i1</code>, <code>i2</code>, <code>b1</code>, <code>b2</code>, <code>l1</code>, <code>l2</code>, <code>r1</code>, <code>r2</code>, <code>t1</code>, <code>t2</code>, and <code>bl1</code>, <code>bl2</code> are nullable.
In some sense variables and columns declared nullable (by virtue of the missing <code>NOT NULL</code>) are the
root sources of nullability in the SQL language.  That and the <code>NULL</code> literal.  Though there are other
sources as we will see.</p><p><code>NOT NULL</code> could be added to any of these, e.g.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- real code should use better names than this :)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> i_nn </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the context of computing the types of expressions, CQL is statically typed and so it must make a decision about the type of any expression based on the type information at hand at compile time.  As a result it handles the static type of an expression conservatively.  If the result might be null then the expression is of a nullable type and the compiled code will include an affordance for the possibility of a null value at runtime.</p><p>The generated code for nullable types is considerably less efficient and so it should be avoided if that is reasonably possible.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="let-statement">LET Statement<a class="hash-link" href="#let-statement" title="Direct link to heading">​</a></h4><p>You can declare and initialize a variable in one step using the <code>LET</code> form, e.g.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">LET x :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The named variable is declared to be the exact type of the expression on the right.  More on expressions in the coming sections.  The right side is often a constant
in these cases but does not need to be.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">LET i :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- integer not null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">LET l :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain">L</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- long not null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">LET t :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;x&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- text not null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">LET b :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- bool not null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">LET b :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- bool (maybe not null depending on x/y)</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The psuedo function &quot;nullable&quot; removes <code>not null</code> from the type of its argument but otherwise does no computation.
This can be useful to initialize nullable types.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">LET n_i :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> nullable</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- nullable integer variable initialized to 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">LET n_l :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> nullable</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain">L</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- nullable long variable initialized to 1</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The psuedo function &quot;sensitive&quot; adds <code>@sensitive</code> to the type of its argument but otherwise does no computation.
This also can be useful to initialize nullable types.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">LET s_i :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> sensitive</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- sensitive nullable integer variable initialized to 1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">LET s_l :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> sensitive</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain">L</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- sensitive nullable long variable initialized to 1</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-rc-special-variable">The <code>@RC</code> special variable<a class="hash-link" href="#the-rc-special-variable" title="Direct link to heading">​</a></h4><p>CQL also has the special built-in variable <code>@RC</code> which refers to the most recent error code returned by a SQLite operation, e.g. 0 == <code>SQLITE_OK</code>, 1 == <code>SQLITE_ERROR</code>.   <code>@RC</code> is of type <code>integer not null</code>.  Specifically:</p><ul><li>each catch block captures the error code when it is entered into its own local variable</li><li>this variable is created lazily, so it only exists if it is used<ul><li>the variable is called <code>_rc_thrown_n</code> where n is the catch block number in the procedure</li></ul></li><li>any reference to <code>@RC</code> refers to the above error variable of the innermost catch block the <code>@RC</code> reference is in</li><li>if the <code>@RC</code> reference happens outside of any catch block its value is <code>SQLITE_OK</code> (i.e. zero).</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="types-of-literals">Types of Literals<a class="hash-link" href="#types-of-literals" title="Direct link to heading">​</a></h3><p>There are a number of literal objects that may be expressed in CQL.  These are as follows:</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="string-literals">String Literals<a class="hash-link" href="#string-literals" title="Direct link to heading">​</a></h4><ul><li>A double quoted string is a C style string literal<ul><li>the usual simple C escape sequences are supported</li><li>the \xNN form for embedded hex characters is supported, however</li><li>the \0NNN octal form is not supported, and</li><li>embedded nulls in string literals (\0 or \0x00) are not supported (you must use blobs in such cases)</li></ul></li><li>a single quoted string is a SQL style string literal<ul><li>No escape sequences are supported other than <code>&#x27;&#x27;</code> to indicate a single quote character (this is just like normal SQLite)</li></ul></li><li>The sequence @FILE(&quot;some_string&quot;) is a special string literal<ul><li>the value of this literal is the path of the current compiland starting at the letters in <code>some_string</code>, or</li><li>the entire path of the current compiland if <code>some_string</code> does not occur in the path</li><li>the purpose of the <code>@FILE</code> construct is to provide a partial path to a file for diagnostics that is consistent even if the file is built in various different root paths on different build machines</li></ul></li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="blob-literals">Blob Literals<a class="hash-link" href="#blob-literals" title="Direct link to heading">​</a></h4><ul><li>SQLite Blob literals are supported in SQL contexts (i.e. where they will be processed by SQLite), CQL produces an error if you attempt to use a blob literal in a loose expression</li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="numeric-literals">Numeric Literals<a class="hash-link" href="#numeric-literals" title="Direct link to heading">​</a></h4><ul><li>All numeric literals are considered to be positive; negative numbers are actually a positive literal combined with unary minus (the negation operator)</li><li>Base 10 and hexadecimal literals are supported</li><li>Literals with a decimal point are of type <code>REAL</code> and stored as the C type <code>double</code></li><li>Literals that can fit in a signed integer without loss, and do not end in the letter <code>L</code> are integer literals</li><li>Larger literals, or those ending with the letter <code>L</code> are long integer literals.</li><li>Literals that begin with 0x are interpreted as hex</li></ul><p>Examples:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token number" style="color:rgb(247, 140, 108)">1.3</span><span class="token plain">            </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- real</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain">L             </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- long</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token number" style="color:rgb(247, 140, 108)">123456789123</span><span class="token plain">   </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- long</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token number" style="color:rgb(247, 140, 108)">123</span><span class="token plain">            </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- integer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token number" style="color:rgb(247, 140, 108)">0x10</span><span class="token plain">           </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- hex integer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain">x10L          </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- hex long integer</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-null-literal">The NULL literal<a class="hash-link" href="#the-null-literal" title="Direct link to heading">​</a></h4><p>The use of <code>NULL</code> always gives a nullable result however this literal is special in that it has no storage class. <code>NULL</code> is neither numeric nor string itself but rather mutates into
whatever it is first combined with.   For instance <code>NULL + 1</code> results in a nullable integer.  Because <code>NULL</code> has no primitive type in some cases where type knowledge
is required you might have to use the CAST() function to cast the NULL to a specific type such as <code>CAST(NULL as TEXT)</code>.   This construct guarantees type consistence in cases like <code>SELECT</code> from different sources combined with <code>UNION ALL</code></p><p>Note:  constructs like <code>CAST(NULL as TEXT)</code> are always rewritten to just <code>NULL</code> before going to SQLite as the cast is uninteresting except for the type information which SQLite doesn&#x27;t need/use anyway.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="other-considerations">Other Considerations<a class="hash-link" href="#other-considerations" title="Direct link to heading">​</a></h4><p>There are no boolean literals other than the integers <code>0</code> and <code>1</code>.</p><p>The C pre-processor is often combined with CQL in which case the <code>_FILE_</code> and <code>_LINE_</code> directives may be used to create literals; they will be preprocessed into normal literals.</p><p>The use of <code>_FILE_</code> can give surprising results in the presence of build systems, hence the existence of <code>@FILE(...)</code>.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="const-and-enumerations">Const and Enumerations<a class="hash-link" href="#const-and-enumerations" title="Direct link to heading">​</a></h3><p>It&#x27;s possible to use named constants in CQL with nothing more than the C pre-processor features that have already appeared,
however use of #define in such a way is not entirely satisfactory.  For one thing, CQL will not know these constants
exist in any way as they will be replaced before it ever sees them.  This means CQL can&#x27;t provide their values for you
in the JSON output for instance.</p><p>To help with this problem, CQL includes constants, note, this is not the same as enumerated types as we&#x27;ll
see later.  You can now write something like this:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">enum</span><span class="token plain"> business_type </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  restaurant</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  laundromat</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  corner_store </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">11</span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* math added for demo purposes only */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>After this enum is declared, this:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> business_type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">corner_store</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>is the same as this:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">14</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And that is exactly what SQLite will see, the literal <code>14</code>.</p><p>You can also use the enum to define column types:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> businesses </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">name  </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">type</span><span class="token plain">  business_type</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>CQL will then enforce that you use the correct enum to access those columns. For example, this is valid:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> businesses </span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">type</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> business_type</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">laundromat</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>While this does not type check:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> businesses </span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">type</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> business_corp_state</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">delaware</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Enumerations follow these rules:</p><ul><li>the enumeration can be any numeric type (bool, integer, long integer, real)</li><li>the values of the enumeration start at 1 (i.e. if there is no <code>= expression</code> the first item will be <code>1</code>, not <code>0</code>)</li><li>if you don&#x27;t specify a value, the next value is the previous value plus one</li><li>if you do specify a value it can be any constant expression and it will be cast to the type of the enumeration (even if that is lossy)</li><li>the enumeration can refer to previous values in itself with no qualification <code>(big = 100.0, medium = big/2, small = medium/2)</code></li><li>the enumeration can refer to previously defined enumerations as usual <code>(code = business_type.restaurant)</code></li><li>once the enumeration is defined you refer to its members in a fully qualified fashion <code>enum_name.member_name</code> elsewhere</li></ul><p>With these forms you get some additional useful output:</p><ul><li>the JSON includes the enumerations and their values in their own section</li><li>you can use the <code>@emit_enums</code> directive to put declarations like this into the <code>.h</code> file that corresponds to the current compiland</li></ul><div class="language-c codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-c codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">enum</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">business_type</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  business_type__restaurant </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  business_type__laundromat </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  business_type__corner_store </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">14</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note that C does not allow for floating point enumerations, so in case of floating point values such as:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">enum</span><span class="token plain"> floating </span><span class="token keyword" style="font-style:italic">real</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  one </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1.0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  two </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2.0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  e </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2.71828</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  pi </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3.14159</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>you get:</p><div class="language-c codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-c codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// enum floating (floating point values)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">define</span><span class="token macro property"> </span><span class="token macro property macro-name">floating__one</span><span class="token macro property"> </span><span class="token macro property expression number" style="color:rgb(247, 140, 108)">1.000000e+00</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">define</span><span class="token macro property"> </span><span class="token macro property macro-name">floating__two</span><span class="token macro property"> </span><span class="token macro property expression number" style="color:rgb(247, 140, 108)">2.000000e+00</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">define</span><span class="token macro property"> </span><span class="token macro property macro-name">floating__e</span><span class="token macro property"> </span><span class="token macro property expression number" style="color:rgb(247, 140, 108)">2.718280e+00</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">define</span><span class="token macro property"> </span><span class="token macro property macro-name">floating__pi</span><span class="token macro property"> </span><span class="token macro property expression number" style="color:rgb(247, 140, 108)">3.141590e+00</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In order to get useful expressions in enumeration values, constant folding and general evaluation was added to the compiler;
these expressions work on any numeric type and the literal null.  The supported operations include:</p><p><code>+</code>, <code>-</code>, <code>*</code>, <code>/</code>, <code>%</code>, <code>|</code>, <code>&amp;</code>, <code>&lt;&lt;</code>, <code>&gt;&gt;</code>, <code>~</code>, <code>and</code>, <code>or</code>, <code>not</code>, <code>==</code>, <code>&lt;=</code>, <code>&gt;=</code>, <code>!=</code>, <code>&lt;</code>, <code>&gt;</code>, the <code>cast</code> operator
and the <code>case</code> forms (including the <code>iif</code> function).  These are enough to make a lot of very interesting expressions, all of
which are evaluated at compile time.</p><p>Constant folding was added to allow for rich <code>enum</code> expressions, but there is also the <code>const()</code> primitive in the
language which can appear anywhere a literal could appear.  This allows you do things like:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> something</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  x </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">default</span><span class="token plain"> const</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;&lt;</span><span class="token number" style="color:rgb(247, 140, 108)">16</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token number" style="color:rgb(247, 140, 108)">0xf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/*  again the math is just for illustration */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>const</code> form is also very useful in macros:</p><div class="language-c codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-c codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">define</span><span class="token macro property"> </span><span class="token macro property macro-name">SOMETHING</span><span class="token macro property"> </span><span class="token macro property expression keyword" style="font-style:italic">const</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token macro property expression number" style="color:rgb(247, 140, 108)">12</span><span class="token macro property expression operator" style="color:rgb(137, 221, 255)">+</span><span class="token macro property expression number" style="color:rgb(247, 140, 108)">3</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This form ensures that the constant will be evaluated at compile time. The <code>const</code> psuedo-function can also nest
so you can build these kinds of macros from other macros or you can build enum values this way.
Anywhere you might need literals, you can use <code>const</code>.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="named-types">Named Types<a class="hash-link" href="#named-types" title="Direct link to heading">​</a></h3><p>A common source of errors in stored procedures is incorrect typing in arguments.  For instance, a particular key
for an entity might need to be <code>LONG</code> or even always <code>LONG NOT NULL</code> or <code>LONG NOT NULL @SENSITIVE</code> and the only
way to do this in the past was maybe with some <code>#define</code> thing.  Otherwise you have to diligently get the type right
in all the places, and should it ever change, again you have to visit all the places.   To help with this situation,
and to make the code a little more self-describing we added named types to the language.  This is a lot like <code>typedef</code> in
the C language.  They do not create different incompatible types but they do let you name things well.</p><p>You can now write these sorts of forms:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> foo_id </span><span class="token keyword" style="font-style:italic">type</span><span class="token plain"> long </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  id foo_id </span><span class="token keyword" style="font-style:italic">primary</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">key</span><span class="token plain"> autoincrement</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> inserter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">name_ </span><span class="token keyword" style="font-style:italic">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> id foo_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">values</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> name_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> id :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> last_insert_rowid</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> func_return_foo_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> foo_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> var foo_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Additionally any enumerated type can be used as a type name.  e.g.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">enum</span><span class="token plain"> thing </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  thing1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  thing2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> thing_type </span><span class="token keyword" style="font-style:italic">type</span><span class="token plain"> thing</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Enumerations always get &quot;not null&quot; in addition to their base type.  Enumerations also have a unique &quot;kind&quot; associated,
specifically the above enum has type <code>integer&lt;thing&gt; not null</code>.  The rules for type kinds are described below.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="type-kinds">Type Kinds<a class="hash-link" href="#type-kinds" title="Direct link to heading">​</a></h3><p>Any CQL type can be tagged with a &quot;kind&quot; for instance <code>real</code> can become <code>real&lt;meters&gt;</code>, <code>integer</code> can become <code>integer&lt;job_id&gt;</code>.  The idea here is that the additional tag, the &quot;kind&quot; can help prevent type mistakes
in arguments, in columns and in procedure calls.  For instance:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> things</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  size </span><span class="token keyword" style="font-style:italic">real</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">meters</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  duration </span><span class="token keyword" style="font-style:italic">real</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">seconds</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> do_something</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">size_ </span><span class="token keyword" style="font-style:italic">real</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">meters</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> duration_ </span><span class="token keyword" style="font-style:italic">real</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">seconds</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> things</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">size</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> duration</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">values</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">size_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> duration_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this situation you couldn&#x27;t accidentally switch the columns in <code>do_something</code> even though both
are <code>real</code>, and indeed SQLite will only see the type <code>real</code> for both.  If you have your own variables
typed <code>real&lt;size&gt;</code> and <code>read&lt;duration&gt;</code> you can&#x27;t accidentally do:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> do_something</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">duration</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> size</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>even though both are real.  The type kind won&#x27;t match.</p><p>Importantly, an expression with no type kind is compatible with any type kind (or none).  Hence all of
the below are legal.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> generic </span><span class="token keyword" style="font-style:italic">real</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> generic :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> size</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- no kind may accept &lt;meters&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> generic :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> duration</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- no kind may accept &lt;seconds&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> duration :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> generic</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- no kind may be stored in &lt;seconds&gt;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Only mixing types where both have a kind, and the kind is different generates errors.  This choice allows you to
write procedures that (for instance) log any <code>integer</code> or any <code>real</code>, or that return an <code>integer</code> out of a collection.</p><p>These rules are applied to comparisons, assignments, column updates, anywhere and everywhere types are checked for compatibility.</p><p>To get the most value out of these constructs, the authors recommend that type kinds be used universally except
when the extra compatibility described above is needed (like low level helper functions.)</p><p>Importantly, type kind can be applied to object types as well, allowing <code>object&lt;dict&gt;</code> to be distinct from <code>object&lt;list&gt;</code>.</p><p>At run time the kind information is lost. But it does find it&#x27;s way into the JSON output so external tools
also get to see the kinds.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="nullability">Nullability<a class="hash-link" href="#nullability" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_mojV" id="nullability-rules">Nullability Rules<a class="hash-link" href="#nullability-rules" title="Direct link to heading">​</a></h4><p>Nullability is tracked via CQL&#x27;s type system. To understand whether or not an
expression will be assigned a nullable type, you can follow these rules; they
will hopefully be intuitive if you are familiar with SQL:</p><ul><li><p>The literal <code>NULL</code> is, of course, always assigned a nullable type. All other
literals are nonnull.</p></li><li><p>In general, the type of an expression involving an operator (e.g., <code>+</code>, <code>==</code>,
<code>!=</code>, <code>~</code>, <code>LIKE</code>, et cetera) is nullable if any of its arguments are
nullable. For example, <code>1 + NULL</code> is assigned the type <code>INTEGER</code>, implying
nullability. <code>1 + 2</code>, however, is assigned the type <code>INTEGER NOT NULL</code>.</p></li><li><p><code>IN</code> and <code>NOT IN</code> expressions are assigned a nullable type if and only if
their left argument is nullable: The nullability of the right side is
irrelevant. For example, <code>&quot;foo&quot; IN (a, b)</code> will always have the type <code>BOOL NOT
NULL</code>, whereas <code>some_nullable IN (a, b)</code> will have the type <code>BOOL</code>.</p><ul><li><strong>NOTE:</strong> In CQL, the <code>IN</code> operator behaves like a series of equality tests
(i.e., <code>==</code> tests, not <code>IS</code> tests), and <code>NOT IN</code> behaves symmetrically.
SQLite has slightly different nullability rules for <code>IN</code> and <code>NOT IN</code>. <em>This
is the one place where CQL has different evaluation rules from SQLite, by
design.</em></li></ul></li><li><p>The result of <code>IS</code> and <code>IS NOT</code> is always of type <code>BOOL NOT NULL</code>, regardless
of the nullability of either argument.</p></li><li><p>For <code>CASE</code> expressions, the result is always of a nullable type if no <code>ELSE</code>
clause is given. If an <code>ELSE</code> is given, the result is nullable if any of the
<code>THEN</code> or <code>ELSE</code> expressions are nullable.</p><ul><li><strong>NOTE:</strong> The SQL <code>CASE</code> construct is quite powerful: Unlike the C <code>switch</code>
statement, it is actually an expression. In this sense, it is rather more
like a highly generalized ternary <code>a ? b : c</code> operator than a C switch
statement. There can be arbitrarily many conditions specified, each with
their own result, and the conditions need not be constants; typically, they
are not.</li></ul></li><li><p><code>IFNULL</code> and <code>COALESCE</code> are assigned a <code>NOT NULL</code> type if one or more of their
arguments are of a <code>NOT NULL</code> type.</p></li><li><p>In most join operations, the nullability of each column participating in the
join is preserved. However, in a <code>LEFT OUTER</code> join, the columns on the right
side of the join are always considered nullable; in a <code>RIGHT OUTER</code> join, the
columns on the left side of the join are considered nullable.</p></li><li><p>As in most other languages, CQL does not perform evaluation of value-level
expressions during type checking. There is one exception to this rule: An
expression within a <code>const</code> is evaluated at compilation time, and if its
result is then known to be nonnull, it will be given a <code>NOT NULL</code> type. For
example, <code>const(NULL or 1)</code> is given the type <code>BOOL NOT NULL</code>, whereas merely
<code>NULL or 1</code> has the type <code>BOOL</code>.</p></li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="nullability-improvements">Nullability Improvements<a class="hash-link" href="#nullability-improvements" title="Direct link to heading">​</a></h4><p>CQL is able to &quot;improve&quot; the type of some expressions from a nullable type to a
<code>NOT NULL</code> type via occurrence typing, also known as flow typing. There are
three kinds of improvements that are possible:</p><ul><li><p>Positive improvements, i.e., improvements resulting from the knowledge that
some condition containing one or more <code>AND-</code>linked <code>IS NOT NULL</code> checks must
have been <em>true</em>:</p><ul><li><p><code>IF</code> statements:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> a </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">x </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `a` and `c.x` are not null here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">ELSE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> b </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `b` is not null here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p><code>CASE</code> expressions:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CASE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">WHEN</span><span class="token plain"> a </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">x </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `a` and `c.x` are not null here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">WHEN</span><span class="token plain"> b </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `b` is not null here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">ELSE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p><code>IIF</code> expressions:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">IIF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">x </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `a` and `c.x` are not null here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p><code>SELECT</code> expressions:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `t.x` and `t.y` are not null here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> t</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> y </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul></li><li><p>Negative improvements, i.e., improvements resulting from the knowledge that
some condition containing one or more <code>OR</code>-linked <code>IS NULL</code> checks must have
been <em>false</em>:</p><ul><li><p><code>IF</code> statements:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> a </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">ELSE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">x </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `a` is not null here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">ELSE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `a` and `c.x` are not null here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p><code>IF</code> statements, guard pattern:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> a </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">RETURN</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `a` is not null here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">x </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  THROW</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `a` and `c.x` are not null here</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p><code>CASE</code> expressions:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CASE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">WHEN</span><span class="token plain"> a </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">WHEN</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">x </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `a` is not null here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">ELSE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `a` and `c.x` are not null here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p><code>IIF</code> expressions:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">IIF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">x </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `a` and `c.x` are not null here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul></li><li><p>Assignment improvements, i.e., improvements resulting from the knowledge that
the right side of a statement (or a portion therein) cannot be <code>NULL</code>:</p><ul><li><p><code>SET</code> statements:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SET</span><span class="token plain"> a :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">42</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `a` is not null here</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><p><strong>NOTE:</strong> Assignment improvements from <code>FETCH</code> statements are not currently
supported. This may change in a future version of CQL.</p></li></ul><p>There are several ways in which improvements can cease to be in effect:</p><ul><li><p>The scope of the improved variable or cursor field has ended:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> a </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">x </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `a` and `c.x` are not null here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `a` and `c.x` are nullable here</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>An improved variable was <code>SET</code> to a nullable value:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> a </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `a` is not null here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">SET</span><span class="token plain"> a :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> some_nullable</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `a` is nullable here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>An improved variable was used as an <code>OUT</code> (or <code>INOUT</code>) argument:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> a </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `a` is not null here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> some_procedure_that_requires_an_out_argument</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `a` is nullable here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>An improved variable was used as a target for a <code>FETCH</code> statement:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> a </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `a` is not null here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">FETCH</span><span class="token plain"> c </span><span class="token keyword" style="font-style:italic">INTO</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `a` is nullable here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>An improved cursor field was re-fetched:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">x </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `c.x` is not null here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">FETCH</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `c.x` is nullable here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>A procedure call was made (which removes improvements from <em>all globals</em>
because the procedure may have mutated any of them; locals are unaffected):</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> a </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> some_global </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `a` and `some_global` are not null here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> some_procedure</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `a` is still not null here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `some_global` is nullable here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><p>CQL is generally smart enough to understand the control flow of your program and
infer nullability appropriately; here are a handful of examples:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> some_condition </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">SET</span><span class="token plain"> a :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">42</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">ELSE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  THROW</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `a` is not null here because it must have been set to 42</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- if we&#x27;ve made it this far</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> some_condition </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">SET</span><span class="token plain"> a :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">42</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">ELSE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">SET</span><span class="token plain"> a :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">100</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `a` is not null here because it was set to a value of a</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `NOT NULL` type in all branches and the branches cover</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- all of the possible cases</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> a </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> some_condition </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">SET</span><span class="token plain"> a :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">ELSE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `a` is not null here despite the above `SET` because</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- CQL understands that, if we&#x27;re here, the previous</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- branch must not have been taken</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> a </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">WHILE</span><span class="token plain"> some_condition</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `x` is nullable here despite `a IS NOT NULL` because</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `a` was set to `NULL` later in the loop and thus `x`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- will be `NULL` when the loop repeats</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    LET x :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">SET</span><span class="token plain"> a :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here are some additional details to note regarding conditions:</p><ul><li><p>For positive improvements, the check must be exactly of the form <code>IS NOT
NULL</code>; other checks that imply a variable or cursor field must not be null
when true have no effect:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> a </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">42</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `a` is nullable here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>NOTE:</strong> This may change in a future version of CQL.</p></li><li><p>For multiple positive improvements to be applied from a single condition, they
must be linked by <code>AND</code> expressions along the outer spine of the condition;
uses of <code>IS NOT NULL</code> checks that occur as subexpressions within anything
other than <code>AND</code> have no effect:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> b </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"> c </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `a`, `b`, and `c` are all nullable here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>For negative improvements, the check must be exactly of the form <code>IS NULL</code>;
other checks that imply a variable or cursor field must not be null when false
have no effect:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> equal_to_null </span><span class="token keyword" style="font-style:italic">INT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> a </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> equal_to_null </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">ELSE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `a` is nullable here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li><li><p>For multiple negative improvements to be applied from a single condition, they
must be linked by <code>OR</code> expressions along the outer spine of the condition;
uses of <code>IS NULL</code> checks that occur as subexpressions within anything other
than <code>OR</code> have no effect:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"> b </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> c </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">ELSE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `a`, `b`, and `c` are all nullable here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="forcing-nonnull-types">Forcing Nonnull Types<a class="hash-link" href="#forcing-nonnull-types" title="Direct link to heading">​</a></h4><p>If possible, it is best to use the techniques described in &quot;Nullability
Improvements&quot; to verify that the value of a nullable type is nonnull before using it
as such.</p><p>Sometimes, however, you may know that a value with a nullable type cannot be
null and simply wish to use it as though it were nonnull.  The <code>ifnull_crash</code>
and <code>ifnull_throw</code> &quot;attesting&quot; functions convert the type of an expression to be
nonnull and ensure that the value is nonnull with a runtime check.  They cannot
be used in SQLite contexts because the functions are not known to SQLite, but
they can be used in loose expressions. For example:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> square_if_odd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">INT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">OUT</span><span class="token plain"> result </span><span class="token keyword" style="font-style:italic">INT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> a </span><span class="token operator" style="color:rgb(137, 221, 255)">%</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">SET</span><span class="token plain"> result :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">ELSE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">SET</span><span class="token plain"> result :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> a </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `x` has type `INT`, but we know it can&#x27;t be `NULL`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">let x :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> square_if_odd</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `y` has type `INT NOT NULL`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">let y :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> ifnull_crash</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Above, the <code>ifnull_crash</code> attesting function is used to coerce the expression
<code>x</code> to be of type <code>INT NOT NULL</code>. If our assumptions were somehow wrong,
however—and <code>x</code> were, in fact, <code>NULL</code>—our program would crash.</p><p>As an alternative to crashing, you can use <code>ifnull_throw</code>. The following two
pieces of code are equivalent:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> y_is_not_null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x </span><span class="token keyword" style="font-style:italic">INT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  let y :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> ifnull_throw</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> y_is_not_null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x </span><span class="token keyword" style="font-style:italic">INT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> y </span><span class="token keyword" style="font-style:italic">INT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">SET</span><span class="token plain"> y :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">ELSE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    THROW</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="expression-types">Expression Types<a class="hash-link" href="#expression-types" title="Direct link to heading">​</a></h3><p>CQL supports a variety of expressions, nearly everything from the SQLite world.  The following are the various supported operators; they are presented in order from the weakest binding strength to the strongest.
Note that the binding order is NOT the same as C, and in some cases it is radically different (e.g. boolean math)</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="union-and-union-all">UNION and UNION ALL<a class="hash-link" href="#union-and-union-all" title="Direct link to heading">​</a></h4><p>These appear only in the context of <code>SELECT</code> statements.  The arms of a compound select may include <code>FROM</code>, <code>WHERE</code>, <code>GROUP BY</code>, <code>HAVING</code>, and <code>WINDOW</code>.  If <code>ORDER BY</code> or <code>LIMIT ... OFFSET</code> are present, these apply to the entire UNION.</p><p>example:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> A</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">x x </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> A </span><span class="token keyword" style="font-style:italic">inner</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">join</span><span class="token plain"> B </span><span class="token keyword" style="font-style:italic">using</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">z</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">union</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">all</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">x x </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> C</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>WHERE</code> applies only to the second select in the union.  And each <code>SELECT</code> is evaluated before the the <code>UNION ALL</code></p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> A</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">x x </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> A </span><span class="token keyword" style="font-style:italic">inner</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">join</span><span class="token plain"> B </span><span class="token keyword" style="font-style:italic">using</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">z</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">union</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">all</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">x x </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> C</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">order</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">by</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>ORDER BY</code> applies to the result of the union, so any results from the 2nd branch will sort before any results from the first branch (because <code>x</code> is constrained in both).</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="assignment">Assignment<a class="hash-link" href="#assignment" title="Direct link to heading">​</a></h4><p>Assignment only occurs in the <code>UPDATE</code> statement or in the <code>SET</code> statement.  In both cases the left side
is a simple target and the right side is a general expression.  The expression is evaluated before the assignment.</p><p>example:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SET</span><span class="token plain"> x :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- + before AND then :=</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="logical-or">Logical OR<a class="hash-link" href="#logical-or" title="Direct link to heading">​</a></h4><p>The logical <code>OR</code> operator does shortcut evaluation, much like the C <code>||</code> operator (not to be confused with SQL&#x27;s concatenation operator with the same lexeme).</p><p>The truth table for logical <code>OR</code> is as follows:</p><table><thead><tr><th align="center">A</th><th align="center">B</th><th align="center">A OR B</th></tr></thead><tbody><tr><td align="center">0</td><td align="center">0</td><td align="center">0</td></tr><tr><td align="center">0</td><td align="center">1</td><td align="center">1</td></tr><tr><td align="center">0</td><td align="center">NULL</td><td align="center">NULL</td></tr><tr><td align="center">1</td><td align="center">0</td><td align="center">1</td></tr><tr><td align="center">1</td><td align="center">1</td><td align="center">1</td></tr><tr><td align="center">1</td><td align="center">NULL</td><td align="center">1</td></tr><tr><td align="center">NULL</td><td align="center">0</td><td align="center">NULL</td></tr><tr><td align="center">NULL</td><td align="center">1</td><td align="center">1</td></tr><tr><td align="center">NULL</td><td align="center">NULL</td><td align="center">NULL</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_mojV" id="logical-and">Logical AND<a class="hash-link" href="#logical-and" title="Direct link to heading">​</a></h4><p>The logical <code>AND</code> operator does shortcut evaluation, much like the C <code>&amp;&amp;</code> operator, so if the left side is zero the result is 0 and the right side is not evaluated.</p><p>The truth table for logical <code>AND</code> is as follows:</p><table><thead><tr><th align="center">A</th><th align="center">B</th><th align="center">A AND B</th></tr></thead><tbody><tr><td align="center">0</td><td align="center">0</td><td align="center">0</td></tr><tr><td align="center">0</td><td align="center">1</td><td align="center">0</td></tr><tr><td align="center">0</td><td align="center">NULL</td><td align="center">0</td></tr><tr><td align="center">1</td><td align="center">0</td><td align="center">0</td></tr><tr><td align="center">1</td><td align="center">1</td><td align="center">1</td></tr><tr><td align="center">1</td><td align="center">NULL</td><td align="center">NULL</td></tr><tr><td align="center">NULL</td><td align="center">0</td><td align="center">0</td></tr><tr><td align="center">NULL</td><td align="center">1</td><td align="center">NULL</td></tr><tr><td align="center">NULL</td><td align="center">NULL</td><td align="center">NULL</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_mojV" id="between-and-not-between">BETWEEN and NOT BETWEEN<a class="hash-link" href="#between-and-not-between" title="Direct link to heading">​</a></h4><p>These are ternary operators.  The general forms are:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  expr1 </span><span class="token operator" style="color:rgb(137, 221, 255)">BETWEEN</span><span class="token plain"> expr2 </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> expr3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  expr1 </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">BETWEEN</span><span class="token plain"> expr2 </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> expr3</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note that there is an inherent ambiguity in the language because <code>expr2</code> or <code>expr3</code> could be logical expressions that include <code>AND</code>. CQL resolves this ambiguity by insisting that <code>expr2</code> and <code>expr3</code> be &quot;math expressions&quot; in the grammar.  These expressions may not have ungrouped <code>AND</code> or <code>OR</code> operators.</p><p>Examples::</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- oh hell no (syntax error)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">a </span><span class="token operator" style="color:rgb(137, 221, 255)">between</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">and</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">and</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- all ok</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">a </span><span class="token operator" style="color:rgb(137, 221, 255)">between</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">and</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">and</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">a </span><span class="token operator" style="color:rgb(137, 221, 255)">between</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">and</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">and</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">a </span><span class="token operator" style="color:rgb(137, 221, 255)">between</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">and</span><span class="token plain"> b </span><span class="token operator" style="color:rgb(137, 221, 255)">between</span><span class="token plain"> c </span><span class="token operator" style="color:rgb(137, 221, 255)">and</span><span class="token plain"> d</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- binds left to right</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">a </span><span class="token operator" style="color:rgb(137, 221, 255)">between</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">and</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">12</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="logical-not">Logical NOT<a class="hash-link" href="#logical-not" title="Direct link to heading">​</a></h4><p>The one operand of logical <code>NOT</code> must be a numeric.  <code>NOT &#x27;x&#x27;</code> is illegal.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="non-ordering-tests-----like-glob-match-regexp-in-is-is-not">Non-ordering tests <code>!=</code>, <code>&lt;&gt;</code>, <code>=</code>, <code>==</code>, <code>LIKE</code>, <code>GLOB</code>, <code>MATCH</code>, <code>REGEXP</code>, <code>IN</code>, <code>IS</code>, <code>IS NOT</code><a class="hash-link" href="#non-ordering-tests-----like-glob-match-regexp-in-is-is-not" title="Direct link to heading">​</a></h4><p>These operations do some non-ordered comparison of their two operands.</p><ul><li><code>IS</code> and <code>IS NOT</code> never return <code>NULL</code>,  So for instance <code>X IS NOT NULL</code> gives the natural answer.  <code>x IS y</code> is true if and only if: 1. both <code>x</code> and <code>y</code> are <code>NULL</code> or 2. if they are equal.</li><li>The other operators return <code>NULL</code> if either operand is <code>NULL</code> and otherwise perform their usual test to produce a boolean</li><li><code>!=</code> and <code>&lt;&gt;</code> are equivalent as are <code>=</code> and <code>==</code></li><li>strings and blobs compare equal based on their value, not their identity (i.e. not the string/blob pointer)</li><li>objects compare equal based on their address, not their content (i.e. reference equality)</li><li><code>MATCH</code>, <code>GLOB</code>, and <code>REGEXP</code> are only valid in SQL contexts, <code>LIKE</code> can be used in any context (a helper method to do <code>LIKE</code> in C is provided by SQLite, but not the others)</li><li><code>MATCH</code>, <code>GLOB</code>, <code>REGEXP</code>, <code>LIKE</code>, and <code>IN</code> may be prefixed with <code>NOT</code> which reverses their value</li></ul><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- this is true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- this is also true because NULL == NULL is not 1, it&#x27;s NULL.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- this is also true because NULL != NULL is not 0, it&#x27;s also NULL.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;xy&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">LIKE</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;z%&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">`</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- this is true</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="ordering-comparisons----">Ordering comparisons &lt;, &gt;, &lt;=, &gt;=<a class="hash-link" href="#ordering-comparisons----" title="Direct link to heading">​</a></h4><p>These operators do the usual order comparison of their two operands.</p><ul><li>If either operand is <code>NULL</code> the result is <code>NULL</code></li><li>Objects and Blobs may not be compared with these operands</li><li>Strings are compared based on their value (as with other comparisons) not their address</li><li>Numerics are compared as usual with the usual promotion rules</li></ul><p>NOTE: CQL uses <code>strcmp</code> for string comparison. In SQL expressions the comparison happens in whatever way SQLite has been configured. Typically general purpose string comparison should be done with helper functions that deal with collation and other considerations.  This is a very complex topic and CQL is largely silent on it.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="bitwise-operators----">Bitwise operators &lt;&lt;, &gt;&gt;, &amp;, |<a class="hash-link" href="#bitwise-operators----" title="Direct link to heading">​</a></h4><p>These are the bit-manipulation operations.  Their binding strength is VERY different than C so beware.
And notably the <code>&amp;</code> operator has the same binding strength as the <code>|</code> operator so they bind left to right,
which is utterly unlike most systems.  Many parentheses are likely to be needed to get the usual &quot;or of ands&quot; patterns codified correctly.  Likewise, the shift operators <code>&lt;&lt;</code> and <code>&gt;&gt;</code> are the same strength as <code>&amp;</code> and <code>|</code> which is very atypical. Consider:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">x </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">7</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- probably doesn&#x27;t mean what you think (this is not ambiguous, it&#x27;s well defined, but unlike C)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">7</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">   </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- means the same as the above</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">x </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">7</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">   </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- probably what you intended</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note that these operators only work on integer and long integer data.  If any operand is <code>NULL</code> the result is `NULL.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="addition-and-subtraction---">Addition and Subtraction +, -<a class="hash-link" href="#addition-and-subtraction---" title="Direct link to heading">​</a></h4><p>These operators do the typical math.  Note that there are no unsigned numerics so it&#x27;s always signed math that is happening here.</p><ul><li>operands are promoted to the &quot;biggest&quot; type involved as previously described (bool -&gt; int -&gt; long -&gt; real)</li><li>only numeric operands are legal (no adding strings)</li><li>if any operand is <code>NULL</code> the result is <code>NULL</code></li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="multiplication-division-modulus---">Multiplication, Division, Modulus *, /, %<a class="hash-link" href="#multiplication-division-modulus---" title="Direct link to heading">​</a></h4><p>These operators do the typical math.  Note that there are no unsigned numerics so it&#x27;s always signed math that is happening here.</p><ul><li>operands are promoted to the &quot;biggest&quot; type as previously described (bool -&gt; int -&gt; long -&gt; real)</li><li>only numeric operands are legal (no multiplying strings)</li><li>if any operand is <code>NULL</code> the result is <code>NULL</code></li></ul><p>EXCEPTION: the <code>%</code> operator doesn&#x27;t make sense on real values, so real values produce an error.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="unary-operators---">Unary operators -, ~<a class="hash-link" href="#unary-operators---" title="Direct link to heading">​</a></h4><p>Unary negation (<code>-</code>) and bitwise invert (<code>~</code>) are the strongest binding operators.</p><ul><li>The <code>~</code> operator only works on integer types (not text, not real)</li><li>the usual promotion rules otherwise apply</li><li>if the operand is <code>NULL</code> the result is <code>NULL</code></li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="case-expressions">CASE Expressions<a class="hash-link" href="#case-expressions" title="Direct link to heading">​</a></h3><p>The <code>case</code> expression has two major forms and provides a great deal of flexibility in an expression.  You can kind of think of it as the C <code>?:</code> operator on steroids.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> x :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;y&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">case</span><span class="token plain"> x</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">when</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;y&#x27;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">when</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;z&#x27;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this form the <code>case</code> expression (<code>x</code> here) is evaluated exactly once and then compared against each <code>when</code> clause. Every <code>when</code> clause must be type compatible with the <code>case</code> expression.  The <code>then</code> expression that corresponds to the matching <code>when</code> is evaluated and becomes the result. If no <code>when</code> matches then the <code>else</code> expression is used.  If there is no <code>else</code> and no matching <code>when</code> then the result is <code>null</code>.</p><p>If that&#x27;s not general enough, there is an alternate form:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> y :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;yy&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> z :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;z&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">case</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">when</span><span class="token plain"> y </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;y&#x27;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">when</span><span class="token plain"> z </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;z&#x27;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The second form, where there is no value before the first <code>when</code> keyword, each <code>when</code> expression is a separate independent boolean expression.  The first one that evaluates to true causes the corresponding <code>then</code> to be evaluated and that becomes the result.  As before, if there is no matching <code>when</code> clause then the result is the <code>else</code> expression if present, or <code>null</code> if there is no <code>else</code>.</p><p>The result types must be compatible and the best type to hold the answer is selected with the usual promotion rules.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="select-expressions">SELECT expressions<a class="hash-link" href="#select-expressions" title="Direct link to heading">​</a></h4><p>Single values can be extracted from SQLite using an inline <code>select</code> expression.  For instance:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> x_ :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> x </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> somewhere </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The select statement in question must extract exactly one column and the type of the expression becomes the type of the column.  This form can appear
anywhere an expression can appear, though it is most commonly used in assignments.  Something like this would also be valid:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> x </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> somewhere </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The select statement can of course be arbitrarily complex.</p><p>Note, if the select statement returns no rows this will result in the normal error flow.  In that case, the error code will be SQLITE_DONE, which is treated like an
error because in this context SQLITE_ROW is expected as a result of the select.  This is not a typical error code and can be quite surprising to callers. If you&#x27;re
seeing this failure mode it usually means the code had no affordance for the case where there were no rows and probably that situation should have been handled.
This is an easy mistake to make, so to avoid it, CQL also supports these more tolerant forms:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> x_ :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> x </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> somewhere </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> nothing </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And even more generally if the schema allows for null vales and those are not desired:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> x_ :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> x </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> somewhere </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> nothing </span><span class="token operator" style="color:rgb(137, 221, 255)">or</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Both of these are much safer to use as only genuine errors (e.g. the table was dropped and no longer exists) will result in the error control flow.</p><p>Again note that:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> x_ :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> ifnull</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> somewhere </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Would not avoid the SQLITE_DONE error code, because no rows returned is not at all the same as a null value returned.</p><p>The <code>if nothing or null</code> form above is equivalent to the following, but it is more economical, and probably clearer:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> x_ :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> ifnull</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> somewhere </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> nothing </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To compute the type of the overall expression, the rules are almost the same as normal binary operators.  In particular:</p><ul><li>if the default expression is present it must be type compatible with the select result<ul><li>the result type is the smallest type that holds both the select value and the default expression (see normal promotion rules above)</li></ul></li><li>object types are not allowed (SQLite cannot return an object)</li><li>in <code>(select ...)</code> the result type is not null if and only if the select result type is not null (see select statement, many cases)</li><li>in <code>(select ... if nothing)</code> the result type is not null if and only if both the select result and the default expression types are not null (normal binary rules)</li><li>in <code>(select ... if nothing or null)</code> the result type is not null if and only if the default expression type is not null</li></ul><p>Finally, the form  <code>(select ... if nothing throw)</code> is allowed; this form is exactly the same as normal
<code>(select ...)</code> but makes the explicit that the error control flow will happen if there is no row.  Consequently
this form is allowed even if <code>@enforce_strict select if nothing</code> is in force.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="marking-data-as-sensitive">Marking Data as Sensitive<a class="hash-link" href="#marking-data-as-sensitive" title="Direct link to heading">​</a></h3><p>CQL supports the notion of &#x27;sensitive&#x27; data in a first class way.  You can think of it as very much like nullability;  It largely begins by tagging data columns with <code>@sensitive</code></p><p>Rather than go through the whole calculus, it&#x27;s easier to understand by a series of examples.  So let&#x27;s start with a table with some sensitive data.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> with_sensitive</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> name </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@sensitive</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> sens </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@sensitive</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The most obvious thing you might do at this point is create a stored proc that would read data out of that table.  Maybe something like this:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> get_sensitive</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> id </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> not_sensitive_1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        sens </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> sensitive_1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        name </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> sensitive_2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;x&#x27;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> not_sensitive_2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">sens </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> sensitive_3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        sens </span><span class="token operator" style="color:rgb(137, 221, 255)">between</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">and</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> sensitive_4</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> with_sensitive</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>So looking at that procedure we can see that it&#x27;s reading sensitive data, so the result will have some sensitive columns in it.</p><ul><li>the &quot;id&quot; is not sensitive (at least not in this example)</li><li>sens + 1 is sensitive, math on a sensitive field leaves it sensitive</li><li>name is sensitive, it began that way and is unchanged</li><li>&#x27;x&#x27; is just a string literal, it&#x27;s not sensitive</li><li>-sens is sensitive, that&#x27;s more math</li><li>and the between expression is also sensitive</li></ul><p>Generally sensitivity is &quot;radioactive&quot; - anything it touches becomes sensitive.  This is very important because even a simple looking expression like <code>lgbtqia IS NOT NULL</code> must lead to a sensitive result or the whole process would be largely useless.  It has to be basically impossible to wash away sensitivity.<!-- -->[Careful here - this made me think that you believe in the notion that LGBTQIA is something that can/should be washed away...]</p><p>These rules apply to normal expressions as well as expressions in the context of SQL.  Accordingly:</p><p>Sensitive variables can be declared:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> sens </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@sensitive</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Simple operations on the variables are sensitive</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- this is sensitive (and the same would be true for any other math)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sens </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>IN</code> expression gives you sensitive results if anything about it is sensitive</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- all of these are sensitive</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sens </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> sens</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> sens </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> with_sensitive</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Similarly sensitive constructs in <code>CASE</code> expressions result in a sensitive output</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- not sensitive</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">case</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">when</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- all of these are sensitive</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">case</span><span class="token plain"> sens </span><span class="token keyword" style="font-style:italic">when</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">case</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">when</span><span class="token plain"> sens </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">case</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">when</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"> sens </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">case</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">when</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"> sens </span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Cast operations preserve sensitivity</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- sensitive result</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> cast</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sens </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Aggregate functions likewise preserve sensitivity</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- all of these are sensitive</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">AVG</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sens</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> with_sensitive T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">MIN</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sens</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> with_sensitive T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">MAX</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sens</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> with_sensitive T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">SUM</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sens</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> with_sensitive T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">COUNT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sens</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> with_sensitive T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>There are many operators that get similar treatment such as <code>COALESCE</code>, <code>IFNULL</code>, <code>IS</code> and <code>IS NOT</code>.</p><p>Things get more interesting when we come to the <code>EXISTS</code> operator:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- sensitive if and only if any selected column is sensitive</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">exists</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> with_sensitive</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- sensitive because &quot;info&quot; is sensitive</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">exists</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> info </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> with_sensitive</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- not sensitive because &quot;id&quot; is not sensitive</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">exists</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> id </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> with_sensitive</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If this is making you nervous, it probably should, we need a little more protection because of the way EXISTS is typically used.  The predicates matter, consider the following:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- id is now sensitive because the predicate of the where clause was sensitive</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> id </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> with_sensitive </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> sens </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- this expression is now sensitive because id is sensitive in this context</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">exists</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> id </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> with_sensitive </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> sens </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In general: if the predicate of a <code>WHERE</code> or <code>HAVING</code> clause is sensitive then all columns in the result become sensitive.</p><p>Similarly when performing joins, if the column specified in the <code>USING</code> clause is sensitive or the predicate of the <code>ON</code> clause is sensitive then the result of the join is considered to be all sensitive columns (even if the columns were not sensitive in the schema).</p><p>Likewise a sensitive expression in <code>LIMIT</code> or <code>OFFSET</code> will result in 100% sensitive columns as these can be used in a <code>WHERE</code>-ish way.  There is no reasonable defense against using <code>LIMIT</code> and testing for the presence or absence of a row as a way to wash away sensitivity so that is a weakness, but the rules that are present are likely to be very helpful.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- join with ON</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> with_sensitive T1 </span><span class="token keyword" style="font-style:italic">inner</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">join</span><span class="token plain"> with_sensitive T2 </span><span class="token keyword" style="font-style:italic">on</span><span class="token plain"> T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sens </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> T2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">sens</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- join with USING</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> with_sensitive T1 </span><span class="token keyword" style="font-style:italic">inner</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">join</span><span class="token plain"> with_sensitive T2 </span><span class="token keyword" style="font-style:italic">using</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sens</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>All of these expression and join propagations are designed to make it impossible to simply wash-away sensitivity with a little bit of math.</p><p>Now we come to enforcement, which boils down to what assignments or &quot;assignment-like&quot; operations we allow.</p><p>If we have these:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> sens </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@sensitive</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> not_sens </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We can use those as stand-ins for lots of expressions, but the essential calculus goes like this:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- assigning a sensitive to a sensitive is ok</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> sens :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> sens </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- assigning not sensitive data to a sensitive is ok</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- this is needed so you can (e.g.) initialize to zero</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> sens :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> not_sens</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- not ok</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> not_sens :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> sens</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now these &quot;assignments&quot; can happen in a variety of ways:</p><ul><li>you can set an out parameter of your procedure</li><li>when calling a function or procedure, we require:<ul><li>any IN parameters of the target be &quot;assignable&quot; from the value of the argument expression</li><li>any OUT parameters of the target be &quot;assignable&quot; from the procedures type to the argument variable</li><li>any IN/OUT parameters require both the above</li></ul></li></ul><p>Now it&#x27;s possible to write a procedure that accepts sensitive things and returns non-sensitive things.  This is fundamentally necessary because the proc must be able return (e.g.) a success code, or encrypted data, that is not sensitive.  However, if you write the procedure in CQL it, too, will have to follow the assignment rules and so cheating will be quite hard.  The idea here is to make it easy to handle sensitive data well and make typical mistakes trigger errors.</p><p>With these rules  it&#x27;s possible to compute the the type of procedure result sets and also to enforce IN/OUT parameters.  Since the signature of procedures is conveniently generated with --generate_exports good practices are fairly easy to follow and sensitivity checks flow well into your programs.</p><p>This is a brief summary of CQL semantics for reference types -- those types that are ref counted by the runtime.</p><p>The three reference types are:</p><ul><li>TEXT</li><li>OBJECT</li><li>BLOB</li></ul><p>Each of these has their own macro for <code>retain</code> and <code>release</code> though all three actually turn into the exact same code in all the current CQL runtime implementations.  In all cases the object is expected to be promptly freed when the reference count falls to zero.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="reference-semantics">Reference Semantics<a class="hash-link" href="#reference-semantics" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_mojV" id="stored-procedure-arguments">Stored Procedure Arguments<a class="hash-link" href="#stored-procedure-arguments" title="Direct link to heading">​</a></h4><ul><li><code>in</code> and <code>inout</code> arguments are not retained on entry to a stored proc</li><li><code>out</code> arguments are assumed to contain garbage and are nulled without retaining on entry</li><li>if your <code>out</code> argument doesn&#x27;t have garbage in it, then it is up to you do <code>release</code> it before you make a call</li><li>When calling a proc with an <code>out</code> argument CQL will <code>release</code> the argument variable before the call site, obeying its own contract</li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="local-variables">Local Variables<a class="hash-link" href="#local-variables" title="Direct link to heading">​</a></h4><ul><li>assigning to a local variable <code>retains</code> the object, and then does a <code>release</code> on the previous object</li><li>this order is important; all assignments are done in this way in case of aliasing (<code>release</code> first might accidentally free too soon)</li><li>CQL calls <code>release</code> on all local variable when the method exits</li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="assigning-to-an-out-parameter-or-a-global-variable">Assigning to an <code>out</code> parameter or a global variable<a class="hash-link" href="#assigning-to-an-out-parameter-or-a-global-variable" title="Direct link to heading">​</a></h4><ul><li><code>out</code>, <code>inout</code> parameters, and global variables work just like local variables except that CQL does not call <code>release</code> at the end of the procedure</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="function-return-values">Function Return Values<a class="hash-link" href="#function-return-values" title="Direct link to heading">​</a></h3><p>Stored procedures do not return values, they only have <code>out</code> arguments and those are well defined as above.  Functions however are also supported and they can have either <code>get</code> or <code>create</code> semantics</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="get-semantics">Get Semantics<a class="hash-link" href="#get-semantics" title="Direct link to heading">​</a></h4><p>If you declare a function like so:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> Getter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> object</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Then CQL assumes that the returned object should follow the normal rules above, retain/release will balance by the end of the procedure for locals and globals or <code>out</code> arguments could retain the object</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="create-semantics">Create Semantics<a class="hash-link" href="#create-semantics" title="Direct link to heading">​</a></h4><p>If you declare a function like so:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> Getter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>then CQL assumes that the function created a new result which it is now responsible for releasing.  In short, the returned object is assumed to arrive with a retain count of 1 already on it.  When CQL stores this return value it will:</p><ul><li>release the object that was present at the storage location (if any)</li><li>copy the returned pointer without further retaining it this one time</li></ul><p>As a result if you store the returned value in a local variable it will be released when the procedure exits (as usual) or if you instead store the result in a global or an out parameter the result will survive to be used later.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="comparison">Comparison<a class="hash-link" href="#comparison" title="Direct link to heading">​</a></h3><p>CQL tries to adhere to normal SQL comparison rules but with a C twist.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="object"><code>OBJECT</code><a class="hash-link" href="#object" title="Direct link to heading">​</a></h3><p>The object type has no value based comparison, so there is no <code>&lt;</code>, <code>&gt;</code> and so forth.</p><p>The following table is useful.  Let&#x27;s suppose there are exactly two distinct objects &#x27;X&#x27; and &#x27;Y&#x27;</p><p>true expressions: <code>X = X</code>   <code>X &lt;&gt; Y</code> <code>Y = Y</code>   <code>Y &lt;&gt; X</code>  <code>X IN (X, Y)</code>  <code>X NOT IN (Y)</code></p><p>false expressions: <code>X = Y</code>  <code>X &lt;&gt; X</code> <code>Y = X</code>  <code>Y &lt;&gt; Y</code>  <code>X NOT IN (X, Y)</code></p><p>null expressions: <code>null = null</code>  <code> X &lt;&gt; null</code>   <code>x = null</code> <code>null &lt;&gt; null</code>  <code>Y &lt;&gt; null</code>   <code>y = null</code></p><p><code>null = null</code> resulting in <code>null</code> is particular surprising but consistent with the usual SQL rules.  And again, as in SQL, the <code>IS</code> operator returns true for <code>X IS Y</code> even if both are <code>null</code>.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="text"><code>TEXT</code><a class="hash-link" href="#text" title="Direct link to heading">​</a></h3><p>Text has value comparison semantics but normal string comparison is done only with <code>strcmp</code> which is of limited value.  Typically you&#x27;ll want to either delegate the comparison to Sqlite (with <code>(select x &lt; y)</code>) or else use a helper function with a suitable comparison mechanism.</p><p>For text comparisons including equality:</p><p>true:   if and only if both operands are not null and the comparison matches (using strcmp)
false:  if and only if  both operands are not null and the comparison does not match (using strcmp)
null:   if and only if at least one operand is null</p><p>EXAMPLE: <code>&#x27;x&#x27; &lt; &#x27;y&#x27;</code>  is true because <code>strcmp(&quot;x&quot;, &quot;y&quot;) &lt; 0</code></p><p>The <code>IS</code> and <code>IS NOT</code> operators behave similarly to equality and inequality, but never return <code>null</code>.  If <code>X</code> is some value that doesn&#x27;t happen to be <code>null</code> then we have the following:</p><p>true:  <code>null is null</code> <code>X is X</code> <code>X is not null</code> <code>null is not X</code>
false: <code>null is not null</code> <code>X is not X</code> <code>X is null</code> <code>null  is X</code></p><p>The <code>IN</code> and <code>NOT IN</code> operators also work for text using the same value comparisons as above.  Additionally there are special text comparison
operators such as <code>LIKE</code>, <code>MATCH</code> and <code>GLOB</code>.  These comparisons are defined by SQLite.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="blob"><code>BLOB</code><a class="hash-link" href="#blob" title="Direct link to heading">​</a></h3><p>Blobs are compared by value (equivalent to <code>memcmp</code>) but have no well-defined ordering. The <code>memcmp</code> order is deemed not helpful as blobs
usually have internal structure hence the valid comparisons are only equality and inequality.
You can use user defined functions to do better comparisons of your particular blobs if needed.</p><p>The net comparison behavior is otherwise just like strings.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="sample-code">Sample Code<a class="hash-link" href="#sample-code" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_mojV" id="out-argument-semantics">Out Argument Semantics<a class="hash-link" href="#out-argument-semantics" title="Direct link to heading">​</a></h4><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FUNCTION</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> OBJECT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> foo_user </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">OUT</span><span class="token plain"> baz OBJECT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">SET</span><span class="token plain"> baz :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-c codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-c codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">foo_user</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cql_object_ref _Nullable </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">_Nonnull baz</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">baz </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// set out arg to non-garbage</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">cql_set_object_ref</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">baz</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="function-with-create-semantics">Function with Create Semantics<a class="hash-link" href="#function-with-create-semantics" title="Direct link to heading">​</a></h4><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FUNCTION</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> OBJECT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> foo_user </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">INOUT</span><span class="token plain"> baz OBJECT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> x OBJECT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">SET</span><span class="token plain"> x :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">SET</span><span class="token plain"> baz :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-c codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-c codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">foo_user</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cql_object_ref _Nullable </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">_Nonnull baz</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_object_ref x </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">cql_object_release</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  x </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">cql_object_release</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">baz</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">baz </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cql_cleanup</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">cql_object_release</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="function-with-get-semantics">Function with Get Semantics<a class="hash-link" href="#function-with-get-semantics" title="Direct link to heading">​</a></h4><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FUNCTION</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> OBJECT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> foo_user </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">INOUT</span><span class="token plain"> baz OBJECT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> x OBJECT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">SET</span><span class="token plain"> x :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">SET</span><span class="token plain"> baz :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-c codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-c codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">foo_user</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cql_object_ref _Nullable </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">_Nonnull baz</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_object_ref x </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">cql_set_object_ref</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">cql_set_object_ref</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">baz</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cql_cleanup</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">cql_object_release</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="chapter-4-procedures-functions-and-control-flow">Chapter 4: Procedures, Functions, and Control Flow<a class="hash-link" href="#chapter-4-procedures-functions-and-control-flow" title="Direct link to heading">​</a></h2><p>All kinds of control flow happens in the context of some procedure. Though we&#x27;ve already introduced examples of procedures let&#x27;s
now go over some of the additional aspects we have not yet illustrated.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="out-parameters">Out Parameters<a class="hash-link" href="#out-parameters" title="Direct link to heading">​</a></h3><p>Consider this procedure:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">procedure</span><span class="token plain"> echo_integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> arg1 </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> arg2 </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> arg2 :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> arg1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>arg1</code> has been declared <code>in</code>. This is the default: <code>in arg1 integer not null</code>
and <code>arg1 integer not null</code> mean the exact same thing.</p><p><code>arg2</code>, however, has been declared <code>out</code>. When a parameter is declared using
<code>out</code>, arguments for it are passed by reference. This is similar to by-reference
arguments in other languages; indeed, they compile into a simple pointer
reference in the generated C code.</p><p>Given that <code>arg2</code> is passed by reference, the statement <code>set arg2 := arg1;</code>
actually updates a variable in the caller. For example:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> x </span><span class="token keyword" style="font-style:italic">int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">echo_integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">42</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `x` is now 42</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>It is important to note that values cannot be passed <em>into</em> a procedure via an
<code>out</code> parameter. In fact, <code>out</code> parameters are immediately assigned a new value
as soon as the procedure is called:</p><ul><li><p>All nullable <code>out</code> parameters are set to <code>null</code>.</p></li><li><p>Nonnull <code>out</code> parameters of a non-reference type (e.g., <code>integer</code>, <code>long</code>,
<code>bool</code>, et cetera) are set to their default values (<code>0</code>, <code>0.0</code>, <code>false</code>, et
cetera).</p></li><li><p>Nonnull <code>out</code> parameters of a reference type (e.g., <code>blob</code>, <code>object</code>, and
<code>text</code>) are set to <code>null</code> as there are no default values for reference types.
They must, therefore, be assigned a value within the procedure so that they
will not be <code>null</code> when the procedure returns. CQL enforces this.</p></li></ul><p>In addition to <code>in</code> and <code>out</code> parameters, there are also <code>inout</code> parameters.
<code>inout</code> parameters are, as one might expect, a combination of <code>in</code> and <code>out</code>
parameters: The caller passes in a value as with <code>in</code> parameters, but the value
is passed by reference as with <code>out</code> parameters.</p><p><code>inout</code> parameters allow for code such as the following:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">procedure</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">double</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">inout</span><span class="token plain"> arg </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- note that a variable in the caller is both</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- read from and written to</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> arg :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> arg </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> arg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">let x :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">double</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `x` is now four</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="procedure-calls">Procedure Calls<a class="hash-link" href="#procedure-calls" title="Direct link to heading">​</a></h3><p>The usual <code>call</code> syntax is used to invoke a procedure.  It returns no value but it can have any number of <code>out</code> arguments.</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  declare scratch integer not null;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  call echo(12, scratch);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  scratch == 12; -- true</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let&#x27;s go over the most essential bits of control flow.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="the-if-statement">The IF statement<a class="hash-link" href="#the-if-statement" title="Direct link to heading">​</a></h3><p>The CQL <code>IF</code> statement has no syntatic ambiguities at the expense of being somewhat more verbose than many other languages.
In CQL the <code>ELSE IF</code> portion is baked into the <code>IF</code> statement, so what you see below is logically a single statement.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> checker</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">foo </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> result </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> foo </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> result :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> foo </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> result :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> result :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="the-while-statement">The WHILE statement<a class="hash-link" href="#the-while-statement" title="Direct link to heading">​</a></h3><p>What follows is a simple procedure that counts down its input argument.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">procedure</span><span class="token plain"> printf </span><span class="token keyword" style="font-style:italic">no</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">check</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> looper</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">while</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;%d\n&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> x :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>WHILE</code> loop has additional keywords that can be used within it to better control the loop.  A more general
loop might look like this:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">procedure</span><span class="token plain"> printf </span><span class="token keyword" style="font-style:italic">no</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">check</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> looper</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">while</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> x :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token keyword" style="font-style:italic">leave</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">%</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">100</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token keyword" style="font-style:italic">continue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">%</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;%d\n&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let&#x27;s go over this peculiar loop:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">while</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This is an immediate sign that there will be an unusual exit condition.  The loop will never end without one because <code>1</code> will never be false.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token keyword" style="font-style:italic">leave</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now here we&#x27;ve encoded our exit condition a bit strangely: we might have done the equivalent job with a normal condition in the predicate
part of the <code>while</code> statement but for illustration anyway, when x becomes negative <code>leave</code> will cause us to exit the loop.  This is like
<code>break</code> in C.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">%</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">100</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token keyword" style="font-style:italic">continue</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This bit says that on every 100th iteration we go back to the start of the loop.  So the next bit will not run, which is the printing.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">%</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;%d\n&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Finishing up the control flow, on every 10th iteration we print the value of the loop variable.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="the-switch-statement">The SWITCH Statement<a class="hash-link" href="#the-switch-statement" title="Direct link to heading">​</a></h3><p>The  CQL <code>SWITCH</code> is designed to map to the C <code>switch</code> statement for better codegen and also to give us the opportunity to do better error checking.
<code>SWITCH</code> is a <em>statement</em> like <code>IF</code> not an <em>expression</em> like <code>CASE..WHEN..END</code> so it combines with other statements. The general form looks like this:</p><div class="language-SQL codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-SQL codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">SWITCH switch-expression [optional ALL VALUES]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">WHEN expr1, expr2, ... THEN</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  [statement_list]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">WHEN expr3, ... THEN</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  [statement_list]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">WHEN expr4 THEN</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  NOTHING</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ELSE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  [statement_list]</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">END;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>the switch-expression must be a not-null integral type (<code>integer not null</code> or <code>long integer not null</code>)</li><li>the <code>WHEN</code> expressions <!-- -->[expr1, expr2, etc.]<!-- --> are made from constant integer expressions (e.g. <code>5</code>, <code>1+7</code>, <code>1&lt;&lt;2</code>, or <code>my_enum.thing</code>)</li><li>the <code>WHEN</code> expressions must be compatible with the switch expression (long constants cannot be used if the switch expression is an integer)</li><li>the values in the <code>WHEN</code> clauses must be unique (after evaluation)</li><li>within one of the interior statement lists the <code>LEAVE</code> keyword exits the <code>SWITCH</code> prematurely, just like <code>break</code> in C<ul><li>a <code>LEAVE</code> is not required before the next <code>WHEN</code></li><li>there are no fall-through semantics as you can find in <code>C</code>, if fall-through ever comes to <code>SWITCH</code> it will be explicit</li></ul></li><li>if the keyword <code>NOTHING</code> is used after <code>THEN</code> it means there is no code for that case, which is useful with <code>ALL VALUES</code> (see below)</li><li>the <code>ELSE</code> clause is optional and works just like <code>default</code> in <code>C</code>, covering any cases not otherwise explicitly listed</li><li>if you add <code>ALL VALUES</code> then:<ul><li>the expression must be an from an enum type</li><li>the <code>WHEN</code> values must cover every value of the enum<ul><li>enum members that start with a leading <code>_</code> are by convention considered pseudo values and do not need to be covered</li></ul></li><li>there can be no extra <code>WHEN</code> values not in the enum</li><li>there can be no <code>ELSE</code> clause (it would defeat the point of listing <code>ALL VALUES</code> which is to get an error if new values come along)</li></ul></li></ul><p>Some more complete examples:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">let x := get_something();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">switch x</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  when 1,1+1 then -- constant expressions ok</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    set y := &#x27;small&#x27;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    -- other stuff</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  when 3,4,5 then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    set y := &#x27;medium&#x27;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    -- other stuff</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  when 6,7,8 then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    set y := &#x27;large&#x27;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    -- other stuff</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  else</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    set y := &#x27;zomg enormous&#x27;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare enum item integer (</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  pen = 0, pencil, brush,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  paper, canvas,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  _count</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">let x := get_item(); -- returns one of the above</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">switch x all values</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  when item.pen, item.pencil then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     call write_something();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  when item.brush then nothing</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     -- itemize brush but it needs no code</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  when item.paper, item.canvas then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    call setup_writing();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Using <code>THEN NOTHING</code> allows the compiler to avoid emitting a useless <code>break</code> in the C code.  Hence that choice is better/clearer than <code>when brush then leave;</code></p><p>Note that the presence of <code>_count</code> in the enum will not cause an error in the above because it starts with <code>_</code>.</p><p>The <code>C</code> output for this statement will be a direct mapping to a <code>C</code> switch statement.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="the-try-catch-and-throw-statements">The TRY, CATCH, and THROW Statements<a class="hash-link" href="#the-try-catch-and-throw-statements" title="Direct link to heading">​</a></h3><p>This example illustrates catching an error from some DML, and recovering rather than letting the error cascade up.
This is the common &quot;upsert&quot; pattern (insert or update)</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">procedure</span><span class="token plain"> printf </span><span class="token keyword" style="font-style:italic">no</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">check</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">procedure</span><span class="token plain"> upsert_foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id_ </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> t_ </span><span class="token keyword" style="font-style:italic">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"> try</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">values</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> t_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> try</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"> catch</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"> try</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">update</span><span class="token plain"> foo </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> t </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> t_ </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> id_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> try</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"> catch</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Error code %d!\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@rc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      throw</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> catch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> catch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Once again, let&#x27;s go over this section by section:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"> try</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">values</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> t_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> try</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Normally if the <code>insert</code> statement fails, the procedure will exit with a failure result code.  Here, instead,
we prepare to catch that error.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"> catch</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"> try</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">update</span><span class="token plain"> foo </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> t </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> t_ </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> id_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> try</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now, having failed to insert, presumably because a row with the provided <code>id</code> already exists, we try to update
that row instead.  However that might also fail, so we  wrap it in another try.  If the update fails, then there is a final catch block:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"> catch</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Error code %d!\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@rc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      throw</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> catch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here we see a usage of the <code>@rc</code> variable to observe the failed error code.  In this case we simply print a diagnostic message and
then use the <code>throw</code> keyword to rethrow the previous failure (exactly what is stored in <code>@rc</code>).  In general, <code>throw</code> will create a
failure in the current block using the most recent failed result code from SQLite (<code>@rc</code>) if it is an error, or else the general
<code>SQLITE_ERROR</code> result code if there is no such error.  In this case the failure code for the <code>update</code> statement will become the
result code of the current procedure.</p><p>This leaves only the closing markers:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> catch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If control flow reaches the normal end of the procedure it will return <code>SQLITE_OK</code>.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="procedures-as-functions-motivation-and-example">Procedures as Functions: Motivation and Example<a class="hash-link" href="#procedures-as-functions-motivation-and-example" title="Direct link to heading">​</a></h3><p>The calling convention for CQL stored procedures often (usually) requires that the procedure returns a result code from SQLite.
This makes it impossible to write a procedure that returns a result like a function, as the result position is already used for
the error code.  You can get around this problem by using <code>out</code> arguments as your return codes.  So for instance, this version
of the Fibonacci function is possible.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- this works, but it is awkward</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">procedure</span><span class="token plain"> fib </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> arg </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> result </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">arg </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> result :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> t </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> fib</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">arg </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">  result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> fib</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">arg </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">  t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> result :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> t </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The above works, but the notation is very awkward.</p><p>CQL has a &quot;procedures as functions&quot; feature that tries to make this more pleasant by making it possible to use function call notation
on a procedure whose last argument is an <code>out</code> variable.  You simply call the procedure like it was a function and omit the last argument in the call.
A temporary variable is automatically created to hold the result and that temporary becomes the logical return of the function.
For semantic analysis, the result type of the function becomes the type of the <code>out</code> argument.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- rewritten with function call syntax</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">procedure</span><span class="token plain"> fib </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> arg </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> result </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">arg </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> result :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> result :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> fib</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">arg </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> fib</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">arg </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This form is allowed when:</p><ul><li>all but the last argument of the procedure was specified</li><li>the formal parameter for that last argument was marked with <code>out</code> (neither <code>in</code> nor <code>inout</code> are acceptable)</li><li>the procedure does not return a result set using a <code>select</code> statement or <code>out</code> statement (more on these later)</li></ul><p>If the procedure in question uses SQLite, or calls something that uses SQLite, then it might fail.
If that happens the result code will propagate just like it would have with the usual <code>call</code> form.
Any failures can be caught with <code>try/catch</code> as usual.
This feature is really only syntatic sugar for the &quot;awkward&quot; form above, but it does allow for slightly better generated C code.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="chapter-5-types-of-cursors-shapes-out-and-out-union-and-fetch">Chapter 5: Types of Cursors, Shapes, OUT and OUT UNION, and FETCH<a class="hash-link" href="#chapter-5-types-of-cursors-shapes-out-and-out-union-and-fetch" title="Direct link to heading">​</a></h2><p>In the previous chapters we have used cursor variables without fully discussing them.
Most of the uses are fairly self-evident but a more exhaustive discussion is also useful.</p><p>First there are three types of cursors, as we will see below.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="statement-cursors">Statement Cursors<a class="hash-link" href="#statement-cursors" title="Direct link to heading">​</a></h3><p>A statement cursor is based on a SQL <code>SELECT</code> statement.  A full example might look like this:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- elsewhere</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> xy_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> y </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> y </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> xy_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>When compiled, this will result in creating a SQLite statement object (type <code>sqlite_stmt *</code>)
and storing it in a variable called <code>C_stmt</code>.  This statement can then be used later in various ways.</p><p>Here&#x27;s perhaps the simplest way to use the cursor above:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> y </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This will have the effect of reading one row from the results of the query into
the local variables <code>x</code> and <code>y</code>.</p><p>These variables might then be used to create some output such as:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* note use of double quotes so that \n is legal */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;x:%d y:%d\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ifnull</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ifnull</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>More generally, there the cursor may or may not be holding fetched values.
The cursor variable <code>C</code> can be used by itself as a boolean indicating the
presence of a row.  So a more complete example might be</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;x:%d y:%d\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ifnull</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ifnull</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;nada\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And even more generally</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">loop</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> y</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;x:%d y:%d\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ifnull</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ifnull</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The last example above reads all the rows and prints them.</p><p>Now if the table <code>xy_table</code> had instead had dozens of columns, those declarations
would be very verbose and error prone, and frankly annoying, especially if
the table definition was changing over time.</p><p>To make this a little easier, there are so-called &#x27;automatic&#x27; cursors.  These
happen implicitly and include all the necessary storage to exactly match
the rows in their statement.  Using the automatic syntax for the above looks like so:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> xy_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;x:%d y:%d\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ifnull</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ifnull</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>or the equivalent loop form:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> xy_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">loop</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;x:%d y:%d\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ifnull</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ifnull</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>All the necessary local state is automatically created, hence &quot;automatic&quot; cursor.
This pattern is generally preferred, but the loose variables pattern is in
some sense more general.</p><p>In all the cases if the number or type of variables do not match the select statement,
semantic errors are produced.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="value-cursors">Value Cursors<a class="hash-link" href="#value-cursors" title="Direct link to heading">​</a></h3><p>The purpose of value cursors is to make it possible for a stored procedure to
work with structures as a unit rather than only field by field.  SQL doesn&#x27;t have
the notion of structure types, but structures actually appear pretty directly
in many places.  Generally we call these things &quot;Shapes&quot; and there are a variety
of source for shapes including:</p><ul><li>the columns of a table</li><li>the projection of a <code>SELECT</code> statement</li><li>the columns of a cursor</li><li>the result type of a procedure that returns a select</li><li>the arguments of a procedure</li><li>other things derived from the above</li></ul><p>Let&#x27;s first start with how you declare a value cursor.  It is providing one of the
shape sources above.</p><p>So:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> xy_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;x&#x27;</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> my_view</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> my_other_cursor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> my_previously_declared_stored_proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> my_previously_declared_stored_proc arguments</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Any of those forms define a valid set of columns -- a shape.  Note that the
<code>select</code> example in no way causes the query provided to run. Instead, the select
statement is analyzed and the column names and types are computed.  The cursor
gets the same field names and types.  Nothing happens at run time.</p><p>The last two examples assume that there is a stored procedure defined somewhere
earlier in the same translation unit and that the procedure returns a result set
or has arguments, respectively.</p><p>In all cases the cursor declaration makes a cursor that could hold the indicated result.
That result can then be loaded with <code>FETCH</code> or emitted with <code>OUT</code> or <code>OUT UNION</code> which
will be discussed below.</p><p>Once we have declared a value cursor we can load it with values using <code>FETCH</code> in its
value form. Here are some examples:</p><p>Fetch from compatible values:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">values</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Fetch from a call to a procedure that returns a single row:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> my_previously_declared_stored_proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Fetch from another cursor:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> D</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this last case if D is a statement cursor it must also be &quot;automatic&quot; (i.e. it has
the storage).  This form lets you copy a row and save it for later.  For instance, in
a loop you could copy the current max-value row into a value cursor and use it after
the loop, like so:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> somewhere</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> D </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">loop</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> D </span><span class="token operator" style="color:rgb(137, 221, 255)">or</span><span class="token plain"> D</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">something </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">something</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> D </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>After the loop, D either empty because there were no rows (thus <code>if D</code> would fail)
or else it has the row with the maximum value of <code>something</code>, whatever that is.</p><p>Value cursors are always have their own storage, so you could say all value cursors
are &quot;automatic&quot;.</p><p>And as we saw above, value cursors may or may not be holding a row.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> xy_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;this will always print because C starts empty\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>When you call a procedure you may or may not get a row as we&#x27;ll see below.</p><p>The third type of cursor is a &quot;result set&quot; cursor but that won&#x27;t make any sense
until we&#x27;ve discussed result sets a little which requires <code>OUT</code> and/or <code>OUT UNION</code>
and so we&#x27;ll go on to those statements next.  As it happens, we are recapitulating
the history of cursor features in the CQL language by exploring the system in this way.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="benefits-of-using-named-typed-to-declare-a-cursor">Benefits of using named typed to declare a cursor<a class="hash-link" href="#benefits-of-using-named-typed-to-declare-a-cursor" title="Direct link to heading">​</a></h4><p>This form allows any kind of declaration, for instance:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare C cursor like ( id integer not null, val real, flag boolean );</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This wouldn&#x27;t really give us much more than the other forms, however typed name lists can include LIKE in them again, as part of the list.  Which means you can do this kind of thing:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare C cursor like (like D, extra1 real, extra2 bool)</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You could then load that cursor like so:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">fetch C from values (from D, 2.5, false);</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>and now you have D plus 2 more fields which maybe you want to output.</p><p>Importantly this way of doing it means that C always includes D, even if D changes over time.  As long as the <code>extra1</code> and <code>extra2</code> fields don&#x27;t conflict names it will always work.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="out-statement">OUT Statement<a class="hash-link" href="#out-statement" title="Direct link to heading">​</a></h3><p>Value cursors were initially designed to create a convenient way for
a procedure to return a single row from a complex query
without having a crazy number of <code>OUT</code> parameters.  It&#x27;s easiest
to illustrate this with an example.</p><p>Suppose you want to return several variables, the &quot;classic&quot; way to do so
would be a procedure like this:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> get_a_row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  id_ </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> got_row </span><span class="token keyword" style="font-style:italic">bool</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> w </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> x </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> y </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> z </span><span class="token keyword" style="font-style:italic">real</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> w</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> z </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> somewhere </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> id_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> w</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> z</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> got_row :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This is already verbose, but you can imagine the situation gets very annoying
if <code>get_a_row</code> has to produce a couple dozen column values.  And of course you
have to get the types exactly right. And they might evolve over time.  Joy.</p><p>On the receiving side you get to do something just as annoying:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> w </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> x </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> y </span><span class="token keyword" style="font-style:italic">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> z </span><span class="token keyword" style="font-style:italic">real</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> got_row </span><span class="token keyword" style="font-style:italic">bool</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> get_a_row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> got_row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> w</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> z</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Using the <code>out</code> statement we get the equivalent functionality with a much
simplified pattern. It looks like this:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> get_a_row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id_ </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> w</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> z </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> somewhere </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> id_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To use the new procedure you simply do this:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> get_a_row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> get_a_row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In fact, originally you did the two steps above in one statement and that was the
only way to load a value cursor. Later, the calculus was generalized. The original
form still works:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> get_a_row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>OUT</code> statement lets you return a single row economically and
lets you then test if there actually was a row and if so, read the columns.
It infers all the various column names and types so it is resilient
to schema change and generally a lot less error prone than having a
large number of <code>out</code> arguments to your procedure.</p><p>Once you have the result in a value cursor you can do the usual
cursor operations to move it around or otherwise work with it.</p><p>The use of the <code>LIKE</code> keyword to refer to groups of columns spread
to other places in CQL as a very useful construct, but it began here
with the need to describe a cursor shape economically, by reference.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="out-union-statement">OUT UNION Statement<a class="hash-link" href="#out-union-statement" title="Direct link to heading">​</a></h3><p>The semantics of the <code>OUT</code> statement are that it always produces one row
of output (a procedure can produce no row if an <code>out</code> never actually rans
but the procedure does use <code>OUT</code>).</p><p>If an <code>OUT</code> statement runs more than once, the most recent row becomes the
result.  So the <code>OUT</code> statement really does mirror having one <code>out</code> variable
for each output column.  This was its intent and procedures that return at most,
or exactly, one row are very common so it works well enough.</p><p>However, in general, one row results do not suffice; you might want to produce a
result set from various sources, possibly with some computation as part of
the row creation process.  To make general results, you need to be able to emit
multiple rows from a computed source.  This is exactly what <code>OUT UNION</code> provides.</p><p>Here&#x27;s a (somewhat contrived) example of the kind of thing you can do with this form:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">n </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  let i :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">while</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> n</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- emit one row for every integer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">values</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">union</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> i :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In <code>foo</code> above, we make an entire result set out of thin air.  It isn&#x27;t a very
interesting result, but of course any computation would have been possible.</p><p>This pattern is very flexible as we see below in <code>bar</code> where
we merge two different data streams.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> stuff </span><span class="token keyword" style="font-style:italic">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">other things too</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> stuff </span><span class="token keyword" style="font-style:italic">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">other things too</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> t1 </span><span class="token keyword" style="font-style:italic">order</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">by</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> D </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> t2 </span><span class="token keyword" style="font-style:italic">order</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">by</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> D</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- we&#x27;re going to merge these two queries</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">while</span><span class="token plain"> C </span><span class="token operator" style="color:rgb(137, 221, 255)">or</span><span class="token plain"> D</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- if both have a row pick the smaller id</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> C </span><span class="token operator" style="color:rgb(137, 221, 255)">and</span><span class="token plain"> D </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> D</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         </span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">union</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         </span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">union</span><span class="token plain"> D</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> D</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       </span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- only C has a row, emit that</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">union</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- only D has a row, emit that</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">union</span><span class="token plain"> D</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> D</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Just like <code>foo</code>, in <code>bar</code>, each time <code>OUT UNION</code> runs a new row is accumulated.</p><p>Now, if you build a procedure that ends with a <code>SELECT</code> statement CQL automatically
creates a fetcher function that does something like an <code>OUT UNION</code> loop -- it loops
over the SQLite statement for the <code>SELECT</code> and fetches each row, materializing a result.</p><p>With <code>OUT UNION</code> you take manual control of this process, allowing you to build arbitrary
result sets.  Note that either of <code>C</code> or <code>D</code> above could have been modified, replaced,
skipped, normalized, etc. with any kind of computation.  Even entirely synthetic rows can
be computed and inserted into the output as we saw in <code>foo</code>.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="result-set-cursors">Result Set Cursors<a class="hash-link" href="#result-set-cursors" title="Direct link to heading">​</a></h3><p>Now that we have <code>OUT UNION</code> it makes sense to talk about the final type of cursor.</p><p><code>OUT UNION</code> makes it possible to create arbitrary result sets using a mix of sources
and filtering.  Unfortunately this result type is not a simple row, nor is it a SQLite
statement.  This meant that neither of the existing types of cursors could hold the
result of a procedure that used <code>OUT UNION</code>. -- CQL could not itself consume its own
results.</p><p>To address this hole, we need an additional cursor type.  The syntax is exactly the same
as the statement cursor cases described above but, instead of holding a SQLite statement,
the cursor holds a result set pointer and the current and maximum row numbers.
Stepping through the cursor simply increments the row number and fetches the next row
out of the rowset instead of from SQLite.</p><p>Example:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- reading the above</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> reader</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">loop</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;%d %s\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">stuff</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- or whatever fields you need</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If <code>bar</code> had been created with a <code>SELECT</code>, <code>UNION ALL</code>, and <code>ORDER BY</code> to merge the
results, the above would have worked with <code>C</code> being a standard statement cursor,
iterating over the union. Since <code>foo</code> produces a result set, CQL transparently produces
a suitable cursor implementation behind the scenes, but otherwise the usage is the same.</p><p>Note this is a lousy way to simply iterate over rows; you have to materialize the entire
result set so that you can just step over it.  Re-consuming like this is not recommended
at all for production code, but it is ideal for testing result sets that were made with
<code>OUT UNION</code> which otherwise would require C/C++ to test.  Testing CQL with CQL is
generally a lot easier.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="reshaping-data-cursor-like-forms">Reshaping Data, Cursor <code>LIKE</code> forms<a class="hash-link" href="#reshaping-data-cursor-like-forms" title="Direct link to heading">​</a></h3><p>There are lots of cases where you have big rows with many columns, and there are various manipulations you might need to do.</p><p>What follows is a set of useful syntactic sugar constructs that simplify handling
complex rows.  The idea is that pretty much anywhere you can specify a list of columns
you can instead use the <code>LIKE x</code> construct to get the columns as they appear in the
shape <code>x</code> -- which is usually a table or a cursor.</p><p>It’s a lot easier to illustrate with examples, even though these are, again, a bit contrived.</p><p>First we need some table with lots of columns -- usually the column names are much bigger which makes it all the more important to not have to type them over and over, but
in the interest of some brevity, here&#x27;s a big table:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> big </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">primary</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  id2 </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">unique</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  a </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  b </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  c </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  d </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  e </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  f </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This example showcases several of the cursor and shape slicing features by emitting
two related rows:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id_ </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- this is the shape of the result we want -- it&#x27;s some of the columns of &quot;big&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- note this query doesn&#x27;t run, we just use its shape to create a cursor</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- with those columns.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> result </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> d </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> big</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- fetch the main row, specified by id_</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- main row has all the fields, including id2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> main_row </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> big </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> id_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> main_row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- now fetch the result columns out of the main row</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- &#x27;like result&#x27; means &quot;the column names found in &#x27;result&#x27;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> result </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> main_row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- this is our first result row</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">union</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- now we want the related row, but we only need two columns</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- from the related row, &#x27;b&#x27; and &#x27;c&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> alt_row </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> c </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> big </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> big</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id2 </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> main_row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> alt_row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- update some of the fields &#x27;result&#x27; from the the new cursor</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">update</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> alt_row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> alt_row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- and emit the 2nd row</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">union</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now let&#x27;s briefly discuss what is above.  The two essential parts are:</p><p><code>fetch result from cursor main_row(like result);</code></p><p>and</p><p><code>update cursor result(like alt_row) from cursor alt_row;</code></p><p>In the first case what we&#x27;re saying is that we want to load the columns
of <code>result</code> from <code>main_row</code> but we only want to take the columns that are
actually present in <code>result</code>.  So this is a narrowing of a wide row into a
smaller row.  In this case, the smaller row, <code>result</code>, is what we want to emit.
We needed the other columns to compute <code>alt_row</code>.</p><p>The second case, what we&#x27;re saying is that we want to update <code>result</code> by
replacing the columns found in <code>alt_row</code> with the values in <code>alt_row</code>.
So in this case we&#x27;re writing a smaller cursor into part of a wider cursor.
Note that we used the <code>update cursor</code> form here because it preserves all other
columns.  If we used <code>fetch</code> we would be rewriting the entire row contents,
using <code>NULL</code> if necessary, and that is not desired here.</p><p>Here is the rewritten version of the above procedure; this is what ultimately gets
compiled into C.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> foo </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id_ </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> result </span><span class="token keyword" style="font-style:italic">CURSOR</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">LIKE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> d </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> big</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> main_row </span><span class="token keyword" style="font-style:italic">CURSOR</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FOR</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> big </span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> id_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">FETCH</span><span class="token plain"> main_row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">FETCH</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> d</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">VALUES</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">main_row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> main_row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> main_row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> main_row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">d</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">OUT</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">UNION</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> alt_row </span><span class="token keyword" style="font-style:italic">CURSOR</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FOR</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> c </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> big </span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"> big</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id2 </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> main_row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">FETCH</span><span class="token plain"> alt_row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">UPDATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">CURSOR</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">VALUES</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">alt_row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> alt_row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">OUT</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">UNION</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Of course you could have typed the above directly but if there are 50 odd columns it
gets old fast and is very error prone.  The sugar form is going to be 100% correct
and will require much less typing and maintenance.</p><p>Finally, while I&#x27;ve shown both <code>LIKE</code> forms separately, they can also be used together.  For instance:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">update</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> X</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> D</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> X</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The above would mean, &quot;move the columns that are found in <code>X</code> from cursor <code>D</code> to cursor <code>C</code>&quot;, presuming <code>X</code> has columns common to both.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="fetch-statement-specifics">Fetch Statement Specifics<a class="hash-link" href="#fetch-statement-specifics" title="Direct link to heading">​</a></h3><p>Many of the examples used the <code>FETCH</code> statement in a sort of demonstrative way that is
hopefully self-evident but the statement has many forms and so it&#x27;s worth going over
them specifically.  Below we&#x27;ll use the letters <code>C</code> and <code>D</code> for the names of cursors.  Usually <code>C</code>;</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="fetch-with-statement-or-result-set-cursors">Fetch with Statement or Result Set Cursors<a class="hash-link" href="#fetch-with-statement-or-result-set-cursors" title="Direct link to heading">​</a></h4><p>A cursor declared in one of these forms:</p><ul><li><code>declare C cursor for select * from foo;</code></li><li><code>declare C cursor for call foo();</code>  (foo might end with a <code>select</code> or use <code>out union</code>)</li></ul><p>is either a statement cursor or a result set cursor.  In either case the cursor moves
through the results.  You load the next row with:</p><ul><li><code>FETCH C</code>, or</li><li><code>FETCH C into x, y, z;</code></li></ul><p>In the first form <code>C</code> is said to be <em>automatic</em> in that it automatically declares the storage needed to hold all its columns.  As mentioned above, automatic cursors have
storage for their row.</p><p>Having done this fetch you can use C as a scalar variable to see if it holds a row, e.g.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> foo </span><span class="token keyword" style="font-style:italic">limit</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- bingo we have a row</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;%s\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">whatever</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can easily iterate, e.g.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">loop</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- one time for every row</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;%s\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">whatever</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Automatic cursors are so much easier to use than explicit storage that explicit storage
is rarely seen.  Storing to <code>out</code> parameters is one case where explicit storage actually
is the right choice, as the <code>out</code> parameters have to be declared anyway.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="fetch-with-value-cursors">Fetch with Value Cursors<a class="hash-link" href="#fetch-with-value-cursors" title="Direct link to heading">​</a></h4><p> A value cursor is declared in one of these ways:</p><ul><li><p><code>declare C cursor fetch from call foo(args)</code></p><ul><li><code>foo</code> must be a procedure that returns one row with <code>OUT</code></li></ul></li><li><p><code>declare C cursor like select 1 id, &quot;x&quot; name;</code></p></li><li><p><code>declare C cursor like X;</code></p><ul><li>where X is the name of a table, a view, another cursor, or a procedure that returns a structured result</li></ul><p>A value cursor is <em>always</em> automatic; it&#x27;s purpose is to hold a row.  It doesn&#x27;t iterate over anything but it can be re-loaded in a loop.</p></li><li><p><code>fetch C</code> or <code>fetch C into ...</code> is not valid on such a cursor, because it doesn&#x27;t have a source to step through.</p><p>The canonical way to load such a cursor is:</p></li><li><p><code>fetch C from call foo(args);</code></p><ul><li><code>foo</code> must be a procedure that returns one row with <code>OUT</code></li></ul></li><li><p><code>fetch C(a,b,c...) from values(x, y, z);</code></p></li></ul><p>The first form is in some sense the origin of the value cursor.  Value cursors were added to the language initially to provide a way to capture the single row <code>OUT</code> statement results, much like result set cursors were added to capture procedure results from <code>OUT UNION</code>.  In the first form, the cursor storage (a C struct) is provided by reference as a hidden out parameter to the procedure and the procedure fills it in.  The procedure may or may not use the <code>OUT</code> statement in its control flow, as the cursor might not hold a row.  You can use <code>if C then ...</code> as before to test for a row.</p><p>The second form is more interesting as it allows the cursor to be loaded from arbitrary expressions subject to some rules:</p><ul><li>you should think of the cursor as a logical row: it&#x27;s either fully loaded or it&#x27;s not, therefore you must specify enough columns in the column list to ensure that all <code>NOT NULL</code> columns will get a value</li><li>if not mentioned in the list, NULL will be loaded where possible</li><li>if insufficient columns are named, an error is generated</li><li>if the value types specified are not compatible with the column types mentioned, an error is generated</li><li>later in this chapter, we&#x27;ll show that columns can also be filled with dummy data using a seed value</li></ul><p>With this form, any possible valid cursor values could be set, but many forms of updates
that are common would be awkward. So there are various forms of syntactic sugar that are
automatically rewritten into the canonical form.  See the examples below:</p><ul><li><p><code>fetch C from values(x, y, z)</code></p><ul><li>if no columns are specified this is the same as naming all the columns, in declared order</li></ul></li><li><p><code>fetch C from arguments</code></p><ul><li>the arguments to the procedure in which this statement appears are used as the values, in order</li><li>in this case <code>C</code> was also rewritten into <code>C(a,b,c,..)</code> etc.</li></ul></li><li><p><code>fetch C from arguments like C</code></p><ul><li>the arguments to the procedure in which this statement appears are used, by name, as the values, using the names of of the indicated shape</li><li>the order in which the arguments appeared no longer matters, the names that match the columns of C are used if present</li><li>the formal parameter name may have a single trailing underscore (this is what <code>like C</code> would generate)</li><li>e.g. if <code>C</code> has columns <code>a</code> and <code>b</code> then there must exist formals named <code>a</code> or <code>a_</code> and <code>b</code> or <code>b_</code>, in any position</li></ul></li><li><p><code>fetch C(a,b) from cursor D(a,b)</code></p><ul><li>the named columns of D are used as the values</li><li>in this case the statement becomes: <code>fetch C(a,b) from values(D.a, D.b);</code></li></ul></li></ul><p>That most recent form doesn&#x27;t seem like it saves much, but recall the first rewrite:</p><ul><li><p><code>fetch C from cursor D</code></p><ul><li>both cursors are expanded into all their columns, creating a copy from one to the other</li><li><code>fetch C from D</code> can be used if the cursors have the exact same column names and types; it also generates slightly better code and is a common case</li></ul><p>It is very normal to want to use only some of the columns of a cursor; these <code>like</code> forms do that job.  We saw some of these forms in an earlier example.</p></li><li><p><code>fetch C from cursor D(like C)</code></p><ul><li>here <code>D</code> is presumed to be &quot;bigger&quot; than <code>C</code>, in that it has all of the <code>C</code> columns and maybe more.  The <code>like C</code> expands into the names of the <code>C</code> columns so <code>C</code> is loaded from the <code>C</code> part of <code>D</code></li><li>the expansion might be <code>fetch C(a, b, g) from values (D.a, D.b, D.g)</code></li><li><code>D</code> might have had fields <code>c, d, e, f</code> which were not used because they are not in <code>C</code>.</li></ul><p>The symmetric operation, loading some of the columns of a wider cursor can be expressed neatly:</p></li><li><p><code>fetch C(like D) from cursor D</code></p><ul><li>the <code>like D</code> expands into the columns of <code>D</code> causing the cursor to be loaded with what&#x27;s in <code>D</code> and <code>NULL</code> (if needed)</li><li>when expanded, this might look like <code>fetch C(x, y) from values(D.x, D.y)</code></li></ul></li></ul><p><code>LIKE</code> can be used in both places, for instance suppose <code>E</code> is a shape that has a subset of the rows of both <code>C</code> and <code>D</code>.  You can write a form like this:</p><ul><li><p><code>fetch C(like E) from cursor D(like E)</code></p><ul><li>this means take the column names found in <code>E</code> and copy them from D to C.</li><li>the usual type checking is done</li></ul><p>As is mentioned above, the <code>fetch</code> form means &quot;load an entire row into the cursor&quot;. This
is important because &quot;half loaded&quot; cursors would be semantically problematic.  However
there are many cases where you might like to amend the values of an already loaded
cursor.  You can do this with the <code>update</code> form.</p></li><li><p><code>update cursor C(a,b,..) from values(1,2,..);</code></p><ul><li>the update form is a no-op if the cursor is not already loaded with values (!!)</li><li>the columns and values are type checked so a valid row is ensured (or no row)</li><li>all the re-writes above are legal so <code>update cursor C(like D) from D</code> is possible; it is in fact the use-case for which this was designed.</li></ul></li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="calling-procedures-with-argument-bundles">Calling Procedures with Argument Bundles<a class="hash-link" href="#calling-procedures-with-argument-bundles" title="Direct link to heading">​</a></h3><p>It&#x27;s often desirable to treat bundles of arguments as a unit, or cursors as a unit, especially when calling other procedures.  The shape patterns above are very helpful
for moving data between cursors, and the database.  These can be rounded out with
similar constructs for procedure definitions and procedure calls as follows.</p><p>First we&#x27;ll define some shapes to use in the examples.  Note that we made <code>U</code> using <code>T</code>.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> T</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> y </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">  z </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> U</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> T</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> a </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We haven&#x27;t mentioned this before but the implication of the above is that you can
use the <code>LIKE</code> construct inside a table definition to add columns from a shape.</p><p>We can also use the <code>LIKE</code> construct to create procedure arguments.  To avoid conflicts
with column names, when used this way the procedure arguments all get a trailing
underscore appended to them.  The arguments will be <code>x_</code>, <code>y_</code>, and <code>z_</code> as we can
see if the following:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> p1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> T</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;%d %d %d\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> x_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> y_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> z_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Shapes can also be used in a procedure call, as showed below. This next example is
obviously contrived, but of course it generalizes. It is exactly equivalent to the above.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> p2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> T</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;%d %d %d\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> arguments</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now we might want to chain these things together.  This next example uses a cursor to
call <code>p1</code>.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> q1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> T</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token keyword" style="font-style:italic">loop</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* this is the same as call p(C.x, C.y, C.z) */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> p1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>like</code> construct allows you to select some of the arguments, or
some of a cursor to use as arguments.  This next procedure has more arguments
than just <code>T</code>. The arguments will be <code>x_</code>, <code>y_</code>, <code>z_</code>, <code>a_</code>, <code>b_</code>.  But the
call will still have the <code>T</code> arguments <code>x_</code>, <code>y_</code>, and <code>z_</code>.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> q2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> U</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* just the args that match T: so this is still call p(x_, y_, z_) */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> p1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> arguments </span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> T</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Or similarly, using a cursor.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> q3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> U</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> U</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token keyword" style="font-style:italic">loop</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* just the columns that match T so this is still call p(C.x, C.y, C.z) */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> p1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> C </span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> T</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note that the <code>from</code> argument forms do not have to be all the arguments.  For instance
you can get columns from two cursors like so:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> something</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> D</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>All the varieties can be combined but of course the procedure signature must match.  And
all these forms work in function expressions as well as procedure calls.</p><p>e.g.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> x :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> a_function</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Since these forms are simply syntatic sugar, they can also appear inside of function calls
that are in SQL statements. The variables mentioned will be expanded and become bound
variables just like any other variable that appears in a SQL statement.</p><p>Note the form <code>x IN (from arguments)</code> is not supported at this time, though this would be
a relatively easy addition.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="using-named-argument-bundles">Using Named Argument Bundles<a class="hash-link" href="#using-named-argument-bundles" title="Direct link to heading">​</a></h3><p>There are many cases where stored procedures require complex arguments using data shapes
that come from the schema, or from other procedures.  As we have seen the <code>LIKE</code> construct
for arguments can help with this, but it has some limitations. Let&#x27;s consider a specific
example to study:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> Person </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  id </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">primary</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  address </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  birthday </span><span class="token keyword" style="font-style:italic">real</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To manage this table we might need something like this:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> insert_person</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> Person</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> Person </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> arguments</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>As we have seen, the above expands into:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> insert_person</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  id_ </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name_ </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  address_ </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  birthday_ </span><span class="token keyword" style="font-style:italic">real</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> Person</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> birthday</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">values</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> name_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> address_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> birthday_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>It&#x27;s clear that the sugared version is a lot easier to reason about than the
fully expanded version, and much less prone to errors as well.</p><p>This much is already helpful, but just those forms aren&#x27;t general enough to handle
the usual mix of situations.  For instance, what if we need a procedure that works
with two people? A hypothetical <code>insert_two_people</code> procedure cannot be written with
the forms we have so far.</p><p>To generalize this the language adds the notion of named argument bundles. The idea here
is to name the bundles which provides a useful scoping.  Example:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> insert_two_people</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">p1 </span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> Person</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> p2 </span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> Person</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- using a procedure that takes a Person args</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> insert_person</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> p1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> insert_person</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> p2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>or alternatively</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> insert_two_people</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">p1 </span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> Person</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> p2 </span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> Person</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- inserting a Person directly</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> Person </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> p1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> Person </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> p2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The above expands into:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> insert_two_people</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  p1_id </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  p1_name </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  p1_address </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  p1_birthday </span><span class="token keyword" style="font-style:italic">real</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  p2_id </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  p2_name </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  p2_address </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  p2_birthday </span><span class="token keyword" style="font-style:italic">real</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> Person</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> birthday</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">values</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">p1_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> p1_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> p1_address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> p1_birthday</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> Person</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> birthday</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">values</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">p2_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> p2_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> p2_address</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> p2_birthday</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Or course different named bundles can have different types -- you can create and name
shapes of your choice.  The language allows you to use an argument bundle name in all
the places that a cursor was previously a valid source.  That includes <code>insert</code>,
<code>fetch</code>, <code>update cursor</code>, and procedure calls.  You can refer to the arguments by
their expanded name such as <code>p1_address</code> or alternatively <code>p1.address</code> -- they mean
the same thing.</p><p>Here&#x27;s another example showing a silly but illustrative thing you could do:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> insert_lotsa_people</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">P </span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> Person</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- make a cursor to hold the arguments</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> P</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- convert arguments to a cursor</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> P</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- set up to patch the cursor and use it 20 times</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  let i :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">while</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">20</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">update</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">values</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;id_%d&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> Person </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> i :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The above shows that you can use a bundle as the source of a shape, and you can
use a bundle as a source of data to load a cursor.  After which you can do all the
usual value cursor things.  Of course in this case the value cursor was redundant,
we could just as easily have done something like this:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> P_id :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;id_%d&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> Person </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> P</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> i :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note: the CQL JSON output includes extra information about procedure arguments
if they originated as part of a shape bundle do identify the shape source
for tools that might need that information.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="the-columnslike-construct-in-the-select-statement">The COLUMNS/LIKE construct in the SELECT statement<a class="hash-link" href="#the-columnslike-construct-in-the-select-statement" title="Direct link to heading">​</a></h3><p>The select list of a <code>SELECT</code> statement already has complex syntax and functionality,
but it is a very interesting place to use shapes.  To make it possible to use
shape notations and not confuse them with standard SQL the <code>COLUMNS</code> construct was
added to the language.  This allows for a sugared syntax for extracting columns in bulk.</p><p>The <code>COLUMNS</code> clause is like of a generalization of the <code>select T.*</code> with shape slicing and type-checking.  The forms are discussed below:</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="columns-from-a-join-table-or-tables">Columns from a join table or tables<a class="hash-link" href="#columns-from-a-join-table-or-tables" title="Direct link to heading">​</a></h4><p>This is the simplest form, it&#x27;s just like <code>T.*</code>:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- same as A.*</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">select columns(A) from ...;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- same as A.*, B.*</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">select columns(A, B) from ...;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="columns-from-a-particular-joined-table-that-match-a-shape">Columns from a particular joined table that match a shape<a class="hash-link" href="#columns-from-a-particular-joined-table-that-match-a-shape" title="Direct link to heading">​</a></h4><p>This allows you to choose some of the columns of one table of the FROM clause.</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- the columns of A that match the shape Foo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">select columns(A like Foo) from ...;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- get the Foo shape from A and the Far shape from B</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">select columns(A like Foo, B like Bar) from ...;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="columns-from-any-that-match-a-shape-from-anywhere-in-the-from">Columns from any that match a shape, from anywhere in the FROM<a class="hash-link" href="#columns-from-any-that-match-a-shape-from-anywhere-in-the-from" title="Direct link to heading">​</a></h4><p>Here we do not specify a particular table that contains the columns,
the could come from any of the tables in the FROM clause.</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">--- get the Foo shape from anywhere in the join</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">select columns(like Foo) from ...;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- get the Foo and Bar shapes, from anywhere in the join</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">select columns(like Foo, like Bar) from ...;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="specific-columns">Specific columns<a class="hash-link" href="#specific-columns" title="Direct link to heading">​</a></h4><p>This form allows you to slice out a few columns without defining a shape, you
simply list the exact columns you want.</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- T1.x and T2.y plus the Foo shape</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">select columns(T1.x, T2.y, like Foo) from ...;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="distinct-columns">Distinct columns<a class="hash-link" href="#distinct-columns" title="Direct link to heading">​</a></h4><p>Its often the case that there are duplicate column names in the <code>FROM</code> clause.
For instance, you could join <code>A</code> to <code>B</code> with both having a column <code>pk</code>. The
final result set can only have one column named <code>pk</code>, the distinct clause
helps you to get distinct column names.  In this context <code>distinct</code> is about
column names, not values.</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- removes duplicate column names</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- e.g. there will be one copy of &#x27;pk&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">select columns(distinct A, B) from A join B using(pk);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- if both Foo and Bar have an (e.g.) &#x27;id&#x27; field you only get one copy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">select columns(distinct like Foo, like Bar) from ...;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If a specific column is mentioned it is always included, but later expressions
that are not a specific column will avoid that column name.</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- if F or B has an x it won&#x27;t appear again, just T.x</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">select columns(distinct T.x, F like Foo, B like Bar) from F, B ..;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Of course this is all just sugar, so it all compiles to a column list with table
qualifications -- but the syntax is very powerful.  You can easily narrowin a
wide table, or fusing joins that share common keys.</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- just the Foo columns</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">select columns(like Foo) from Superset_Of_Foo_From_Many_Joins_Even;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- only one copy of &#x27;pk&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">select columns(distinct A,B,C) from</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  A join B using (pk) join C using (pk);</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And of course you can define shapes however you like and then use them
to slice off column chucks of your choice.  There are many ways to build
up shapes from other shapes.  For instance, you can declare procedures
that return the shape you want and never actually create the procedure --
a pattern is very much like a shape &quot;typedef&quot;.  E.g.</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare proc shape1() (x integer, y real, z text);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare proc shape2() (like shape1, u bool, v bool);</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>With this combination you can easily define common column shapes and slice them
out of complex queries without having to type the columns names over and over.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="missing-data-columns-nulls-and-dummy-data">Missing Data Columns, Nulls and Dummy Data<a class="hash-link" href="#missing-data-columns-nulls-and-dummy-data" title="Direct link to heading">​</a></h3><p>What follows are the rules for columns that are missing in an <code>INSERT</code>, or <code>FETCH</code> statement. As with many of the other things discussed here, the forms result in
automatic rewriting of the code to include the specified dummy data.  So SQLite
will never see these forms.</p><p>Two things to note: First, the dummy data options described below are really only interesting in test code, it&#x27;s hard to imagine them being useful in production code.
Second, none of what follows applies to the <code>update cursor</code> statement because its
purpose is to do partial updates on exactly the specified columns and we&#x27;re about to
talk about what happens with the columns that were not specified.</p><p>When fetching a row all the columns must come from somewhere; if the column is
mentioned or mentioned by rewrite then it must have a value mentioned, or a value
mentioned by rewrite. For columns that are not mentioned, a NULL value is used if
it is legal to do so.  For example, <code>fetch C(a) from values(1)</code> might turn into <code>fetch C(a,b,c,d) from values (1, NULL, NULL, NULL)</code></p><p>In addition to the automatic NULL you may add the annotation <code>@dummy_seed([long integer expression])</code>. If this annotion is present then:</p><ul><li>the expression is evaluated and stored in the hidden variable <em>seed</em></li><li>all integers, and long integers get <em>seed</em> as their value (possibly truncated)</li><li>booleans get 1 if and only if <em>seed</em> is non-zero</li><li>strings get the name of the string column an underscore and the value as text (e.g.   &quot;myText<em>7&quot; if _seed</em> is 7)</li><li>blobs are not currently supported for dummy data (CQL is missing blob conversions which are needed first)</li></ul><p>This construct is hugely powerful in a loop to create many complete rows with very little effort, even if the schema change over time.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> i </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> my_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> i :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">i </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">20</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">values</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">i</span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token number" style="color:rgb(247, 140, 108)">10000</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@dummy_seed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> my_table </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now in this example we don&#x27;t need to know anything about <code>my_table</code> other than that it has a column named <code>id</code>. This example shows several things:</p><ul><li>we got the shape of the cursor from the table we were inserting into</li><li>you can do your own computation for some of the columns (those named) and leave the unnamed values to be defaulted</li><li>the rewrites mentioned above work for the <code>insert</code> statement as well as <code>fetch</code></li><li>in fact <code>insert into my_table(id) values(i+10000) @dummy_seed(i)</code> would have worked too with no cursor at all<ul><li>bonus, dummy blob data does work in insert statements because SQLite can do the string conversion easily</li><li>the dummy value for a blob is a blob that holds the text of the column name and the text of the seed just like a string column</li></ul></li></ul><p>The <code>@dummy_seed</code> form can be modified with <code>@dummy_nullables</code>, this indicates that rather than using NULL for any nullable value that is missing, CQL should use the seed value.  This overrides the default behavior of using NULL where columns are needed.  Note the NULL filling works a little differently on insert statements.  Since SQLite will provide a NULL if one is legal the column doesn&#x27;t have to be added to the list with a NULL value during rewriting, it can simply be omitted, making the statement smaller.</p><p>Finally for <code>insert</code> statement only, SQLite will normally use the default value of a column if it has one, so there is no need to add missing columns with default values to the insert statement.  However if you specify <code>@dummy_defaults</code> then columns with a default value will instead be rewritten and they will get <code>_seed_</code> as their value.</p><p>Some examples.  Suppose columns a, b, c are not null;  m, n are nullable; and x, y have defaults.</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- as written</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">insert into my_table(a) values(7) @dummy_seed(1000)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- rewrites to</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">insert into my_table(a, b, c) values(7, 1000, 1000);</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- as written</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">insert into my_table(a) values(7) @dummy_seed(1000) @dummy_nullables</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- rewrites to</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">insert into my_table(a, b, c, m, n) values(7, 1000, 1000, 1000, 1000);</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- as written</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">insert into my_table(a) values(7) @dummy_seed(1000) @dummy_nullables @dummy_defaults</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- rewrites to</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">insert into my_table(a, b, c, m, n, x, y) values(7, 1000, 1000, 1000, 1000, 1000, 1000);</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The sugar features on <code>fetch</code>, <code>insert</code>, and <code>update cursor</code> are as symmetric as possible, but again, dummy data is generally only interesting in test code. Dummy  data will continue to give you valid test rows even if columns are added or removed from the tables in question.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="generalized-cursor-lifetimes-aka-cursor-boxing">Generalized Cursor Lifetimes aka Cursor &quot;Boxing&quot;<a class="hash-link" href="#generalized-cursor-lifetimes-aka-cursor-boxing" title="Direct link to heading">​</a></h3><p>Generalized Cursor Lifetime refers to capturing a Statement Cursor in an object so that it can used more flexibly.  Wrapping something
in an object is often called &quot;boxing&quot;.  Since Generalized Cursor Lifetime is a mouthful we&#x27;ll refer to it as &quot;boxing&quot;
from here forward. The symmetric operation &quot;unboxing&quot; refers to converting the boxed object back into a cursor.</p><p>The normal cursor usage pattern is by far the most common, a cursor is created directly with something like
these forms:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> shape_source</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> D </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> proc_that_returns_a_shape</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>At this point the cursor can be used normally as follows:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">loop</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- do stuff with C</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Those are the usual patterns and they allow statement cursors to be consumed sort of &quot;up&quot; the call chain from where the cursor was created.
But what if you want some worker procedures that consume a cursor? There is no way to pass your cursor down again with these normal patterns alone.</p><p>To generalize the patterns, allowing, for instance, a cursor to be returned as an out parameter or accepted as
an in parameter you first need to declare an object variable that can hold the cursor and has a type indicating
the shape of the cursor.</p><p>To make an object that can hold a cursor:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> obj object</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">T </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Where <code>T</code> is the name of a shape. It can be a table name, or a view name, or it can be the name of the canonical procedure that returns the result.
T should be some kind of global name, something that could be accessed with <code>#include</code> in various places.
Referring to the examples above, choices for <code>T</code> might be <code>shape_source</code> the table or <code>proc_that_returns_a_shape</code> the procedure.</p><p>Note: it&#x27;s always possible make a fake procedure that returns a result to sort of &quot;typedef&quot; a shape name.  e.g.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> my_shape</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> name </span><span class="token keyword" style="font-style:italic">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The procedure here <code>my_shape</code> doesn’t have to actually ever be created, in fact it’s better if it isn&#x27;t.  It won’t ever be called;
its hypothetical result is just being as a shape.  This can be useful if you have several procedures like <code>proc_that_returns_a_shape</code>
that all return results with the columns of <code>my_shape</code>.</p><p>To create the boxed cursor, first declare the object variable that will hold it and then set object from the cursor.
Note that in the following example the cursor <code>C</code> must have the shape defined by <code>my_shape</code> or an error is produced.
The type of the object is crucial because, as we&#x27;ll see, during unboxing that type defines the shape
of the unboxed cursor.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- recap: declare the box that holds the cursor (T changed to my_shape for this example)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> box_obj object</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">my_shape </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- box the cursor into the object (the cursor shape must match the box shape)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> box_obj </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The variable <code>box_obj</code> can now be passed around as usual.  It could be stored in a suitable <code>out</code> variable
or it could be passed to a procedure as an <code>in</code> parameter.  Then, later, you can &quot;unbox&quot; <code>box_obj</code> to get a
cursor back. Like so</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- unboxing a cursor from an object, the type of box_obj defines the type of the created cursor</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> D </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> box_obj</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>These primitives will allow cursors to be passed around with general purpose lifetime.</p><p>Example:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- consumes a cursor</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> cursor_user</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">box_obj object</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">my_shape </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> box_obj</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- the cursors shape will be my_shape matching box</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">loop</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- do something with C</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- captures a cursor and passes it on</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> cursor_boxer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> something_like_my_shape</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> box_obj object</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">my_shape </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> box </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- produces error if shape doesn&#x27;t match</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> cursor_user</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">box_obj</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Importantly, once you box a cursor the underlying SQLite statement’s lifetime is managed by the box object with normal
retain/release semantics.  The box and underlying statement can be released simply by setting all references to it to null
as usual.</p><p>With this pattern it&#x27;s possible to, for instance, create a cursor, box it, consume some of the rows in one procedure, do some other stuff,
and then consume the rest of the rows in another different procedure.</p><p>Important Notes:</p><ul><li>the underlying SQLite statement is shared by all references to it.  Unboxing does not reset the cursor&#x27;s position.  It is possible, even desirable, to have different procedures advancing the same cursor</li><li>there is no operation for &quot;peeking&quot; at a cursor without advancing it; if your code requires that you inspect the row and then delegate it, you can do this simply by passing the cursor data as a value rather than the cursor statement.  Boxing and unboxing are for cases where you need to stream data out of the cursor in helper procedures</li><li>durably storing a boxed cursor (e.g. in a global) could lead to all manner of problems -- it is <em>exactly</em> like holding on to a <code>sqlite3_stmt *</code> for a long time with all the same problems because that is exactly is happening</li></ul><p>Summarizing, the main reason for using the boxing patterns is to allow for standard helper procedures that can get a cursor from a variety of places and process it.
Boxing isn’t the usual pattern at all and returning cursors in a box, while possible, should be avoided in favor of the simpler patterns, if only because then then lifetime management is very simple in all those cases.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="chapter-6-calling-procedures-defined-elsewhere">Chapter 6: Calling Procedures Defined Elsewhere<a class="hash-link" href="#chapter-6-calling-procedures-defined-elsewhere" title="Direct link to heading">​</a></h2><p>CQL generally doesn&#x27;t see the whole world in one compilation.
In this way it&#x27;s a lot more like, say, the C compiler than it is like, say, Java
or C# or something like that.  This means several things:</p><ul><li>You don&#x27;t have to tell CQL about all your schema in all your files,
so particular stored procs can be more encapsulated</li><li>You can have different databases mounted in different places and CQL
won&#x27;t care; you provide the database connection to the stored procedures when you call them, and that database is assumed to have the tables declared in this translation unit</li><li>Several different schema can be maintained by CQL,
even in the same database, and they won&#x27;t know about each other</li></ul><p>To make this possible there are a few interesting features</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="declaring-procedures-defined-elsewhere">Declaring Procedures Defined Elsewhere<a class="hash-link" href="#declaring-procedures-defined-elsewhere" title="Direct link to heading">​</a></h3><p>Stored procedures defined in another file can be declared to CQL in various
ways for each major type of stored procedure.  These are covered in
the sections below.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="simple-procedures-database-free">Simple Procedures (database free):<a class="hash-link" href="#simple-procedures-database-free" title="Direct link to heading">​</a></h3><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> name </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This introduces the symbol name without providing the body.
This has important variations.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="procedures-that-use-the-database">Procedures that use the database<a class="hash-link" href="#procedures-that-use-the-database" title="Direct link to heading">​</a></h3><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> name </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">USING</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TRANSACTION</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Most procedures you write will use SQLite in some fashion,
maybe a <code>select</code> or something.  The <code>USING TRANSACTION</code> annotation indicates that
the proc in question uses the database and therefore the generated code
will need a database connection in-argument and it will return a SQLite error code.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="procedures-that-create-a-result-set">Procedures that create a result set<a class="hash-link" href="#procedures-that-create-a-result-set" title="Direct link to heading">​</a></h3><p>If the procedure in question is going to use <code>select</code> or <code>call</code> to create a result set,
the type of that result set has to be declared.  An example might look like this:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> with_result_set </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                 name </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                 rate LONG </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                 </span><span class="token keyword" style="font-style:italic">type</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                 size </span><span class="token keyword" style="font-style:italic">REAL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This says that the procedure takes no arguments (other than the implicit database
connection) and it has an implicit out-argument that can be read to get a result
set with the indicated columns: id, name, rate, type, and size.
This form implies <code>USING TRANSACTION</code>.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="procedures-that-return-a-single-row-with-a-value-cursor">Procedures that return a single row with a value cursor<a class="hash-link" href="#procedures-that-return-a-single-row-with-a-value-cursor" title="Direct link to heading">​</a></h3><p>If the procedure emits a cursor with the <code>OUT</code> statement to produce a single
row then it can be declared as follows:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> with_result_set </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">OUT</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                     name </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                     rate LONG </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                     </span><span class="token keyword" style="font-style:italic">type</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                     size </span><span class="token keyword" style="font-style:italic">REAL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This form can have <code>USING TRANSACTION</code>  or not, since it is possible to emit a row with a value cursor and never use the database.  See the previous chapter for details on the <code>OUT</code> statement.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="procedures-that-return-a-full-result-set">Procedures that return a full result set<a class="hash-link" href="#procedures-that-return-a-full-result-set" title="Direct link to heading">​</a></h3><p>If the procedure emits many rows with the <code>OUT UNION</code> statement to produce a full result set
then it can be declared as follows:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> with_result_set </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">OUT</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">UNION</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                     name </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                     rate LONG </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                     </span><span class="token keyword" style="font-style:italic">type</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                     size </span><span class="token keyword" style="font-style:italic">REAL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This form can have <code>USING TRANSACTION</code>  or not, since it is possible to emit a rows with a value cursor and never use the database.  See the previous chapter for details on the <code>OUT UNION</code> statement.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="exporting-declared-symbols-automatically">Exporting Declared Symbols Automatically<a class="hash-link" href="#exporting-declared-symbols-automatically" title="Direct link to heading">​</a></h3><p>To avoid errors, the declarations for any given file can be automatically created
by adding something like <code>--generate_exports</code> to the command line. This will require an additonal file name to be passed in the <code>--cg</code> portion to capture the exports.</p><p>That file can then be used with <code>#include</code> when you combine the C pre-processor
with CQL as is normally done.</p><p>Nomenclature is perhaps a bit weird here.  You use <code>--generate_exports</code> to export
the stored procedure declarations from the translation units.  Of course those
exported symbols are what you then import in some other module.  Sometimes this
output file is called <code>foo_imports.sql</code> because those exports are of course exactly
what you need to import <code>foo</code>.  You can use whatever convention you like of course,
CQL doesn&#x27;t care.  The full command line might look something like this:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cql --in foo.sql --cg foo.h foo.c foo_imports.sql --generate_exports</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Using the pre-processor you can get declarations from elsewhere with
a directive like this:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">#include &quot;foo_imports.sql&quot;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="declaration-examples">Declaration Examples<a class="hash-link" href="#declaration-examples" title="Direct link to heading">​</a></h3><p>Here are some more examples directly from the CQL test cases; these are all
auto-generated with <code>--generate_exports</code>.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> test </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">i </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> out_test </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">OUT</span><span class="token plain"> i </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">OUT</span><span class="token plain"> ii </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> outparm_test </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">OUT</span><span class="token plain"> foo </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">USING</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TRANSACTION</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> select_from_view </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">type</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> make_view </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">USING</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TRANSACTION</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> copy_int </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">OUT</span><span class="token plain"> b </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> complex_return </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">_bool </span><span class="token keyword" style="font-style:italic">BOOL</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   _integer </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   _longint LONG </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   _real </span><span class="token keyword" style="font-style:italic">REAL</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   _text </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   _nullable_bool </span><span class="token keyword" style="font-style:italic">BOOL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> outint_nullable </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">OUT</span><span class="token plain"> output </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">OUT</span><span class="token plain"> result </span><span class="token keyword" style="font-style:italic">BOOL</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">USING</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TRANSACTION</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> outint_notnull </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">OUT</span><span class="token plain"> output </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">OUT</span><span class="token plain"> result </span><span class="token keyword" style="font-style:italic">BOOL</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">USING</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TRANSACTION</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> obj_proc </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">OUT</span><span class="token plain"> an_object OBJECT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> insert_values </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  id_ </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  type_ </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">USING</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TRANSACTION</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>So far we&#x27;ve avoided discussing the generated C code in any details but here
it seems helpful to show exactly what these declarations correspond to in the
generated C to demystify all this.  There is a very straightforward conversion.</p><div class="language-c codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-c codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">test</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cql_int32 i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">out_test</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_int32 </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">_Nonnull i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_nullable_int32 </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">_Nonnull ii</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cql_code </span><span class="token function" style="color:rgb(130, 170, 255)">outparm_test</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  sqlite3 </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">_Nonnull _db_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_int32 </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">_Nonnull foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cql_code </span><span class="token function" style="color:rgb(130, 170, 255)">select_from_view_fetch_results</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  sqlite3 </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">_Nonnull _db_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  select_from_view_result_set_ref _Nullable </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">_Nonnull result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cql_code </span><span class="token function" style="color:rgb(130, 170, 255)">make_view</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sqlite3 </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">_Nonnull _db_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">copy_int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cql_nullable_int32 a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> cql_nullable_int32 </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">_Nonnull b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cql_code </span><span class="token function" style="color:rgb(130, 170, 255)">complex_return_fetch_results</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  sqlite3 </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">_Nonnull _db_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  complex_return_result_set_ref _Nullable </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">_Nonnull result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cql_code </span><span class="token function" style="color:rgb(130, 170, 255)">outint_nullable</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  sqlite3 </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">_Nonnull _db_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_nullable_int32 </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">_Nonnull output</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_bool </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">_Nonnull result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cql_code </span><span class="token function" style="color:rgb(130, 170, 255)">outint_notnull</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  sqlite3 </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">_Nonnull _db_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_int32 </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">_Nonnull output</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_bool </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">_Nonnull result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">obj_proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_object_ref _Nullable </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">_Nonnull an_object</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cql_code </span><span class="token function" style="color:rgb(130, 170, 255)">insert_values</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  sqlite3 </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">_Nonnull _db_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_int32 id_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_nullable_int32 type_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>As you can see, these declarations use exactly the normal SQLite
types and so it is very easy to declare a procedure in CQL and then implement it
yourself in straight C, simply by conforming to the contract.</p><p>Importantly, SQLite does not know anything about CQL stored procedures, or anything at all about CQL
really so CQL stored procedure names cannot be used in any way in SQL statements.  CQL
control flow like the <code>call</code> statement can be used to invoke other procedures and
results can be captured by combing the <code>OUT</code> statement and a <code>DECLARE CURSOR</code> construct
but SQLite is not involved in those things.  This is another place where the inherent
two-headed nature of CQL leaks out.</p><p>Finally, this is a good place to reinforce that procedures with any of the structured
result types (<code>select</code>, <code>out</code>, <code>out union</code>) can be used with a suitable cursor.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">procedure</span><span class="token plain"> get_stuff</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> stuff</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Can be used in two interesting ways:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">procedure</span><span class="token plain"> meta_stuff</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">meta </span><span class="token keyword" style="font-style:italic">bool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> meta </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> get_stuff</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> get_other_stuff</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Assuming that <code>get_stuff</code> and <code>get_other_stuff</code> have the same shape, then
this procedure simply passes on one or the other&#x27;s result set unmodified
as its own return value.</p><p>But you could do more than simply pass on the result.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">procedure</span><span class="token plain"> meta_stuff</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">meta </span><span class="token keyword" style="font-style:italic">bool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> get_stuff</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- or get_meta_stuff(...)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">loop</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- do stuff with C</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- may be out union some of the rows after adjustment even</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here we can see that we used the procedure to get the results and then
process them directly somehow.</p><p>And of course the result of an <code>OUT</code> can similarly be processed using
a value cursor, as previously seen.</p><p>These combinations allow for pretty general composition of stored procedures
so long as they are not recombined with SQLite statements.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="chapter-7-cql-result-sets">Chapter 7: CQL Result Sets<a class="hash-link" href="#chapter-7-cql-result-sets" title="Direct link to heading">​</a></h2><p>Most of this tutorial is about the CQL language itself but here we must diverge a bit.  The purpose of the
result set feature of CQL is to create a C interface to SQLite data.  Because of this
there are a lot of essential details that require looking carefully at the generated C code.  Appendix 2
covers this code in even more detail but here it makes sense to at least talk about the interface.</p><p>Let&#x27;s say we have this simple stored procedure:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b </span><span class="token keyword" style="font-style:italic">bool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> t </span><span class="token keyword" style="font-style:italic">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> read_foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id_ </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> foo </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> id_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We&#x27;ve created a simple data reader: this CQL code will cause the compiler to
generate helper functions to read the data and materialize a result set.</p><p>Let&#x27;s look at the public interface of that result set now considering the most essential pieces.</p><div class="language-c codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-c codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* this is almost everything in the generated header file */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">define</span><span class="token macro property"> </span><span class="token macro property macro-name">read_foo_data_types_count</span><span class="token macro property"> </span><span class="token macro property expression number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">cql_result_set_type_decl</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  read_foo_result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  read_foo_result_set_ref</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">extern</span><span class="token plain"> cql_int32 </span><span class="token function" style="color:rgb(130, 170, 255)">read_foo_get_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">read_foo_result_set_ref</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  _Nonnull result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> cql_int32 row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">extern</span><span class="token plain"> cql_bool </span><span class="token function" style="color:rgb(130, 170, 255)">read_foo_get_b_is_null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">read_foo_result_set_ref</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  _Nonnull result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> cql_int32 row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">extern</span><span class="token plain"> cql_bool </span><span class="token function" style="color:rgb(130, 170, 255)">read_foo_get_b_value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">read_foo_result_set_ref</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  _Nonnull result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> cql_int32 row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">extern</span><span class="token plain"> cql_string_ref _Nullable </span><span class="token class-name" style="color:rgb(255, 203, 107)">read_foo_get_t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   read_foo_result_set_ref  _Nonnull result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   cql_int32 row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">extern</span><span class="token plain"> cql_int32 </span><span class="token function" style="color:rgb(130, 170, 255)">read_foo_result_count</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">read_foo_result_set_ref</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  _Nonnull result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">extern</span><span class="token plain"> cql_code </span><span class="token function" style="color:rgb(130, 170, 255)">read_foo_fetch_results</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sqlite3 </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">_Nonnull _db_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  read_foo_result_set_ref _Nullable </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">_Nonnull result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_int32 id_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">define</span><span class="token macro property"> </span><span class="token macro property macro-name function" style="color:rgb(130, 170, 255)">read_foo_row_hash</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token macro property expression">result_set</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token macro property expression"> row</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token macro property expression"> </span><span class="token macro property punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token macro property"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token macro property">  </span><span class="token macro property expression function" style="color:rgb(130, 170, 255)">cql_result_set_get_meta</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token macro property expression">cql_result_set_ref</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token macro property expression">result_set</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token macro property expression operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token macro property punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token macro property"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token macro property">  </span><span class="token macro property expression function" style="color:rgb(130, 170, 255)">rowHash</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token macro property expression">cql_result_set_ref</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token macro property expression">result_set</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token macro property expression"> row</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">define</span><span class="token macro property"> </span><span class="token macro property macro-name function" style="color:rgb(130, 170, 255)">read_foo_row_equal</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token macro property expression">rs1</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token macro property expression"> row1</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token macro property expression"> rs2</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token macro property expression"> row2</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token macro property expression"> </span><span class="token macro property punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token macro property"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token macro property"></span><span class="token macro property expression function" style="color:rgb(130, 170, 255)">cql_result_set_get_meta</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token macro property expression">cql_result_set_ref</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token macro property expression">rs1</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token macro property expression"> </span><span class="token macro property punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token macro property"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token macro property"> </span><span class="token macro property expression operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token macro property expression function" style="color:rgb(130, 170, 255)">rowsEqual</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token macro property expression"> </span><span class="token macro property punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token macro property"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token macro property">   </span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token macro property expression">cql_result_set_ref</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token macro property expression">rs1</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token macro property expression">  row1</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token macro property expression">  </span><span class="token macro property punctuation" style="color:rgb(199, 146, 234)">\</span><span class="token macro property"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token macro property">   </span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token macro property expression">cql_result_set_ref</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token macro property expression">rs2</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token macro property expression">  row2</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let&#x27;s consider some of these individually now</p><div class="language-c codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-c codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">cql_result_set_type_decl</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  read_foo_result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  read_foo_result_set_ref</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This declares the data type for <code>read_foo_result_set</code> and the associated object reference <code>read_foo_result_set_ref</code>.
As it turns out, the underlying data type for all result sets is the same, and only the shape of the data varies.</p><div class="language-c codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-c codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">extern</span><span class="token plain"> cql_code </span><span class="token function" style="color:rgb(130, 170, 255)">read_foo_fetch_results</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sqlite3 </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">_Nonnull _db_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  read_foo_result_set_ref _Nullable </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">_Nonnull result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_int32 id_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The result set fetcher method gives you a <code>read_foo_result_set_ref</code> if it succeeds.  It accepts the <code>id_</code> argument which it
will internally pass along to <code>read_foo(...)</code>.  The latter function provides a <code>sqlite3_stmt*</code> which can then be iterated in the fetcher.
This method is the main public entry point for result sets.</p><p>Once you have a result set, you can read values out of it.</p><div class="language-c codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-c codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">extern</span><span class="token plain"> cql_int32 </span><span class="token function" style="color:rgb(130, 170, 255)">read_foo_result_count</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">read_foo_result_set_ref</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  _Nonnull result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>That function tells you how many rows are in the result set.</p><p>For each row you can use any of the row readers:</p><div class="language-c codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-c codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">extern</span><span class="token plain"> cql_int32 </span><span class="token function" style="color:rgb(130, 170, 255)">read_foo_get_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">read_foo_result_set_ref</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  _Nonnull result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> cql_int32 row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">extern</span><span class="token plain"> cql_bool </span><span class="token function" style="color:rgb(130, 170, 255)">read_foo_get_b_is_null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">read_foo_result_set_ref</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  _Nonnull result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> cql_int32 row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">extern</span><span class="token plain"> cql_bool </span><span class="token function" style="color:rgb(130, 170, 255)">read_foo_get_b_value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">read_foo_result_set_ref</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  _Nonnull result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> cql_int32 row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">extern</span><span class="token plain"> cql_string_ref _Nullable </span><span class="token class-name" style="color:rgb(255, 203, 107)">read_foo_get_t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   read_foo_result_set_ref  _Nonnull result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   cql_int32 row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>These let you read the <code>id</code> of a particular row, and get a <code>cql_int32</code> or you can read the nullable boolean,
using the <code>read_foo_get_b_is_null</code> function first to see if the boolean is null and then <code>read_foo_get_b_value</code>
to get the value.  Finally the string can be accessed with <code>read_foo_get_t</code>.  As you can see, there is a
simple naming convention for each of the field readers.</p><p>Note:  The compiler has runtime arrays that control naming conventions as well as using CamelCasing.  Additional customizations may be created by adding new runtime arrays into the CQL compiler.</p><p>Finally, also part of the public interface, are these macros:</p><div class="language-c codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-c codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">define</span><span class="token macro property"> </span><span class="token macro property macro-name function" style="color:rgb(130, 170, 255)">read_foo_row_hash</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token macro property expression">result_set</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token macro property expression"> row</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">define</span><span class="token macro property"> </span><span class="token macro property macro-name function" style="color:rgb(130, 170, 255)">read_foo_row_equal</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token macro property expression">rs1</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token macro property expression"> row1</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token macro property expression"> rs2</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token macro property expression"> row2</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>These use the CQL runtime to hash a row or compare two rows from identical result
set types.  Metadata included in the result set allows general purpose code to work for
every result set.  Based on configuration, result set copying methods can also
be generated.   When you&#x27;re done with a result set you can use the <code>cql_release(...)</code>
method to free the memory.</p><p>Importantly, all of the rows from the query in the stored procedure are materialized
immediately and become part of the result set.  Potentially large amounts of memory can
be used if a lot of rows are generated.</p><p>The code that actually creates the result set starting from the prepared statement is always the same.
The essential parts are:</p><p>First, a constant array that holds the data types for each column.</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">uint8_t read_foo_data_types[read_foo_data_types_count] = {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  CQL_DATA_TYPE_INT32 | CQL_DATA_TYPE_NOT_NULL, // id</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  CQL_DATA_TYPE_BOOL, // b</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  CQL_DATA_TYPE_STRING, // t</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>All references are stored together at the end of the row, so we only need the count
of references and the offset of the first one to do operations like <code>cql_retain</code> or <code>cql_release</code>
on the row.</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">#define read_foo_refs_offset cql_offsetof(read_foo_row, t) // count = 1</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Lastly we need metadata to tell us count of columns and the offset of each column within the row.</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">static cql_uint16 read_foo_col_offsets[] = { 3,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_offsetof(read_foo_row, id),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_offsetof(read_foo_row, b),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_offsetof(read_foo_row, t)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">};</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Using the above we can now write this fetcher</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">CQL_WARN_UNUSED cql_code</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">read_foo_fetch_results(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  sqlite3 *_Nonnull _db_,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  read_foo_result_set_ref _Nullable *_Nonnull result_set,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_int32 id_)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  sqlite3_stmt *stmt = NULL;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_profile_start(CRC_read_foo, &amp;read_foo_perf_index);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // we call the original procedure, it gives us a prepared statement</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_code rc = read_foo(_db_, &amp;stmt, id_);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // this is everything you need to know to fetch the result</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_fetch_info info = {</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    .rc = rc,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    .db = _db_,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    .stmt = stmt,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    .data_types = read_foo_data_types,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    .col_offsets = read_foo_col_offsets,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    .refs_count = 1,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    .refs_offset = read_foo_refs_offset,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    .rowsize = sizeof(read_foo_row),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    .crc = CRC_read_foo,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    .perf_index = &amp;read_foo_perf_index,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  };</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  // this function does all the work, it cleans up if .rc is an error code.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  return cql_fetch_all_results(&amp;info, (cql_result_set_ref *)result_set);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="results-sets-from-out-union">Results Sets From <code>OUT UNION</code><a class="hash-link" href="#results-sets-from-out-union" title="Direct link to heading">​</a></h3><p>The <code>out</code> keyword was added for writing procedures that produce a single row result set.  With that, it became possible to make any single row result you wanted, assembling it from whatever sources you needed.  That is an important
case as single row results happen frequently and they are comparatively easy to create and pass around using C
structures for the backing store.  However, it&#x27;s not everything; there are also cases where full flexibility is needed
while producing a standard many-row result set.  For this we have <code>out union</code> which was discussed fully in Chapter 5.  Here we&#x27;ll discuss the code generation behind that.</p><p>Here’s an example from the CQL tests:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> some_integers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">start</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> stop </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> v</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> v_squared</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;xx&quot;</span><span class="token plain"> some_text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> i </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> i :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">start</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">while</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">i </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> stop</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">v</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> v_squared</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> junk</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">values</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;%d&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">union</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> i :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this example the entire result set is made up out of thin air.  Of course any combination of this computation or data-access is possible, so you can ultimately make any rows you want in any order using SQLite to help you as much or as little as you need.</p><p>Virtually all the code pieces to do this already exist for normal result sets.  The important parts of the output code look like this in your generated C.</p><p>We need a buffer to hold the rows we are going to accumulate;  We use <code>cql_bytebuf</code> just like the normal fetcher above.</p><div class="language-c codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-c codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// This bit creates a growable buffer to hold the rows</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// This is how we do all the other result sets, too</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cql_bytebuf _rows_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">cql_bytebuf_open</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">_rows_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We need to be able to copy the cursor into the buffer and retain any internal references</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">// This bit is what you get when you &quot;out union&quot; a cursor &quot;C&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">// first we +1 any references in the cursor then we copy its bits</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cql_retain_row(C_);   // a no-op if there is no row in the cursor</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">if (C_._has_row_) cql_bytebuf_append(&amp;_rows_, (const void *)&amp;C_, sizeof(C_));</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Finally, we make the rowset when the procedure exits. If the procedure is returning with no errors the result set is created, otherwise the buffer is released.  The global <code>some_integers_info</code> has constants that describe the shape produced by this procedure just like the other cases that produce a result set.</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cql_results_from_data(_rc_,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                      &amp;_rows_,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                      &amp;some_integers_info,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                      (cql_result_set_ref *)_result_set_);</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The operations here are basically the same ones that will happen inside of the standard helper
<code>cql_fetch_all_results</code>, the difference, of course, is that you write the loop manually and therefore have
full control of the rows as they go in to the result set.</p><p>In short, the overhead is pretty low.  What you’re left with is pretty much the base cost of your algorithm.  The cost here is very similar to what it would be for any other thing that make rows.</p><p>Of course, if you make a million rows, well, that would burn a lot of memory.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="a-working-example">A Working Example<a class="hash-link" href="#a-working-example" title="Direct link to heading">​</a></h3><p>Here&#x27;s a fairly simple example illustrating some of these concepts including the reading of rowsets.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- hello.sql:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> hello</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> my_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    pos </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">primary</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    txt </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> my_data </span><span class="token keyword" style="font-style:italic">values</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;World&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> my_data </span><span class="token keyword" style="font-style:italic">values</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;Hello&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> my_data </span><span class="token keyword" style="font-style:italic">values</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;There&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> my_data </span><span class="token keyword" style="font-style:italic">order</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">by</span><span class="token plain"> pos</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And this main code to open the database and access the procedure:</p><div class="language-c codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-c codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// main.c</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;stdlib.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;sqlite3.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(195, 232, 141)">&quot;hello.h&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> argc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">char</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">argv</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  sqlite3 </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">db</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> rc </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">sqlite3_open</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;:memory:&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">db</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">rc </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> SQLITE_OK</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">exit</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* not exactly world class error handling but that isn&#x27;t the point */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  hello_result_set_ref result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  rc </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">hello_fetch_results</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">db</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">rc </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> SQLITE_OK</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;error: %d\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> rc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">exit</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_int32 result_count </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">hello_result_count</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">for</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cql_int32 row </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> row </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> result_count</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> row</span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    cql_string_ref text </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">hello_get_txt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">cql_alloc_cstr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ctext</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;%d: %s\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ctext</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">cql_free_cstr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ctext</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">cql_result_set_release</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">sqlite3_close</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">db</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>From these pieces you can make a working example like so:</p><div class="language-sh codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sh codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain"># ${cgsql} refers to the root directory of the CG-SQL sources</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cql --in hello.sql --cg hello.h hello.c</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cc -o hello -I ${cgsql}/sources main.c hello.c ${cgsql}/sources/cqlrt.c -lsqlite3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">./hello</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Additional demo code is available in <a href="https://cgsql.dev/cql-guide/x10" target="_blank" rel="noopener noreferrer">Appendix 10</a>.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="chapter-8-functions">Chapter 8: Functions<a class="hash-link" href="#chapter-8-functions" title="Direct link to heading">​</a></h2><p>CQL stored procs have a very simple contract so it is easy to declare procedures and then implement them in regular C; the C functions just have to conform to the contract.  However, CQL procedures have their own calling conventions and this makes it very inconvenient to use external code that is not doing database things and wants to return values.  Even a random number generator or something would be difficult to use because it could not be called in the context of an expression.  To allow for this CQL adds declared functions</p><p>In another example of the two-headed nature of CQL, there are two ways to declare functions.  As we have already
seen you can make function-like procedures and call them like functions simply by making a procedure with an <code>out</code> parameter. However, there are also cases where it is reasonable to make function calls to external functions of other kinds.  There are three major types of functions you might wish to call.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="function-types">Function Types<a class="hash-link" href="#function-types" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_mojV" id="ordinary-scalar-functions">Ordinary Scalar Functions<a class="hash-link" href="#ordinary-scalar-functions" title="Direct link to heading">​</a></h4><p>These functions are written in regular C and provide for the ability to do operations on in-memory objects.  For instance,
you could create functions that allow you to read and write from a dictionary.  You can declare these functions like so:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> dict_get_value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">dict object</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> key_ </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Such a function is not known to SQLite and therefore cannot appear in SQL statements.  CQL will enforce this.</p><p>The above function returns a text reference, and, importantly, this is a borrowed reference.  The dictionary
is presumably holding on to the reference and as long as it is not mutated the reference is valid.  CQL will
retain this reference as soon as it is stored and release it automatically when it is out of scope.  So, in
this case, the dictionary continues to own the object.</p><p>It is also possible to declare functions that create objects.  Such as this example:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> dict_create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> object</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This declaration tells CQL that the function will create a new object for our use.  CQL does not retain the
provided object, rather assuming ownership of the presumably one reference count the object already has.
When the object goes out of scope it is released as usual.</p><p>If we also declare this procedure:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">procedure</span><span class="token plain"> dict_add</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    dict object </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    key_ </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">value</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>then with this family of declarations we could write something like this:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> create_and_init</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> dict object </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> dict :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> dict_create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> dict_add</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">dict</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;k1&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;v1&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> dict_add</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">dict</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;k2&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;v2&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">dict_get_value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">dict</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;k1&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> dict__get_value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">dict</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;k2)) then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token string" style="color:rgb(195, 232, 141)">    call printf(&quot;</span><span class="token plain">insanity has ensued\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note: Ordinary scalar functions may not use the database in any way. When they are invoked they will not
be provided with the database pointer and so they will be unable to do any database operations.  To do
database operations, use regular procedures.  You can create a function-like-procedure using the <code>out</code> convention
discussed previously.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="sql-scalar-functions">SQL Scalar Functions<a class="hash-link" href="#sql-scalar-functions" title="Direct link to heading">​</a></h4><p>SQLite includes the ability to add new functions to its expressions using <code>sqlite3_create_function</code>.  In
order to use this function in CQL, you must also provide its prototype definition to the compiler.  You
can do so following this example:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> strencode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">t </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This introduces the function <code>strencode</code> to the compiler for use in SQL constructs.  With this done you
could write a procedure something like this:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> t </span><span class="token keyword" style="font-style:italic">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">procedure</span><span class="token plain"> bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id_ </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> strencode</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> foo T1 </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> id_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This presumably returns the &quot;encoded&quot; text, whatever that might be.  Note that if <code>sqlite3_create_function</code>
is not called before this code runs, a run-time error will ensue.  Just as CQL must assume that declared
tables really are created, it also assumes that declared function really are created.  This is another case
of telling the compiler in advance what the situation will be at runtime.</p><p>SQLite allows for many flexible kinds of user defined functions.  CQL doesn&#x27;t concern itself with the details of the implementation of the function, it only needs the signature so that it can validate calls.</p><p>Note that SQL Scalar Functions cannot contain <code>object</code> parameters. To pass an <code>object</code>, you should instead pass
the memory address of this object using a <code>LONG INT</code> parameter. To access the address of an <code>object</code> at runtime, you should use
the <code>ptr()</code> function. See <a href="#notes-on-builtin-functions">the notes section below</a> for more information.</p><p>See also: <a href="https://www.sqlite.org/c3ref/create_function.html" target="_blank" rel="noopener noreferrer">Create Or Redefine SQL Functions</a>.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="sql-table-valued-functions">SQL Table Valued Functions<a class="hash-link" href="#sql-table-valued-functions" title="Direct link to heading">​</a></h4><p>More recent versions of SQLite also include the ability to add table-valued functions to statements in place of actual tables. These functions can use their arguments to create a &quot;virtual table&quot; value for use in place of a table.  For this
to work, again SQLite must be told of the existence of the table.  There are a series of steps to make this happen
beginning with <code>sqlite3_create_module</code> which are described in the SQLite documents under &quot;The Virtual Table Mechanism Of SQLite.&quot;</p><p>Once that has been done, a table-valued function can be defined for most object types.  For instance it is possible to
create a table-valued function like so:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> dict_contents</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">dict object </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">k </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> v </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This is just like the previous type of select function but the return type is a table shape.  Once the above has been done you can legally write something like this:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> read_dict</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">dict object </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> pattern </span><span class="token keyword" style="font-style:italic">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> pattern </span><span class="token operator" style="color:rgb(137, 221, 255)">is</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> k</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> v </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> dict_contents</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">dict</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> T1 </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">k </span><span class="token operator" style="color:rgb(137, 221, 255)">LIKE</span><span class="token plain"> pattern</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> k</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> v </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> dict_contents</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">dict</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This construct is very general indeed but the runtime set up for it is much more complicated than scalar functions
and only more modern versions of SQLite even support it.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="sql-functions-with-unchecked-parameter-types">SQL Functions with Unchecked Parameter Types<a class="hash-link" href="#sql-functions-with-unchecked-parameter-types" title="Direct link to heading">​</a></h3><p>Certain SQL functions like <a href="https://www.sqlite.org/json1.html#jex" target="_blank" rel="noopener noreferrer"><code>json_extract</code></a> are variadic (they accept variable number of arguments). To use such functions within CQL, you can declare a SQL function to have untyped parameters by including the <code>NO CHECK</code> clause instead of parameter types.</p><p>For example:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> json_extract </span><span class="token keyword" style="font-style:italic">no</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">check</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This is also supported for SQL table-valued functions:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> table_valued_function </span><span class="token keyword" style="font-style:italic">no</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">check</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">t </span><span class="token keyword" style="font-style:italic">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> i </span><span class="token keyword" style="font-style:italic">int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>Note: currently the <code>NO CHECK</code> clause is not supported for non SQL <a href="#Ordinary-Scalar-Functions">Ordinary Scalar Functions</a>.</p></blockquote><h3 class="anchor anchorWithStickyNavbar_mojV" id="notes-on-builtin-functions">Notes on Builtin Functions<a class="hash-link" href="#notes-on-builtin-functions" title="Direct link to heading">​</a></h3><p>Some of the SQLite builtin functions are hard-coded;  these are the functions that have semantics that are not readily captured with a simple prototype.  Other SQLite functions can be declared with <code>declare select function ...</code> and then used.</p><p>CQL&#x27;s hard-coded builtin list includes:</p><p><em>Aggregate Functions</em></p><ul><li>count</li><li>max</li><li>min</li><li>sum</li><li>total</li><li>avg</li><li>average</li><li>group_concat</li></ul><p><em>Scalar Functions</em></p><ul><li>ifnull</li><li>nullif</li><li>upper</li><li>char</li><li>abs</li><li>instr</li><li>coalesce</li><li>last_insert_rowid</li><li>printf</li><li>strftime</li><li>date</li><li>time</li><li>datetime</li><li>julianday</li><li>substr</li><li>replace</li><li>round</li><li>trim</li><li>ltrim</li><li>rtrim</li></ul><p><em>Window Functions</em></p><ul><li>row_number</li><li>rank</li><li>dense_rank</li><li>percent_rank</li><li>cume_dist</li><li>ntile</li><li>lag</li><li>lead</li><li>first_value</li><li>last_value</li><li>nth_value</li></ul><p>Special Functions</p><ul><li>nullable</li><li>sensitive</li><li>ptr</li></ul><p><code>Nullable</code> casts an operand to the nullable version of its type and otherwise does nothing.  This cast might be useful if you need an exact type match in a situation.  It is stripped from any generated SQL and generated C so it has no runtime effect at all other than the indirect consequences of changing the storage class of its operand.</p><p><code>Sensitive</code> casts an operand to the sensitive version of its type and otherwise does nothing.  This cast might be useful if you need an exact type match in a situation.  It is stripped from any generated SQL and generated C so it has no runtime effect at all other than the indirect consequences of changing the storage class of its operand.</p><p><code>Ptr</code> is used to cause a reference type variable to be bound as a long integer to SQLite. This is a way of giving object pointers to SQLite UDFs. Not all versions of Sqlite support
binding object variables, so passing memory addresses is the best we can do on all versions.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="chapter-9-statements-summary-and-error-checking">Chapter 9: Statements Summary and Error Checking<a class="hash-link" href="#chapter-9-statements-summary-and-error-checking" title="Direct link to heading">​</a></h2><p>The following is a brief discussion of the major statement types and the semantic rules that CQL enforces for each of the statements.  A detailed discussion of SQL statements (the bulk of these) is beyond the scope of this document and you should refer to the SQLite documentation for most details.  However, in many cases CQL does provide additional enforcement and it is helpful to describe the basic checking that happens for each fragment of CQL.  A much
more authoritative list of the things CQL checks for can be inferred from the error documentation.  &quot;Tricky&quot; errors have examples and suggested remediation.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="the-primary-sql-statements">The Primary SQL Statements<a class="hash-link" href="#the-primary-sql-statements" title="Direct link to heading">​</a></h3><p>These are, roughly, the statements that involve the database.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-select-statement">The <code>SELECT</code> Statement<a class="hash-link" href="#the-select-statement" title="Direct link to heading">​</a></h4><p>Top level statement list processing for select.  This is easily the hardest
statement to process. Each clause has its own set of complex rules and
the result of previous clauses constrains the next in a complex fashion.
Among the things that are verified:</p><ul><li>the mentioned tables exist and have the mentioned columns</li><li>the columns are type compatible in their context</li><li>any variables in the expressions are compatible</li><li>aggregate functions are used only in places where aggregation makes sense</li><li>column and table names are unambiguous, especially when self-joins are involved</li><li>compound selects (e.g. with UNION) are type-consistent in all the fragments</li><li>the projection of a select has unique column labels if they are used</li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-select--statement">The <code>SELECT *</code> Statement<a class="hash-link" href="#the-select--statement" title="Direct link to heading">​</a></h4><p><code>SELECT *</code> is special in that it creates its own struct type by assembling
all the columns of all the tables in the select&#x27;s join result.  CQL rewrites these
column names into a new <code>SELECT</code> with the specific columns explicitly listed.
While this makes the program slightly bigger it means that logically deleted columns
are never present in results because <code>SELECT *</code> won&#x27;t select them and attempting
to use a logically deleted column results in an error.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-create-table-statement">The <code>CREATE TABLE</code> Statement<a class="hash-link" href="#the-create-table-statement" title="Direct link to heading">​</a></h4><p>Unlike the other parts of DDL we actually deeply care about the tables.
We have to grab all the columns and column types out of it and create
the appropriate structure type for the table.
Along the way we validate a bunch of stuff like:</p><ul><li>verify unique table name</li><li>no duplicate column names</li><li>recursive correctness of constraints (see constraints discussion below)</li></ul><h5 class="anchor anchorWithStickyNavbar_mojV" id="the-unique-key-clause">The <code>UNIQUE KEY</code> Clause<a class="hash-link" href="#the-unique-key-clause" title="Direct link to heading">​</a></h5><p>Similar to other constraints, we don&#x27;t actually do anything with this
other than offer some validation.  Again, we use the usual helpers
for name lookup within the context of the table that contains the constraint.</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="the-foreign-key-clause">The <code>FOREIGN KEY</code> Clause<a class="hash-link" href="#the-foreign-key-clause" title="Direct link to heading">​</a></h5><p>Similar to other constraints, we don&#x27;t actually do anything with this
other than offer some validation.  Again, we use the usual helpers
for name lookup within the context of the table with the foreign key.
Note that the foreign key has to be validated against two tables to fully validate it.</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="the-primary-key-clause">The <code>PRIMARY KEY</code> Clause<a class="hash-link" href="#the-primary-key-clause" title="Direct link to heading">​</a></h5><p>Similar to other constraints, we don&#x27;t actually do anything with this
other than offer some validation.  Again, we use the usual helpers
for name lookup within the context of the table with the primary key.</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="the-check-clause">The <code>CHECK</code> Clause<a class="hash-link" href="#the-check-clause" title="Direct link to heading">​</a></h5><p>Similar to other constraints, we don&#x27;t actually do anything with this
other than offer some validation.  The <code>CHECK</code> clause is validated
after the entire table has been processed so that even if it appears
early in the table, the clause can use any columns defined later in the
table.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-create-index-statement">The <code>CREATE INDEX</code> Statement<a class="hash-link" href="#the-create-index-statement" title="Direct link to heading">​</a></h4><p>CQL doesn&#x27;t really do anything with indices but we do validate that they make sense (so we lookup all the names of all the columns and so forth.)</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-create-view-statement">The <code>CREATE VIEW</code> Statement<a class="hash-link" href="#the-create-view-statement" title="Direct link to heading">​</a></h4><p>Create view analysis is very simple because the <code>select</code> analysis does the heavy lifting.  All we
have to do is validate that the view is unique, then validate the select statement.</p><p>Additionally, views must not be allowed to have any NULL type columns; all nulls must be converted to
some type with a CAST.   e.g. <code>create view foo as select NULL n</code> is not valid.  NULL is not a real storage type.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-create-trigger-statement">The <code>CREATE TRIGGER</code> Statement<a class="hash-link" href="#the-create-trigger-statement" title="Direct link to heading">​</a></h4><p>The create trigger statement is quite a beast, and validations include:</p><ul><li>The trigger name must be unique</li><li>For <code>insert</code> the &quot;new.*&quot; table is available in expressions/statement</li><li>For <code>delete</code> the &quot;old.*&quot; table is available in expressions/statements</li><li>For <code>update</code> both are available<ul><li>If optional columns present in the <code>update</code>, they must be unique/valid</li></ul></li><li>The <code>when</code> expression must evaluate to a numeric</li><li>The statement list must be error free with the usual rules plus new/old</li><li>The <code>raise</code> function may be used inside a trigger (NYI)</li><li>The table name must be a table (not a view) UNLESS the trigger type is <code>INSTEAD OF</code></li><li>Select statements inside the statement block do not count as returns for the procedure and that includes the create trigger</li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-drop-table-statement">The <code>DROP TABLE</code> Statement<a class="hash-link" href="#the-drop-table-statement" title="Direct link to heading">​</a></h4><p>This is the basic checking for the drop table statement:</p><ul><li>the table must exist in some version</li><li>it has to be a table and not a view</li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-drop-view-statement">The <code>DROP VIEW</code> Statement<a class="hash-link" href="#the-drop-view-statement" title="Direct link to heading">​</a></h4><p>This is the basic checking for the drop view statement:</p><ul><li>the view must exist in some version</li><li>it has to be a view and not a table</li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-drop-index-statement">The <code>DROP INDEX</code> Statement<a class="hash-link" href="#the-drop-index-statement" title="Direct link to heading">​</a></h4><p>This is the basic checking for the drop index statement:</p><ul><li>the index must exist in some version</li><li>it could be deleted now, that&#x27;s ok, but the name has to be valid</li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-drop-trigger-statement">The <code>DROP TRIGGER</code> Statement<a class="hash-link" href="#the-drop-trigger-statement" title="Direct link to heading">​</a></h4><p>This is the basic checking for the drop trigger statement</p><ul><li>the trigger  must exist in some version</li><li>it could be deleted now, that&#x27;s ok, but the name has to be valid</li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-raise-statement">The <code>RAISE</code> Statement<a class="hash-link" href="#the-raise-statement" title="Direct link to heading">​</a></h4><p>CQL validates that <code>RAISE</code> is being used in the context of a trigger and that
it has the correct arguments</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-alter-table-add-column-statement">The <code>ALTER TABLE ADD COLUMN</code> Statement<a class="hash-link" href="#the-alter-table-add-column-statement" title="Direct link to heading">​</a></h4><p>To validate <code>alter table add column</code> we check the following:</p><ul><li>the table must exist and not be a view (in any version)</li><li>the column definition of the new column must be self-consistent</li><li>no auto-increment columns may be added</li><li>added columns must be either nullable or have a default value</li></ul><p>Note: Alter statements are typically used in the context of migration, so it&#x27;s
possible the table that is mentioned is condemned in a future version.  We still have to run
the intervening upgrade steps so basically DDL gets to ignore the current deadness
of the table as in context it might be &quot;not dead yet&quot;.  This will be more obvious
in the context of the schema maintenance features. (q.v.)</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-delete-statement">The <code>DELETE</code> Statement<a class="hash-link" href="#the-delete-statement" title="Direct link to heading">​</a></h4><p>The delete analyzer sets up a scope for the table being
deleted and then validates the WHERE clause, if present, against that scope.
Additionally, we verify that the table actually was defined and is not a view.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-update-statement">The <code>UPDATE</code> Statement<a class="hash-link" href="#the-update-statement" title="Direct link to heading">​</a></h4><p>The update analyzer sets up the scope for the table(s) being updated.  If there are
optional clauses (e.g. <code>LIMIT</code>), they are evaluated just like in a select statement
with those same helper methods.  Expression fragments are evaluated similarly as
in a select statement.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-insert-statement">The <code>INSERT</code> Statement<a class="hash-link" href="#the-insert-statement" title="Direct link to heading">​</a></h4><p>We check that the table exists and then we walk the columns and the value list
to make sure they are valid for the table. Also, we cannot insert into a view.</p><p>Details:</p><ul><li>The column list specifies the columns we will provide; they must exist and be unique.</li><li>The columns specified must suffice to insert a row (all not nulls and not default present.)</li><li>The insert list specifies the values that are to be inserted.</li><li>The type of each value must match the type of the column.</li><li>Auto-increment columns may be specified as NULL.</li><li>If there are too many or too few columns, that is considered an error.</li><li>If no columns are specified, that is the same as if all columns had been specified, in table order.</li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-throw-statement">The <code>THROW</code> Statement<a class="hash-link" href="#the-throw-statement" title="Direct link to heading">​</a></h4><p>Throw can literally go anywhere, so it&#x27;s always ok.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-begin-transaction-statement">The <code>BEGIN TRANSACTION</code> Statement<a class="hash-link" href="#the-begin-transaction-statement" title="Direct link to heading">​</a></h4><p>Begin transaction can go anywhere, so it&#x27;s always ok.</p><p>The sqlite documentation can be helpful here (CQL syntax is a subset).  See: <a href="https://www.sqlite.org/lang_transaction.html" target="_blank" rel="noopener noreferrer">https://www.sqlite.org/lang_transaction.html</a></p><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-commit-transaction-statement">The <code>COMMIT TRANSACTION</code> Statement<a class="hash-link" href="#the-commit-transaction-statement" title="Direct link to heading">​</a></h4><p>Commit transaction can go anywhere, so it&#x27;s always ok.</p><p>The sqlite documentation can be helpful here (CQL syntax is a subset).  See: <a href="https://www.sqlite.org/lang_transaction.html" target="_blank" rel="noopener noreferrer">https://www.sqlite.org/lang_transaction.html</a></p><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-rollback-transaction-statement">The <code>ROLLBACK TRANSACTION</code> Statement<a class="hash-link" href="#the-rollback-transaction-statement" title="Direct link to heading">​</a></h4><p>Rollback transaction can go anywhere but if you&#x27;re using the format
where you rollback to a particular save point, then we must have
seen that name in a <code>savepoint</code> statement previously. Otherwise, it&#x27;s an error.</p><p>The sqlite documentation can be helpful here again (CQL syntax is a subset).  See: <a href="https://www.sqlite.org/lang_transaction.html" target="_blank" rel="noopener noreferrer">https://www.sqlite.org/lang_transaction.html</a></p><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-savepoint-statement">The <code>SAVEPOINT</code> Statement<a class="hash-link" href="#the-savepoint-statement" title="Direct link to heading">​</a></h4><p>The <code>savepoint</code> statement can go anywhere but we do record this savepoint name
as having been seen, so that we can verify it in rollback.  So this is sort of a weak declaration of the savepoint name.</p><p>The sqlite documentation can be helpful here (CQL syntax is a subset).  <a href="https://www.sqlite.org/lang_savepoint.html" target="_blank" rel="noopener noreferrer">https://www.sqlite.org/lang_savepoint.html</a></p><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-release-savepoint-statement">The <code>RELEASE SAVEPOINT</code> Statement<a class="hash-link" href="#the-release-savepoint-statement" title="Direct link to heading">​</a></h4><p>Release savepoint can go anywhere but we must have
seen that name in a previous <code>savepoint</code> statement, otherwise it&#x27;s an error.</p><p>The sqlite documentation can be helpful here (CQL syntax is a subset). <a href="https://www.sqlite.org/lang_savepoint.html" target="_blank" rel="noopener noreferrer">https://www.sqlite.org/lang_savepoint.html</a></p><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-procedure-savepoint-statement">The <code>PROCEDURE SAVEPOINT</code> Statement<a class="hash-link" href="#the-procedure-savepoint-statement" title="Direct link to heading">​</a></h4><p>A common pattern is to have a savepoint associated with a particular procedure. The savepoint&#x27;s scope is the same
as the procedure&#x27;s scope.  More precisely</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">procedure</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">savepoint</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- your code</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>becomes:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">procedure</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">savepoint</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- @proc is always the name of the current procedure</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"> try</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- your code</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">release</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">savepoint</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> try</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"> catch</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">rollback</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">transaction</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">to</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">savepoint</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">release</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">savepoint</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    throw</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> catch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This form is not quite syntactic sugar because there are some interesting rules:</p><ul><li>the <code>proc savepoint</code> form must be used at the top level of the procedure, hence no <code>leave</code> or <code>continue</code> may escape it</li><li>within <code>begin</code>/<code>end</code> the <code>return</code> form may not be used; you must use <code>rollback return</code> or <code>commit return</code> (see below)</li><li><code>throw</code> may be used to return an error as usual</li><li><code>proc savepoint</code> may be used again, at the top level, in the same procedure, if there are, for instance, several sequential stages</li><li>a procedure using <code>proc savepoint</code> could call another such procedure, or a procedure that manipulates savepoints in some other way</li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-rollback-return-statement">The <code>ROLLBACK RETURN</code> Statement<a class="hash-link" href="#the-rollback-return-statement" title="Direct link to heading">​</a></h4><p>This form may be used only inside of  a <code>proc savepoint</code> block.  It indicates that the savepoint should be rolled back and then the procedure
should return.  It is exactly equivalent to:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">rollback</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">transaction</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">to</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">savepoint</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">release</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">savepoint</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">return</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- wouldn&#x27;t actually be allowed inside of proc savepoint; see note below</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note: to avoid errors, the loose <code>return</code> above is not actually allowed inside of <code>proc savepoint</code> -- you must use <code>rollback return</code> or <code>commit return</code>.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-commit-return-statement">The <code>COMMIT RETURN</code> Statement<a class="hash-link" href="#the-commit-return-statement" title="Direct link to heading">​</a></h4><p>This form may be used only inside of  a <code>proc savepoint</code> block.  It indicates that the savepoint should be released and then the procedure
should return.  It is exactly equivalent to:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">release</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">savepoint</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">return</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- wouldn&#x27;t actually be allowed inside of proc savepoint; see note below</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Of course this isn&#x27;t exactly a commit, in that there might be an outer savepoint or outer transaction that might
still be rolled back, but it is commited at its level of nesting, if you will.  Or, equivalently, you can think of
it as merging the savepoint into the transaction in flight.</p><p>Note: to avoid errors, the loose <code>return</code> above is not actually allowed inside of <code>proc savepoint</code> and you must use <code>rollback return</code> or <code>commit return</code>.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-create-virtual-table-statement">The <code>CREATE VIRTUAL TABLE</code> Statement<a class="hash-link" href="#the-create-virtual-table-statement" title="Direct link to heading">​</a></h4><p>The SQLite <code>CREATE VIRTUAL TABLE</code> form (<a href="https://sqlite.org/lang_createvtab.html" target="_blank" rel="noopener noreferrer">https://sqlite.org/lang_createvtab.html</a>) is problematic from CQL because:</p><ul><li>it is not parseable, because the module arguments can be literally anything (or nothing), even a letter to your grandma</li><li>the arguments do not necessarily say anything about the table&#x27;s schema at all</li></ul><p>So the CQL form departs from the standard syntax to this form:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> virtual </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> virt_table </span><span class="token keyword" style="font-style:italic">using</span><span class="token plain"> my_module </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">module arguments</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain">  </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The part after the <code>AS</code> is used by CQL as a table declaration for the virtual table.  The grammar for that
is exactly the same as a normal <code>CREATE TABLE</code> statement.  However, that part is not transmitted to
SQLite; when the table is created, SQLite sees only the part it cares about, which is the part before the <code>AS</code>.</p><p>In order to have strict parsing rules, the module arguments follow one of these forms:</p><ol><li>no arguments at all</li><li>a list of identifiers, constants, and parenthesized sublists, just like in the <code>@attribute</code> form</li><li>the words <code>arguments following</code></li></ol><h5 class="anchor anchorWithStickyNavbar_mojV" id="case-1-example">Case 1 Example<a class="hash-link" href="#case-1-example" title="Direct link to heading">​</a></h5><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> virtual </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> virt_table </span><span class="token keyword" style="font-style:italic">using</span><span class="token plain"> my_module </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>becomes (to SQLite)</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> VIRTUAL </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> virt_table </span><span class="token keyword" style="font-style:italic">USING</span><span class="token plain"> my_module</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note: empty arguments <code>USING my_module()</code> are not allowed in the SQLite docs but do seem to work in SQLite.
We take the position that no args should be formatted with no parentheses, at least for now.</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="case-2-example">Case 2 Example<a class="hash-link" href="#case-2-example" title="Direct link to heading">​</a></h5><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">create virtual table virt_table using my_module(foo, &#x27;goo&#x27;, (1.5, (bar, baz))) as (</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  id integer not null,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name text</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">);</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">CREATE VIRTUAL TABLE virt_table USING my_module(foo, &quot;goo&quot;, (1.5, (bar, baz)));</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This form allows for very flexible arguments but not totally arbitrary arguments, so it can still be
parsed and validated.</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="case-3-example">Case 3 Example<a class="hash-link" href="#case-3-example" title="Direct link to heading">​</a></h5><p>This case recognizes the popular choice that the arguments are often the actual schema declaration
for the table in question. So:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">create virtual table virt_table using my_module(arguments following) as (</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  id integer not null,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name text</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">);</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>becomes</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">CREATE VIRTUAL TABLE virt_table USING my_module(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  id INTEGER NOT NULL,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name TEXT</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">);</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The normalized text (keywords capitalized, whitespace normalized) of the table declaration in the <code>as</code> clause is used as the arguments.</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="other-details">Other details<a class="hash-link" href="#other-details" title="Direct link to heading">​</a></h5><p>Virtual tables go into their own section in the JSON and they include the <code>module</code> and <code>moduleArgs</code> entries; they are additionally
marked <code>isVirtual</code> in case you want to use the same processing code for virtual tables as normal tables.  The JSON format is otherwise
the same, although some things can&#x27;t happen in virtual tables (e.g. there is no <code>TEMP</code> option so <code>&quot;isTemp&quot;</code> must be false in the JSON.)</p><p>For purposes of schema processing, virtual tables are on the <code>@recreate</code> plan, just like indices, triggers, etc.  This is the only option since
the <code>alter table</code> form is not allowed on a virtual table.</p><p>Semantic validation enforces &quot;no alter statements on virtual tables&quot; as well as other things like no indices, and no triggers, since SQLite
does not support any of those things.</p><p>CQL supports the notion of <a href="https://www.sqlite.org/vtab.html#epovtab" target="_blank" rel="noopener noreferrer">eponymous virtual tables</a>.  If you intend to register the virtual
table&#x27;s module in this fashion, you can use <code>create virtual table @eponymous ...</code> to declare this to CQL.  The only effect this has
is to ensure that CQL will not try to drop this table during schema maintenance as dropping such a table is an invalid operation.  In
all other ways, the fact that the table is eponymous makes no difference.</p><p>Finally, because virtual tables are on the <code>@recreate</code> plan, you may not have foreign keys that reference virtual tables. Such keys seem
like a bad idea in any case.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="the-primary-procedure-statements">The Primary Procedure Statements<a class="hash-link" href="#the-primary-procedure-statements" title="Direct link to heading">​</a></h3><p>These are the statements which form the language of procedures, and do not involve the database.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-create-procedure-statement">The <code>CREATE PROCEDURE</code> Statement<a class="hash-link" href="#the-create-procedure-statement" title="Direct link to heading">​</a></h4><p>Semantic analysis of stored procedures is fairly easy at the core:</p><ul><li>check for duplicate names</li><li>validate the parameters are well formed</li><li>set the current proc in flight (this not allowed to nest)</li><li>recurse on the statement list and prop errors</li><li>record the name of the procedure for callers
In addition, while processing the statement:</li><li>we determine if it uses the database; this will change the emitted signature of the proc to include a <code>sqlite3 *db</code>
input argument and it will return a sqlite error code (e.g. <code>SQLITE_OK</code>)</li><li>select statements that are loose in the proc represent the &quot;return&quot; of that
select;  this changes the signature to include a <code>sqlite3_stmt **pstmt</code> parameter corresponding to the returned statement</li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-if-statement-1">The <code>IF</code> Statement<a class="hash-link" href="#the-if-statement-1" title="Direct link to heading">​</a></h4><p>The top level if node links the initial condition with a possible
series of else_if nodes and then the else node.  Each condition is
checked for validity. The conditions must be valid expressions that
can each be converted to a boolean.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-set-statement">The <code>SET</code> Statement<a class="hash-link" href="#the-set-statement" title="Direct link to heading">​</a></h4><p>The set statement is for variable assignment.  We just validate
that the target exists and is compatible with the source.
Cursor variables cannot be set with simple assignment and CQL generates
errors if you attempt to do so.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-let-statement">The <code>LET</code> Statement<a class="hash-link" href="#the-let-statement" title="Direct link to heading">​</a></h4><p>Let combines a <code>DECLARE</code> and a <code>SET</code>.  The variable is declared to be
the exact type of the right hand side.  All the validations for <code>DECLARE</code>
and <code>SET</code> are applicable, but there is no chance that the variable will
not be compatible with the expression.  The expression could still be
erroneous in the first place.  The variable could be a duplicate.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-switch-statement-1">The <code>SWITCH</code> Statement<a class="hash-link" href="#the-switch-statement-1" title="Direct link to heading">​</a></h4><p>The <code>SWITCH</code> form requires a number of conditions to successfully map
down to a <code>C</code> <code>switch</code> statement.  These are:</p><ul><li>the switch-expression must be a not-null integral type (<code>integer not null</code> or <code>long integer not null</code>)<ul><li>the <code>WHEN</code> expressions must be losslessly promotable to the type of the switch-expression</li></ul></li><li>the values in the <code>WHEN</code> clauses must be unique</li><li>If <code>ALL VALUES</code> is present then:<ul><li>the switch-expression must be of an enum type</li><li>the <code>WHEN</code> values must cover every value of the enum except those beginning with &#x27;_&#x27;</li><li>there can be no extra <code>WHEN</code> values not in the enum</li><li>there can be no <code>ELSE</code> clause</li></ul></li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-declare-procedure-statement">The <code>DECLARE PROCEDURE</code> Statement<a class="hash-link" href="#the-declare-procedure-statement" title="Direct link to heading">​</a></h4><p>There are three forms of this declaration:</p><ul><li>a regular procedure with no DML<ul><li>e.g. <code>declare proc X(id integer);</code></li></ul></li><li>a regular procedure that uses DML (it will need a db parameter and returns a result code)<ul><li>e.g. <code>declare proc X(id integer) using transaction;</code></li></ul></li><li>a procedure that returns a result set, and you provide the result columns<ul><li>e.g. <code>declare proc X(id integer) : (A bool not null, B text);</code>
The main validations here are that there are no duplicate parameter names, or return value columns.</li></ul></li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-declare-function-statement">The <code>DECLARE FUNCTION</code> Statement<a class="hash-link" href="#the-declare-function-statement" title="Direct link to heading">​</a></h4><p>Function declarations are similar to procedures; there must be a return type
(use proc if there is none).  The <code>DECLARE SELECT FUNCTION</code> form indicates a function
visible to SQLite; other functions are usable in the <code>call</code> statement.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-declare-variable-statement">The <code>DECLARE</code> Variable Statement<a class="hash-link" href="#the-declare-variable-statement" title="Direct link to heading">​</a></h4><p>This declares a new local or global variable that is not a cursor.
The type is computed with the same helper that is used for analyzing
column definitions.  Once we have the type we walk the list of variable
names, check them for duplicates and such (see above) and assign their type.  The canonical
name of the variable is defined here. If it is later used with a different casing the output
will always be as declared.   e.g. <code>declare Foo integer;  set foo = 1;</code> is legal but the output
will always contain the variable written as <code>Foo</code>.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-declare-cursor-statement">The <code>DECLARE</code> Cursor Statement<a class="hash-link" href="#the-declare-cursor-statement" title="Direct link to heading">​</a></h4><p>There are two forms of the declare cursor, both of which allow CQL to infer the exact type of the cursor.</p><ul><li><code>declare foo cursor for select etc.</code><ul><li>the type of the cursor is the net struct type of the select list</li></ul></li><li><code>declare foo cursor for call proc();</code><ul><li>proc must be statement that produces a result set via select (see above)</li><li>the type of the cursor is the struct of the select returned by the proc</li><li>note if there is more than one loose select in the proc they must match exactly</li></ul></li><li>cursor names have the same rules regarding duplicates as other variables
With this in mind, both cases simply recurse on either the select or the call
and then pull out the structure type of that thing and use it for the cursor&#x27;s shape.  If the
<code>call</code> is not semantically valid according to the rules for calls or the <code>select</code> is not semantically valid,
then of course this declaration will generate errors.</li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-declare-value-cursor-statement">The <code>DECLARE</code> Value Cursor Statement<a class="hash-link" href="#the-declare-value-cursor-statement" title="Direct link to heading">​</a></h4><p>This statement declares a cursor that will be based on the return type of a procedure.
When using this form the cursor is also fetched, hence the name.  The fetch result of
the stored proc will be used for the value.  At this point, we use its type only.</p><ul><li>the call must be semantically valid</li><li>the procedure must return an OUT parameter (not a result set)</li><li>the cursor name must be unique</li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-while-statement-1">The <code>WHILE</code> Statement<a class="hash-link" href="#the-while-statement-1" title="Direct link to heading">​</a></h4><p>While semantic analysis is super simple.</p><ul><li>the condition must be numeric</li><li>the statement list must be error-free</li><li>loop_depth is increased allowing the use of interior leave/continue</li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-loop-statement">The <code>LOOP</code> Statement<a class="hash-link" href="#the-loop-statement" title="Direct link to heading">​</a></h4><p>Loop analysis is just as simple as &quot;while&quot; -- because the loop_stmt
literally has an embedded fetch, you simply use the fetch helper to
validate that the fetch is good and then visit the statement list.
Loop depth is increased as it is with while.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-call-statement">The <code>CALL</code> Statement<a class="hash-link" href="#the-call-statement" title="Direct link to heading">​</a></h4><p>There are three ways that a call can happen:</p><ul><li>signatures of procedures that we know in full:<ul><li>call foo();</li><li>declare cursor for call foo();</li></ul></li><li>some external call to some outside function we don&#x27;t know<ul><li>e.g. call printf(&#x27;hello, world\n&#x27;);</li></ul></li></ul><p>The cursor form can be used if and only if the procedure has a loose select
or a call to a procedure with a loose select. In that case, the procedure will
have a structure type, rather than just &quot;ok&quot; (the normal signature for a proc).
If the user is attempting to do the second case, cursor_name will be set and
the appropriate verification happens here.</p><p>Note:  Recursively calling fetch cursor is not really doable in general
because at the point in the call we might not yet know that the method
does in fact return a select.  You could make it work if you put the select
before the recursive call.</p><p>Semantic rules:</p><ul><li>for all cases each argument must be error-free (no internal type conflicts)</li><li>for known procs<ul><li>the call has to have the correct number of arguments</li><li>if the formal is an out parameter the argument must be a variable<ul><li>the type of the variable must be an exact type match for the formal</li></ul></li><li>non-out parameters must be type-compatible, but exact match is not required</li></ul></li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-declare-out-call-statement">The <code>DECLARE OUT CALL</code> Statement<a class="hash-link" href="#the-declare-out-call-statement" title="Direct link to heading">​</a></h4><p>This form is syntactic sugar and corresponds to declaring any <code>OUT</code> parameters
of the <code>CALL</code> portion that are not already declared as the exact type of the
<code>OUT</code> parameter.  This is intended to save you from declaring a lot of variables
just so that you can use them as <code>OUT</code> arguments.</p><p>Since any variables that already exist are not re-declared, there are no
additional semantic rules beyond the normal call except that it is an error
to use this form if no <code>OUT</code> variables needed to be declared.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-fetch-statement">The <code>FETCH</code> Statement<a class="hash-link" href="#the-fetch-statement" title="Direct link to heading">​</a></h4><p>The fetch statement has two forms:</p><ul><li>fetch C into var1, var2, var3 etc.</li><li>fetch C;
The second form is called the auto_cursor.
In the first form the variables of the cursor must be assignment compatible
with declared structure type of the cursor and the count must be correct.
In the second form, the codegen will implicitly create local variables that
are exactly the correct type, but we&#x27;ll cover that later.  Since no semantic error is
possible in that case, we simply record that this is an auto_cursor and then
later we will allow the use of C.field during analysis.
Of course &quot;C&quot; must be a valid cursor.</li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-continue-statement">The <code>CONTINUE</code> Statement<a class="hash-link" href="#the-continue-statement" title="Direct link to heading">​</a></h4><p>We just need to ensure that <code>continue</code> is inside a <code>loop</code> or <code>while</code>.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-leave-statement">The <code>LEAVE</code> Statement<a class="hash-link" href="#the-leave-statement" title="Direct link to heading">​</a></h4><p>We only need to ensure that <code>leave</code> is inside a <code>loop</code>, <code>while</code> or <code>switch</code>.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-trycatch-statements">The <code>TRY/CATCH</code> Statements<a class="hash-link" href="#the-trycatch-statements" title="Direct link to heading">​</a></h4><p>No analysis needed here other than that the two statement lists are ok.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-close-cursor-statement">The <code>CLOSE</code> CURSOR Statement<a class="hash-link" href="#the-close-cursor-statement" title="Direct link to heading">​</a></h4><p>For close <!-- -->[cursor]<!-- -->, we just validate that the name is in fact a cursor
and it is not a boxed cursor.  Boxed cursor lifetime is managed by the
box object so manually closing it is not allowed.  Instead, the usual
reference-counting semantics apply; the boxed cursor variable typically falls out of
scope and is released, or is perhaps set to NULL to release its reference early.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-out-cursor-statement">The <code>OUT</code> CURSOR Statement<a class="hash-link" href="#the-out-cursor-statement" title="Direct link to heading">​</a></h4><p>For out <!-- -->[cursor]<!-- -->, we first validate that the name is a cursor
then we set the output type of the procedure we&#x27;re in accordingly.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="the-meta-statements">The &quot;Meta&quot; Statements<a class="hash-link" href="#the-meta-statements" title="Direct link to heading">​</a></h3><p>The program&#x27;s control/ the overall meaning of the program / or may give the compiler specific directives
as to how the program should be compiled.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-echo-statement">The <code>@ECHO</code> Statement<a class="hash-link" href="#the-echo-statement" title="Direct link to heading">​</a></h4><p>Echo is valid in any top level contexts.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-previous-schema-statement">The <code>@PREVIOUS SCHEMA</code> Statement<a class="hash-link" href="#the-previous-schema-statement" title="Direct link to heading">​</a></h4><p>Begins the region where previous schema will be compared against what has been
declared before this directive for alterations that could not be upgraded.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-schema_upgrade_script-statement">The <code>@SCHEMA_UPGRADE_SCRIPT</code> Statement<a class="hash-link" href="#the-schema_upgrade_script-statement" title="Direct link to heading">​</a></h4><p>When upgrading the DDL, it&#x27;s necessary to emit create table statements
for the original version of the schema.  These create statements may conflict
with the current version of the schema.  This attribute tells CQL to
1) ignore DDL in stored procedures for declaration purposes; only DDL outside of a proc counts
2) do not make any columns &quot;hidden&quot; thereby allowing all annotations to be present
so they can be used to validate other aspects of the migration script.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-schema_upgrade_version-statement">The <code>@SCHEMA_UPGRADE_VERSION</code> Statement<a class="hash-link" href="#the-schema_upgrade_version-statement" title="Direct link to heading">​</a></h4><p>For sql stored procedures that are supposed to update previous schema versions
you can use this attribute to put CQL into that mindset.  This will make
the columns hidden for the version in question rather than the current version.
This is important because older schema migration procedures might still refer to
old columns.  Those columns truly exist at that schema version.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-enforce_strict-statement">The <code>@ENFORCE_STRICT</code> Statement<a class="hash-link" href="#the-enforce_strict-statement" title="Direct link to heading">​</a></h4><p>Switch to strict mode for the indicated item.  The choices and their meanings are:</p><ul><li>&quot;FOREIGN KEY ON DELETE&quot; indicates there must be some <code>ON DELETE</code> action in every FK</li><li>&quot;FOREIGN KEY ON UPDATE&quot; indicates there must be some <code>ON UPDATE</code> action in every FK</li><li>&quot;INSERT SELECT&quot; indicates that insert with <code>SELECT</code> for values may not include top level joins (avoiding a SQLite bug)</li><li>&quot;IS TRUE&quot; indicates that <code>IS TRUE</code> <code>IS FALSE</code> <code>IS NOT TRUE</code> <code>IS NOT FALSE</code> may not be used (*)</li><li>&quot;JOIN&quot; indicates only ANSI style joins may be used, and &quot;from A,B&quot; is rejected</li><li>&quot;PROCEDURE&quot; indicates no calls to undeclared procedures (like loose printf calls)</li><li>&quot;SELECT IF NOTHING&quot; indicates <code>(select ...)</code> expressions must include an <code>IF NOTHING</code> clause if they have a <code>FROM</code> part</li><li>&quot;TABLE FUNCTIONS&quot; indicates table valued functions cannot be used on left/right joins (avoiding a SQLite bug)</li><li>&quot;TRANSACTION&quot; indicates no transactions may be started, committed, or aborted</li><li>&quot;UPSERT&quot; indicates no upsert statement may be used (*)</li><li>&quot;WINDOW FUNCTION&quot; indicates no window functions may be used (*)</li><li>&quot;WITHOUT ROWID&quot; indicates <code>WITHOUT ROWID</code> may not be used</li></ul><p>The items marked with * are present so that features can be disabled to target downlevel versions of SQLite
that may not have those features.</p><p>See the grammar details for exact syntax.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-enforce_normal-statement">The <code>@ENFORCE_NORMAL</code> Statement<a class="hash-link" href="#the-enforce_normal-statement" title="Direct link to heading">​</a></h4><p>Turn off strict enforcement for the indicated item.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-enforce_push-statement">The <code>@ENFORCE_PUSH</code> Statement<a class="hash-link" href="#the-enforce_push-statement" title="Direct link to heading">​</a></h4><p>Push the current strict settings onto the enforcement stack.  This does not change the current settings.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-enforce_pop-statement">The <code>@ENFORCE_POP</code> Statement<a class="hash-link" href="#the-enforce_pop-statement" title="Direct link to heading">​</a></h4><p>Pop the previous current strict settings from the enforcement stack.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-enforce_reset-statement">The <code>@ENFORCE_RESET</code> Statement<a class="hash-link" href="#the-enforce_reset-statement" title="Direct link to heading">​</a></h4><p>Turns off all the strict modes.  Best used immediately after <code>@ENFORCE_PUSH</code>.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-declare_schema_region-statement">The <code>@DECLARE_SCHEMA_REGION</code> Statement<a class="hash-link" href="#the-declare_schema_region-statement" title="Direct link to heading">​</a></h4><p>A schema region is a partitioning of the schema such that it
only uses objects in the same partition or one of its declared
dependencies.  One schema region may be upgraded independently
from any others (assuming they happen such that dependents are done first.)
Here we validate:</p><ul><li>the region name is unique</li><li>the dependencies (if any) are unique and exist</li><li>the directive is not inside a procedure</li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-begin_schema_region-statement">The <code>@BEGIN_SCHEMA_REGION</code> Statement<a class="hash-link" href="#the-begin_schema_region-statement" title="Direct link to heading">​</a></h4><p>Entering a schema region makes all the objects that follow part of that
region.  It also means that all the contained objects must refer to
only pieces of schema that are in the same region or a dependent region.
Here we validate that region we are entering is in fact a valid region
and that there isn&#x27;t already a schema region.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-end_schema_region-statement">The <code>@END_SCHEMA_REGION</code> Statement<a class="hash-link" href="#the-end_schema_region-statement" title="Direct link to heading">​</a></h4><p>Leaving a schema region puts you back in the default region.
Here we check that we are in a schema region.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-emit_enums-statement">The <code>@EMIT_ENUMS</code> Statement<a class="hash-link" href="#the-emit_enums-statement" title="Direct link to heading">​</a></h4><p>Declared enumarations can be voluminous and it is undesirable for every
emitted <code>.h</code> file to contain every enumeration.  To avoid this problem
you can emit enumeration values of your choice using <code>@emit_enums x, y, z</code>
which places the named enumerations into the <code>.h</code> file associated with
the current translation unit. If no enumerations are listed, all enums
are emitted.</p><p>Note: generated enum definitions are protected by <code>#ifndef X ... #endif</code> so multiple
definitions are harmless and hence you can afford to use <code>@emit_enums</code>
for the same enum in several translations units, if desired.</p><p>Note: Enumeration values also appear in the JSON output in their own section.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-emit_constants-statement">The <code>@EMIT_CONSTANTS</code> Statement<a class="hash-link" href="#the-emit_constants-statement" title="Direct link to heading">​</a></h4><p>This statement is entirely analogous to the the <code>@EMIT_ENUMS</code> except that
the parameters are one or more constant groups.  In fact constants are put
into groups precisely so that they can be emitted in logical bundles (and
to encourage keeping related constants together).  Placing <code>@EMIT_CONSTANTS</code>
causes the C version of the named groups to go into the current <code>.h</code> file.</p><p>Note: Global constants also appear in the JSON output in their own section.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="important-program-fragments">Important Program Fragments<a class="hash-link" href="#important-program-fragments" title="Direct link to heading">​</a></h3><p>These items appear in a variety of places and are worthy of discussion.  They are generally handled uniformly.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="argument-lists">Argument Lists<a class="hash-link" href="#argument-lists" title="Direct link to heading">​</a></h4><p>In each case we walk the entire list and do the type inference on each argument.
Note that this happens in the context of a function call, and depending
on what the function is, there may be additional rules for compatibility of the
arguments with the function.  The generic code doesn&#x27;t do those checks, there
is per-function code that handles that sort of thing.</p><p>At this stage the compiler computes the type of each argument and makes sure
that, independently, they are not bogus.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="procedures-that-return-a-result-set">Procedures that return a Result Set<a class="hash-link" href="#procedures-that-return-a-result-set" title="Direct link to heading">​</a></h4><p>If a procedure is returning a select statement then we need to attach a
result type to the procedure&#x27;s semantic info.  We have to do some extra validation
at this point, especially if the procedure already has some other select that
might be returned.  The compiler ensures that all the possible select results are
are 100% compatible.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="general-name-lookups">General Name Lookups<a class="hash-link" href="#general-name-lookups" title="Direct link to heading">​</a></h4><p>Every name is checked in a series of locations.  If the name is known to be
a table, view, cursor, or some other specific type of object then only those
name are considered.  If the name is more general a wider search is used.</p><p>Among the places that are considered:</p><ul><li>columns in the current join if any (this must not conflict with #2)</li><li>local or global variables</li><li>fields in an open cursor</li><li>fields in enumerations and global constants</li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="data-types-with-a-discriminator">Data Types with a Discriminator<a class="hash-link" href="#data-types-with-a-discriminator" title="Direct link to heading">​</a></h4><p>Discriminators can appear on any type, <code>int</code>, <code>real</code>, <code>object</code>, etc.</p><p>Where there is a discriminator the compiler checks that (e.g.) <code>object&lt;Foo&gt;</code> only combines
with <code>object&lt;Foo&gt;</code> or <code>object</code>.  <code>real&lt;meters&gt;</code> only combines with <code>real&lt;meters&gt;</code> or <code>real</code>.
In this way its not possible to accidentally add <code>meters</code> to <code>kilograms</code> or to store
an <code>int&lt;task_id&gt;</code> where an <code>int&lt;person_id&gt;</code> is required.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-case-expression">The <code>CASE</code> Expression<a class="hash-link" href="#the-case-expression" title="Direct link to heading">​</a></h4><p>There are two parts to this: the &quot;when&quot; expression and the &quot;then&quot; expression.
We compute the aggregate type of the &quot;when&quot; expressions as we go, promoting it
up to a larger type if needed (e.g. if one &quot;when&quot; is an int and the other is
a real, then the result is a real).  Likewise, nullability is computed as
the aggregate.  Note that if nothing matches, the result is null, so we always
get a nullable resultm unless there is an &quot;else&quot; expression.
If we started with case expression, then each &quot;when&quot; expression must be comparable
to the case expression.  If we started with case when xx then yy;  then
each case expression must be numeric (typically boolean).</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-between-expressions">The <code>BETWEEN</code> EXPRESSIONS<a class="hash-link" href="#the-between-expressions" title="Direct link to heading">​</a></h4><p>Between requires type compatibility between all three of its arguments.
Nullability follows the usual rules: if any might be null then the result
type might be null.  In any case, the result&#x27;s core type is BOOL.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-cast-expression">The <code>CAST</code> Expression<a class="hash-link" href="#the-cast-expression" title="Direct link to heading">​</a></h4><p>For cast expressions we use the provided semantic type;
the only trick is that we preserve the extra properties of the input argument.
e.g. CAST does not remove <code>NOT NULL</code>.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-coalesce-function">The <code>COALESCE</code> Function<a class="hash-link" href="#the-coalesce-function" title="Direct link to heading">​</a></h4><p>Coalesce requires type compatibility between all of its arguments.  The result
is a not null type if we find a not null item in the list.  There should be
nothing after that item.  Note that ifnull and coalesce are really the same thing
except ifnull must have exactly two arguments.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="the-in-and-not-in-expressions">The <code>IN</code> AND <code>NOT IN</code> Expressions<a class="hash-link" href="#the-in-and-not-in-expressions" title="Direct link to heading">​</a></h4><p>The in predicate is like many of the other multi-argument operators.  All the
items must be type compatible.  Note that in this case the nullablity of
the items does not matter, only the nullability of the item being tested.
Note that null in (null) is null, not true.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="aggregate-functions">Aggregate Functions<a class="hash-link" href="#aggregate-functions" title="Direct link to heading">​</a></h4><p>Aggregate functions can only be used in certain places.  For instance
they may not appear in a <code>WHERE</code> clause.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="user-defined-functions">User Defined Functions<a class="hash-link" href="#user-defined-functions" title="Direct link to heading">​</a></h4><p>User defined function - this is an external function.
There are a few things to check:</p><ul><li>If this is declared without the select keyword then<ul><li>we can&#x27;t use these in SQL, so this has to be a loose expression</li></ul></li><li>If this is declared with the select keyword then<ul><li>we can ONLY use these in SQL, not in a loose expression</li></ul></li><li>args have to be compatible with formals</li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="calling-a-procedure-as-a-function">Calling a procedure as a function<a class="hash-link" href="#calling-a-procedure-as-a-function" title="Direct link to heading">​</a></h4><p>There are a few things to check:</p><ul><li>we can&#x27;t use these in SQL, so this has to be a loose expression</li><li>args have to be compatible with formals, except</li><li>the last formal must be an OUT arg and it must be a scalar type</li><li>that out arg will be treated as the return value of the &quot;function&quot;</li><li>in code-gen we will create a temporary for it; semantic analysis doesn&#x27;t care</li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="root-expressions">Root Expressions<a class="hash-link" href="#root-expressions" title="Direct link to heading">​</a></h4><p>A top level expression defines the context for that evaluation.  Different expressions
can have constraints.  e.g. aggregate functions may not appear in the <code>WHERE</code> clause of a statement.  There are cases where expression nesting can happen. This nesting changes the evaluation context accordingly, e.g. you can put a nested select in a where clause and that
nested select could legally have aggregates.  Root expressions keep a stack of nested contexts to facilitate the changes.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="table-factors">Table Factors<a class="hash-link" href="#table-factors" title="Direct link to heading">​</a></h4><p>A table factor is one of three things:</p><ul><li>a table name (a string)  select * from X</li><li>a select subquery (select X,Y from..) as T2</li><li>a list of table references select * from (X, Y, Z)
Here we dispatch to the appropriate helper for each case.</li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="joining-with-the-using-clause">Joining with the <code>USING</code> Clause<a class="hash-link" href="#joining-with-the-using-clause" title="Direct link to heading">​</a></h4><p>When specifying joins, one of the alternatives is to give the shared
columns in the join e.g. select * from X inner join Y using (a,b).
This method validates that all the columns are present on both sides of the
join, that they are unique, and they are comparable.
The return code tells us if any columns had SENSITIVE data.   See Special Note on JOIN...USING below</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="join-with-the-on-clause">JOIN WITH THE <code>ON</code> Clause<a class="hash-link" href="#join-with-the-on-clause" title="Direct link to heading">​</a></h4><p>The most explicit join condition is a full expression in an ON clause
this is like <code>select a,b from X inner join Y on X.id = Y.id;</code>
The on expression should be something that can be used as a bool,
so any numeric will do.
The return code tells us if the ON condition used SENSITIVE data.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="table-valued-functions">TABLE VALUED FUNCTIONS<a class="hash-link" href="#table-valued-functions" title="Direct link to heading">​</a></h4><p>Table valued functions can appear anywhere a table is allowed.
The validation rules are:</p><ul><li><p>must be a valid function</p></li><li><p>must return a struct type (i.e. a table-valued-function)</p></li><li><p>must have valid arg expressions</p></li><li><p>arg expressions must match formal parameters
The name of the resulting table is the name of the function</p></li><li><p>but it can be aliased later with &quot;AS&quot;</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="special-note-on-the-select--and-select-t-forms">Special Note on the <code>select *</code> and <code>select T.*</code> forms<a class="hash-link" href="#special-note-on-the-select--and-select-t-forms" title="Direct link to heading">​</a></h3><p>The <code>select *</code> construct is very popular in many codebases but it can be unsafe to use in production code because, if the schema changes, the code might get columns it does not expect.  Note the extra columns could have appeared anywhere in the result set because the <code>*</code> applies to the entire result of the <code>FROM</code> clause, joins and all, so extra columns are not necessarily at the end and column ordinals are not preserved.  CQL mitigates this situation somewhat with some useful constraints/features:</p></li><li><p>in a <code>select *</code>, and indeed in any query, the column names of the select must be unique, this is because:</p><ul><li>they could form the field names of an automatically generated cursor (see the section on cursors)</li><li>they could form the field names in a CQL result set (see section on result sets)</li><li>it&#x27;s weird/confusing to not have unique names generally</li></ul></li><li><p>when issuing a <code>select *</code> or a <code>select T.*</code> CQL will automatically expand the <code>*</code> into the actual logical columns that exist in the schema at the time the code was compiled</p><ul><li>this is important because if a column had been logically deleted from a table it would be unexpected in the result set even though it is still present in the database and would throw everything off</li><li>likewise if the schema were to change without updating the code, the code will still get the columns it was compiled with, not new columns</li></ul></li></ul><p>Expanding the <code>*</code> at compile time means Sqlite cannot see anything that might tempt it to include different columns in the result.</p><p>With this done we just have to look at the places a <code>select *</code> might appear so we can see if it is safe (or at least reasonably safe) to use <code>*</code> and, by extension of the same argument, <code>T.*</code>.</p><p><em>In an <code>EXISTS</code> or <code>NOT EXISTS</code> clause like `where not exists (select </em> from x)`*</p><ul><li>this is perfectly safe; the particular columns do not matter; <code>select *</code> is not even expanded in this case.</li></ul><p><em>In a statement that produces a result set like `select </em> from table_or_view`*</p><ul><li>binding to a CQL result set is done by column name and we know those names are unique</li><li>we won&#x27;t include any columns that are logically deleted, so if you try to use a deleted column you&#x27;ll get a compile time error</li></ul><p>In a cursor statement like <code>declare C cursor for select * from table_or_view</code> there are two cases here:</p><p><em>Automatic Fetch  <code>fetch C;</code></em></p><ul><li>in this case you don&#x27;t specify the column names yourself;2 they are inferred</li><li>you are therefore binding to the columns by name, so new columns in the cursor would be unused (until you choose to start using them)</li><li>if you try to access a deleted column you get a compile-time error</li></ul><p><em>Manual Fetch:  <code>fetch C into a, b, c;</code></em></p><ul><li>In this case the number and type of the columns must match exactly with the specified variables</li><li>If new columns are added, deleted, or changed, the above code will not compile</li></ul><p>So considering the cases above we can conclude that auto expanding the <code>*</code> into the exact columns present in the compile-time schema version ensures that any incompatible changes result in compile time errors. Adding columns to tables does not cause problems even if the code is not recompiled. This makes the <code>*</code> construct much safer, if not perfect, but no semantic would be safe from arbitrary schema changes without recompilation.  At the very least here we can expect a meaningful runtime error rather than silently fetching the wrong columns.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="special-note-on-the-joinusing-form">Special Note on the JOIN...USING form<a class="hash-link" href="#special-note-on-the-joinusing-form" title="Direct link to heading">​</a></h3><p>CQL varies slightly from SQLite in terms of the expected results for joins if the USING syntax is employed.  This is not the most common syntax (typically an ON clause is used) but Sqlite has special rules for this kind of join.</p><p>Let&#x27;s take a quick look.  First some sample data:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">create table A( id integer, a text, b text);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create table B( id integer, c text, d text);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">insert into A values(1, &#x27;a1&#x27;, &#x27;b1&#x27;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">insert into B values(1, &#x27;c1&#x27;, &#x27;d1&#x27;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">insert into A values(2, &#x27;a2&#x27;, &#x27;b2&#x27;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">insert into B values(2, &#x27;c2&#x27;, &#x27;d2&#x27;);</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now let&#x27;s look at the normal join; this is our reference:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">select * from A T1 inner join B T2 on T1.id = T2.id;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">result:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">1|a1|b1|1|c1|d1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2|a2|b2|2|c2|d2</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>As expected, you get all the columns of A, and all the columns of B.  The &#x27;id&#x27; column appears twice.</p><p>However, with the <code>USING</code> syntax:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">select * T1 inner join B T2 using (id);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">result:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">1|a1|b1|c1|d1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2|a2|b2|c2|d2</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>id</code> column is now appearing exactly once.  However, the situation is not so simple as that.  It seems that what hapened was that the <code>*</code> expansion has not included two copies of the <code>id</code>.  The following cases show that both copies of <code>id</code> are still logically in the join.</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">select T1.*, &#x27;xxx&#x27;, T2.* from A T1 inner join B T2 using (id);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">result:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">1|a1|b1|xxx|1|c1|d1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2|a2|b2|xxx|2|c2|d2</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>T2.id</code> column is part of the join, it just wasn&#x27;t part of the <code>*</code></p><p>In fact, looking further:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">select T1.id, T1.a, T1.b, &#x27;xxx&#x27;, T2.id, T2.c, T2.d from A T1 inner join B T2 using (id);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">result:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">1|a1|b1|xxx|1|c1|d1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2|a2|b2|xxx|2|c2|d2</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>There is no doubt, <code>T2.id</code> is a valid column and can be used in expressions freely. That means the column cannot be removed from the type calculus.</p><p>Now in CQL, the <code>*</code> and <code>T.*</code> forms are automatically expanded; SQLite doesn&#x27;t see the <code>*</code>.  This is done so that if any columns have been logically deleted they can be elided from the result set.  Given that this happens, the <code>*</code> operator will expand to ALL the columns.  Just the same as if you did <code>T1.*</code> and <code>T2.*</code>.</p><p><em>As a result, in CQL, there is no difference between  the <code>USING</code> form of a join and the <code>ON</code> form of a join.</em></p><p>In fact, only the <code>select *</code> form could possibly be different, so in most cases this ends up being moot anyway.  Typically, you don&#x27;t need to use <code>*</code> in the presence of joins because of name duplication and ambiguity of the column names of the result set.  CQL&#x27;s automatic expansion means you have a much better idea exactly what columns you will get - those that were present in the schema you declared.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="chapter-10-schema-management-features">Chapter 10: Schema Management Features<a class="hash-link" href="#chapter-10-schema-management-features" title="Direct link to heading">​</a></h2><p>CQL has a lot of schema knowledge already and so it&#x27;s well positioned to think about schema upgrades and versioning.</p><p>It seemed essential to be able to record changes to the schema over time so CQL got an understanding of versioning.  This lets you do things like:</p><ul><li>ensure columns are only added where they should be</li><li>generate compiler errors if you try to access columns that are deprecated</li><li>move from one version to another tracking schema facets that have to be added</li></ul><p>To use cql in this fashion, the sequence will be something like the below.  See Appendix 1 for command line details.</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cql --in input.sql --rt schema_upgrade --cg schema_upgrader.sql \</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                   --global_proc desired_upgrade_proc_name</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="annotations">Annotations<a class="hash-link" href="#annotations" title="Direct link to heading">​</a></h3><p>There are three basic flavors of annotation</p><ul><li><code>@create(version [, migration proc])</code></li><li><code>@delete(version [, migration proc])</code></li><li><code>@recreate</code></li></ul><p>They have various constraints:</p><ul><li><code>@create</code> and <code>@delete</code> can only be applied to tables and columns</li><li><code>@recreate</code> can only be applied to tables (nothing else needs it anyway)</li><li><code>@recreate</code> cannot mix with <code>@create</code> or <code>@delete</code></li><li><code>@recreate</code> can include a group name as in <code>@recreate(musketeers)</code>; if a group name is specified then all the tables in that group are recreated if any of them change</li></ul><p>Indices, Views, and Triggers are always &quot;recreated&quot; (just like tables can be) and so neither the <code>@recreate</code> nor the <code>@create</code> annotations are needed (or allowed).  However when an Index, View, or Trigger is retired it must be marked with <code>@delete</code> so that it isn&#x27;t totally forgotten but can be deleted anywhere it might still exist.  Note that when one of these items is deleted, the definition is not used as it will only be dropped anyway. The simplest creation of the object with the correct name will do the job as a tombstone.</p><p>e.g. <code>create view used_to_be_fabulous as select 1 x @delete(12);</code>  suffices to drop the <code>used_to_be_fabulous</code> view in version 12 no matter how complicated it used to be.  Its <code>CREATE VIEW</code> will not be emitted into the upgrade procedure in any case.  Similarly, trivial indices and triggers of the correct name can be used for the tombstone.</p><p>In addition, if there is some data migration that needs to happen at a particular schema version that isn&#x27;t associated with any particular change in schema, you can run an <em>ad hoc</em> migrator at any time.  The syntax for that is <code>@schema_ad_hoc_migration(version, migration proc);</code>.  Ad hoc migrations are the last to run in any given schema version; they happen after table drop migrations.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="semantics">Semantics<a class="hash-link" href="#semantics" title="Direct link to heading">​</a></h3><p><code>@create</code> declares that the annotated object first appeared in the indicated version, and at that time the migration proc needs to be executed to fill in default values, denormalize values, or whatever the case may be.</p><p><code>@delete</code> declares that the annotated object disappeared in the indicated version, and at that time the migration proc needs to be executed to clean up the contents, or potentially move them elsewhere.</p><p><code>@recreate</code> declares that the annotated object can be dropped and recreated when it changes because there is no need to preserve its contents during an upgrade. Such objects may be changed arbitrarily from version to version.</p><ul><li>no columns in a <code>@recreate</code> table may have <code>@create</code> or <code>@delete</code> (these aren&#x27;t needed anyway)<ul><li>therefore tables with <code>@recreate</code> never have deprecated columns (since <code>@delete</code> isn&#x27;t allowed on their columns)</li></ul></li></ul><p>NOTE: all annotations are suppressed from generated SQL.  SQLite never sees them.</p><p>NOTE: looking at the annotations it is possible to compute the logical schema at any version, especially the original schema -- it&#x27;s what you get if you disregard all <code>@delete</code> entirely (don&#x27;t delete) and then remove anything marked with <code>@create</code> directives.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="allowable-changes">Allowable changes<a class="hash-link" href="#allowable-changes" title="Direct link to heading">​</a></h3><p>Not all migrations are possible in a sensible fashion, therefore CQL enforces certain limitations:</p><ul><li>the &quot;original&quot; schema has no annotations or just delete annotations</li><li>new tables may be added (with <code>@create</code>)</li><li>tables may be deleted (with <code>@delete</code>)</li><li>columns may be added to a table, but only at the end of the table</li><li>added columns must be nullable or have a default value (otherwise all existing insert statements would break for sure)</li><li>columns may not be renamed</li><li>columns may be deleted but this is only a logical delete, SQLite has no primitive to remove columns; once deleted you may no longer refer to that column in queries</li><li>deleted columns must be nullable or have a default value (otherwise all existing and future insert statements would break for sure, the column isn&#x27;t really gone)</li><li>views, indices, and triggers may be added (no annotation required) and removed (with <code>@delete</code>) like tables</li><li>views, indices, and triggers may be altered completely from version to version</li><li>no normal code is allowed to refer to deleted columns, tables, etc.  This includes views, indices, and triggers</li><li>schema migration stored procs see the schema as it existed in their annotation (so an older version). They are also forbidden from using views (see below)</li><li>recreated objects (tables marked with @recreate, views, tables, and indices) have no change restrictions</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="prosecution">Prosecution<a class="hash-link" href="#prosecution" title="Direct link to heading">​</a></h3><p>Moving from one schema version to another is done in an orderly fashion with the migration proc taking these essential steps in this order:</p><ul><li><p>the <code>cql_schema_facets</code> table is created if needed -- this records the current state of the schema</p></li><li><p>the last known schema hash is read from the <code>cql_schema_facets</code> tables (it is zero by default)</p></li><li><p>if the overall schema hash code matches what is stored, processing stops; otherwise an upgrade ensues</p></li><li><p>all known views are dropped (hence migration procs won&#x27;t see them!)</p></li><li><p>any index that needs to change is dropped (this includes items marked <code>@delete</code> or indices that are different than before)</p><ul><li>change is detected by hash (crc64) of the previous index definition vs. the current</li></ul></li><li><p>all known triggers are dropped (hence they will not fire during migration!)</p></li><li><p>the current schema version is extracted from <code>cql_schema_facets</code> (it is zero by default)</p></li><li><p>if the current schema version is zero, then the original versions of all the tables are created</p></li><li><p>if the current schema version is &lt;= 1 then</p><ul><li>any tables that need to be created at schema version 1 are created as they exist at schema version 1</li><li>any columns that need to be created at schema version 1 are created as they exist at schema version 1</li><li>migration procedures schema version 1 are run in this order:<ul><li>create table migration</li><li>create column migration</li><li>delete trigger migration (these are super rare and supported for uniformity)</li><li>delete index migration (these are super rare and supported for uniformity)</li><li>delete view migration  (these are super rare and supported for uniformity)</li><li>delete column migration</li><li>delete table migration</li><li>ad hoc migration</li><li>each proc is run exactly one time</li></ul></li><li>any tables that need to be dropped at schema version 1 are dropped</li><li>the schema version is marked as 1 in <code>cql_schema_facets</code></li><li>each sub-step in the above is recorded in <code>cql_schema_facets</code> as it happens so it is not repeated<ul><li>all that checking not shown for brevity</li></ul></li></ul></li><li><p>the above process is repeated for all schema versions up to the current version</p></li><li><p>all tables that are marked with <code>@recreate</code> are re-created if necessary</p><ul><li>i.e. if the checksum of the table definition has changed for any  table (or group) then <code>drop</code> it and create the new version.</li></ul></li><li><p>all indices that changed and were not marked with <code>@delete</code> are re-created</p></li><li><p>all views not marked with <code>@delete</code> are re-created</p></li><li><p>all triggers not marked with <code>@delete</code> are re-installed</p></li><li><p>the current schema hash is written to the <code>cql_schema_facets</code> table</p></li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="example-migration">Example Migration<a class="hash-link" href="#example-migration" title="Direct link to heading">​</a></h3><p>Here&#x27;s an example of a schema directly from the test cases:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- crazy amount of versioning here</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create table foo(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  id integer not null,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  rate long integer @delete(5),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  rate_2 long integer @delete(4, DeleteRate2Proc),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  id2 integer default 12345 @create(4, CreateId2Proc),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name text @create(5),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name_2 text @create(6)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- much simpler table, lots of stuff added in v2.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- note v1 is the first new version and v0 is base version</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create table table2(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  id integer not null,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name1 text @create(2, CreateName1Proc),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name2 text @create(2, CreateName2Proc),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name3 text @create(2), -- no proc</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name4 text @create(2) -- no proc</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create table added_table(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  id integer not null,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name1 text,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name2 text @create(4)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">) @create(3) @delete(5);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- this view is present in the output</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create view live_view as select * from foo;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- this view is also present in the output</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create view another_live_view as select * from foo;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- this view is not present in the output</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create view dead_view as select * from foo @delete(2);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- this index is present</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create index index_still_present on table2(name1, name2);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- this index is going away</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create index index_going_away on table2(name3) @delete(3);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- this is a simple trigger, and it&#x27;s a bit silly but that doesn&#x27;t matter</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create trigger trigger_one</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  after insert on foo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  delete from table2 where table2.id = new.id;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This schema has a LOT of versioning... you can see tables and columns appearing in versions 2 through 6.  There is a lot of error checking happening.</p><ul><li>things with no create annotation were present in the base schema</li><li>only things with no delete annotation are visible to normal code</li><li>created columns have to be at the end of their table (required by SQLite)</li><li>they have to be in ascending schema version order (but you can add several columns in one version)</li><li>there may or may not be a proc to run to populate data in that column when it&#x27;s added or to remove data when it&#x27;s deleted<ul><li>proc names must be unique</li></ul></li><li>you can&#x27;t delete a table or column in a version before it was created</li><li>you can&#x27;t delete a column in a table in a version before the table was created</li><li>you can&#x27;t create a column in a table in a version after the table was deleted</li><li>there may be additional checks not listed here</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="sample-upgrade-script">Sample Upgrade Script<a class="hash-link" href="#sample-upgrade-script" title="Direct link to heading">​</a></h3><p>With just those annotations you can automatically create the following upgrade script which is itself CQL (and hence has to be compiled). Notice that this code is totally readable!</p><p>The script has been split into logical pieces to make it easier to explain what&#x27;s going on.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="preamble">Preamble<a class="hash-link" href="#preamble" title="Direct link to heading">​</a></h4><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- ...copyright notice... possibly generated source tag... elided to avoid confusion</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- no columns will be considered hidden in this script</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- DDL in procs will not count as declarations</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@SCHEMA_UPGRADE_SCRIPT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Schema upgrade scripts need to see all the columns even the ones that would be logically deleted in normal mode.  This is so that things like <code>alter table add column</code> can refer to real columns and <code>drop table</code> can refer to a table that shouldn&#x27;t even be visible.  Remember in CQL the declarations tell you the logical state of the universe and DLL mutations are expected to create that condition, so you should be dropping tables that are marked with <code>@delete</code>
CQL stores the current state of the universe in this table.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- schema crc -7714030317354747478</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The schema crc is computed by hashing all the schema declarations in canonical form.  That&#x27;s everything in this next section.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="facet-helpers">Facet Helpers<a class="hash-link" href="#facet-helpers" title="Direct link to heading">​</a></h4><p>CQL uses a set of four functions to manage a dictionary.  The implementation is in <code>cqlrt_common.c</code> but it&#x27;s really
just a simple hash table that maps from a string key to a number.  This functionality was added because over time
the facets table can get pretty big and running a SQL query every time to read a single integer is not economical.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- declare facet helpers--</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> facet_data </span><span class="token keyword" style="font-style:italic">TYPE</span><span class="token plain"> LONG</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">facet_data</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> test_facets facet_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FUNCTION</span><span class="token plain"> cql_facets_new</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> facet_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> cql_facets_delete</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">facets facet_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FUNCTION</span><span class="token plain"> cql_facet_add</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">facets facet_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> facet </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> crc LONG </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">BOOL</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FUNCTION</span><span class="token plain"> cql_facet_find</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">facets facet_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> facet </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> LONG </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="declaration-section">Declaration Section<a class="hash-link" href="#declaration-section" title="Direct link to heading">​</a></h4><p>Wherein all the necessary objects are declared...</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- declare sqlite_master --</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> sqlite_master </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">type</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  tbl_name </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  rootpage </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>sqlite_master</code> table is built-in but it has to be introduced to CQL so that we can query it. Like all the other loose DDL declarations here there is no code generated for this.  We are simply declaring tables.  To create code you have to put the DDL in a proc.  Normally DDL in procs also declares the table but since we may need the original version of a table created and the final version declared we have <code>@schema_upgrade_script</code> to help avoid name conflicts.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- declare full schema of tables and views to be upgraded --</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  id </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  rate LONG </span><span class="token keyword" style="font-style:italic">INT</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@DELETE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  rate_2 LONG </span><span class="token keyword" style="font-style:italic">INT</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@DELETE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> DeleteRate2Proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  id2 </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">DEFAULT</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">12345</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@CREATE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> CreateId2Proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@CREATE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name_2 </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@CREATE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> table2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  id </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name1 </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@CREATE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> CreateName1Proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name2 </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@CREATE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> CreateName2Proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name3 </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@CREATE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name4 </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@CREATE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> added_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  id </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name1 </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name2 </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@CREATE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@CREATE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@DELETE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>NOTE: all the tables are emitted including all the annotations.  This lets us do the maximum validation when we compile this script.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">VIEW</span><span class="token plain"> live_view </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">VIEW</span><span class="token plain"> another_live_view </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">VIEW</span><span class="token plain"> dead_view </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> foo </span><span class="token variable" style="color:rgb(191, 199, 213)">@DELETE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>These view declarations do very little.  We only need the view names so we can legally drop the views.  We create the views elsewhere.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INDEX</span><span class="token plain"> index_still_present </span><span class="token keyword" style="font-style:italic">ON</span><span class="token plain"> table2 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">name1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> name2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INDEX</span><span class="token plain"> index_going_away </span><span class="token keyword" style="font-style:italic">ON</span><span class="token plain"> table2 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">name3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@DELETE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Just like views, these declarations introduce the index names and nothing else.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TRIGGER</span><span class="token plain"> trigger_one</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">AFTER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INSERT</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">ON</span><span class="token plain"> foo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">DELETE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> table2 </span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"> table2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> new</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We have only the one trigger; we declare it here.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- facets table declaration --</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">EXISTS</span><span class="token plain"> test_cql_schema_facets</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  facet </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">KEY</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  version LONG </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This is where we will store everything we know about the current state of the schema.  Below we define a few helper procs for reading and writing that table and reading <code>sqlite_master</code></p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- saved facets table declaration --</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TEMP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> test_cql_schema_facets_saved</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  facet </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">KEY</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  version LONG </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We will snapshot the facets table at the start of the run so that we can produce a summary of the changes
at the end of the run.  This table will hold that snapshot.</p><p>NOTE: the prefix &quot;test&quot; was specified when this file was built so all the methods and tables begin with <code>test_</code>.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="helper-procedures">Helper Procedures<a class="hash-link" href="#helper-procedures" title="Direct link to heading">​</a></h4><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- helper proc for testing for the presence of a column/type</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> test_check_column_exists</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">table_name </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                          decl </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                          </span><span class="token keyword" style="font-style:italic">OUT</span><span class="token plain"> present </span><span class="token keyword" style="font-style:italic">BOOL</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">SET</span><span class="token plain"> present :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">EXISTS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> sqlite_master</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                  </span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"> tbl_name </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> table_name </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain"> GLOB decl</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>check_column_exists</code> inspects <code>sqlite_master</code> and returns true if a column matching <code>decl</code> exists.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- helper proc for creating the schema version table</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> test_create_cql_schema_facets_if_needed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">EXISTS</span><span class="token plain"> test_cql_schema_facets</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    facet </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">KEY</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    version LONG </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here we actually create the <code>cql_schema_facets</code> table with DDL inside a proc.  In a non-schema-upgrade script the above would give a name conflict.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- helper proc for saving the schema version table</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> test_save_cql_schema_facets</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DROP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">EXISTS</span><span class="token plain"> test_cql_schema_facets_saved</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TEMP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> test_cql_schema_facets_saved</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    facet </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">KEY</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    version LONG </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">INSERT</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INTO</span><span class="token plain"> test_cql_schema_facets_saved</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> test_cql_schema_facets</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>save_sql_schema_facets</code> procedure simply makes a snapshot of the current facets table.  Later we use
this snapshot to report the differences by joining these tables.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- helper proc for setting the schema version of a facet</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> test_cql_set_facet_version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">_facet </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                            _version LONG </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">INSERT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">REPLACE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INTO</span><span class="token plain"> test_cql_schema_facets </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">facet</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       </span><span class="token keyword" style="font-style:italic">VALUES</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">_facet</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> _version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- helper proc for getting the schema version of a facet</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> test_cql_get_facet_version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">_facet </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                            </span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> _version LONG </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"> TRY</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">SET</span><span class="token plain"> _version :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> version </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> test_cql_schema_facets</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                       </span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"> facet </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> _facet </span><span class="token keyword" style="font-style:italic">LIMIT</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> NOTHING </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> TRY</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"> CATCH</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">SET</span><span class="token plain"> _version :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> CATCH</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The two procedures <code>cql_get_facet_version</code> and <code>cql_set_facet_version</code> do just what you would expect.  Note the use of <code>try</code> and <code>catch</code> to return a default value if the select fails.</p><p>There are two additional helper procedures that do essentially the same thing using a schema version index.  These two methods exist only to avoid unnecessary repeated string literals in the output file which cause bloat.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- helper proc for getting the schema version CRC for a version index</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> test_cql_get_version_crc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">_v </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> _crc LONG </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">SET</span><span class="token plain"> _crc :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> cql_facet_find</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">test_facets</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;cql_schema_v%d&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> _v</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- helper proc for setting the schema version CRC for a version index</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> test_cql_set_version_crc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">_v </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                          _crc LONG </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">INSERT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">REPLACE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INTO</span><span class="token plain"> test_cql_schema_facets </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">facet</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       </span><span class="token keyword" style="font-style:italic">VALUES</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;cql_schema_v&#x27;</span><span class="token operator" style="color:rgb(137, 221, 255)">||</span><span class="token plain">_v</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> _crc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>As you can see, these procedures are effectively specializations of <code>cql_get_facet_version</code> and <code>cql_set_facet_version</code> where the facet name is computed from the integer.</p><p>Triggers require some special processing.  There are so-called &quot;legacy&quot; triggers that crept into the system.  These
begin with <code>tr__</code> and they do not have proper tombstones.  In fact some are from early versions of CQL before
they were properly tracked.  To fix any old databases that have these in them, we delete all triggers that start with <code>tr__</code>.
Note we have to use the <code>GLOB</code> operator to do this, because <code>_</code> is the <code>LIKE</code> wildcard.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- helper proc to reset any triggers that are on the old plan --</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> cql_exec_internal</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">USING</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TRANSACTION</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> test_cql_drop_legacy_triggers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">CURSOR</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FOR</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> name </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> sqlite_master</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">type</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;trigger&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> name GLOB </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;tr__*&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">LOOP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FETCH</span><span class="token plain"> C</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> cql_exec_internal</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;DROP TRIGGER %s;&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="baseline-schema">Baseline Schema<a class="hash-link" href="#baseline-schema" title="Direct link to heading">​</a></h4><p>The &#x27;baseline&#x27; or &#x27;v0&#x27; schema is unannotated (no <code>@create</code> or <code>@recreate</code>).    The first real schema
management procedures are for creating and dropping these tables.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> test_cql_install_baseline_schema</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    id </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    rate LONG_INT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    rate_2 LONG_INT</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> table2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    id </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- helper proc for dropping baseline tables before installing the baseline schema</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> test_cql_drop_baseline_tables</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DROP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">EXISTS</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DROP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">EXISTS</span><span class="token plain"> table2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="migration-procedures">Migration Procedures<a class="hash-link" href="#migration-procedures" title="Direct link to heading">​</a></h4><p>The next section declares the migration procedures that were in the schema.  These are expected to be
defined elsewhere.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- declared upgrade procedures if any</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> CreateName1Proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">USING</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TRANSACTION</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> CreateName2Proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">USING</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TRANSACTION</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> CreateId2Proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">USING</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TRANSACTION</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> DeleteRate2Proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">USING</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TRANSACTION</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The code below will refer to these migration procedures.  We emit a declaration so that we can use the names in context.
NOTE: <code>USING TRANSACTION</code> when applied to a proc declaration simply means the proc will access the database so it needs to be provided with a <code>sqlite3 *db</code> parameter.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="views">Views<a class="hash-link" href="#views" title="Direct link to heading">​</a></h4><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- drop all the views we know</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> test_cql_drop_all_views</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DROP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">VIEW</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">EXISTS</span><span class="token plain"> live_view</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DROP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">VIEW</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">EXISTS</span><span class="token plain"> another_live_view</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DROP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">VIEW</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">EXISTS</span><span class="token plain"> dead_view</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- create all the views we know</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> test_cql_create_all_views</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">VIEW</span><span class="token plain"> live_view </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">VIEW</span><span class="token plain"> another_live_view </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>View migration is done by dropping all views and putting all views back.</p><p>NOTE: <code>dead_view</code> was not created, but we did try to drop it if it existed.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="indices">Indices<a class="hash-link" href="#indices" title="Direct link to heading">​</a></h4><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- drop all the indices that are deleted or changing</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> test_cql_drop_all_indices</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> cql_facet_find</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">test_facets</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;index_still_present_index_crc&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">6823087563145941851</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">DROP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INDEX</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">EXISTS</span><span class="token plain"> index_still_present</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DROP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INDEX</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">EXISTS</span><span class="token plain"> index_going_away</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- create all the indices we need</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> test_cql_create_indices</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> cql_facet_find</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">test_facets</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;index_still_present_index_crc&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">6823087563145941851</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INDEX</span><span class="token plain"> index_still_present </span><span class="token keyword" style="font-style:italic">ON</span><span class="token plain"> table2 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">name1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> name2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_set_facet_version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;index_still_present_index_crc&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">6823087563145941851</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Indices are processed similarly to views, however we do not want to drop indices that are not changing.  Therefore we compute the CRC of the index definition.  At the start of the script any indices that are condemned (e.g. <code>index_going_away</code>) are dropped as well as any that have a new CRC. At the end of migration, changed or new indices are (re)created using <code>cql_create_indices</code>.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="triggers">Triggers<a class="hash-link" href="#triggers" title="Direct link to heading">​</a></h4><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">drop</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">all</span><span class="token plain"> the triggers we know</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> test_cql_drop_all_triggers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_drop_legacy_triggers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DROP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TRIGGER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">EXISTS</span><span class="token plain"> trigger_one</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- create all the triggers we know</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> test_cql_create_all_triggers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TRIGGER</span><span class="token plain"> trigger_one</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">AFTER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INSERT</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">ON</span><span class="token plain"> foo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DELETE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> table2 </span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"> table2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> new</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Triggers are always dropped before migration begins and are re-instated quite late in the processing
as we will see below.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="caching-the-state-of-the-facets">Caching the state of the facets<a class="hash-link" href="#caching-the-state-of-the-facets" title="Direct link to heading">​</a></h4><p>To avoid selecting single rows out of the facets table repeatedly we introduce this procedure
whose job is to harvest the facets table and store it in a dictionary.  The helpers that do this
were declared above.  You&#x27;ve already seen usage of the facets in the
code above.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> test_setup_facets</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"> TRY</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">SET</span><span class="token plain"> test_facets :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> cql_facets_new</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">CURSOR</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FOR</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> test_cql_schema_facets</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">LOOP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FETCH</span><span class="token plain"> C</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      LET added :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> cql_facet_add</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">test_facets</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">facet</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> TRY</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"> CATCH</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- if table doesn&#x27;t exist we just have empty facets, that&#x27;s ok</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> CATCH</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="main-migration-script">Main Migration Script<a class="hash-link" href="#main-migration-script" title="Direct link to heading">​</a></h4><p>The main script orchestrates everything.  There are inline comments for all of it.  The general order of events is:</p><ul><li>create schema facets table if needed</li><li>check main schema crc; if it matches we&#x27;re done here, otherwise continue...</li></ul><p>These operations are done in <code>test_perform_needed_upgrades</code></p><ul><li>drop all views</li><li>drop condemned indices</li><li>fetch the current schema version</li><li>if version 0 then install the baseline schema (see below)</li><li>for each schema version with changes do the following:<ul><li>create any tables that need to be created in this version</li><li>add any columns that need to be added in this version</li><li>run migration procs in this order:<ul><li>create table</li><li>create column</li><li>delete trigger</li><li>delete view</li><li>delete index</li><li>delete column</li><li>delete table</li></ul></li><li>drop any tables that need to be dropped in this version</li><li>mark schema upgraded to the current version so far, and proceed to the next version</li><li>each partial step is also marked as completed so that it can be skipped if the script is run again</li></ul></li><li>create all the views</li><li>(re)create any indices that changed and are not dead</li><li>set the schema CRC to the current CRC</li></ul><p>That&#x27;s it... the details are below.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> test_perform_upgrade_steps</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> column_exists </span><span class="token keyword" style="font-style:italic">BOOL</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> schema_version LONG </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- dropping all views --</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_drop_all_views</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- dropping condemned or changing indices --</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_drop_all_indices</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- dropping condemned or changing triggers --</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_drop_all_triggers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">---- install baseline schema if needed ----</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_get_version_crc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> schema_version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> schema_version </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">9177754326374570163</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_install_baseline_schema</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_set_version_crc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">9177754326374570163</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">---- upgrade to schema version 2 ----</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_get_version_crc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> schema_version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> schema_version </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">6840158498294659234</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- altering table table2 to add column name1 TEXT;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_check_column_exists</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;table2&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;*[( ]name1 TEXT*&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> column_exists</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> column_exists </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">ALTER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> table2 </span><span class="token keyword" style="font-style:italic">ADD</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">COLUMN</span><span class="token plain"> name1 </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- altering table table2 to add column name2 TEXT;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_check_column_exists</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;table2&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;*[( ]name2 TEXT*&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> column_exists</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> column_exists </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">ALTER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> table2 </span><span class="token keyword" style="font-style:italic">ADD</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">COLUMN</span><span class="token plain"> name2 </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- altering table table2 to add column name3 TEXT;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_check_column_exists</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;table2&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;*[( ]name3 TEXT*&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> column_exists</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> column_exists </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">ALTER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> table2 </span><span class="token keyword" style="font-style:italic">ADD</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">COLUMN</span><span class="token plain"> name3 </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- altering table table2 to add column name4 TEXT;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_check_column_exists</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;table2&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;*[( ]name4 TEXT*&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> column_exists</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> column_exists </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">ALTER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> table2 </span><span class="token keyword" style="font-style:italic">ADD</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">COLUMN</span><span class="token plain"> name4 </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- data migration procedures</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> cql_facet_find</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">test_facets</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;CreateName1Proc&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> CreateName1Proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_set_facet_version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;CreateName1Proc&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> cql_facet_find</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">test_facets</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;CreateName2Proc&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> CreateName2Proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_set_facet_version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;CreateName2Proc&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_set_version_crc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">6840158498294659234</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">---- upgrade to schema version 3 ----</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_get_version_crc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> schema_version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> schema_version </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">4851321700834943637</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- creating table added_table</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">EXISTS</span><span class="token plain"> added_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        id </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        name1 </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_set_version_crc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">4851321700834943637</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">---- upgrade to schema version 4 ----</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_get_version_crc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> schema_version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> schema_version </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">6096284368832554520</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- altering table added_table to add column name2 TEXT;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_check_column_exists</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;added_table&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;*[( ]name2 TEXT*&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> column_exists</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> column_exists </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">ALTER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> added_table </span><span class="token keyword" style="font-style:italic">ADD</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">COLUMN</span><span class="token plain"> name2 </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- altering table foo to add column id2 INTEGER;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_check_column_exists</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;foo&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;*[( ]id2 INTEGER*&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> column_exists</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> column_exists </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">ALTER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> foo </span><span class="token keyword" style="font-style:italic">ADD</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">COLUMN</span><span class="token plain"> id2 </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">DEFAULT</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">12345</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- logical delete of column rate_2 from foo; -- no ddl</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- data migration procedures</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> cql_facet_find</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">test_facets</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;CreateId2Proc&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> CreateId2Proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_set_facet_version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;CreateId2Proc&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> cql_facet_find</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">test_facets</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;DeleteRate2Proc&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> DeleteRate2Proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_set_facet_version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;DeleteRate2Proc&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_set_version_crc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">6096284368832554520</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">---- upgrade to schema version 5 ----</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_get_version_crc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> schema_version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> schema_version </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5720357430811880771</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- altering table foo to add column name TEXT;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_check_column_exists</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;foo&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;*[( ]name TEXT*&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> column_exists</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> column_exists </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">ALTER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> foo </span><span class="token keyword" style="font-style:italic">ADD</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">COLUMN</span><span class="token plain"> name </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- logical delete of column rate from foo; -- no ddl</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- dropping table added_table</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">DROP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">EXISTS</span><span class="token plain"> added_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_set_version_crc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5720357430811880771</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">---- upgrade to schema version 6 ----</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_get_version_crc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> schema_version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> schema_version </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3572608284749506390</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- altering table foo to add column name_2 TEXT;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_check_column_exists</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;foo&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;*[( ]name_2 TEXT*&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> column_exists</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> column_exists </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">ALTER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> foo </span><span class="token keyword" style="font-style:italic">ADD</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">COLUMN</span><span class="token plain"> name_2 </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_set_version_crc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3572608284749506390</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_create_all_views</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_create_all_indices</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_create_all_triggers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_set_facet_version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;cql_schema_version&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_set_facet_version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;cql_schema_crc&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">7714030317354747478</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We have one more helper that will look for evidence that we&#x27;re trying
to move backwards to a previous schema version.  This is not supported.
This procedure also arranges for the original facet versions to be saved
and it proceduces a difference in facets after the upgrade is done.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> test_perform_needed_upgrades</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- check for downgrade --</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> cql_facet_find</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">test_facets</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;cql_schema_version&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;downgrade detected&#x27;</span><span class="token plain"> facet</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">ELSE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- save the current facets so we can diff them later --</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_save_cql_schema_facets</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_perform_upgrade_steps</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- finally produce the list of differences</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">facet </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      test_cql_schema_facets T1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">LEFT</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">OUTER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">JOIN</span><span class="token plain"> test_cql_schema_facets_saved T2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">ON</span><span class="token plain"> T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">facet </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> T2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">facet</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"> T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">version </span><span class="token operator" style="color:rgb(137, 221, 255)">is</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> T2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This is the main function for upgrades, it checks only the master schema version.
This function is separate so that the normal startup path doesn&#x27;t have to have
the code for the full upgrade case in it.  This lets linker order files do a superior job
(since full upgrade is the rare case).</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> test</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> schema_crc LONG </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- create schema facets information table --</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_create_cql_schema_facets_if_needed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- fetch the last known schema crc, if it&#x27;s different do the upgrade --</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_get_facet_version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;cql_schema_crc&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> schema_crc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> schema_crc </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;&gt;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token number" style="color:rgb(247, 140, 108)">7714030317354747478</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"> TRY</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_setup_facets</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_perform_needed_upgrades</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> TRY</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"> CATCH</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> cql_facets_delete</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">test_facets</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">SET</span><span class="token plain"> test_facets :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      THROW</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> CATCH</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> cql_facets_delete</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">test_facets</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">SET</span><span class="token plain"> test_facets :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">ELSE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- some canonical result for no differences --</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;no differences&#x27;</span><span class="token plain"> facet</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="temp-tables">Temp Tables<a class="hash-link" href="#temp-tables" title="Direct link to heading">​</a></h4><p>We had no temporary tables in this schema, but if there were some they get added
to the schema after the upgrade check.</p><p>A procedure like this one is generated:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> test_cql_install_temp_schema</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TEMP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> tempy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    id </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This entry point can be used any time you need the temp tables.  But normally it is
automatically invoked.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">---- install temp schema after upgrade is complete ----</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> test_cql_install_temp_schema</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>That logic is emitted at the end of the test procedure.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="schema-regions">Schema Regions<a class="hash-link" href="#schema-regions" title="Direct link to heading">​</a></h3><p>Schema Regions are designed to let you declare your schema in logical regions whose dependencies are specified.  It enforces the dependencies you specify creating errors if you attempt to break the declared rules.  Schema regions allow you to generate upgrade scripts for parts of your schema that can compose and be guaranteed to remain self-consistent.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="details">Details<a class="hash-link" href="#details" title="Direct link to heading">​</a></h4><p>In many cases schema can be factored into logical and independent islands.  This is desireable for a number of reasons:</p><ul><li>so that the schema can go into different databases</li><li>so that the schema can be upgraded on a different schedule</li><li>so that &quot;not relevant&quot; schema can be omitted from distributions</li><li>so that parts of your schema that have no business knowing about each other can be prevented from taking dependencies on each other</li></ul><p>These all have very real applications:</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="eg-your-application-has-an-on-disk-and-an-in-memory-database">E.g. Your Application has an on-disk and an in-memory database<a class="hash-link" href="#eg-your-application-has-an-on-disk-and-an-in-memory-database" title="Direct link to heading">​</a></h5><p>This creates basically three schema regions:</p><ol><li>on disk: which cannot refer to the in-memory at all</li><li>in-memory: which cannot refer to the on-disk schema at all</li><li>cross-db: which refers to both, also in memory (optional)</li></ol><h5 class="anchor anchorWithStickyNavbar_mojV" id="your-application-needs-to-upgrade-each-of-the-above">Your Application Needs To Upgrade Each of the Above<a class="hash-link" href="#your-application-needs-to-upgrade-each-of-the-above" title="Direct link to heading">​</a></h5><p>There must be a separate upgrade script for both the island databases and yet a different one for the &quot;cross-db&quot; database</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="your-customer-doesnt-want-the-kitchen-sink-of-schema">Your Customer Doesn&#x27;t Want The Kitchen Sink of Schema<a class="hash-link" href="#your-customer-doesnt-want-the-kitchen-sink-of-schema" title="Direct link to heading">​</a></h5><p>If you&#x27;re making a library with database support, your customers likely want to be able to create databases that have only features they want; you will want logical parts within your schema that can be separated for cleanliness and distribution.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="declaring-regions-and-dependencies">Declaring Regions and Dependencies<a class="hash-link" href="#declaring-regions-and-dependencies" title="Direct link to heading">​</a></h4><p>Schema Regions let you create logical groupings, you simply declare the regions you want and then start putting things into those regions.  The regions form a directed acyclic graph -- just like C++ base classes.  You create regions like this:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token variable" style="color:rgb(191, 199, 213)">@declare_schema_region</span><span class="token plain"> root</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@declare_schema_region</span><span class="token plain"> extra </span><span class="token keyword" style="font-style:italic">using</span><span class="token plain"> root</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The above simply declares the regions -- it doesn&#x27;t put anything into them.  In this case we now have a <code>root</code> region and an <code>extra</code> region.  The <code>root</code> schema items will not be allowed to refer to anything in <code>extra</code>.</p><p>Without regions, you could also ensure that the above is true by putting all the <code>extra</code> items afer the <code>root</code> in the input file but things can get more complicated than that in general, and the schema might also be in several files, complicating ordering as the option.  Also, relying on order could be problematic as it is quite easy to put things in the wrong place (e.g. add a new <code>root</code> item after the <code>extra</code> items).  Making this a bit more complicated, we could have:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token variable" style="color:rgb(191, 199, 213)">@declare_schema_region</span><span class="token plain"> feature1 </span><span class="token keyword" style="font-style:italic">using</span><span class="token plain"> extra</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@declare_schema_region</span><span class="token plain"> feature2 </span><span class="token keyword" style="font-style:italic">using</span><span class="token plain"> extra</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@declare_schema_region</span><span class="token plain"> everything </span><span class="token keyword" style="font-style:italic">using</span><span class="token plain"> feature1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> feature2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And now there are many paths to <code>root</code> from the <code>everything</code> region;  that&#x27;s ok but certainly it will be tricky to do all that with ordering.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="using-regions">Using Regions<a class="hash-link" href="#using-regions" title="Direct link to heading">​</a></h4><p>An illustrative example, using the regions defined above:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token variable" style="color:rgb(191, 199, 213)">@begin_schema_region</span><span class="token plain"> root</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">view</span><span class="token plain"> names </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> name </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> main </span><span class="token keyword" style="font-style:italic">order</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">by</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@end_schema_region</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@begin_schema_region</span><span class="token plain"> extra</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> details</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">references</span><span class="token plain"> main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   details </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> get_detail</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> id_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">details</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> T2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">name </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> details T1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">inner</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">join</span><span class="token plain"> main T2 </span><span class="token keyword" style="font-style:italic">on</span><span class="token plain"> T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> T2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> id_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@end_schema_region</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@begin_schema_region</span><span class="token plain"> feature1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> f1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">references</span><span class="token plain"> details</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   f1_info </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> get_detail</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> id_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">details</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> T2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> f1_info </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> details T1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">inner</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">join</span><span class="token plain"> f T2 </span><span class="token keyword" style="font-style:italic">on</span><span class="token plain"> T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> T2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">inner</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">join</span><span class="token plain"> f1 </span><span class="token keyword" style="font-style:italic">on</span><span class="token plain"> f1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> id_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@end_schema_region</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@begin_schema_region</span><span class="token plain"> feature2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- you can use details, and main but not f1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@end_schema_region</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>With the structure above specified, even if a new contribution to the <code>root</code> schema appears later, the rules enforce that this region cannot refer to anything other than things in <code>root</code>.  This can be very important if schema is being included via <code>#include</code> and might get pulled into the compilation in various orders.  A feature area might also have a named public region that others things can depend on (e.g. some views) and private regions (e.g. some tables, or whatever).</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="region-visibility">Region Visibility<a class="hash-link" href="#region-visibility" title="Direct link to heading">​</a></h4><p>Schema regions do not provide additional name spaces -- the names of objects should be unique across all regions. In other words, regions do not hide or scope entity names; rather they create errors if inappropriate names are used.</p><p>Case 1: The second line will fail semantic validation because table <code>A</code> already exists</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- obvious standard name conflict</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> A </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> A </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> name </span><span class="token keyword" style="font-style:italic">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Case 2: This fails for the same reason as case #1. Table <code>A</code> already exists</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token variable" style="color:rgb(191, 199, 213)">@declare_region</span><span class="token plain"> root</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- table A is in no region</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> A </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@begin_region</span><span class="token plain"> root:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- this table A is in the root region, still an error</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> A </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> name </span><span class="token keyword" style="font-style:italic">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@end_region</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Case 3: Again fails for the same reason as case #1. Table <code>A</code> already exist in region <code>extra</code>, and you cannot define another table with the same name in another region.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token variable" style="color:rgb(191, 199, 213)">@declare_region</span><span class="token plain"> root</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@declare_region</span><span class="token plain"> extra</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@begin_region</span><span class="token plain"> extra</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- so far so good</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> A </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@end_region</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@begin_region</span><span class="token plain"> root</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- no joy, this A conflicts with the previous A</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> A </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> name </span><span class="token keyword" style="font-style:italic">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@end_region</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Really the visibility rules couldn&#x27;t be anything other than the above, as SQLite has no knowledge of regions at all and so any exotic name resolution would just doom SQLite statements to fail when they finally run.</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="exception-for--like-table-statement">Exception for <code>&quot;... LIKE &lt;table&gt;&quot;</code> statement<a class="hash-link" href="#exception-for--like-table-statement" title="Direct link to heading">​</a></h5><p>The rules above are enforced for all constructs except for where the syntactic sugar <code>... LIKE &lt;table&gt;</code> forms, which can happen in a variety of statements. This form doesn&#x27;t create a dependence on the table (but does create a dependence on its shape). When CQL generates output, the <code>LIKE</code> construct is replaced with the actual names of the columns it refers to.  But these are independent columns, so this is simply a keystroke saver.  The table (or view, cursor, etc.) reference will be gone.</p><p>These cases below will succeed.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token variable" style="color:rgb(191, 199, 213)">@declare_region</span><span class="token plain"> root</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> A </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">view</span><span class="token plain"> B </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">procedure</span><span class="token plain"> C {</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">}</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@begin_region</span><span class="token plain"> root</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> AA</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">LIKE</span><span class="token plain"> A</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> BB</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">LIKE</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> CC</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">LIKE</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@end_region</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note: this exception may end up causing maintenance problems and so it might be revisited in the future.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="maintaining-schema-in-pieces">Maintaining Schema in Pieces<a class="hash-link" href="#maintaining-schema-in-pieces" title="Direct link to heading">​</a></h4><p>When creating upgrade scripts, using the <code>--rt schema_upgrade</code> flags you can add region options <code>--include_regions a b c</code> and <code>--exclude_regions d e f</code> per the following:</p><p>Included regions:</p><ul><li>must be valid region names -- the base types are walked to compute all the regions that are &quot;in&quot;</li><li>declarations are emitted in the upgrade for all of the &quot;in&quot; objects -- &quot;exclude&quot; does not affect the declarations</li></ul><p>Excluded regions:</p><ul><li>must be valid region names and indicate parts of schema that are upgraded elsewhere, perhaps with a seperate CQL run, a different automatic upgrade, or even a manual mechanism</li><li>upgrade code will be generated for all the included schema, but not for the excluded regions and their contents</li></ul><p>Example: Referring to the regions above you might do something like this</p><div class="language-bash codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-bash codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic"># All of these also need a --global_proc param for the entry point but that&#x27;s not relevant here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cql --in schema.sql --cg shared.sql --rt schema_upgrade  --include_regions extra</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cql --in schema.sql --cg f1.cql --rt schema_upgrade --include_regions feature1 --exclude_regions extra</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cql --in schema.sql --cg f2.cql --rt schema_upgrade --include_regions feature2 --exclude_regions extra</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The first command generates all the shared schema for regions <code>root</code> and <code>extra</code> because <code>extra</code> contains <code>root</code></p><p>The second command declares all of <code>root</code> and <code>extra</code> so that the <code>feature1</code> things can refer to them, however the upgrade code for these shared regions is not emitted.  Only the upgrade for schema in <code>feature1</code> is emitted.  <code>feature2</code> is completely absent.  This will be ok because we know <code>feature1</code> cannot depend on <code>feature2</code> and <code>extra</code> is assumed to be upgraded elsewhere (such as in the previous line).</p><p>The third command declares all of <code>root</code> and <code>extra</code> so that the <code>feature2</code> things can refer to them, however the upgrade code for these shared regions is not emitted.  Only the upgrade for schema in <code>feature2</code> is emitted.  <code>feature1</code> is completely absent.</p><p>Note that in the above examples, CQL is generating more CQL to be compiled again (a common pattern).  The CQL upgrade scripts need to be compiled as usual to produce executable code.  Thus the output of this form includes the schema declarations and executable DDL.</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="schema-not-in-any-region">Schema Not In Any Region<a class="hash-link" href="#schema-not-in-any-region" title="Direct link to heading">​</a></h5><p>For schema that is not in any region you might imagine that it is a special region <code>&lt;none&gt;</code> that depends on everything.  So basically you can put anything there.  Schema that is in any region cannot ever refer to schema that is in <code>&lt;none&gt;</code>.</p><p>When upgrading, if any include regions are specified then <code>&lt;none&gt;</code> will not be emitted at all.  If you want an upgrader for just <code>&lt;none&gt;</code> this is possible with an assortment of exclusions.  You can always create arbitrary grouping regions to make this easier. A region named <code>any</code> that uses all other regions would make this simple.</p><p>In general, best practice is that there is no schema in <code>&lt;none&gt;</code>, but since most SQL code has no regions some sensible meaning has to be given to DDL before it gets region encodings.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="deployable-regions">Deployable Regions<a class="hash-link" href="#deployable-regions" title="Direct link to heading">​</a></h4><p>Given the above we note that some schema regions correspond to the way that we will deploy the schema.  We want those bundles to be safe to deploy but to in order to be so we need a new notion -- a deployable region.  To make this possible CQL includes the following:</p><ul><li>You can declare a region as deployable using <code>@declare_deployable_region</code></li><li>CQL computes the covering of a deployable region: its transitive closure up to but not including any deployable regions it references</li><li>No region is allowed to depend on a region that is within the interior of a different deployable region, but you can depend on the deployable region itself</li></ul><p>Because of the above, each deployable region is in fact a well defined root for the regions it contains.  The deployable region becomes the canonical way in which a bundle of regions (and their content) is deployed and any given schema item can be in only one deployable region.</p><h5 class="anchor anchorWithStickyNavbar_mojV" id="motivation-and-examples">Motivation and Examples<a class="hash-link" href="#motivation-and-examples" title="Direct link to heading">​</a></h5><p>As we saw above, regions are logical groupings of tables/views/etc such that if an entity is in some region <code>R</code> then it is allowed to only refer to the things that <code>R</code> declared as dependencies <code>D1</code>, <code>D2</code>, etc. and their transitive closures.  You can make as many logical regions as you like and you can make them as razor thin as you like; they have no physical reality but they let you make as many logical groups of things as you might want.</p><p>Additionally, when we’re deploying schema you generally need to do it in several pieces. E.g. if we have tables that go in an in-memory database then defining a region that holds all the in-memory tables makes it easy to, say, put all those in-memory tables into a particular deployment script.</p><p>Now we come to the reason for deployable regions. From CQL’s perspective, all regions are simply logical groups; some grouping is then meaningful to programmers but has no physical reality. This means you’re free to reorganize tables etc. as you see fit into new or different regions when things should move. Only, that’s not quite true. The fact that we deploy our schema in certain ways means while most logical moves are totally fine, if you were to move a table from, say, the main database region to the in-memory region you would be causing a major problem.  Some installations may already have the table in the main area and there would be nothing left in the schema to tell CQL to drop the table from the main database -- the best you can hope for is the new location gets a copy of the table the old location keeps it and now there are name conflicts forever.</p><p>So, the crux of the problem is this: We want to let you move schema freely between logical regions in whatever way makes sense to you, but once you pick the region you are going to deploy in, you cannot change that.</p><p>To accomplish this, CQL needs to know that some of the regions are deployable regions and there have to be rules to make it all makes sense.  Importantly, every region has to be contained in at most one deployable region.</p><p>Since the regions form a DAG we must create an error if any region could ever roll up to two different deployable regions. The easiest way to describe this rule is “no peeking” – the contents of a deployable region are “private” they can refer to each other in any DAG shape but outside of the deployable region you can only refer to its root. So you can still compose them but each deployable region owns a well-defined covering. Note that you can make as many fine-grained deployable regions as you want; you don’t actually have to deploy them separately, but you get stronger rules about the sharing when you do.</p><p>Here’s an example:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Master Deployment 1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Feature 1 (Deployable)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    logical regions for feature 1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Core (Deployable)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      logical regions for core</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Feature 2 (Deployable)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    logical regions for feature 2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    Core</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Master Deployment 2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Feature 1 (Deployable)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Feature 3 (Deployable)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    logical regions for feature 3</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the above:</p><ul><li>none of the logical regions for feature 1, 2, 3 are allowed to refer to logical regions in any other feature, though any of them could refer to Core (but not directly to what is inside Core)</li><li>within those regions you can make any set of groupings that makes sense and you can change them over time as you see fit, with some restrictions</li><li>any such regions are not allowed to move to a different Feature group (because those are deployment regions)</li><li>the Master Deployment regions just group features in ways we’d like to deploy them; in this case there are two deployments: one that includes Feature 1 &amp; 2 and another that includes Feature 1 &amp; 3</li><li>the deployable region boundaries are preventing Feature 1 regions from using Feature 2 regions in an ad hoc way (i.e. you can&#x27;t cheat by taking a direct dependency on something inside a different feature), but both Features can use Core</li><li>Feature 3 doesn’t use Core but Core will still be in Master Deployment 2 due to Feature 1</li></ul><p>Note that the deployable regions for Feature 1, 2, and 3 aren&#x27;t actually deployed alone, but they are adding enforcement that makes the features cleaner</p><p>Because of how upgrades work, “Core” could have its own upgrader. Then when you create the upgrader for Master Deployment 1 and 2, you can specify “exclude Core” in which case those tables are assumed to be updated independently. You could create as many or as few independently upgrade-able things with this pattern. Because regions are not allowed to &quot;peek&quot; inside of a deployable region, you can reorganize your logical regions without breaking other parts of the schema.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="private-regions">Private Regions<a class="hash-link" href="#private-regions" title="Direct link to heading">​</a></h4><p>The above constructs create a good basis for creating and composing regions, but a key missing aspect is the ability to hide internal details in the logical groups.  This becomes increasingly important as your desire to modularize schema grows; you will want to have certain parts that can change without worrying about breaking others and without fear that there are foreign keys and so forth referring to them.</p><p>To accomplish this, CQL provides the ability to compose schema regions with the optional <code>private</code> keyword.  In the following example there will be three regions creatively named <code>r1</code>, <code>r2</code>, and <code>r3</code>.  Region <code>r2</code> consumes <code>r1</code> privately and therefore <code>r3</code> is not allowed to use things in <code>r1</code> even though it consumes <code>r2</code>.  When creating an upgrade script for <code>r3</code> you will still need (and will get) all of <code>r2</code> and <code>r1</code>, but from a visibility perspective <code>r3</code> can only directly depend on <code>r2</code>.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token variable" style="color:rgb(191, 199, 213)">@declare_schema_region</span><span class="token plain"> r1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@declare_schema_region</span><span class="token plain"> r2 </span><span class="token keyword" style="font-style:italic">using</span><span class="token plain"> r1 private</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@declare_schema_region</span><span class="token plain"> r3 </span><span class="token keyword" style="font-style:italic">using</span><span class="token plain"> r2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@begin_schema_region</span><span class="token plain"> r1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> r1_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">primary</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@end_schema_region</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@begin_schema_region</span><span class="token plain"> r2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> r2_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">primary</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">key</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">references</span><span class="token plain"> r1_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@end_schema_region</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@begin_schema_region</span><span class="token plain"> r3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- this is OK</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> r3_table_2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">primary</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">key</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">references</span><span class="token plain"> r2_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- this is an error, no peeking into r1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> r3_table_1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">primary</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">key</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">references</span><span class="token plain"> r1_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@end_schema_region</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>As expected <code>r2</code> is still allowed to use <code>r1</code> because your private regions are not private from yourself.  So you may think it’s easy to work around this privacy by simply declaring a direct dependency on r1 wherever you need it.</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">@declare_schema_region my_sneaky_region using r1, other_stuff_I_need;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>That would seem to make it all moot.  However, this is where deployable regions come in.  Once you bundle your logical regions in a deployable region there’s no more peeking inside the the deployable region.  So we could strengthen the above to:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">@declare_deployable_region r2 using r1 private;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Once this is done it becomes an error to try to make new regions that peek into <code>r2</code>; you have to take all of <code>r2</code> or none of it -- and you can’t see the private parts.  Of course you can do region wrapping at any level so you can have as many subgroups as you like, whatever is useful. You can even add additional deployable regions that aren’t actually deployed to get the &quot;hardened&quot; grouping at no cost.</p><p>So, in summary, to get true privacy, first make whatever logical regions you like that are helpful.  Put privacy where you need/want it.  Import logical regions as much as you want in your own bundle of regions.  Then wrap that bundle up in a deployable region (they nest) and then your private regions are safe from unwanted usage.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="unsubscription-and-resubscription-features">Unsubscription and Resubscription Features<a class="hash-link" href="#unsubscription-and-resubscription-features" title="Direct link to heading">​</a></h3><p>Any significant library that is centered around a database is likely to accrue significant amounts of schema to support its features.
Often users of the library don’t want all its features and therefore don’t want all of its schema.  CQL’s primary strategy is to allow
the library author to divide the schema into regions and then the consumer of the library  may generate a suitable schema deployer
that deploys only the desired regions.  You simply subscribe to the regions you want.</p><p>The <code>@unsub</code>/<code>@resub</code> constructs  deal with the unfortunate situation of over-subscription.  In the event that a customer has subscribed to regions
that it turns out they don’t need, or if indeed the regions are not fine-grained enough, they may wish to (possibly much later) unsubscribe
from particular tables or entire regions that they previously had included.</p><p>Unfortunately it’s not so trivial as to simply remove the regions after the fact. The problem is that there might be billions
of devices that already have the undesired tables and are paying the initialization costs for them.  Affirmatively removing the tables
is highly desirable and that means a forward-looking annotation is necessary to tell the upgrader to generate <code>DROP</code> statements at some point.
Furthermore, a customer  might decide at some point later that now is the time they need the schema in question, so resubcription also
has to be possible.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="unsubscription-and-resubscription">Unsubscription and Resubscription<a class="hash-link" href="#unsubscription-and-resubscription" title="Direct link to heading">​</a></h4><p>To accomplish this we add the following constructs:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token variable" style="color:rgb(191, 199, 213)">@unsub</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">version_number</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> table_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And its twin</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token variable" style="color:rgb(191, 199, 213)">@resub</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">version_number</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> table_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The effects of a valid <code>@unsub</code> are as follows:</p><ul><li>The table is no longer accessible by statements</li><li>If the table is marked <code>@create</code>, then “DROP IF EXISTS table<em>name” is emitted into the upgrade steps for _version_number</em></li><li>If the table is <code>@recreate</code> the table is unconditionally dropped as though it had been deleted</li><li>The JSON includes the unsub details in a new subscriptions section</li></ul><p>The effects of a valid <code>@resub</code> are as follows:</p><ul><li>The table is once again accessible by statements</li><li>If the table is <code>@create</code> then <code>CREATE TABLE table_name ...</code> is emitted into the upgrade steps for <em>version_number</em><ul><li>the emitted create is for the table as it would have existed at <em>version_number</em>.</li></ul></li><li>If the table is <code>@recreate</code>, the table is recreated as usual</li><li>The JSON includes the resub details in a new subscriptions section</li></ul><p>The compiler ensures that the directives are valid and stay valid.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="validations-for-unsubversion-table">Validations for @unsub(<em>version</em>, <em>table</em>):<a class="hash-link" href="#validations-for-unsubversion-table" title="Direct link to heading">​</a></h4><ul><li><em>version</em> must be an integer greater or equal to 1</li><li><em>version</em> must be greater or equal to any unsub or resub version previously seen</li><li><em>table</em> must be a valid table name</li><li><em>table</em> may have no previous unsub/resub at <em>version</em></li><li><em>table</em> must be marked with an <code>@create</code> version &lt; <em>version</em> or else be marked <code>@recreate</code><ul><li>recall that unmarked (baseline) tables are the same as <code>@create(0)</code></li></ul></li><li><em>table</em> must not be already unsubscribed</li><li>If <em>table</em> is marked with <code>@delete</code>, its delete version must be &gt; <em>version</em><ul><li>unsubscribing from a table after it’s been outright deleted is clearly a mistake</li><li>deleting a table in the same version that it is unsubscribed makes the <code>@unsub</code> redundant</li><li><em>table</em> might be later outright deleted, the <code>@unsub</code> at an earlier version stands</li></ul></li><li>For every child table -- those that mention this table using <code>REFERENCES</code><ul><li>The child must be already deleted or unsubscribed</li><li>The deletion or unsubscription must have happened at a version &lt;= <em>version</em></li></ul></li><li><em>table</em> is marked unsubscribed for purposes of further analysis</li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="validations-for-resubversion-table">Validations for @resub(<em>version</em>, <em>table</em>):<a class="hash-link" href="#validations-for-resubversion-table" title="Direct link to heading">​</a></h4><ul><li><em>version</em> must be an integer greater or equal to 1</li><li><em>version</em> must be greater or equal to any unsub or resub version previously seen</li><li><em>table</em> must be a valid table name</li><li><em>table</em> may have no previous unsub/resub at <em>version</em></li><li><em>table</em> must be marked with an <code>@create</code> version &lt; <em>version</em> or else be marked <code>@recreate</code><ul><li>recall that unmarked (baseline) tables are the same as <code>@create(0)</code></li></ul></li><li><em>table</em> must currently be unsubscribed</li><li>If <em>table</em> is marked with <code>@delete</code>, its delete version must be &gt; <em>version</em><ul><li>resubscribing from a table after it’s been outright deleted is clearly a mistake</li><li>deleting a table in the same version that it is resubscribed makes the <code>@resub</code> redundant</li><li><em>table</em> might be later outright deleted, the <code>@resub</code> at an earlier version stands</li></ul></li><li>If <em>table</em> is not currently deleted then<ul><li>For every parent table (i.e. the tables it REFERENCES)</li><li>The parent table must not be deleted or unsubscribed</li></ul></li><li><em>table</em> has its unsubscribed status removed for further analysis</li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="previous-schema-validations-for-unsubresub">Previous Schema validations for @unsub/@resub<a class="hash-link" href="#previous-schema-validations-for-unsubresub" title="Direct link to heading">​</a></h4><p>In the presence of <code>@previous_schema;</code> the following additional validations must be made:</p><ul><li>Every <code>@unsub</code> and <code>@resub</code> in the previous schema must exist in the current schema in the exact same order with the exact same parameters<ul><li>i.e. these operations are never revoked, they undo each other creating a linear history like every other annotation</li></ul></li><li>Any <code>@unsub</code> or <code>@resub</code> not present in the previous schema version happens at a version number that is greater or equal to the largest version number that was present anywhere in the previous schema<ul><li>i.e. you cannot unsubscribe or subscribe in the past.</li></ul></li></ul><p>These validations are sufficient to guarantee a constistent logical history for unsubscriptions.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="chapter-11-previous-schema-validation">Chapter 11: Previous Schema Validation<a class="hash-link" href="#chapter-11-previous-schema-validation" title="Direct link to heading">​</a></h2><p>As we saw in the previous chapter, CQL includes powerful schema management tools for creating automatic
upgrade scripts for your databases.  However, not all schema alterations are possible after-the-fact
and so CQL also includes schema comparison tools to help you avoid problems as you version your schema over time.</p><p>You can compare the previous version of a schema with the current version to do additional checks such as:</p><ul><li>the data type of a column may not change</li><li>the attributes of a column (e.g. nullable, default value) may not change</li><li>columns can&#x27;t be renamed</li><li>columns can&#x27;t be removed, only marked delete</li><li>new columns must be at the end of the table and marked with create</li><li>created columns have to be created in a schema version &gt;= any that previously existed (no creating columns in the past)</li><li>nothing other than new columns at the end may be added to a table (e.g. new PK/UK is right out)</li><li>new tables must be marked create, deleted tables must be marked delete</li><li>new views must be marked create, deleted views must be marked delete</li><li>new indices must be marked create, deleted indices must be marked delete</li><li>an item that was previously a table/view cannot turn into the other one</li><li>version numbers in the annotations may not ever change</li><li>if any annotation has a migration proc associated with it, it cannot change to a different proc later</li><li>created tables, views, indices have to be created in a schema version &gt;= any that previously existed (no creating tables in the past)</li><li>there may be other checks not mentioned here</li></ul><p>When checking <code>@recreate</code> tables against the previous schema version for errors, these checks are done:</p><ul><li>suppress checking of any table facet changes in previous schema on recreate tables; you can do anything you want</li><li>allow new <code>@recreate</code> tables to appear with no <code>@create</code> needed</li><li>allow a table to go from &quot;original schema&quot; (no annotation) to <code>@recreate</code> but not back</li><li>allow a table to go from <code>@recreate</code> to <code>@create</code> at the current schema version</li><li>allow a table to go from recreate directly to <code>@delete</code> at the current schema version</li><li>do not allow a table to go from <code>@create</code> or <code>@delete</code> state to <code>@recreate</code></li></ul><p>All of these are statically checked.</p><p>To use these tools, you must run CQL in a mode where it has both the proposed and existing schema in its input stream,
then it can provide suitable errors if any unsupported change is about to happen.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="basic-usage">Basic Usage<a class="hash-link" href="#basic-usage" title="Direct link to heading">​</a></h3><p>The normal way that you do previous schema validation is to create an input file that provides both schema.</p><p>This file may look something like this:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- prev_check.sql</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  new_field </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@previous_schema</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>So, here the old version of <code>foo</code> will be validated against the new version and all is well.  A new nullable text field was added at the end.</p><p>In practice these comparisons are likely to be done in a somewhat more maintainable way, like so:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- prev_check.sql</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#include &quot;table1.sql&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#include &quot;table2.sql&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#include &quot;table3.sql&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@previous_schema</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#include &quot;previous.sql&quot;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now importantly, in this configuration, everything that follows the <code>@previous_schema</code> directive does not actually contribute to
the declared schema.  This means the <code>--rt schema</code> result type will not see it.   Because of this, you can do your checking
operation like so:</p><div class="language-bash codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-bash codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cc -E -x c prev_check.sql </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> cql --cg new_previous_schema.sql --rt schema</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The above command will generate the schema in new_previous_schema and, if this command succeeds, it&#x27;s safe to replace the existing
<code>previous.sql</code> with <code>new_previous_schema</code>.</p><p>NOTE: you can bootstrap the above by leaving off the <code>@previous_schema</code> and what follows to get your first previous schema from the command above.</p><p>Now, as you can imagine, comparing against the previous schema allows many more kinds of errors to be discovered.
What follows is a large chunk of the CQL tests for this area taken from the test files themselves.
For easy visibility I have brought each fragment of current and previous schema close to each other
and I show the errors that are reported.  We start with a valid fragment and go from there.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="case-1--no-problemo">Case 1 : No problemo<a class="hash-link" href="#case-1--no-problemo" title="Direct link to heading">​</a></h4><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  rate long </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@delete</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> deletor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  rate_2 long </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@delete</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  id2 </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name_2 </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  rate long </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@delete</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> deletor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  rate_2 long </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@delete</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  id2 </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name_2 </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The table <code>foo</code> is the same!  It doesn&#x27;t get any easier than that.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="case-2--table-create-version-changed">Case 2 : table create version changed<a class="hash-link" href="#case-2--table-create-version-changed" title="Direct link to heading">​</a></h4><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_create_verison_changed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_create_verison_changed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">15</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> str : </span><span class="token keyword" style="font-style:italic">current</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> version </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> equal </span><span class="token keyword" style="font-style:italic">to</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">previous </span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> version </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;t_create_verison_changed&#x27;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can&#x27;t change the version a table was created in.  Here the new schema says it appeared in version 1.  The old schema says 2.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="case-3--table-delete-version-changed">Case 3 : table delete version changed<a class="hash-link" href="#case-3--table-delete-version-changed" title="Direct link to heading">​</a></h4><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_delete_verison_changed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@delete</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_delete_verison_changed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@delete</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">18</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> str : </span><span class="token keyword" style="font-style:italic">current</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">delete</span><span class="token plain"> version </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> equal </span><span class="token keyword" style="font-style:italic">to</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">previous </span><span class="token keyword" style="font-style:italic">delete</span><span class="token plain"> version </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;t_delete_verison_changed&#x27;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can&#x27;t change the version a table was deleted in.  Here the new schema says it was gone in version 1.  The old schema says 2.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="case-4--table-not-present-in-new-schema">Case 4 : table not present in new schema<a class="hash-link" href="#case-4--table-not-present-in-new-schema" title="Direct link to heading">​</a></h4><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- t_not_present_in_new_schema is gone</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_not_present_in_new_schema</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">176</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> create_table_stmt : </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> was present but now it</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">does </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> exist </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">use</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@delete</span><span class="token plain"> instead</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;t_not_present_in_new_schema&#x27;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>So here <code>t_not_present_in_new_schema</code> was removed, it should have been marked with <code>@delete</code>.  You don&#x27;t remove tables.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="case-5--table-is-now-a-view">Case 5 : table is now a view<a class="hash-link" href="#case-5--table-is-now-a-view" title="Direct link to heading">​</a></h4><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">view</span><span class="token plain"> t_became_a_view </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> id </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_became_a_view</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">24</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> create_view_stmt : object was a </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> but </span><span class="token operator" style="color:rgb(137, 221, 255)">is</span><span class="token plain"> now a</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">view</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;t_became_a_view&#x27;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Tables can&#x27;t become views...</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="case-6--table-was-in-base-schema-now-created">Case 6 : table was in base schema, now created<a class="hash-link" href="#case-6--table-was-in-base-schema-now-created" title="Direct link to heading">​</a></h4><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_created_in_wrong_version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_created_in_wrong_version</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">27</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> str : </span><span class="token keyword" style="font-style:italic">current</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> version </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> equal </span><span class="token keyword" style="font-style:italic">to</span><span class="token plain"> previous</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> version </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;t_created_in_wrong_version&#x27;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here a version annotation is added after the fact.  This item was already in the base schema.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="case-7-table-was-in-base-schema-now-deleted-ok">Case 7: table was in base schema, now deleted (ok)<a class="hash-link" href="#case-7-table-was-in-base-schema-now-deleted-ok" title="Direct link to heading">​</a></h4><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_was_correctly_deleted</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@delete</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_was_correctly_deleted</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>No errors here, just a regular delete.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="case-8-column-name-changed">Case 8: column name changed<a class="hash-link" href="#case-8-column-name-changed" title="Direct link to heading">​</a></h4><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_column_name_changed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id_ </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_column_name_changed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">33</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> str : </span><span class="token keyword" style="font-style:italic">column</span><span class="token plain"> name </span><span class="token operator" style="color:rgb(137, 221, 255)">is</span><span class="token plain"> different </span><span class="token operator" style="color:rgb(137, 221, 255)">between</span><span class="token plain"> previous </span><span class="token operator" style="color:rgb(137, 221, 255)">and</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">current</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">schema</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;id_&#x27;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can&#x27;t rename columns.  We could support this but it&#x27;s a bit of a maintenance nightmare and logical renames are possible easily without doing physical renames.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="case-9--column-type-changed">Case 9 : column type changed<a class="hash-link" href="#case-9--column-type-changed" title="Direct link to heading">​</a></h4><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_column_type_changed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">real</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_column_type_changed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">36</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> str : </span><span class="token keyword" style="font-style:italic">column</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">type</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">is</span><span class="token plain"> different </span><span class="token operator" style="color:rgb(137, 221, 255)">between</span><span class="token plain"> previous</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">and</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">current</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">schema</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;id&#x27;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can&#x27;t change the type of a column.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="case-10--column-attribute-changed">Case 10 : column attribute changed<a class="hash-link" href="#case-10--column-attribute-changed" title="Direct link to heading">​</a></h4><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_column_attribute_changed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_column_attribute_changed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">39</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> str : </span><span class="token keyword" style="font-style:italic">column</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">type</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">is</span><span class="token plain"> different </span><span class="token operator" style="color:rgb(137, 221, 255)">between</span><span class="token plain"> previous</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">and</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">current</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">schema</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;id&#x27;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Change of column attributes counts as a change of type.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="case-11-column-version-changed-for-delete">Case 11: column version changed for delete<a class="hash-link" href="#case-11-column-version-changed-for-delete" title="Direct link to heading">​</a></h4><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_column_delete_version_changed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> id2 </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@delete</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_column_delete_version_changed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> id2 </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@delete</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">42</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> str : </span><span class="token keyword" style="font-style:italic">column</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">current</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">delete</span><span class="token plain"> version </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> equal </span><span class="token keyword" style="font-style:italic">to</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">previous </span><span class="token keyword" style="font-style:italic">delete</span><span class="token plain"> version </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;id2&#x27;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can&#x27;t change the delete version after it has been set.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="case-12--column-version-changed-for-create">Case 12 : column version changed for create<a class="hash-link" href="#case-12--column-version-changed-for-create" title="Direct link to heading">​</a></h4><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_column_create_version_changed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> id2 </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_column_create_version_changed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> id2 </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">45</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> str : </span><span class="token keyword" style="font-style:italic">column</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">current</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> version </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> equal </span><span class="token keyword" style="font-style:italic">to</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">previous </span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> version </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;id2&#x27;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can&#x27;t change the create version after it has been set.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="case-13--column-default-value-changed">Case 13 : column default value changed<a class="hash-link" href="#case-13--column-default-value-changed" title="Direct link to heading">​</a></h4><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_column_default_value_changed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> id2 </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">default</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_column_default_value_changed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> id2 </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">default</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">48</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> str : </span><span class="token keyword" style="font-style:italic">column</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">current</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">default</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">value</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> equal </span><span class="token keyword" style="font-style:italic">to</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">previous </span><span class="token keyword" style="font-style:italic">default</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">value</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;id2&#x27;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can&#x27;t change the default value after the fact.  There&#x27;s no alter statement that would allow this even though it does make some logical sense.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="case-14--column-default-value-did-not-change-ok">Case 14 : column default value did not change (ok)<a class="hash-link" href="#case-14--column-default-value-did-not-change-ok" title="Direct link to heading">​</a></h4><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_column_default_value_ok</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> id2 </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">default</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_column_default_value_ok</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> id2 </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">default</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>No change. No error here.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="case-15--create-table-with-additional-attribute-present-and-matching-ok">Case 15 : create table with additional attribute present and matching (ok)<a class="hash-link" href="#case-15--create-table-with-additional-attribute-present-and-matching-ok" title="Direct link to heading">​</a></h4><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_additional_attribute_present</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b </span><span class="token keyword" style="font-style:italic">int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">primary</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">key</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_additional_attribute_present</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b </span><span class="token keyword" style="font-style:italic">int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">primary</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">key</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>No change. No error here.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="case-16--create-table-with-additional-attribute-doesnt-match">Case 16 : create table with additional attribute (doesn&#x27;t match)<a class="hash-link" href="#case-16--create-table-with-additional-attribute-doesnt-match" title="Direct link to heading">​</a></h4><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_additional_attribute_mismatch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">primary</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">key</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_additional_attribute_mismatch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b </span><span class="token keyword" style="font-style:italic">int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">primary</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">key</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">57</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> pk_def : a </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> facet </span><span class="token operator" style="color:rgb(137, 221, 255)">is</span><span class="token plain"> different </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> the previous</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">and</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">current</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">schema</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This is an error because the additional attribute does not match the previous schema.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="case-17--column-removed">Case 17 : column removed<a class="hash-link" href="#case-17--column-removed" title="Direct link to heading">​</a></h4><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_columns_removed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_columns_removed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> id2 </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">255</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> col_def : items have been removed </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> the </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">rather than marked </span><span class="token keyword" style="font-style:italic">with</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@delete</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;t_columns_removed&#x27;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can&#x27;t remove columns from tables.  You have to mark them with <code>@delete</code> instead.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="case-18--create-table-with-added-facet-not-present-in-the-previous">Case 18 : create table with added facet not present in the previous<a class="hash-link" href="#case-18--create-table-with-added-facet-not-present-in-the-previous" title="Direct link to heading">​</a></h4><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_attribute_added</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">primary</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">key</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_attribute_added</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">63</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> pk_def : </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> has a facet that </span><span class="token operator" style="color:rgb(137, 221, 255)">is</span><span class="token plain"> different </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> the</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">previous </span><span class="token operator" style="color:rgb(137, 221, 255)">and</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">current</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">schema</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;t_attribute_added&#x27;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Table facets like primary keys cannot be added after the fact. There is no way to do this in sqlite.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="case-19--create-table-with-additional-column-and-no-create">Case 19 : create table with additional column and no <code>@create</code><a class="hash-link" href="#case-19--create-table-with-additional-column-and-no-create" title="Direct link to heading">​</a></h4><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_additional_column</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b </span><span class="token keyword" style="font-style:italic">int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_additional_column</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">66</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> col_def : </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> has </span><span class="token keyword" style="font-style:italic">columns</span><span class="token plain"> added without marking</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">them </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;t_additional_column&#x27;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If you add a new column like <code>b</code> above you have to mark it with <code>@create</code> in a suitable version.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="case-20--create-table-with-additional-column-and-create-ok">Case 20 : create table with additional column and `<code>@create</code> (ok)<a class="hash-link" href="#case-20--create-table-with-additional-column-and-create-ok" title="Direct link to heading">​</a></h4><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_additional_column_ok</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> c </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_additional_column_ok</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Column properly created.  No errors here.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="case-21--create-table-with-different-flags-like-temp">Case 21 : create table with different flags (like TEMP)<a class="hash-link" href="#case-21--create-table-with-different-flags-like-temp" title="Direct link to heading">​</a></h4><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TEMP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_becomes_temp_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b </span><span class="token keyword" style="font-style:italic">int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_becomes_temp_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b </span><span class="token keyword" style="font-style:italic">int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">72</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> create_table_stmt : </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> statement attributes</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">different than previous version </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;t_becomes_temp_table&#x27;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Table became a TEMP table, there is no way to generate an alter statement for that.  Not allowed.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="case-22--create-table-and-apply-annotation-ok">Case 22 : create table and apply annotation (ok)<a class="hash-link" href="#case-22--create-table-and-apply-annotation-ok" title="Direct link to heading">​</a></h4><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_new_table_ok</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b </span><span class="token keyword" style="font-style:italic">int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- no previous version</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>No errors here; this is a properly created new table.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="case-23--create-new-table-without-annotation-error">Case 23 : create new table without annotation (error)<a class="hash-link" href="#case-23--create-new-table-without-annotation-error" title="Direct link to heading">​</a></h4><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_new_table_no_annotation</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b </span><span class="token keyword" style="font-style:italic">int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- no previous version</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">85</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> create_table_stmt : new </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> must be added </span><span class="token keyword" style="font-style:italic">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">or</span><span class="token plain"> later </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;t_new_table_no_annotation&#x27;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This table was added with no annotation.  It has to have an @create and be at least version 6, the current largest.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="case-24--create-new-table-stale-annotation-error">Case 24 : create new table stale annotation (error)<a class="hash-link" href="#case-24--create-new-table-stale-annotation-error" title="Direct link to heading">​</a></h4><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_new_table_stale_annotation</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b </span><span class="token keyword" style="font-style:italic">int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- no previous version</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">91</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> create_table_stmt : new </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> must be added </span><span class="token keyword" style="font-style:italic">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">or</span><span class="token plain"> later </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;t_new_table_stale_annotation&#x27;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The schema is already up to version 6.  You can&#x27;t then add a table in the past at version 2.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="case-25--add-columns-to-table-marked-create-and-delete">Case 25 : add columns to table, marked <code>@create</code> and <code>@delete</code><a class="hash-link" href="#case-25--add-columns-to-table-marked-create-and-delete" title="Direct link to heading">​</a></h4><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_new_table_create_and_delete</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@delete</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">7</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_new_table_create_and_delete</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">96</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> col_def : </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> has newly added </span><span class="token keyword" style="font-style:italic">columns</span><span class="token plain"> that are</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">marked both </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">and</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@delete</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;t_new_table_create_and_delete&#x27;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Adding a column in the new version and marking it both create and delete is ... weird... don&#x27;t do that.  Technically you can do it (sigh) but it must be done one step at a time.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="case-26--add-columns-to-table-marked-create-correctly">Case 26 : add columns to table, marked <code>@create</code> correctly<a class="hash-link" href="#case-26--add-columns-to-table-marked-create-correctly" title="Direct link to heading">​</a></h4><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_new_legit_column</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t_new_legit_column</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>No errors here; new column added in legit version.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="case-27--create-table-with-a-create-migration-proc-where-there-was-none">Case 27 : create table with a create migration proc where there was none<a class="hash-link" href="#case-27--create-table-with-a-create-migration-proc-where-there-was-none" title="Direct link to heading">​</a></h4><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> with_create_migrator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ACreateMigrator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> with_create_migrator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">104</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> str : </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">procedure</span><span class="token plain"> changed </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> object</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;with_create_migrator&#x27;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can&#x27;t add a create migration proc after the fact.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="case-28--create-table-with-a-different-create-migration-proc">Case 28 : create table with a different create migration proc<a class="hash-link" href="#case-28--create-table-with-a-different-create-migration-proc" title="Direct link to heading">​</a></h4><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> with_create_migrator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ACreateMigrator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> with_create_migrator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ADifferentCreateMigrator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">104</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> str : </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">procedure</span><span class="token plain"> changed </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> object</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;with_create_migrator&#x27;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can&#x27;t change a create migration proc after the fact.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="case-29--create-table-with-a-delete-migration-proc-where-there-was-none">Case 29 : create table with a delete migration proc where there was none<a class="hash-link" href="#case-29--create-table-with-a-delete-migration-proc-where-there-was-none" title="Direct link to heading">​</a></h4><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> with_delete_migrator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@delete</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ADeleteMigrator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> with_delete_migrator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@delete</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">107</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> str : </span><span class="token variable" style="color:rgb(191, 199, 213)">@delete</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">procedure</span><span class="token plain"> changed </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> object</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;with_delete_migrator&#x27;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can&#x27;t add a delete migration proc after the fact.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="case-30--create-table-with-a-different-delete-migration-proc">Case 30 : create table with a different delete migration proc<a class="hash-link" href="#case-30--create-table-with-a-different-delete-migration-proc" title="Direct link to heading">​</a></h4><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> with_delete_migrator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@delete</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ADeleteMigrator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> with_delete_migrator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@delete</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ADifferentDeleteMigrator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">107</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> str : </span><span class="token variable" style="color:rgb(191, 199, 213)">@delete</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">procedure</span><span class="token plain"> changed </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> object</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;with_delete_migrator&#x27;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can&#x27;t change a delete migration proc after the fact.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="case-31--create-a-table-which-was-a-view-in-the-previous-schema">Case 31 : create a table which was a view in the previous schema<a class="hash-link" href="#case-31--create-a-table-which-was-a-view-in-the-previous-schema" title="Direct link to heading">​</a></h4><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> view_becomes_a_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">view</span><span class="token plain"> view_becomes_a_table </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> X</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">110</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> create_table_stmt : object was a </span><span class="token keyword" style="font-style:italic">view</span><span class="token plain"> but </span><span class="token operator" style="color:rgb(137, 221, 255)">is</span><span class="token plain"> now a</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;view_becomes_a_table&#x27;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Converting views to tables is not allowed.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="case-32--delete-a-view-without-marking-it-deleted">Case 32 : delete a view without marking it deleted<a class="hash-link" href="#case-32--delete-a-view-without-marking-it-deleted" title="Direct link to heading">​</a></h4><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">--- no matching view in current schema</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">view</span><span class="token plain"> view_was_zomg_deleted </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> X</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">333</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> create_view_stmt : </span><span class="token keyword" style="font-style:italic">view</span><span class="token plain"> was present but now it does</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> exist </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">use</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@delete</span><span class="token plain"> instead</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;view_was_zomg_deleted&#x27;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here the view was deleted rather than marking it with <code>@delete</code>, resulting in an error.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="case-33--create-a-new-version-of-this-view-that-is-not-temp">Case 33 : create a new version of this view that is not temp<a class="hash-link" href="#case-33--create-a-new-version-of-this-view-that-is-not-temp" title="Direct link to heading">​</a></h4><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">view</span><span class="token plain"> view_was_temp_but_now_it_is_not </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> X</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">temp</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">view</span><span class="token plain"> view_was_temp_but_now_it_is_not </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> X</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">339</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> create_view_stmt : </span><span class="token keyword" style="font-style:italic">TEMP</span><span class="token plain"> property changed </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> new</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">schema</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">view</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;view_was_temp_but_now_it_is_not&#x27;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>A temp view became a view.  This flag is not allowed to change.  Side note: temp views are weird.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="case-34--create-a-new-version-of-this-view-that-was-created-in-a-different-version">Case 34 : create a new version of this view that was created in a different version<a class="hash-link" href="#case-34--create-a-new-version-of-this-view-that-was-created-in-a-different-version" title="Direct link to heading">​</a></h4><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">view</span><span class="token plain"> view_with_different_create_version </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> X </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">view</span><span class="token plain"> view_with_different_create_version </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> X </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">116</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> str : </span><span class="token keyword" style="font-style:italic">current</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> version </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> equal </span><span class="token keyword" style="font-style:italic">to</span><span class="token plain"> previous</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> version </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;view_with_different_create_version&#x27;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can&#x27;t change the create version of a view after the fact.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="case-35--create-an-index-that-is-now-totally-gone-in-the-new-schema">Case 35 : create an index that is now totally gone in the new schema<a class="hash-link" href="#case-35--create-an-index-that-is-now-totally-gone-in-the-new-schema" title="Direct link to heading">​</a></h4><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">--- no matching index in current schema</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">index</span><span class="token plain"> this_index_was_deleted_with_no_annotation </span><span class="token keyword" style="font-style:italic">on</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">349</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> create_index_stmt : </span><span class="token keyword" style="font-style:italic">index</span><span class="token plain"> was present but now it</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">does </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> exist </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">use</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@delete</span><span class="token plain"> instead</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;this_index_was_deleted_with_no_annotation&#x27;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You have to use <code>@delete</code> on indices to remove them correctly.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="case-36--create-a-view-with-no-annotation-that-is-not-in-the-previous-schema">Case 36 : create a view with no annotation that is not in the previous schema<a class="hash-link" href="#case-36--create-a-view-with-no-annotation-that-is-not-in-the-previous-schema" title="Direct link to heading">​</a></h4><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">view</span><span class="token plain"> view_created_with_no_annotation </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> X</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">--- there is no previous version</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">122</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> create_view_stmt : new </span><span class="token keyword" style="font-style:italic">view</span><span class="token plain"> must be added </span><span class="token keyword" style="font-style:italic">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">or</span><span class="token plain"> later </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;view_created_with_no_annotation&#x27;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You have to use <code>@create</code> on views to create them correctly.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="case-37--index-created-in-different-version">Case 37 : index created in different version<a class="hash-link" href="#case-37--index-created-in-different-version" title="Direct link to heading">​</a></h4><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">index</span><span class="token plain"> this_index_has_a_changed_attribute </span><span class="token keyword" style="font-style:italic">on</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">index</span><span class="token plain"> this_index_has_a_changed_attribute </span><span class="token keyword" style="font-style:italic">on</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">125</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> str : </span><span class="token keyword" style="font-style:italic">current</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> version </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> equal </span><span class="token keyword" style="font-style:italic">to</span><span class="token plain"> previous</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> version </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;this_index_has_a_changed_attribute&#x27;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can&#x27;t change the <code>@create</code> version of an index.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="case-38--create-a-new-index-but-with-no-create-annotation">Case 38 : create a new index but with no <code>@create</code> annotation<a class="hash-link" href="#case-38--create-a-new-index-but-with-no-create-annotation" title="Direct link to heading">​</a></h4><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">index</span><span class="token plain"> this_index_was_created_with_no_annotation </span><span class="token keyword" style="font-style:italic">on</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">--- there is no previous version</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">130</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> create_index_stmt : new </span><span class="token keyword" style="font-style:italic">index</span><span class="token plain"> must be added </span><span class="token keyword" style="font-style:italic">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">or</span><span class="token plain"> later </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;this_index_was_created_with_no_annotation&#x27;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You have to use <code>@create</code> on indices to make new ones.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="case-39--create-a-table-with-a-column-def-that-has-a-different-create-migrator-proc">Case 39 : create a table with a column def that has a different create migrator proc<a class="hash-link" href="#case-39--create-a-table-with-a-column-def-that-has-a-different-create-migrator-proc" title="Direct link to heading">​</a></h4><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> create_column_migrate_test</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> id </span><span class="token keyword" style="font-style:italic">int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> id2 </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ChangedColumnCreateMigrator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> create_column_migrate_test</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> id </span><span class="token keyword" style="font-style:italic">int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> id2 </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> PreviousColumnCreateMigrator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">136</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> str : </span><span class="token keyword" style="font-style:italic">column</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">procedure</span><span class="token plain"> changed </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;id2&#x27;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can&#x27;t change the <code>@create</code> migration stored proc on columns.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="case-40--create-a-table-with-a-column-def-that-has-a-different-delete-migrator-proc">Case 40 : create a table with a column def that has a different delete migrator proc<a class="hash-link" href="#case-40--create-a-table-with-a-column-def-that-has-a-different-delete-migrator-proc" title="Direct link to heading">​</a></h4><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> delete_column_migrate_test</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> id </span><span class="token keyword" style="font-style:italic">int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> id2 </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@delete</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ChangedColumnDeleteMigrator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-------</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> delete_column_migrate_test</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> id </span><span class="token keyword" style="font-style:italic">int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> id2 </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@delete</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> PreviousColumnDeleteMigrator</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">Error at sem_test_prev</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">sql</span><span class="token plain">:</span><span class="token number" style="color:rgb(247, 140, 108)">142</span><span class="token plain"> : </span><span class="token operator" style="color:rgb(137, 221, 255)">in</span><span class="token plain"> str : </span><span class="token keyword" style="font-style:italic">column</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@delete</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">procedure</span><span class="token plain"> changed </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;id2&#x27;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can&#x27;t change the <code>@delete</code> migration stored proc on columns.</p><p>NOTE: in addition to these errors, there are many more that do not require the previous schema which are also checked (not shown here).  These comprise things like making sure the delete version is greater than the create version on any item.  There is a lot of sensibility checking that can happen without reference to the previous schema.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="chapter-12-testability-features">Chapter 12: Testability Features<a class="hash-link" href="#chapter-12-testability-features" title="Direct link to heading">​</a></h2><p>CQL includes a number of features to make it easier to create what you might call &quot;Test&quot; procedures.  These primarily are concerned with loading up the database with dummy data, and/or validating the result of normal procedures that query the database.  There are several interesting language features in these dimensions.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="dummy-data">Dummy Data<a class="hash-link" href="#dummy-data" title="Direct link to heading">​</a></h3><p>Test code can be needlessly brittle, especially when creating dummy data; any column changes typically cause all sorts of data insertion code to need to be repaired.
In many cases the actual data values are completely uninteresting to the test -- any values would do.  There are several strategies you can use to get good dummy data into your database in a more maintainable way.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="simple-inserts-with-dummy-data">Simple Inserts With Dummy Data<a class="hash-link" href="#simple-inserts-with-dummy-data" title="Direct link to heading">​</a></h4><p>The simplest form uses a variant of the insert statement that fills in any missing columns with a seed value.  An example might be something like the below:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> dummy_user</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> users </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">values</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@dummy_seed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">123</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token variable" style="color:rgb(191, 199, 213)">@dummy_nullables</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@dummy_defaults</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This statement causes all values including columns that are nullable or have a default value to get the value <code>123</code> for any numeric type and
<code>&#x27;column_name_123&#x27;</code> for any text.</p><p>If you omit the <code>@dummy_nullables</code> then any nullable fields will be null as usual.  And likewise if you omit <code>@dummy_defaults</code> then any fields with a default value will use that value as usual.  You might want any combination of these for your tests (null values are handy in your tests and default behavior is also handy.)</p><p>The <code>@dummy_seed</code> expression provided can be anything that resolves to a non-null integer value, so it can be pretty flexible.  You might use a <code>while</code> loop to insert a bunch of
rows with the seed value being computed from the <code>while</code> loop variable.</p><p>The form above is sort of like <code>insert * into table</code> in that it is giving dummy values for all columns but you can also specify some of the columns while using the seed value for others.  Importantly, you can specify values you particularly want to control either for purposes of creating a more tailored test or because you need them
to match existing or created rows in a table referenced by a foreign key.</p><p>As an example:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> users </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">values</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1234</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@dummy_seed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">123</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token variable" style="color:rgb(191, 199, 213)">@dummy_nullables</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@dummy_defaults</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>will provide dummy values for everything but the <code>id</code> column.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="using-with-recursive">Using <code>WITH RECURSIVE</code><a class="hash-link" href="#using-with-recursive" title="Direct link to heading">​</a></h4><p>Sometimes what you want to do is create a dummy result set without necessarily populating the database at all.  If you have code
that consumes a result set of a particular shape, it&#x27;s easy enough to create a fake result set with a pattern something like this:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">procedure</span><span class="token plain"> dummy_stuff</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">lim </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">WITH</span><span class="token plain"> RECURSIVE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">dummy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token keyword" style="font-style:italic">UNION</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">ALL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> x</span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">dummy</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> lim</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    x id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;name_%d&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    cast</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x </span><span class="token operator" style="color:rgb(137, 221, 255)">%</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">bool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> is_cool</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    x </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1.3</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> rate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    x etc1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    x etc2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">dummy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The first part of the above creates a series of numbers from 1 to <code>lim</code>.  The second uses those values to create dummy columns.
Any result shape can be generated in this fashion.</p><p>You get data like this from the above:</p><div class="language-text codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">1|name_1|1|1.3|1|1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2|name_2|0|2.6|2|2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">3|name_3|1|3.9|3|3</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">4|name_4|0|5.2|4|4</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">5|name_5|1|6.5|5|5</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">6|name_6|0|7.8|6|6</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">7|name_7|1|9.1|7|7</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">8|name_8|0|10.4|8|8</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">9|name_9|1|11.7|9|9</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">10|name_10|0|13.0|10|10</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The result of the select statement is itself quite flexible and if more dummy data is what you wanted, this form can be combined with
<code>INSERT ... FROM SELECT...</code> to create dummy data in real tables.   And of course once you have a core query you could use it in a variety of ways,
combined with cursors or any other strategy to <code>select</code> out pieces and <code>insert</code> them into various tables.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="using-temporary-tables">Using Temporary Tables<a class="hash-link" href="#using-temporary-tables" title="Direct link to heading">​</a></h4><p>If you need an API to create very flexible dummy data with values of your choice you can use temporary tables and a series of helper procedures.</p><p>First, create a table to hold the results. You can of course make this table however you need to but the <code>like</code> construct in the table creation
is especially helpful; it creates columns in the table that match the name and type of the named object.  For instance <code>like my_proc</code> is shorthand for the column names ands of the shape that <code>my_proc</code> returns.  This is perfect for
emulating the results of <code>my_proc</code>.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> begin_dummy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">drop</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">exists</span><span class="token plain"> my_dummy_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- the shape of my_dummy_data matches the columns</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- returned by proc_I_want_to_emulate</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">temp</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> my_dummy_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> proc_I_want_to_emulate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Next, you will need a procedure that accepts and writes a single row to your temp table.  You can of course write this all explicitly but the testing
support features provide more support to make things easier; In this example, arguments  of the procedure will exactly match the output of the procedure we emulating,
one argument for each column the proc returns. The <code>insert</code> statement gets its values from the arguments.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> add_dummy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> proc_I_want_to_emulate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> my_dummy_data </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> arguments</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This allows you to create the necessary helper methods automatically even if the procedure changes over time.</p><p>Next we need a procedure to get our result set.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> get_dummy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> my_dummy_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And finally, some cleanup.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> cleanup_dummy</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">drop</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">exists</span><span class="token plain"> my_dummy_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Again the temp table could be combined with <code>INSERT INTO ...FROM SELECT...</code> to create dummy data in real tables.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="other-considerations-1">Other Considerations<a class="hash-link" href="#other-considerations-1" title="Direct link to heading">​</a></h4><p>Wrapping your <code>insert</code> statements in <code>try/catch</code> can be very useful if there may be dummy data conflicts.  In test code searching for a new suitable seed is pretty easy.  Alternatively</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> seed :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">max</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>could be very useful.  Many alternatives are also possible.</p><p>The dummy data features are not suitable for use in production code, only tests.  But the LIKE features are generally useful for creating contract-like behavior in procs and there
are reasonable uses for them in production code.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="complex-result-set-example">Complex Result Set Example<a class="hash-link" href="#complex-result-set-example" title="Direct link to heading">​</a></h4><p>Here&#x27;s a more complicated example that can be easily rewritten using the sugar features.  This method is designed to
return a single-row result set that can be used to mock a method.  I&#x27;ve replaced the real fields with &#x27;f1, &#x27;f2&#x27; etc.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> test_my_subject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  f1_ LONG </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  f2_ </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  f3_ </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  f4_ LONG </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  f5_ </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  f6_ </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  f7_ </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  f8_ </span><span class="token keyword" style="font-style:italic">BOOL</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  f9_ </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  f10_ </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> data_cursor </span><span class="token keyword" style="font-style:italic">CURSOR</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">LIKE</span><span class="token plain"> my_subject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">FETCH</span><span class="token plain"> data_cursor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">VALUES</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">f1_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> f2_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> f3_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> f4_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> f5_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> f6_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> f7_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> f8_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> f9_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> f10</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">OUT</span><span class="token plain"> data_cursor</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This can be written much more maintainably as:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> test_my_subject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> my_subject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">CURSOR</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">LIKE</span><span class="token plain"> my_subject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">FETCH</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> ARGUMENTS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">OUT</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Naturally, real columns have much longer names and there are often many more than 10.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="autotest-attributes">Autotest Attributes<a class="hash-link" href="#autotest-attributes" title="Direct link to heading">​</a></h3><p>Some of the patterns described above are so common that CQL offers a mechanism to automatically generate those test procedures.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="temporary-table-pattern">Temporary Table Pattern<a class="hash-link" href="#temporary-table-pattern" title="Direct link to heading">​</a></h4><p>The attributes dummy_table, dummy_insert, and dummy_select can be used together to create and populate temp tables.</p><p>Example:</p><p>To create a dummy row set for <code>sample_proc</code>, add the cql:autotest attribute with dummy_table, dummy_insert, and dummy_select values.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@attribute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cql:autotest</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">dummy_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> dummy_insert</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> dummy_select</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> sample_proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">foo </span><span class="token keyword" style="font-style:italic">int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> Foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>dummy_table</code> generates procedures for creating and dropping a temp table with the same shape as <code>sample_proc</code>.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> open_sample_proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TEMP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> test_sample_proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">LIKE</span><span class="token plain"> sample_proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> close_sample_proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DROP</span><span class="token plain"> test_sample_proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>dummy_insert</code> attribute generates a procedure for inserting into the temp table.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> insert_sample_proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">LIKE</span><span class="token plain"> sample_proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">INSERT</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INTO</span><span class="token plain"> test_sample_proc </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> ARGUMENTS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>dummy_select</code> attribute generates procedures for selecting from the temp table.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> select_sample_proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> test_sample_proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>It&#x27;s interesting to note that the generated test code does not ever
need to mention the exact columns it is emulating because it can always use <code>like</code>, <code>*</code>, and <code>from arguments</code> in a generic way.</p><p>When compiled, the above will create C methods that can create, drop, insert, and select from the temp table.  They will have the following signatures:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">CQL_WARN_UNUSED cql_code open_sample_proc(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  sqlite3 *_Nonnull _db_);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">CQL_WARN_UNUSED cql_code close_sample_proc(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  sqlite3 *_Nonnull _db_);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">CQL_WARN_UNUSED cql_code insert_sample_proc(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  sqlite3 *_Nonnull _db_,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_int32 id_,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_string_ref _Nonnull name_);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">CQL_WARN_UNUSED cql_code select_sample_proc_fetch_results(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  sqlite3 *_Nonnull _db_,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  select_sample_proc_result_set_ref _Nullable *_Nonnull result_set);</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="single-row-resultset">Single Row ResultSet<a class="hash-link" href="#single-row-resultset" title="Direct link to heading">​</a></h4><p>In some cases, using four APIs to generate fake data can be verbose.
In the case that only a single row of data needs to be faked, the dummy_result_set attribute can be more convenient.</p><p>Example:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token variable" style="color:rgb(191, 199, 213)">@attribute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cql:autotest</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">dummy_result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> sample_proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> id </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> Foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Will generate the following procedure</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> generate_sample_proc_row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">LIKE</span><span class="token plain"> sample_proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> curs </span><span class="token keyword" style="font-style:italic">CURSOR</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">LIKE</span><span class="token plain"> sample_proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">FETCH</span><span class="token plain"> curs </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> ARGUMENTS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">OUT</span><span class="token plain"> curs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Which generates this C API:</p><div class="language-c codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-c codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">generate_sample_proc_row_fetch_results</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    generate_sample_proc_row_rowset_ref _Nullable </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">_Nonnull result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    string_ref _Nonnull foo_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">int64_t</span><span class="token plain"> bar_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>These few test helpers are useful in a variety of scenarios and can save you a lot of typing and maintenance.  They evolve automatically as the code
changes, always matching the signature of the attributed procedure.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="generalized-dummy-test-pattern">Generalized Dummy Test Pattern<a class="hash-link" href="#generalized-dummy-test-pattern" title="Direct link to heading">​</a></h4><p>The most flexible test helper is the <code>dummy_test</code> form.  This is far more advanced than the simple helpers above.  While the choices above were designed to help you create fake result sets pretty easily, <code>dummy_test</code> goes much further letting you set up arbitrary schema and data so that you can run your procedure on actual data.  The <code>dummy_test</code> code generator uses the features above to do its job and like the other autotest options, it works by automatically generating CQL code from your procedure definition.  However, you get a lot more code in this mode.  It&#x27;s easiest to study an example so let&#x27;s begin there.</p><p>To understand <code>dummy_test</code> we&#x27;ll need a more complete example, so we start with this simple two-table schema with a trigger and some indices. To this we add a very small procedure that we might want to test.</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">create table foo(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> id integer not null primary key,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> name text</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create table bar(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> id integer not null primary key references foo(id),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> data text</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create index foo_index on foo(name);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create index bar_index on bar(data);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create temp trigger if not exists trigger1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  before delete on foo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  delete from foo where name = &#x27;this is so bogus&#x27;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">@attribute(cql:autotest=(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  dummy_table,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  dummy_insert,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  dummy_select,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  dummy_result_set,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  (dummy_test, (bar, (data), (&#x27;plugh&#x27;))))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create proc the_subject()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  select * from bar;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>As you can see, we have two tables, <code>foo</code> and <code>bar</code>; the <code>foo</code> table has a trigger;  both <code>foo</code> and <code>bar</code> have indices.  This schema is very simple, but of course it could be a lot more complicated, and real cases typically are.</p><p>The procedure we want to test is creatively called <code>the_subject</code>.  It has lots of test attributes on it.  We&#x27;ve already discussed <code>dummy_table</code>, <code>dummy_insert</code>, <code>dummy_select</code>, and <code>dummy_result_set</code> above but as you can see they can be mixed in with <code>dummy_test</code>.  Now let&#x27;s talk about <code>dummy_test</code>.  First you&#x27;ll notice that annotation has additional sub-attributes; the attribute grammar is sufficiently flexible such that, in principle, you could represent an arbitrary LISP program, so the instructions can be very detailed.  In this case, the attribute provides table and column names, as well as sample data.  We&#x27;ll discuss that when we get to the population code.</p><p>First let&#x27;s dispense with the attributes we already discussed -- since we had all the attributes, the output will include those helpers, too.  Here they are again:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- note that the code does not actually call the test subject</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- this declaration is used so that CQL will know the shape of the result</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> the_subject </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">data</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> open_the_subject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TEMP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> test_the_subject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">LIKE</span><span class="token plain"> the_subject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> close_the_subject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DROP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> test_the_subject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> insert_the_subject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">LIKE</span><span class="token plain"> the_subject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">INSERT</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INTO</span><span class="token plain"> test_the_subject </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> ARGUMENTS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> select_the_subject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> test_the_subject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> generate_the_subject_row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">LIKE</span><span class="token plain"> the_subject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> curs </span><span class="token keyword" style="font-style:italic">CURSOR</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">LIKE</span><span class="token plain"> the_subject</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">FETCH</span><span class="token plain"> curs </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> ARGUMENTS</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">OUT</span><span class="token plain"> curs</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>That covers what we had before, so, what&#x27;s new?  Actually, quite a bit.  We&#x27;ll begin with the easiest:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> test_the_subject_create_tables</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">EXISTS</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    id </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">KEY</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    name </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">EXISTS</span><span class="token plain"> bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    id </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">KEY</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">REFERENCES</span><span class="token plain"> foo </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">data</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Probably the most important of all the helpers, <code>test_the_subject_create_tables</code> will create all the tables you need to run the procedure.  Note that in this case, even though the subject code only references <code>bar</code>, CQL determined that <code>foo</code> is also needed because of the foreign key.</p><p>The symmetric drop procedure is also generated:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> test_the_subject_drop_tables</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DROP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">EXISTS</span><span class="token plain"> bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DROP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">EXISTS</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Additionally, in this case there were triggers and indices.  This caused the creation of helpers for those aspects.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> test_the_subject_create_indexes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INDEX</span><span class="token plain"> bar_index </span><span class="token keyword" style="font-style:italic">ON</span><span class="token plain"> bar </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INDEX</span><span class="token plain"> foo_index </span><span class="token keyword" style="font-style:italic">ON</span><span class="token plain"> foo </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> test_the_subject_create_triggers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TEMP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TRIGGER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">EXISTS</span><span class="token plain"> trigger1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    BEFORE </span><span class="token keyword" style="font-style:italic">DELETE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">ON</span><span class="token plain"> foo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DELETE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> foo </span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"> name </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;this is so bogus&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> test_the_subject_drop_indexes</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DROP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INDEX</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">EXISTS</span><span class="token plain"> bar_index</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DROP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INDEX</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">EXISTS</span><span class="token plain"> foo_index</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> test_the_subject_drop_triggers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DROP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TRIGGER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">EXISTS</span><span class="token plain"> trigger1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If there are no triggers or indices, the corresponding create/drop methods will not be generated.</p><p>With these helpers available, when writing test code you can then choose if you want to create just the tables, or the tables and indices, or tables and indices and triggers by invoking the appropriate combination of helper methods.  Since all the implicated triggers and indices are automatically included, even if they change over time, maintenance is greatly simplified.</p><p>Note that in this case the code simply reads from one of the tables, but in general the procedure under test might make modifications as well.  Test code frequently has to read back the contents of the tables to verify that they were modified correctly.  So these additional helper methods are also included:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> test_the_subject_read_foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> test_the_subject_read_bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>These procedures will allow you to easily create result sets with data from the relevant tables which can then be verified for correctness.  Of course if more tables were implicated, those would have been included as well.</p><p>As you can see, the naming always follows the convention <code>test_[YOUR_PROCEDURE]_[helper_type]</code></p><p>Finally, the most complicated helper is the one that used that large annotation.  Recall that we provided the fragment <code>(dummy_test, (bar, (data), (&#x27;plugh&#x27;))))</code> to the compiler.  This fragment helped to produce this last helper function:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> test_the_subject_populate_tables</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">INSERT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IGNORE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INTO</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">VALUES</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@dummy_seed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">123</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">INSERT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IGNORE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INTO</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">VALUES</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@dummy_seed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">124</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token variable" style="color:rgb(191, 199, 213)">@dummy_nullables</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@dummy_defaults</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">INSERT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IGNORE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INTO</span><span class="token plain"> bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">VALUES</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;plugh&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@dummy_seed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">125</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">INSERT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IGNORE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INTO</span><span class="token plain"> bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">VALUES</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@dummy_seed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">126</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token variable" style="color:rgb(191, 199, 213)">@dummy_nullables</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@dummy_defaults</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In general the <code>populate_tables</code> helper will fill all implicated tables with at least two rows of data.  It uses the dummy data features discussed earlier to generate the items using a seed.  Recall that if <code>@dummy_seed</code> is present in an <code>insert</code> statement then any missing columns are generated using that value, either as a string, or as an integer (or true/false for a boolean).   Note that the second of the two rows that is generated also specifies <code>@dummy_nullables</code> and <code>@dummy_defaults</code>.  This means that even nullable columns, and columns with a default value will get the non-null seed instead.  So you get a mix of null/default/explicit values loaded into your tables.</p><p>Of course blindly inserting data doesn&#x27;t quite work.  As you can see, the insert code used the foreign key references in the schema to figure out the necessary insert order and the primary key values for <code>foo</code> were automatically specified so that they could then be used again in <code>bar</code>.</p><p>Lastly, the autotest attribute included explicit test values for the table <code>bar</code>, and  in particular the <code>data</code> column has the value <code>&#x27;plugh&#x27;</code>.  So the first row of data for table <code>bar</code> did not use dummy data for the <code>data</code> column but rather used <code>&#x27;plugh&#x27;</code>.</p><p>In general, the <code>dummy_test</code> annotation can include any number of tables, and for each table you can specify any of the columns and you can have any number of tuples of values for those columns.</p><p>NOTE: if you include primary key and/or foreign key columns among the explicit values, it&#x27;s up to you to ensure that they are valid combinations.  SQLite will complain as usual if they are not, but the CQL compiler will simply emit the data you asked for.</p><p>Generalizing the example a little bit, we could use the following:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">(dummy_test, (foo, (name), (&#x27;fred&#x27;), (&#x27;barney&#x27;), (&#x27;wilma&#x27;), (&#x27;betty&#x27;)),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                        (bar, (id, data), (1, &#x27;dino&#x27;), (2, &#x27;hopparoo&#x27;))))</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>to generate this population:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">CREATE PROC test_the_subject_populate_tables()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">BEGIN</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  INSERT OR IGNORE INTO foo(name, id) VALUES(&#x27;fred&#x27;, 1) @dummy_seed(123);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  INSERT OR IGNORE INTO foo(name, id) VALUES(&#x27;barney&#x27;, 2) @dummy_seed(124)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    @dummy_nullables @dummy_defaults;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  INSERT OR IGNORE INTO foo(name, id) VALUES(&#x27;wilma&#x27;, 3) @dummy_seed(125);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  INSERT OR IGNORE INTO foo(name, id) VALUES(&#x27;betty&#x27;, 4) @dummy_seed(126)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    @dummy_nullables @dummy_defaults;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  INSERT OR IGNORE INTO bar(id, data) VALUES(1, &#x27;dino&#x27;) @dummy_seed(127);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  INSERT OR IGNORE INTO bar(id, data) VALUES(2, &#x27;hopparoo&#x27;) @dummy_seed(128)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    @dummy_nullables @dummy_defaults;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">END;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And of course if the annotation is not flexible enough, you can write your own data population.</p><p>The CQL above results in the usual C signatures.  For instance:</p><div class="language-c codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-c codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">CQL_WARN_UNUSED cql_code </span><span class="token function" style="color:rgb(130, 170, 255)">test_the_subject_populate_tables</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">sqlite3 </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">_Nonnull _db_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>So, it&#x27;s fairly easy to call from C/C++ test code or from CQL test code.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="cross-procedure-limitations">Cross Procedure Limitations<a class="hash-link" href="#cross-procedure-limitations" title="Direct link to heading">​</a></h4><p>Generally it&#x27;s not possible to compute table usages that come from called procedures. This is
because to do so you need to see the body of the called procedure and typically that body is in a different
translation -- and is therefore not available.  A common workaround for this particular problem is to create
a dummy procedure that explicitly uses all of the desired tables.  This is significantly easier than creating all
the schema manually and still gets you triggers and indices automatically.  Something like this:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token variable" style="color:rgb(191, 199, 213)">@attribute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cql:autotest</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">dummy_test</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> use_my_stuff</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  let x :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> t1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> t2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> t3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> t4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> t5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> t6</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> etc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The above can be be done as a macro if desired.  But in any case <code>use_my_stuff</code> simply and directly lists the desired tables.
Using this approach you can have one set of test helpers for an entire unit rather than one per procedure.  This
is often desirable and the maintenance is not too bad.  You just use the <code>use_my_stuff</code> test helpers everywhere.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="chapter-13-json-output">Chapter 13: JSON Output<a class="hash-link" href="#chapter-13-json-output" title="Direct link to heading">​</a></h2><p>To help facilitate additional tools that might want to depend on CQL input files further down the toolchain, CQL includes a JSON output format for SQL DDL as well as stored procedure information, including special information for a single-statement DML.  &quot;Single-statement DML&quot; refers to those stored procedures that consist of a single <code>insert</code>, <code>select</code>, <code>update</code>, or <code>delete</code>.   Even though such procedures comprise just one statement, good argument binding can create very powerful DML fragments that are re-usable.  Many CQL stored procedures are of this form (in practice maybe 95% are just one statement.)</p><p>To use CQL in this fashion, the sequence will be something like the below.  See Appendix 1 for command line details.</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cql --in input.sql --rt json_schema --cg out.json</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The output contains many different sections for the various types of entities that CQL can process.  There is a full description of
the possible outputs available at <a href="https://cgsql.dev/json-diagram" target="_blank" rel="noopener noreferrer">https://cgsql.dev/json-diagram</a>.</p><p>In the balance of this chapter we&#x27;ll deal with the contents of the sections and their meaning rather than the specifics of the format,
which are better described with the grammar above.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="tables">Tables<a class="hash-link" href="#tables" title="Direct link to heading">​</a></h4><p>The &quot;tables&quot; section has zero or more tables, each table is comprised of these fields:</p><ul><li>name : the table name</li><li>crc : the schema CRC for the entire table definition, including columns and constraints</li><li>isTemp : true if this is a temporary table</li><li>ifNotExists : true if the table was created with &quot;if not exists&quot;</li><li>withoutRowid : true if the table was created using &quot;without rowid&quot;</li><li>isAdded : true if the table has an @create directive<ul><li>addedVersion : optional, the schema version number in the @create directive</li></ul></li><li>isDeleted : true if the table was marked with @delete or is currently <em>unsubscribed</em><ul><li>deletedVersion : optional, the schema version number in the @delete directive</li></ul></li><li>isRecreated : true if the table is marked with @recreate<ul><li>recreateGroupName : optional, if the @recreate attribute specifies a group name, it is present here</li></ul></li><li>unsubscribedVersion : optional, if the table was last unsubscribed, the version number when this happened</li><li>resubscribedVersion : optional, if the table was last resubscribed, the version number when this happened</li><li><em>region information</em> : optional, see the section on Region Info</li><li>indices : optional, a list of the names of the indices on this table, see the indices section</li><li><em>attributes</em> : optional, see the section on attributes, they appear in many places</li><li><em>columns</em> : an array of column definitions, see the section on columns</li><li>primaryKey : a list of column names, possibly empty if no primary key</li><li>primaryKeySortOrders : a list of corresponding sort orders, possibly empty, for each column of the primary key if specified</li><li>primaryKeyName : optional, the name of the primary key, if it has one</li><li><em>foreignKeys</em> : a list of foreign keys for this table, possibly empty, see the foreign keys section</li><li><em>uniqueKeys</em> : a list of unique keys for this table, possibly empty, see the unique keys section</li><li><em>checkExpressions</em> : a list of check expressions for this table, possibly empty, see the check expression section</li></ul><p>Example:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token variable" style="color:rgb(191, 199, 213)">@attribute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">an_attribute</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;foo&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;bar&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  id </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>generates:</p><div class="language-json codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-json codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;name&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;foo&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;CRC&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;-1869326768060696459&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;isTemp&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;ifNotExists&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;withoutRowid&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;isAdded&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;isDeleted&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;isRecreated&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;indices&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;foo_name&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;attributes&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;name&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;an_attribute&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;value&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;foo&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;bar&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;columns&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;name&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;id&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;type&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;integer&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;isNotNull&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;isAdded&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;isDeleted&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;isPrimaryKey&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;isUniqueKey&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;isAutoIncrement&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;name&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;name&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;type&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;text&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;isNotNull&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;isAdded&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;isDeleted&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;isPrimaryKey&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;isUniqueKey&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;isAutoIncrement&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;primaryKey&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;primaryKeySortOrders&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;foreignKeys&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;uniqueKeys&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;checkExpressions&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="region-information">Region Information<a class="hash-link" href="#region-information" title="Direct link to heading">​</a></h4><p>Region Information can appear on many entities, it consists of two optional elements:</p><ul><li>region : optional, the name of the region in which the entity was defined</li><li>deployedInRegion : optional, the deployment region in which that region is located</li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="attributes">Attributes<a class="hash-link" href="#attributes" title="Direct link to heading">​</a></h4><p>Miscelleaneous attributes can be present on virtual every kind of entity.  They are optional.  The root node
introduces the attributes:</p><ul><li>attributes : a list at least one attribute</li></ul><p>Each attribute is a name and value pair:</p><ul><li>name : any string<ul><li>attribute names are often compound like &quot;cql:shared_fragment&quot;</li><li>they are otherwise simple identifiers</li></ul></li><li>value : any <em>attribute value</em></li></ul><p>Each <em>attribute value</em> can be:</p><ul><li>any literal</li><li>an array of <em>attribute values</em></li></ul><p>Since the <em>attribute values</em> can nest its possible to represent arbitrarily complex data types in an attribute.  You can even represent a LISP program.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="foreign-keys">Foreign Keys<a class="hash-link" href="#foreign-keys" title="Direct link to heading">​</a></h4><p>Foreign keys appear only in tables, the list of keys contains zero or more entries of this form:</p><ul><li>name : optional, the name of the foreign key if specified</li><li>columns : the names of the constrained columns in the current table (the &quot;child&quot; table)</li><li>referenceTable : the name of the table that came after REFERENCES in the foreign key</li><li>referenceColumns : the constraining columns in the referenced table</li><li>onUpdate : the ON UPDATE action (e.g. &quot;CASCADE&quot;, &quot;NO ACTION&quot;, etc.)</li><li>onDelete : the ON DELETE action (e.g. &quot;CASCADE&quot;, &quot;NO ACTION&quot;, etc.)</li><li>isDeferred : boolean, indicating the deferred or not deferred setting for this foreign key</li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="unique-keys">Unique Keys<a class="hash-link" href="#unique-keys" title="Direct link to heading">​</a></h4><p>Unique keys appear only in tables, the list of keys contains zero or more entries of this form:</p><ul><li>name : optional, the name of the unique key if specified</li><li>columns: a list of 1 or more contrained column names</li><li>sortOrders: a list of corresponding sort orders for the columns</li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="check-expressions">Check Expressions<a class="hash-link" href="#check-expressions" title="Direct link to heading">​</a></h4><p>Check Expressions appear only in tables, the list of keys contains zero or more entries of this form:</p><ul><li>name : optional, the name of the unique key if specified</li><li>checkExpr : the check expression in plain text</li><li>checkExprArgs: an array of zero or more local variables that should be bound to the <code>?</code> items in the check expression</li></ul><p>The checkExprArgs will almost certainly be the empty list <code>[]</code>.  In the exceedingly rare situation that the table
in question was defined in a procedure and some of parts of the check expression were arguments to that procedure
then the check expression is not fully known until that procedure runs and some of its literals will be decided
at run time.  This is an extraordinary choice but technically possible.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="columns">Columns<a class="hash-link" href="#columns" title="Direct link to heading">​</a></h4><p>Columns are themselves rather complex, there are 1 or more of them in each table.  The table will have
a list of records of this form:</p><ul><li>name : the name of the columns</li><li><em>attributes</em> : optional, see the section on attributes, they appear in many places</li><li>type : the column type (e.g. bool, real, text, etc.)</li><li>kind : optional, if the type is qualified by a discriminator such as int&lt;task_id&gt; it appears here</li><li>isSensitive : optional, indicates a column that holds sensitive information such as PII</li><li>isNotNull : true if the column is not null</li><li>isAdded : true if the column has an @create directive<ul><li>addedVersion : optional, the schema version number in the @create directive</li></ul></li><li>isDeleted : true if the column was marked with @delete<ul><li>deletedVersion : optional, the schema version number in the @delete directive</li></ul></li><li>defaultValue : optional, can be any literal, the default value of the column</li><li>collate : optional, the collation string (e.g. nocase)</li><li>checkExpr : optional, the <em>check expression</em> for this column (see the related section)</li><li>isPrimaryKey : true if the column was marked with PRIMARY KEY</li><li>isUniqueKey : true if the column was marked with UNIQUE</li><li>isAutoIncrement : true if the column was marked with AUTOINCREMENT</li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="virtual-tables">Virtual Tables<a class="hash-link" href="#virtual-tables" title="Direct link to heading">​</a></h4><p>The &quot;virtualTables&quot; section is very similar to the &quot;tables&quot; section with zero or more virtual table entries.
Virtual table entries are the same as table entries with the following additions:</p><ul><li>module : the name of the module that manages this virtual table</li><li>isEponymous : true if the virtual table was declared eponymous</li><li>isVirtual : always true for virtual tables</li></ul><p>The JSON schema for these items was designed to be as similar as possible so that typically the same code can handle both
with possibly a few extra tests of the isVirtual field.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="views-1">Views<a class="hash-link" href="#views-1" title="Direct link to heading">​</a></h4><p>The views section contains the list of all views in the schema, it is zero or more view entires of this form.</p><ul><li>name : the view name</li><li>crc : the schema CRC for the entire view definition</li><li>isTemp : true if this is a temporary view</li><li>isDeleted : true if the view was marked with @delete<ul><li>deletedVersion : optional, the schema version number in the @delete directive</li></ul></li><li><em>region information</em> : optional, see the section on Region Info</li><li><em>attributes</em> : optional, see the section on attributes, they appear in many places</li><li><em>columns</em> : an array of column definitions, see the section on columns</li><li><em>projection</em> : an array of projected columns from the view, the view result if you will, see the section on projections</li><li>select : the text of the select statement that defined the view</li><li>selectArgs : the names of arguments any unbound expressions (&quot;?&quot;) in the view</li><li><em>dependencies</em> : several lists of tables and how they are used in the view, see the section on dependencies</li></ul><p>Note that the use of unbound expressions in a view truly extraordinary so selectArgs is essentially always going to be an empty list.</p><p>Example:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">VIEW</span><span class="token plain"> MyView </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> foo</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Generates:</p><div class="language-json codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-json codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;name&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;MyView&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;CRC&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;5545408966671198580&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;isTemp&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;isDeleted&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;projection&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;name&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;id&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;type&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;integer&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;isNotNull&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;name&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;name&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;type&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;text&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;isNotNull&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;select&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;SELECT id, name FROM foo&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;selectArgs&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;fromTables&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;foo&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;usesTables&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;foo&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="projections">Projections<a class="hash-link" href="#projections" title="Direct link to heading">​</a></h4><p>A projection defines the output shape of something that can return a table-like value such as a view or a procedure.</p><p>The projection consists of a list of one or more <em>projected columns</em>, each of which is:</p><ul><li>name : the name of the result column  (e.g. in select 2 as foo) the name is &quot;foo&quot;</li><li>type : the type of the column (e.g. text, real, etc.)</li><li>kind : optional, the discriminator of the type if it has one (e.g. if the result is an <code>int&lt;job_id&gt;</code> the kind is &quot;job_id&quot;)</li><li>isSensitive : optional, true if the result is sensitive (e.g. PII or something like that)</li><li>isNotNull : true if the result is known to be not null</li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="dependencies">Dependencies<a class="hash-link" href="#dependencies" title="Direct link to heading">​</a></h4><p>The dependencies section appears in many entities, it indicates things that were used by the object and how they were used.
Most of the fields are optional, some fields are impossible in some contexts (e.g. inserts can happen inside of views).</p><ul><li>insertTables : optional, a list of tables into which values were inserted</li><li>updateTables : optional, a list of tables whose values were updated</li><li>deleteTables : optional, a list of tables which had rows deleted</li><li>fromTables : optional, a list of tables that appeared in a FROM clause (maybe indirectly inside a VIEW or CTE)</li><li>usesProcedures : optional, a list of procedures that were accessed via CALL (not shared fragments, those are inlined)</li><li>usesViews : optional, a list of views which were accessed (these are recursively visited to get to tables)</li><li>usesTables : the list of tables that were used in any way at all by the current entity (i.e. the union of the previous table sections)</li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="indices-1">Indices<a class="hash-link" href="#indices-1" title="Direct link to heading">​</a></h4><p>The indices section contains the list of all indices in the schema, it is zero or more view entires of this form:</p><ul><li>name : the index name</li><li>crc : the schema CRC for the entire index definition</li><li>table : the name of the table with this index</li><li>isUnique : true if this is a unique index</li><li>ifNotExists : true if this index was created with IF NOT EXISTS</li><li>isDeleted : true if the view was marked with @delete<ul><li>deletedVersion : optional, the schema version number in the @delete directive</li></ul></li><li><em>region information</em> : optional, see the section on Region Info</li><li>where : optional, if this is partial index then this has the partial index where expression</li><li><em>attributes</em> : optional, see the section on attributes, they appear in many places</li><li>columns : the list of column names in the index</li><li>sortOrders : the list of corresponding sort orders</li></ul><p>Example:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">index</span><span class="token plain"> foo_name </span><span class="token keyword" style="font-style:italic">on</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Generates:</p><div class="language-json codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-json codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;name&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;foo_name&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;CRC&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;6055860615770061843&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;table&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;foo&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;isUnique&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;ifNotExists&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;isDeleted&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;columns&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;name&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;sortOrders&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="procedures">Procedures<a class="hash-link" href="#procedures" title="Direct link to heading">​</a></h4><p>The next several sections:</p><ul><li>Queries</li><li>Inserts</li><li>General Inserts</li><li>Updates</li><li>Deletes</li><li>General</li></ul><p>All provide information about various types of procedures.  Some &quot;simple&quot; procedures that consist only of the type of statement
corresond to their section (and some other rules) present additional information about their contents.  This can sometimes
be useful.  All the sections define certain common things about procedures so that basic information is available about
all procedures.  This is is basically the contents of the &quot;general&quot; section which deals with procedures that have a complex
body of which little can be said.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="queries">Queries<a class="hash-link" href="#queries" title="Direct link to heading">​</a></h4><p>The queries section corresponds to the stored procedures that are a single SELECT statement with no fragments.</p><p>The fields of a query record are:</p><ul><li>name : the name of the procedure</li><li>definedInFile : the file that contains the procedure (the path is as it was specified to CQL so it might be relative or absolute)</li><li>args : <em>procedure arguments</em> see the relevant section</li><li><em>dependencies</em> : several lists of tables and how they are used in the view, see the section on dependencies</li><li><em>region information</em> : optional, see the section on Region Info</li><li><em>attributes</em> : optional, see the section on attributes, they appear in many places</li><li><em>projection</em> : an array of projected columns from the procedure, the view if you will, see the section on projections</li><li>statement : the text of the select statement that is the body of the procedure</li><li>statementArgs : a list of procedure arguments (possibly empty) that should be used to replace the corresonding &quot;?&quot; parameters in the statement</li></ul><p>Example:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> p</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">name_ </span><span class="token keyword" style="font-style:italic">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> foo </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> name </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> name_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Generates:</p><div class="language-json codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-json codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;name&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;p&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;definedInFile&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;x&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;args&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;name&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;name_&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;argOrigin&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;name_&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;type&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;text&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;isNotNull&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;fromTables&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;foo&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;usesTables&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;foo&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;projection&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;name&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;id&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;type&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;integer&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;isNotNull&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;name&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;name&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;type&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;text&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;isNotNull&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;statement&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;SELECT id, name FROM foo WHERE name = ?&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;statementArgs&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;name_&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="procedure-arguments">Procedure Arguments<a class="hash-link" href="#procedure-arguments" title="Direct link to heading">​</a></h4><p>Procedure arguments have several generalities that don&#x27;t come up very often but are important to describe.  The argument list
of a procedure is 0 or more arguments of the form:</p><ul><li>name : the argument name, any valid identifier</li><li>argOrigin : either the name repeated if it&#x27;s just a name or a 3 part string if it came from a bundle, see below</li><li>type : the type of the argument (e.g. text, real, etc.)</li><li>kind : optional, the descriminated type if any e.g. in <code>int&lt;job_id&gt;</code> it&#x27;s &quot;job_id&quot;</li><li>isSensitive : optional, true if the argument is marked with @sensitive (e.g. it has PII etc.)</li><li>isNotNull : true if the argument is declared not null</li></ul><p>An example of a simple argumenmt was shown above, if we change the example a little bit to use the argument bundle syntax
(even though it&#x27;s overkill) we can see the general form of argOrigin.</p><p>Example:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> p</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a_foo </span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> foo </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> name </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> a_foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">name </span><span class="token operator" style="color:rgb(137, 221, 255)">or</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> a_foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Generates:</p><div class="language-json codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-json codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;name&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;p&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;definedInFile&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;x&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;args&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;name&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;a_foo_id&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;argOrigin&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;a_foo foo id&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;type&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;integer&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;isNotNull&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;name&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;a_foo_name&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;argOrigin&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;a_foo foo name&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;type&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;text&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;isNotNull&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;fromTables&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;foo&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;usesTables&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;foo&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;projection&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;name&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;id&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;type&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;integer&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;isNotNull&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;name&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;name&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;type&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;text&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;isNotNull&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;statement&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;SELECT id, name FROM foo WHERE name = ? OR id = ?&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;statementArgs&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;a_foo_name&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;a_foo_id&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note the synthetic names <code>a_foo_id</code> and <code>a_foo_name</code> the argOrigin indicates that the bundle name is <code>a_foo</code>
which could have been anything, the shape was <code>foo</code> and the column in <code>foo</code> was <code>id</code> or <code>name</code> as appropriate.</p><p>The JSON is often used to generate glue code to call procedures from different languages.  The argOrigin can be useful if
you want to codegen something other normal arguments in your code.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="general-inserts">General Inserts<a class="hash-link" href="#general-inserts" title="Direct link to heading">​</a></h4><p>The general insert section corresponds to the stored procedures that are a single INSERT statement with no fragments.
The fields of a general insert record are:</p><ul><li>name : the name of the procedure</li><li>definedInFile : the file that contains the procedure (the path is as it was specified to CQL so it might be relative or absolute)</li><li>args : <em>procedure arguments</em> see the relevant section</li><li><em>dependencies</em> : several lists of tables and how they are used in the view, see the section on dependencies</li><li><em>region information</em> : optional, see the section on Region Info</li><li><em>attributes</em> : optional, see the section on attributes, they appear in many places</li><li>table : the name of the table the procedure inserts into</li><li>statement : the text of the select statement that is the body of the procedure</li><li>statementArgs : a list of procedure arguments (possibly empty) that should be used to replace the corresonding &quot;?&quot; parameters in the statement</li><li>statementType : there are several insert forms such as &quot;INSERT&quot;, &quot;INSERT OR REPLACE&quot;, &quot;REPLACE&quot;, etc.  the type is encoded here</li></ul><p>General inserts does not include the inserted values because they are not directly extractable in general.  This form is used if one of
these is true:</p><ul><li>insert from multiple value rows</li><li>insert from a select statement</li><li>insert using a <code>WITH</code> clause</li><li>insert using the upsert clause</li></ul><p>If fragments are in use then even &quot;generalInsert&quot; cannot capture everything and &quot;general&quot; must be used (see below).</p><p>Example:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> p</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> foo </span><span class="token keyword" style="font-style:italic">values</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;foo&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;bar&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Generates:</p><div class="language-json codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-json codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;name&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;p&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;definedInFile&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;x&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;args&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;insertTables&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;foo&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;usesTables&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;foo&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;table&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;foo&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;statement&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;INSERT INTO foo(id, name) VALUES(1, &#x27;foo&#x27;), (2, &#x27;bar&#x27;)&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;statementArgs&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;statementType&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;INSERT&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;columns&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;id&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;name&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="simple-inserts">Simple Inserts<a class="hash-link" href="#simple-inserts" title="Direct link to heading">​</a></h4><p>The vanilla inserts section can be used for procedures that just insert a single row.  This is a
very common case and if the JSON is being used to drive custom code generation it is useful
to provide the extra information.  The data in this section is exactly the same as the General Inserts
section except that includes the inserted values.  The &quot;values&quot; property has this extra information.</p><p>Each value in the values list corresponds 1:1 with a column and has this form:</p><ul><li>value : the expression for this value</li><li>valueArgs: the array of procedure arguments that should replace the &quot;?&quot; entries in the value</li></ul><p>Example:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> p</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> foo </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> arguments</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Generates:</p><div class="language-json codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-json codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;name&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;p&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;definedInFile&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;x&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;args&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;name&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;id_&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;argOrigin&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;foo id&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;type&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;integer&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;isNotNull&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;name&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;name_&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;argOrigin&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;foo name&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;type&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;text&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;isNotNull&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;insertTables&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;foo&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;usesTables&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;foo&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;table&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;foo&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;statement&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;INSERT INTO foo(id, name) VALUES(?, ?)&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;statementArgs&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;id_&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;name_&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;statementType&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;INSERT&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;columns&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;id&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;name&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;values&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;value&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;?&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;valueArgs&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;id_&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;value&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;?&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;valueArgs&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;name_&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="updates">Updates<a class="hash-link" href="#updates" title="Direct link to heading">​</a></h4><p>The updates section corresponds to the stored procedures that are a single UPDATE statement with no fragments. The
fields of an update record are:</p><ul><li>name : the name of the procedure</li><li>definedInFile : the file that contains the procedure (the path is as it was specified to CQL so it might be relative or absolute)</li><li>args : <em>procedure arguments</em> see the relevant section</li><li><em>dependencies</em> : several lists of tables and how they are used in the view, see the section on dependencies</li><li><em>region information</em> : optional, see the section on Region Info</li><li><em>attributes</em> : optional, see the section on attributes, they appear in many places</li><li>table : the name of the table the procedure inserts into</li><li>statement : the text of the update statement that is the body of the procedure</li><li>statementArgs : a list of procedure arguments (possibly empty) that should be used to replace the corresonding &quot;?&quot; parameters in the statement</li></ul><p>Example:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> p</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">update</span><span class="token plain"> foo </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> name </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> name_ </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> id_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Generates:</p><div class="language-json codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-json codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;name&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;p&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;definedInFile&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;x&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;args&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;name&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;id_&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;argOrigin&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;foo id&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;type&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;integer&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;isNotNull&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;name&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;name_&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;argOrigin&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;foo name&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;type&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;text&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;isNotNull&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;updateTables&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;foo&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;usesTables&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;foo&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;table&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;foo&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;statement&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;UPDATE foo SET name = ? WHERE id = ?&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;statementArgs&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;name_&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;id_&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="deletes">Deletes<a class="hash-link" href="#deletes" title="Direct link to heading">​</a></h4><p>The deletes section corresponds to the stored procedures that are a single DELETE statement with no fragments. The
fields of a delete record are exactly the same as those of update.  Those are the basic fields needed to bind any
statement.</p><p>Example:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> delete_proc </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">name_ </span><span class="token keyword" style="font-style:italic">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">delete</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> foo </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> name </span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> name_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Generates:</p><div class="language-json codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-json codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;name&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;delete_proc&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;definedInFile&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;x&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;args&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;name&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;name_&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;argOrigin&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;name_&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;type&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;text&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;isNotNull&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;deleteTables&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;foo&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;usesTables&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;foo&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;table&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;foo&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;statement&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;DELETE FROM foo WHERE name LIKE ?&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;statementArgs&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;name_&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="general">General<a class="hash-link" href="#general" title="Direct link to heading">​</a></h4><p>And finally the section for procedures that were encountered that are not one of the simple prepared statement forms.  The principle reasons for being in this category are:</p><ul><li>the procedure has out arguments</li><li>the procedure uses something other than a single DML statement</li><li>the procedure has no projection (no result of any type)</li><li>the procedure uses shared fragments and hence has complex argument binding</li></ul><p>The fields of a general procedure are something like a union of update and delete and query but with no statement info.  The are
as follows:</p><ul><li>name : the name of the procedure</li><li>definedInFile : the file that contains the procedure (the path is as it was specified to CQL so it might be relative or absolute)</li><li>args : <em>complex procedure arguments</em> see the relevant section</li><li><em>dependencies</em> : several lists of tables and how they are used in the view, see the section on dependencies</li><li><em>region information</em> : optional, see the section on Region Info</li><li><em>attributes</em> : optional, see the section on attributes, they appear in many places</li><li><em>projection</em> : optional, an array of projected columns from the procedure, the view if you will, see the section on projections</li><li><em>result_contract</em> : optional,</li><li>table : the name of the table the procedure inserts into</li><li>statement : the text of the update statement that is the body of the procedure</li><li>statementArgs : a list of procedure arguments (possibly empty) that should be used to replace the corresonding &quot;?&quot; parameters in the statement</li><li>usesDatabase : true if the procedure requires you to pass in a sqlite connection to call it</li></ul><p>The result contract is at most one of these:</p><ul><li>hasSelectResult : true if the procedure generates its projection using SELECT</li><li>hasOutResult: true if the procedure generates its projection using OUT</li><li>hasOutUnionResult: true if the procedure generates its projection using OUT UNION</li></ul><p>A procedure that does not produce a result set in any way will set none of these and have no projection entry.</p><p>Example:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">create proc with_complex_args (inout arg real)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  set arg := (select arg+1 as a);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  select &quot;foo&quot; bar;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Generates:</p><div class="language-json codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-json codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;name&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;with_complex_args&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;definedInFile&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;x&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;args&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;binding&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;inout&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;name&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;arg&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;argOrigin&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;arg&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;type&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;real&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;isNotNull&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;usesTables&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;projection&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;name&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;bar&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;type&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;text&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;isNotNull&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;hasSelectResult&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;usesDatabase&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="complex-procedure-arguments">Complex Procedure Arguments<a class="hash-link" href="#complex-procedure-arguments" title="Direct link to heading">​</a></h4><p>The complex form of the arguments allows for an optional &quot;binding&quot;</p><ul><li>binding : optional, if present it can take the value &quot;out&quot; or &quot;inout&quot;</li><li>if absent then binding is the usual &quot;in&quot;</li></ul><p>Note that atypical binding forces procedures into the &quot;general&quot; section.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="regions">Regions<a class="hash-link" href="#regions" title="Direct link to heading">​</a></h4><p>The regions section contains a list of all the region definitions.  Each region is of the form:</p><ul><li>name : the name of the region</li><li>isDeployableRoot : is this region itself a deployment region (declared with @declare_deployable_region)</li><li>deployedInRegion : name, the deployment region that contains this region or &quot;(orphan)&quot; if none<ul><li>note that deploymentRegions form a forest</li></ul></li><li>using : a list of zero or more parent regions</li><li>usingPrivately: a list of zero more more booleans, one corresponding to each region<ul><li>the boolean is true if the inheritance is private, meaning that sub-regions cannot see the contents of the inherited region</li></ul></li></ul><p>There are more details on regions and the meaning of these terms in Chapter 10.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="ad-hoc-migrations">Ad Hoc Migrations<a class="hash-link" href="#ad-hoc-migrations" title="Direct link to heading">​</a></h4><p>This section lists all of the declared ad hoc migrations.  Each entry is of the form:</p><ul><li>name : the name of the procedure to be called for the migration step</li><li>crc : the CRC of this migration step, a hash of the call</li><li><em>attributes</em> : optional, see the section on attributes, they appear in many places</li></ul><p>Exactly one of:</p><ul><li>version: optional, any positive integer, the version at which the migration runs, OR</li><li>onRecreateOf: optional, if present indicates that the migration runs when the indicated group is recreated</li></ul><p>There are more details on ad hoc migrations in Chapter 10.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="enums">Enums<a class="hash-link" href="#enums" title="Direct link to heading">​</a></h4><p>This section list all the enumeration types and values.  Each entry is of the form:</p><ul><li>name : the name of the enumeration</li><li>type : the base type of the enumeration (e.g. INT, LONG)</li><li>isNotNull: always true, all enum values are not null (here for symmetry with other uses of &quot;type&quot;)</li><li>values: a list of legal enumeration values</li></ul><p>Each enumeration value is of the form:</p><ul><li>name : the name of the value</li><li>value : a numeric literal</li></ul><p>Example:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">enum</span><span class="token plain"> an_enumeration </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"> x </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> y </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">12</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Generates:</p><div class="language-json codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-json codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;name&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;an_enumeration&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;type&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;integer&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;isNotNull&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;values&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;name&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;x&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;value&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;name&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;y&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;value&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">12</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="constant-groups">Constant Groups<a class="hash-link" href="#constant-groups" title="Direct link to heading">​</a></h4><p>This section list all the constant groups and values.  Each entry is of the form:</p><ul><li>name : the name of the constant group</li><li>values: a list of declared constant values, this can be of mixed type</li></ul><p>Each constant value is of the form:</p><ul><li>name : the name of the constant</li><li>type : the base type of the constant (e.g. LONG, REAL, etc.)</li><li>kind : optional, the type kind of the constant (this can be set with a CAST on a literal, e.g. CAST(1 as int&lt;job_id&gt;))</li><li>isNotNull : true if the constant type is not null (which is anything but the NULL literal)</li><li>value : the numeric or string literal value of the constant</li></ul><p>Example:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> const </span><span class="token keyword" style="font-style:italic">group</span><span class="token plain"> some_constants </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  x </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> cast</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">integer</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">job_id</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  y </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">12.0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  z </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;foo&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Generates:</p><div class="language-json codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-json codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;name&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;some_constants&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;values&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;name&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;x&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;type&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;integer&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;kind&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;job_id&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;isNotNull&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;value&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;name&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;y&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;type&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;real&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;isNotNull&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;value&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1.200000e+01</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;name&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;z&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;type&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;text&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;isNotNull&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          </span><span class="token property">&quot;value&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;foo&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="subscriptions">Subscriptions<a class="hash-link" href="#subscriptions" title="Direct link to heading">​</a></h4><p>This section list all the schema subscriptions in non-decreasing order by version.  Each entry is of the form:</p><ul><li>type : either &quot;unsub&quot; or &quot;resub&quot;</li><li>table : the target of the subscription directive</li><li>version : the version at which this operation is to happen</li></ul><p>Example:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token variable" style="color:rgb(191, 199, 213)">@unsub</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@resub</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">15</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Generates:</p><div class="language-json codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-json codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;type&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;unsub&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;table&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;foo&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;version&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;type&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;resub&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;table&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;foo&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token property">&quot;version&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">15</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="summary">Summary<a class="hash-link" href="#summary" title="Direct link to heading">​</a></h4><p>These sections general provide all the information about everything that was declared in a translation unit.  Typically
not the full body of what was declared but its interface.  The schema information provide the core type and context
while the procedure information illuminates the code that was generated and how you might call it.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="chapter-14-cql-query-fragments">Chapter 14: CQL Query Fragments<a class="hash-link" href="#chapter-14-cql-query-fragments" title="Direct link to heading">​</a></h2><p>CQL Query fragments are the most sophisticated rewrite CQL offers for productivity.  The idea is that a very large query
can be represented in &quot;fragments&quot; that add columns or add rows based on the original &quot;core&quot; query.  The final query
will be an assembled rewrite of all the fragments chained together.  Specifically, the motivation for this is that you
can have a &quot;core&quot; query that fetches the essential columns for some UI design and then you can add query extension
fragments that add new/additional columns for some new set of features.  The core and extended columns can be in their
own fragment and they can be compiled independently.  The result of this is that any errors are in much smaller
and easier to understand fragments rather than in some monster &quot;fetch everything&quot; query;  any given extension does not
have to know all the details of all the other extensions and can take a limited dependency on even the core query.</p><p>It&#x27;s easiest to illustrate this with an example so let&#x27;s begin there.</p><p>Let&#x27;s first start with this very simple schema:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> my_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">primary</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> name </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> rate </span><span class="token keyword" style="font-style:italic">real</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> added_rows</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> my_table </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- sugar to duplicate the columns of my_table</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> added_columns</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">references</span><span class="token plain"> my_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token keyword" style="font-style:italic">data</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Typically there would be a lot more columns but where you see <code>flag1</code> and <code>flag2</code> appear in fragments you can imagine any number
of additional columns of any type.  So we can keep the examples simple.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="base-query-fragments">Base Query Fragments<a class="hash-link" href="#base-query-fragments" title="Direct link to heading">​</a></h3><p>The base fragment might look something like this:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token variable" style="color:rgb(191, 199, 213)">@attribute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cql:base_fragment</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">base_frag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> base_frag_template</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id_ </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    base_frag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> my_table </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> my_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> id_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> base_frag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here are the essential aspects:</p><ul><li>the base fragment is given a name, it can be anything, probably something that describes the purpose of the fragments</li><li>the procedure name can be anything at all</li><li>the procedure must consist of exactly one <code>with...select</code> statement</li><li>the fragment name must be the one and only CTE in the select statement</li><li>you must select all the columns from the CTE</li></ul><p>Note the syntax helper <code>base_frag(*)</code> is just shorthand to avoid retyping all the column names of <code>my_table</code>.</p><p>The interesting part is <code>(select * from my_table where my_table.id = id_)</code> which could have been any select statement
of your choice. Everything else in the procedure must follow the designated format, and the format is enforced due to
the presence of <code>@attribute(cql:base_fragment=base_frag)</code>.</p><p>The point of putting everything on rails like this is that all base fragments will look the same and it will be clear how to transform any base fragment into the final query when it is assembled with its extensions.</p><p>Note: the base fragment produces no codegen at all.  There is no <code>base_frag_template</code> procedure in the output.  This is just a template.  Also, the name of the procedure cannot be <code>base_frag</code> this name will be used by the assembly fragment later.  Really any descriptive unique name will do since the name does not appear in the output at all.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="extension-query-fragments">Extension Query Fragments<a class="hash-link" href="#extension-query-fragments" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_mojV" id="adding-columns">Adding Columns<a class="hash-link" href="#adding-columns" title="Direct link to heading">​</a></h4><p>The most common thing that an extension might want to do is add columns to the result.  There can be any number of such extensions in the final assembly.  Here&#x27;s a simple example that adds one column.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token variable" style="color:rgb(191, 199, 213)">@attribute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cql:extension_fragment</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">base_frag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> adds_columns</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id_ </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    base_frag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;name&quot;</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1.0</span><span class="token plain"> rate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    col_adder_frag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> base_frag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> added_columns</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> base_frag</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">left</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">outer</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">join</span><span class="token plain"> added_columns </span><span class="token keyword" style="font-style:italic">on</span><span class="token plain"> base_frag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> added_columns</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> col_adder_frag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Again there are some important features to this extension and they are largely completely constrained, i.e. you must follow the pattern.</p><ul><li>the attribute indicates <code>extension_fragment</code> and the name (here <code>base_frag</code>) must have been previously declared in a <code>base_fragment</code></li><li>the procedure name can be any unique name other than <code>base_frag</code> - it corresponds to this particular extension&#x27;s purpose</li><li>the procedure arguments must be identical to those in the base fragment</li><li>the first CTE must match the <code>base_fragment</code> attribute value, <code>base_frag</code> in this case</li><li>you do not need to repeat the full select statement for <code>base_frag</code>, any surrogate with the same column names and types will do<ul><li>the base fragment code might include a #define to make this easier<ul><li>e.g. <code>#define base_frags_core as base_frag(*) as (select 1 id, &quot;name&quot; name, 1.0 rate)</code></li></ul></li><li>doing so will make maintenance easier if new columns are added to the base fragment</li></ul></li><li>there must be exactly one additional CTE<ul><li>it may have any unique descriptive name you like</li><li>it must begin with <code>select base_frags.*</code> with the appropriate CTE name matching the base fragment CTE</li><li>it must add at least one column (or it would be uninteresting)</li><li>it may not have any clause other than the first <code>from</code> (e.g. no <code>where</code>, <code>having</code>, <code>limit</code> etc.)<ul><li>if any of these were allowed they would remove or re-order rows in the base query which is not allowed</li><li>the <code>from</code> clause often includes nested selects which have no restrictions</li></ul></li><li>it must select from the base fragment name and left outer join to wherever it likes to get optional additional columns<ul><li>because of this the additional column(s) will certainly be a nullable type in the projection</li></ul></li></ul></li><li>the final select must be of the form <code>select * from col_adder_frag</code> with the appropriate name</li><li>keeping all this in mind, the interesting bit happens here:  <code>left outer join added_columns on base_frag.id = added_columns.id</code><ul><li>this is where you get the data for your additional column using values in the core columns</li></ul></li></ul><p>This fragment can be (and should be) compiled in its own compiland while using <code>#include</code> to get the base fragment only.  This will result in code gen for the accessor functions for a piece of the overall query -- the part this extension knows about.  Importantly code that uses this extension&#x27;s data does not need or want to know about any other extensions that may be present, thereby keeping
dependencies under control.</p><p>The C signatures generated would look like this:</p><div class="language-c codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-c codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">extern</span><span class="token plain"> cql_int32 </span><span class="token function" style="color:rgb(130, 170, 255)">adds_columns_get_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    base_frag_result_set_ref _Nonnull result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    cql_int32 row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">extern</span><span class="token plain"> cql_string_ref _Nonnull </span><span class="token function" style="color:rgb(130, 170, 255)">adds_columns_get_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  base_frag_result_set_ref _Nonnull result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_int32 row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">extern</span><span class="token plain"> cql_double </span><span class="token function" style="color:rgb(130, 170, 255)">adds_columns_get_rate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  base_frag_result_set_ref _Nonnull result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_int32 row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">extern</span><span class="token plain"> cql_string_ref _Nullable </span><span class="token function" style="color:rgb(130, 170, 255)">adds_columns_get_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  base_frag_result_set_ref _Nonnull result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_int32 row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">extern</span><span class="token plain"> cql_int32 </span><span class="token function" style="color:rgb(130, 170, 255)">adds_columns_result_count</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  base_frag_result_set_ref _Nonnull result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Even if there were dozens of other extensions, the functions for reading those columns would not be declared in the header for
this extension.  Any given extension &quot;sees&quot; only the core columns plus any columns it added.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="adding-rows">Adding Rows<a class="hash-link" href="#adding-rows" title="Direct link to heading">​</a></h4><p>Query extensions also frequently want to add additional rows to the main result set, based on the data that is already present.</p><p>The second form of extension allows for this; it is similarly locked in form.  Here is an example:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token variable" style="color:rgb(191, 199, 213)">@attribute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cql:extension_fragment</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">base_frag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> adds_rows</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id_ </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    base_frag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;name&quot;</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1.0</span><span class="token plain"> rate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    row_adder_frag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> base_frag</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">union</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">all</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> added_rows</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> row_adder_frag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let&#x27;s review the features of this second template form:</p><ul><li>there is a surrogate for the core query</li><li>there is a mandatory second CTE</li><li>the second CTE is a compound query with any number of branches, all <code>union all</code></li><li>the first branch must be <code>select * from base_frag</code> (the base fragment) to ensure that the original rows remain<ul><li>this is also why all the branches must be <code>union all</code></li></ul></li><li>this form cannot add new columns</li><li>the extension CTE may not include <code>order by</code> or <code>limit</code> because that might reorder or remove rows of the base</li><li>any extensions of this form must come before those of the <code>left outer join</code> form for a given base fragment<ul><li>which ironically means <code>row_adder_frag</code> has to come before <code>col_adder_frag</code></li></ul></li><li>the usual restrictions are in place on compound selects (same type and number of columns) to ensure a consistent result</li><li>the final select after the CTE section must be exactly in the form <code>select * from row_adder_frag</code> which is the name of the one and only additional CTE with no other clauses or options<ul><li>in practice only the CTE will be used to create the final assembly, so even if you did change the final select to something else it would be moot</li></ul></li></ul><p>The signatures generated for this will look something like so:</p><div class="language-c codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-c codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">extern</span><span class="token plain"> cql_int32 </span><span class="token function" style="color:rgb(130, 170, 255)">adds_rows_get_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  base_frag_result_set_ref _Nonnull result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_int32 row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">extern</span><span class="token plain"> cql_string_ref _Nonnull </span><span class="token function" style="color:rgb(130, 170, 255)">adds_rows_get_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  base_frag_result_set_ref _Nonnull result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_int32 row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">extern</span><span class="token plain"> cql_double </span><span class="token function" style="color:rgb(130, 170, 255)">adds_rows_get_rate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  base_frag_result_set_ref _Nonnull result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_int32 row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">extern</span><span class="token plain"> cql_int32 </span><span class="token function" style="color:rgb(130, 170, 255)">adds_rows_result_count</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  base_frag_result_set_ref _Nonnull result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>which gives you access to the core columns.  Again this fragment can and should be compiled standalone with only the declaration
for the base fragment in the same translation unit to get the cleanest possible output.  This is so that consumers of this
extension do not &quot;see&quot; other extensions which may or may not be related and may or may not always be present.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="assembling-the-fragments">Assembling the Fragments<a class="hash-link" href="#assembling-the-fragments" title="Direct link to heading">​</a></h4><p>With all the fragments independently declared they need to be unified to create one final query. This is where the
major rewriting happens.  The <code>assembly_fragment</code> looks something like this:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token variable" style="color:rgb(191, 199, 213)">@attribute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cql:assembly_fragment</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">base_frag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> base_frag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id_ </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    base_frag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;name&quot;</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1.0</span><span class="token plain"> rate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> base_frag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>It will always be as simple as this; all the complexity is in the fragments.</p><ul><li>the <code>assembly_fragment</code> name must match the core fragment name</li><li>the procedure arguments must be identical to the base fragment arguments</li><li>the  procedure must have the same name as the assembly fragment (<code>base_frag</code> in this case)<ul><li>the code that was generated for the previous fragments anticipates this and makes reference to what will be generated here</li><li>this is enforced</li></ul></li><li>the assembled query is what you run to get the result set, this has real code behind it<ul><li>the other fragments only produce result set readers that call into the helper methods to get columns</li></ul></li><li>there is a surrogate for the core fragment as usual</li><li>all of CTE section will ultimately be replaced with the fragments chained together</li><li>the final select should be of the form <code>select * from your_frags</code> but it can include ordering and/or filtering, this statement will be present in final codegen, the final order is usually defined here</li></ul><p>When compiling the assembly fragment, you should include the base, and all the other fragments, and the assembly template.  The presence of the assembly_fragment will cause codegen for the extension fragments to be suppressed. The assembly translation unit only contains the assembly query as formed from the fragments.</p><p>Now let&#x27;s look at how the query is rewritten, the process is pretty methodical.</p><p>After rewriting the assembly looks like this:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> base_frag </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id_ </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">WITH</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  base_frag </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> rate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> my_table</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"> my_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> id_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  row_adder_frag </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> rate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> base_frag</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">UNION</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">ALL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> added_rows</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  col_adder_frag </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> rate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> row_adder_frag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> added_columns</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token keyword" style="font-style:italic">data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> row_adder_frag</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">LEFT</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">OUTER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">JOIN</span><span class="token plain"> added_columns </span><span class="token keyword" style="font-style:italic">ON</span><span class="token plain"> row_adder_frag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> added_columns</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> col_adder_frag</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let&#x27;s dissect this part by part. Each CTE serves a purpose:</p><ul><li>the core CTE was replaced by the CTE in the base_fragment, and it appears directly</li><li>next, the first extension was added as a CTE referring to the base fragment just as before<ul><li>recall that the first extension has to be <code>row_adder_frag</code>, as that type must come first</li><li>looking at the chain you can see why it would be hard to write a correct fragment if it came after columns were added</li></ul></li><li>next the second extension was added as a CTE<ul><li>all references to the base fragment were replaced with references to row_adder_frag</li><li>the extra column names in the CTE were added such that all previous column names are introduced</li></ul></li><li>this process continues until all extensions are exhausted</li><li>the final select statement reads all the columns from the last extension CTE and includes and ordering and so forth that was present in the assembly query</li></ul><p>The result of all this is a single query that gets all the various columns that were requested in all the extensions
and all the <code>union all</code> operations play out as written.  The extensions are emitted in the order that they appear
in the translation unit with the assembly, which again must have the row adding extensions first.</p><p>This facility provides considerable ability to compose a large query, but each fragment can be independently checked for errors
so that nobody ever has to debug the (possibly monstrous) overall result.  Fragments can be removed simply by
excluding them from the final assembly (with e.g. #ifdefs, or build rules)</p><p>With the rewrite of the assembly_fragment complete, the codegen for that procedure is the normal codegen for a procedure with a single select.</p><p>As always, Java and Objective C codegen on these pieces will produce suitable wrappers for the C.</p><p>The output code for the assembly fragment generates these reading functions:</p><div class="language-c codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-c codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">extern</span><span class="token plain"> cql_int32 </span><span class="token function" style="color:rgb(130, 170, 255)">base_frag_get_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  base_frag_result_set_ref _Nonnull result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_int32 row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">extern</span><span class="token plain"> cql_string_ref _Nonnull </span><span class="token function" style="color:rgb(130, 170, 255)">base_frag_get_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  base_frag_result_set_ref _Nonnull result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_int32 row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">extern</span><span class="token plain"> cql_double </span><span class="token function" style="color:rgb(130, 170, 255)">base_frag_get_rate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  base_frag_result_set_ref _Nonnull result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_int32 row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// used by adds_columns_get_data() to read its data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">extern</span><span class="token plain"> cql_string_ref _Nullable </span><span class="token function" style="color:rgb(130, 170, 255)">__PRIVATE__base_frag_get_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  base_frag_result_set_ref _Nonnull result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_int32 row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">extern</span><span class="token plain"> cql_int32 </span><span class="token function" style="color:rgb(130, 170, 255)">base_frag_result_count</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  base_frag_result_set_ref _Nonnull result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>These are exactly what you would get for a normal query except that the pieces that came from extensions are marked <code>PRIVATE</code>.  Those methods should not be used directly but instead the methods generated for each extension proc should be used.</p><p>Additionally, to create the result set, as usual.</p><div class="language-c codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-c codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">extern</span><span class="token plain"> CQL_WARN_UNUSED cql_code </span><span class="token function" style="color:rgb(130, 170, 255)">base_frag_fetch_results</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  sqlite3 </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">_Nonnull _db_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  base_frag_result_set_ref _Nullable </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">_Nonnull result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_int32 id_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>With the combined set of methods you can create a variety of assembled queries from extensions in a fairly straightforward way.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="shared-fragments">Shared Fragments<a class="hash-link" href="#shared-fragments" title="Direct link to heading">​</a></h3><p>Shared fragments do not have the various restrictions that the &quot;extension&quot; style fragments have.  While extensions
were created to allow a single query to be composed by authors that did not necessarily work with each other,
and therefore they are full of restrictions on the shape, shared queries instead are designed to give you
maximum flexibility in how the fragments are re-used.  You can think of them as being somewhat like a parameterized
view, but the parameters are both value parameters and type parameters.  In Java or C#, a shared fragments might have
had an invocation that looked something like this:  `my_fragment(1,2)&lt;table1, table2&gt;.  As with the other fragment types
the common table expression (CTE) is the way that they plug in.</p><p>It&#x27;s helpful to consider a real example:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">split_text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">tok</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">WITH</span><span class="token plain"> RECURSIVE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    splitter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">tok</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">rest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;&#x27;</span><span class="token plain"> tok</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        IFNULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"> some_variable_ </span><span class="token operator" style="color:rgb(137, 221, 255)">||</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;,&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> rest</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">UNION</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">ALL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        substr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">rest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> instr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">rest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;,&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> tok</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        substr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">rest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> instr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">rest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;,&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> rest</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> splitter</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"> rest </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> tok </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> splitter </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> tok </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This text might appear in dozens of places where a comma separated list needs to be split into pieces and there is no good way
to share the code between these locations.  CQL is frequently used in conjunction with the C-pre-processor so you could
come up with something using the #define construct but this is problematic for several reasons:</p><ul><li>the compiler does not then know that the origin of the text really is the same<ul><li>thus it has no clue that sharing the text of the string might be a good idea</li></ul></li><li>any error messages happen in the context of the use of the macro not the definition</li><li>bonus: a multi-line macro like the above gets folded into one line so any error messages are impenetrable</li><li>if you try to compose such macros it only gets worse; it&#x27;s more code duplication and harder error cases</li><li>any IDE support for syntax coloring and so forth will be confused by the macro as it&#x27;s not part of the language</li></ul><p>None of this is any good but the desire to create helpers like this is real both for correctness and for performance.</p><p>To make these things possible, we introduce the notion of shared fragments.  We need to give them parameters
and the natural way to create a select statement that is bindable in CQL is the procedure. So the shape we choose
looks like this:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token variable" style="color:rgb(191, 199, 213)">@attribute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cql:shared_fragment</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> split_text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">value</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">WITH</span><span class="token plain"> RECURSIVE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    splitter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">tok</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">rest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;&#x27;</span><span class="token plain"> tok</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        IFNULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">value</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">||</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;,&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> rest</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">UNION</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">ALL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        substr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">rest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> instr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">rest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;,&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> tok</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        substr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">rest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> instr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">rest</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;,&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> rest</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> tokens</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"> rest </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> tok </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> splitter </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> tok </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The introductory attribute <code>@attribute(cql:shared_fragment)</code> indicates that the procedure is to produce
no code, but rather will be inlined as a CTE in other locations.  To use it, we introduce the ability
to call a procedure as part of a CTE declaration.  Like so:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">WITH</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">v</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> split_text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;x,y,z&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Once the fragment has been defined, the statement above could appear anywhere, and of course the
text <code>&#x27;x,y,z&#x27;</code> need not be constant.  For instance:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> print_parts</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">value</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">CURSOR</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FOR</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">WITH</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">v</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> split_text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;x,y,z&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">LOOP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FETCH</span><span class="token plain"> C</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;%s\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">v</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Fragments are also composable, so for instance, we might also want some shared code that
extracts comma separated numbers.  We could do this:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token variable" style="color:rgb(191, 199, 213)">@attribute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cql:shared_fragment</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> ids_from_string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">value</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">WITH</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">v</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> split_text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> CAST</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">v </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> LONG</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> id </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now we could write:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> print_ids</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">value</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">CURSOR</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FOR</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">WITH</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> ids_from_string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;1,2,3&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">LOOP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FETCH</span><span class="token plain"> C</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;%ld\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Of course these are very simple examples but in principle you can use the generated tables in whatever
way is necessary.  For instance, here&#x27;s a silly but illustrative example:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* This is a bit silly */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> print_common_ids</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">value</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">CURSOR</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FOR</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">WITH</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      v1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> ids_from_string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;1,2,3&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      v2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> ids_from_string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;2,4,6&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">INTERSECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> v2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">LOOP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FETCH</span><span class="token plain"> C</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;%ld\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>With a small amount of dynamism in the generation of the SQL for the above, it&#x27;s possible to share the body
of v1 and v2.  SQL will of course see the full expansion but your program only needs one copy no matter
how many times you use the fragment anywhere in the code.</p><p>So far we have illustrated the &quot;parameter&quot; part of the flexibility.  Now let&#x27;s look at the &quot;generics&quot; part;
even though it&#x27;s overkill for this example, it should still be illustrative.  You could imagine that
the procedure we wrote above <code>ids_from_string</code> might do something more complicated, maybe filtering out
negative ids, ids that are too big, or that don&#x27;t match some pattern, whatever the case might be.  You
might want these features in a variety of contexts, maybe not just starting from a string to split.</p><p>We can rewrite the fragment in a &quot;generic&quot; way like so:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token variable" style="color:rgb(191, 199, 213)">@attribute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cql:shared_fragment</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> ids_from_string_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">WITH</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    source</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">v</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">LIKE</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;x&quot;</span><span class="token plain"> v</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> CAST</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">v </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> LONG</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> id </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> source</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note the new construct for a CTE definition: inside a fragment we can use &quot;LIKE&quot; to define a plug-able CTE.
In this case we used a <code>select</code> statement to describe the shape the fragment requires.  We could also
have used a name <code>source(*) LIKE shape_name</code> just like we use shape names when describing cursors.  The
name can be any existing view, table, a procedure with a result, etc.  Any name that describes a shape.</p><p>Now when the fragment is invoked, you provide the actual data source (some table, view, or CTE) and
that parameter takes the role of &quot;values&quot;.  Here&#x27;s a full example:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> print_ids</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">value</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">CURSOR</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FOR</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">WITH</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      my_data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> split_text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      my_numbers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> ids_from_string_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">USING</span><span class="token plain"> my_data </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> source</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> id </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> my_numbers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">LOOP</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FETCH</span><span class="token plain"> C</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;%ld\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We could actually rewrite the previous simple id fragment as follows:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token variable" style="color:rgb(191, 199, 213)">@attribute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cql:shared_fragment</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> ids_from_string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">value</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">WITH</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    tokens</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">v</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> split_text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">value</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ids</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> ids_from_string_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">USING</span><span class="token plain"> tokens </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> source</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> ids</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And actually we have a convenient name we could use for the shape we need so
we could have used the shape syntax to define <code>ids_from_string_table</code>.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token variable" style="color:rgb(191, 199, 213)">@attribute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cql:shared_fragment</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> ids_from_string_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">WITH</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    source</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">LIKE</span><span class="token plain"> split_text</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> CAST</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">tok </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> LONG</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> id </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> source</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>These examples have made very little use of the database but of course
normal data is readily available, so shared fragments can make a great
way to provide access to complex data with shareable, correct code.
For instance, you could write a fragment that provides the ids of all
open businesses matching a name from a combination of tables.  This is
similar to what you could do with a <code>VIEW</code> plus a <code>WHERE</code> clause but:</p><ul><li>such a system can give you well controlled combinations known to work well</li><li>there is no schema required, so your database load time can still be fast</li><li>parameterization is not limited to filtering VIEWs after the fact</li><li>&quot;generic&quot; patterns are available, allowing arbitrary data sources to be filtered, validated, augmented</li><li>each fragment can be tested separately with its own suite rather than only in the context of some larger thing</li><li>code generation can be more economical because the compiler is aware of what is being shared</li></ul><p>In short, shared fragments can help with the composition of any complicated kinds of queries.
If you&#x27;re producing an SDK to access a data set, they are indispensible.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="creating-and-using-valid-shared-fragments">Creating and Using Valid Shared Fragments<a class="hash-link" href="#creating-and-using-valid-shared-fragments" title="Direct link to heading">​</a></h4><p>When creating a fragment the following rules are enforced:</p><ul><li>the fragment many not have any out arguments</li><li>it must consist of exactly one valid select statement (but see future forms below)</li><li>it may use the LIKE construct in CTE definitions to create placeholder shapes<ul><li>this form is illegal outside of shared fragments (otherwise how would you bind it)</li></ul></li><li>the LIKE form may only appear in top level CTE expressions in the fragment</li><li>the fragment is free to use other fragments, but it may not call itself<ul><li>calling itself would result in infinite inlining</li></ul></li></ul><p>Usage of a fragment is always introduced by a &quot;call&quot; to the fragment name in a CTE body.
When using a fragment the following rules are enforced.</p><ul><li>the provided parameters must create a valid procedure call just like normal procedure calls<ul><li>i.e. the correct number and type of arguments</li></ul></li><li>the provided parameters may not use nested <code>(SELECT ...)</code> expressions<ul><li>this could easily create fragment building within fragment building which seems not worth the complexity</li><li>if database access is required in the parameters simply wrap it in a helper procedure</li></ul></li><li>the optional USING clause must specify each required table parameter exactly once and no other tables<ul><li>a fragment that requires table parameters be invoked without a USING clause</li></ul></li><li>every actual table provided must match the column names of the corresponding table parameter<ul><li>i.e. in <code>USING my_data AS values</code> the actual columns in <code>my_data</code> must be the same as in the <code>values</code> parameter</li><li>the columns need not be in the same order</li></ul></li><li>each column in any actual table must be &quot;assignment compatible&quot; with its corresponding column in the parameters<ul><li>i.e. the actual type could be converted to the formal type using the same rules as the := operator</li><li>these are the same rules used for procedure calls, for instance, where the call is kind of like assigning the actual parameter values to the formal parameter variables</li></ul></li><li>the provided table values must not conflict with top level CTEs in the shared fragment<ul><li>exception: the top level CTEs that were parameters do not create conflicts</li><li>e.g. it&#x27;s common to do <code>values(*) as (CALL something() using source as source)</code> - here the caller&#x27;s &quot;source&quot; takes the value of the fragment&#x27;s &quot;source&quot;, which is not a true conflict</li><li>however, the caller&#x27;s source might itself have been a parameter in which case the value provided could create an inner conflict<ul><li>all these problems are easily avoided with a simple naming convention for parameters so that real arguments never look like parameter names and parameter forwarding is apparent</li><li>e.g. <code>USING _source AS _source</code> makes it clear that a parameter is being forwarded and <code>_source</code> is not likely to conflict with real table or view names</li></ul></li></ul></li></ul><p>Note that when shared fragments are used, the generated SQL has the text split into parts, with each fragment and its surroundings separated, therefore
the text of shared fragments is shared(!) between usages if normal linker optimizations for text folding are enabled (common in production code.)</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="shared-fragments-with-conditionals">Shared Fragments with Conditionals<a class="hash-link" href="#shared-fragments-with-conditionals" title="Direct link to heading">​</a></h3><p>Shared fragments use dynamic assembly of the text to do the sharing but it is also possible to create alternative texts.
There are many instances where it is desirable to not just replace parameters but use, for instance, an entirely different join sequence.
Without shared fragments, the only way to accomplish this is to fork the desired query at the topmost level (because SQLite has no internal
possibility of &quot;IF&quot; conditions.)  This is expensive in terms of code size and also cognitive load because the entire alternative sequences
have to be kept carefully in sync.  Macros can help with this but then you get the usual macro maintenance problems, including poor diagnostics.
And of course there is no possibility to share the common parts of the text of the code if it is forked.</p><p>However, conditional shared fragments allow forms like this:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token variable" style="color:rgb(191, 199, 213)">@attribute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cql:shared_fragment</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> ids_from_string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">val </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">IF</span><span class="token plain"> val </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">OR</span><span class="token plain"> val </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;&#x27;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> id </span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- empty result</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">ELSE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">WITH</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      tokens</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">v</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> split_text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">val</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      ids</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> ids_from_string_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">USING</span><span class="token plain"> tokens </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> source</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> ids</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">IF</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now we can do something like:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ids</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> ids_from_string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">str</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this case, if the string <code>val</code> is empty then SQLite will not see the complex comma splitting code, and instead will see
the trivial case <code>select 0 id where 0</code>.  The code in a conditional fragment might be entirely different between the branches
removing unnecessary code, or swapping in a new experimental cache in your test environment, or anything like that.</p><p>The generalization is simply this:</p><ul><li>instead of just one select statement there is one top level &quot;IF&quot; statement</li><li>each statement list of the IF must be exactly one select statement</li><li>there must be an ELSE clause</li><li>the select statements must be type compatible, just like in a normal procedure</li><li>any table parameters with the same name in different branches must have the same type<ul><li>otherwise it would be impossible to provide a single actual table for those table parameters</li></ul></li></ul><p>With this additional flexibility a wide variety of SQL statements can be constructed economically and maintainability.  Importantly,
consumers of the fragments need not deal with all these various alternate possibilities but they can readily create their own
useful combinations out of building blocks.</p><p>Ultimately, from SQLite&#x27;s perspective, all of these shared fragment forms result in nothing more complicated than a chain of CTE expressions.</p><p>See Appendix 8 for an extensive section on best practices around fragments and common table expressions in general.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="appendix-1-command-line-options">Appendix 1: Command Line Options<a class="hash-link" href="#appendix-1-command-line-options" title="Direct link to heading">​</a></h2><p>CQL has a variety of command line options but many of them are only interesting for cql development.  Nonetheless this is a comprehensive list:</p><ul><li>note CQL is often used after the c pre-processor is run so this kind of invocation is typical:</li></ul><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cc -E -x c foo.sql | cql [args]</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="with-no-options">With No Options<a class="hash-link" href="#with-no-options" title="Direct link to heading">​</a></h3><ul><li>emits a usage message</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="--in-file">--in file<a class="hash-link" href="#--in-file" title="Direct link to heading">​</a></h3><ul><li>reads the given file for the input instead of stdin</li><li>the input should probably have already been run through the C pre-processor as above</li><li>returns non-zero if the file fails to parse</li></ul><p>Example:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cql --in test.sql</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="--sem">--sem<a class="hash-link" href="#--sem" title="Direct link to heading">​</a></h3><ul><li>performs semantic analysis on the input file ONLY</li><li>the return code is zero if there are no errors</li></ul><p>Example:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cql --in sem_test.sql --sem</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="--ast">--ast<a class="hash-link" href="#--ast" title="Direct link to heading">​</a></h3><ul><li>walks the AST and prints it to stdout in human readable text form</li><li>may be combined with --sem (semantic info will be included)
Example</li></ul><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cql --in sem_test.sql --sem --ast &gt;sem_ast.out</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="--echo">--echo<a class="hash-link" href="#--echo" title="Direct link to heading">​</a></h3><ul><li>walks the AST and emits the text of a program that would create it</li><li>this has the effect of &quot;beautifying&quot; badly formatted input or &quot;canonicalizing&quot; it<ul><li>some sensible indenting is added but it might not be the original indenting</li><li>extraneous whitespace, parens, etc. are removed</li></ul></li><li>may be combined with --sem (in which case you see the source after any rewrites for sugar)</li><li>this also validates that the input can be parsed</li></ul><p>Example</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cql --in test.sql --echo &gt;test.out  # test.out is &quot;equivalent&quot; to test.sql</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="--dot">--dot<a class="hash-link" href="#--dot" title="Direct link to heading">​</a></h3><ul><li>prints the internal AST to stdout in DOT format for graph visualization</li><li>this is really only interesting for small graphs for discussion as it rapidly gets insane</li></ul><p>Example:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cql --dot --in dottest.sql</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="--cg-output1-output2-">--cg output1 output2 ...<a class="hash-link" href="#--cg-output1-output2-" title="Direct link to heading">​</a></h3><ul><li>any number of output files may be needed for a particular result type, two is common</li><li>the return code is zero if there are no errors</li><li>any --cg option implies --sem</li></ul><p>Example:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cql --in foo.sql --cg foo.h foo.c</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="--nolines">--nolines<a class="hash-link" href="#--nolines" title="Direct link to heading">​</a></h3><ul><li>Suppress the # directives for lines.  Useful if you need to debug the C code.</li></ul><p>Example:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">cql --in test.sql --nolines --cg foo.h foo.c</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="--global_proc-name">--global_proc name<a class="hash-link" href="#--global_proc-name" title="Direct link to heading">​</a></h3><ul><li>any loose SQL statements not in a stored proc are gathered and put into a procedure of the given name</li><li>when generating a schema migrate script the global proc name is used as a prefix on all of the artifacts so that there can be several independent migrations linked into a single executable</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="--compress">--compress<a class="hash-link" href="#--compress" title="Direct link to heading">​</a></h3><ul><li>for use with the C result type, (or any similar types added to the runtime array in your compiler)</li><li>string literals for the SQL are broken into &quot;fragments&quot; the DML is then represented by an array of fragments</li><li>since DML is often very similar there is a lot of token sharing possible</li><li>the original string is recreated at runtime from the fragments and then executed</li><li>comments show the original string inline for easier debugging and searching</li></ul><p>NOTE: different result types require a different number of output files with different meanings</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="--test">--test<a class="hash-link" href="#--test" title="Direct link to heading">​</a></h3><ul><li>some of the output types can include extra diagnostics if <code>--test</code> is included</li><li>the test output often makes the outputs badly formed so this is generally good for humans only</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="--dev">--dev<a class="hash-link" href="#--dev" title="Direct link to heading">​</a></h3><ul><li>some codegen features only make sense during development, this enables dev mode to turn those one
** example: explain query plan</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="--java_package_name-name">--java_package_name name<a class="hash-link" href="#--java_package_name-name" title="Direct link to heading">​</a></h3><ul><li>used by java code generators when they output a class. Allows to specify the name of package the class will be a part of</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="--java_fragment_interface_mode">--java_fragment_interface_mode<a class="hash-link" href="#--java_fragment_interface_mode" title="Direct link to heading">​</a></h3><ul><li>Sets the Java codegen mode to generate interfaces for base and extension fragments instead of classes.</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="--java_imports-name">--java_imports name<a class="hash-link" href="#--java_imports-name" title="Direct link to heading">​</a></h3><ul><li>Fully qualified name to import in the emitted java source.</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="--c_include_namespace">--c_include_namespace<a class="hash-link" href="#--c_include_namespace" title="Direct link to heading">​</a></h3><ul><li>for the C codegen runtimes, it determines the header namespace (as in #include &quot;namespace/file.h&quot;) that goes into the output C file</li><li>if this option is used, it is prefixed to the first argment to --cg to form the include path in the C file</li><li>if absent there is no &quot;namespace/&quot; prefix</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="--c_include_path">--c_include_path<a class="hash-link" href="#--c_include_path" title="Direct link to heading">​</a></h3><ul><li>for the C codegen runtimes, it determines the full header path (as in #include &quot;your_arg&quot;) that goes into the output C file</li><li>if this option is used, the first argment to --cg controls only the output path and does not appear in include path at all</li><li>this form overrides --c_include_namespace if both are specified</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="--objc_c_include_path">--objc_c_include_path<a class="hash-link" href="#--objc_c_include_path" title="Direct link to heading">​</a></h3><ul><li>for ObjC codegen runtimes that need to refer to the generated C code, this represents the header of the C generated code that will be used during inclusion from the ObjC file</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="result-types---rt-">Result Types (--rt *)<a class="hash-link" href="#result-types---rt-" title="Direct link to heading">​</a></h3><p>These are the various outputs the compiler can produce.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="--rt-c">--rt c<a class="hash-link" href="#--rt-c" title="Direct link to heading">​</a></h4><ul><li>requires two output files (foo.h and foo.c)</li><li>this is the standard C compilation of the sql file</li></ul><h5 class="anchor anchorWithStickyNavbar_mojV" id="--cqlrt-fooh">--cqlrt foo.h<a class="hash-link" href="#--cqlrt-fooh" title="Direct link to heading">​</a></h5><ul><li>emits <code>#include &quot;foo.h&quot;</code> into the C output instead of <code>#include &quot;cqlrt.h&quot;</code></li></ul><h5 class="anchor anchorWithStickyNavbar_mojV" id="--generate_type_getters">--generate_type_getters<a class="hash-link" href="#--generate_type_getters" title="Direct link to heading">​</a></h5><ul><li>changes C output for CQL result sets so that the field readers used shared functions to get fields of a certain type</li><li>this style of codegen makes result-sets more interoperable with each other if they have similar shape so it can be useful</li></ul><h5 class="anchor anchorWithStickyNavbar_mojV" id="--generate_exports">--generate_exports<a class="hash-link" href="#--generate_exports" title="Direct link to heading">​</a></h5><ul><li>adds an additional output file</li><li>example:  `--in foo.sql --generate_exports --rt c --cg foo.h foo.c foo_exports.sql</li><li>the output file <code>foo_exports.sql</code> includes procedure declarations for the contents of <code>foo.sql</code></li><li>basically automatically generates the CQL header file you need to access the procedures in the input from some other file</li><li>if it were C it would be like auto-generating <code>foo.h</code> from <code>foo.c</code></li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="--rt-objc">--rt objc<a class="hash-link" href="#--rt-objc" title="Direct link to heading">​</a></h4><ul><li>objective C wrappers for result sets produced by the stored procedures in the input</li><li>these depend on the output of a standard codegen run so this is additive</li><li>requires one output file (foo.h)</li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="--rt-java">--rt java<a class="hash-link" href="#--rt-java" title="Direct link to heading">​</a></h4><ul><li>java wrappers for result sets produced by the stored procedures in the input</li><li>these depend on the output of a standard codegen run so this is additive</li><li>requires one output file (foo.java)</li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="--rt-schema">--rt schema<a class="hash-link" href="#--rt-schema" title="Direct link to heading">​</a></h4><ul><li>produces the canonical schema for the given input files</li><li>stored procedures etc. are removed</li><li>whitespace etc. is removed</li><li>suitable for use to create the next or first &quot;previous&quot; schema for schema validation</li><li>requires one output file</li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="--rt-schema_facet_checker">--rt schema_facet_checker<a class="hash-link" href="#--rt-schema_facet_checker" title="Direct link to heading">​</a></h4><ul><li>produces a CQL script that checks whether the schema is up to date which can then be compiled with CQL itself</li><li>see the chapter on schema upgrade/migration: <a href="https://cgsql.dev/cql-guide/ch10/" target="_blank" rel="noopener noreferrer">Chapter 10</a></li><li>requires one output file (foo.sql)</li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="--rt-schema_upgrade">--rt schema_upgrade<a class="hash-link" href="#--rt-schema_upgrade" title="Direct link to heading">​</a></h4><ul><li>produces a CQL schema upgrade script which can then be compiled with CQL itself</li><li>see the chapter on schema upgrade/migration: <a href="https://cgsql.dev/cql-guide/ch10/" target="_blank" rel="noopener noreferrer">Chapter 10</a></li><li>requires one output file (foo.sql)</li></ul><h5 class="anchor anchorWithStickyNavbar_mojV" id="--include_regions-a-b-c">--include_regions a b c<a class="hash-link" href="#--include_regions-a-b-c" title="Direct link to heading">​</a></h5><ul><li>the indicated regions will be declared</li><li>used with <code>--rt schema_upgrade</code> or <code>--rt schema</code></li><li>in the upgrade case excluded regions will not be themselves upgraded, but may be referred, to by things that are being upgraded</li></ul><h5 class="anchor anchorWithStickyNavbar_mojV" id="--exclude_regions-x-y-z">--exclude_regions x y z<a class="hash-link" href="#--exclude_regions-x-y-z" title="Direct link to heading">​</a></h5><ul><li>the indicated regions will still be declared but the upgrade code will be suppressed, the presumption being that a different script already upgrades x y z</li><li>used with <code>--rt schema_upgrade</code></li></ul><h5 class="anchor anchorWithStickyNavbar_mojV" id="--min_schema_version-n">--min_schema_version n<a class="hash-link" href="#--min_schema_version-n" title="Direct link to heading">​</a></h5><ul><li>the schema upgrade script will not include upgrade steps for schema older than the version specified</li></ul><h5 class="anchor anchorWithStickyNavbar_mojV" id="--schema_exclusive">--schema_exclusive<a class="hash-link" href="#--schema_exclusive" title="Direct link to heading">​</a></h5><ul><li>the schema upgrade script assumes it owns all the schema in the database, it aggressively removes other things</li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="--rt-json_schema">--rt json_schema<a class="hash-link" href="#--rt-json_schema" title="Direct link to heading">​</a></h4><ul><li>produces JSON output suitable for consumption by downstream codegen</li><li>the JSON includes a definition of the various entities in the input</li><li>see the section on JSON output for details</li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="--rt-query_plan">--rt query_plan<a class="hash-link" href="#--rt-query_plan" title="Direct link to heading">​</a></h4><ul><li>produces CQL output which can be re-compiled by CQL as normal input</li><li>the output consists of a set of procedures that will emit all query plans for the DML that was in the input</li><li>see <code>--rt udf</code> for additional info</li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="--rt-stats">--rt stats<a class="hash-link" href="#--rt-stats" title="Direct link to heading">​</a></h4><ul><li>produces  a simple .csv file with node count information for AST nodes per procedure in the input</li><li>requires one output file (foo.csv)</li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="--rt-udf">--rt udf<a class="hash-link" href="#--rt-udf" title="Direct link to heading">​</a></h4><ul><li>produces stub UDF implementations for all UDFS that were seen in the input</li><li>this output is suitable for use with <code>--rt query_plan</code> so that SQL with UDFs will run in a simple context</li><li>requires two output files (e.g. udfs.h and udfs.c)</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="appendix-2-cql-grammar">Appendix 2: CQL Grammar<a class="hash-link" href="#appendix-2-cql-grammar" title="Direct link to heading">​</a></h2><p>What follows is taken from a grammar snapshot with the tree building rules removed.
It should give a fair sense of the syntax of CQL (but not semantic validation).</p><p>Snapshot as of Tue May 31 09:23:31 PDT 2022</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="operators-and-literals">Operators and Literals<a class="hash-link" href="#operators-and-literals" title="Direct link to heading">​</a></h3><p>These are in order of priority lowest to highest</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">UNION_ALL UNION INTERSECT EXCEPT</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ASSIGN</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">OR</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">AND</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">NOT</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">BETWEEN NOT_BETWEEN &#x27;&lt;&gt;&#x27; &#x27;!=&#x27; &#x27;=&#x27; &#x27;==&#x27; LIKE NOT_LIKE GLOB NOT_GLOB MATCH NOT_MATCH REGEXP NOT_REGEXP IN NOT_IN IS_NOT IS IS_TRUE IS_FALSE IS_NOT_TRUE IS_NOT_FALSE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ISNULL NOTNULL</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&#x27;&lt;&#x27; &#x27;&gt;&#x27; &#x27;&gt;=&#x27; &#x27;&lt;=&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&#x27;&lt;&lt;&#x27; &#x27;&gt;&gt;&#x27; &#x27;&amp;&#x27; &#x27;|&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&#x27;+&#x27; &#x27;-&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&#x27;*&#x27; &#x27;/&#x27; &#x27;%&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">CONCAT</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">COLLATE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">UMINUS &#x27;~&#x27;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>NOTE: The above varies considerably from the C binding order!!!</p><p>Literals:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">ID  /* a name */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">STRLIT /* a string literal in SQL format e.g. &#x27;it&#x27;&#x27;s sql&#x27; */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">CSTRLIT /* a string literal in C format e.g. &quot;hello, world\n&quot; */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">BLOBLIT /* a blob literal in SQL format e.g. x&#x27;12ab&#x27; */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">INTLIT /* integer literal */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">LONGLIT /* long integer literal */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">REALLIT /* floating point literal */</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="statementtype-keywords">Statement/Type Keywords<a class="hash-link" href="#statementtype-keywords" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;@ATTRIBUTE&quot; &quot;@BEGIN_SCHEMA_REGION&quot; &quot;@CREATE&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;@DECLARE_DEPLOYABLE_REGION&quot; &quot;@DECLARE_SCHEMA_REGION&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;@DELETE&quot; &quot;@DUMMY_SEED&quot; &quot;@ECHO&quot; &quot;@EMIT_CONSTANTS&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;@EMIT_ENUMS&quot; &quot;@EMIT_GROUP&quot; &quot;@END_SCHEMA_REGION&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;@ENFORCE_NORMAL&quot; &quot;@ENFORCE_POP&quot; &quot;@ENFORCE_PUSH&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;@ENFORCE_RESET&quot; &quot;@ENFORCE_STRICT&quot; &quot;@EPONYMOUS&quot; &quot;@FILE&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;@PREVIOUS_SCHEMA&quot; &quot;@PROC&quot; &quot;@RC&quot; &quot;@RECREATE&quot; &quot;@RESUB&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;@SCHEMA_AD_HOC_MIGRATION&quot; &quot;@SCHEMA_UPGRADE_SCRIPT&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;@SCHEMA_UPGRADE_VERSION&quot; &quot;@SENSITIVE&quot; &quot;@UNSUB&quot; &quot;ABORT&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;ACTION&quot; &quot;ADD&quot; &quot;AFTER&quot; &quot;ALL&quot; &quot;ALTER&quot; &quot;ARGUMENTS&quot; &quot;AS&quot; &quot;ASC&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;AUTOINCREMENT&quot; &quot;BEFORE&quot; &quot;BEGIN&quot; &quot;BLOB&quot; &quot;BY&quot; &quot;CALL&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;CASCADE&quot; &quot;CASE&quot; &quot;CAST&quot; &quot;CATCH&quot; &quot;CHECK&quot; &quot;CLOSE&quot; &quot;COLUMN&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;COLUMNS&quot; &quot;COMMIT&quot; &quot;CONST&quot; &quot;CONSTRAINT&quot; &quot;CONTEXT COLUMN&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;CONTEXT TYPE&quot; &quot;CONTINUE&quot; &quot;CREATE&quot; &quot;CROSS&quot; &quot;CURRENT ROW&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;CURSOR HAS ROW&quot; &quot;CURSOR&quot; &quot;DECLARE&quot; &quot;DEFAULT&quot; &quot;DEFERRABLE&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;DEFERRED&quot; &quot;DELETE&quot; &quot;DESC&quot; &quot;DISTINCT&quot; &quot;DISTINCTROW&quot; &quot;DO&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;DROP&quot; &quot;ELSE IF&quot; &quot;ELSE&quot; &quot;ENCODE&quot; &quot;END&quot; &quot;ENUM&quot; &quot;EXCLUDE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">CURRENT ROW&quot; &quot;EXCLUDE GROUP&quot; &quot;EXCLUDE NO OTHERS&quot; &quot;EXCLUDE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">TIES&quot; &quot;EXCLUSIVE&quot; &quot;EXISTS&quot; &quot;EXPLAIN&quot; &quot;FAIL&quot; &quot;FETCH&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;FILTER&quot; &quot;FOLLOWING&quot; &quot;FOR EACH ROW&quot; &quot;FOR&quot; &quot;FOREIGN&quot; &quot;FROM</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">BLOB&quot; &quot;FROM&quot; &quot;FUNC&quot; &quot;FUNCTION&quot; &quot;GROUP&quot; &quot;GROUPS&quot; &quot;HAVING&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;HIDDEN&quot; &quot;IF&quot; &quot;IGNORE&quot; &quot;IMMEDIATE&quot; &quot;INDEX&quot; &quot;INITIALLY&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;INNER&quot; &quot;INOUT&quot; &quot;INSERT&quot; &quot;INSTEAD&quot; &quot;INT&quot; &quot;INTEGER&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;INTERFACE&quot; &quot;INTO&quot; &quot;JOIN&quot; &quot;KEY&quot; &quot;LEAVE&quot; &quot;LEFT&quot; &quot;LET&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;LIMIT&quot; &quot;LONG&quot; &quot;LONG_INT&quot; &quot;LONG_INTEGER&quot; &quot;LOOP&quot; &quot;NO&quot; &quot;NOT</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">DEFERRABLE&quot; &quot;NOTHING&quot; &quot;NULL&quot; &quot;OBJECT&quot; &quot;OF&quot; &quot;OFFSET&quot; &quot;ON</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">CONFLICT&quot; &quot;ON&quot; &quot;OPEN&quot; &quot;ORDER&quot; &quot;OUT&quot; &quot;OUTER&quot; &quot;OVER&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;PARTITION&quot; &quot;PRECEDING&quot; &quot;PRIMARY&quot; &quot;PRIVATE&quot; &quot;PROC&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;PROCEDURE&quot; &quot;QUERY PLAN&quot; &quot;RAISE&quot; &quot;RANGE&quot; &quot;REAL&quot; &quot;RECURSIVE&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;REFERENCES&quot; &quot;RELEASE&quot; &quot;RENAME&quot; &quot;REPLACE&quot; &quot;RESTRICT&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;RETURN&quot; &quot;RIGHT&quot; &quot;ROLLBACK&quot; &quot;ROWID&quot; &quot;ROWS&quot; &quot;SAVEPOINT&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;SELECT&quot; &quot;SET&quot; &quot;SIGN FUNCTION&quot; &quot;STATEMENT&quot; &quot;SWITCH&quot; &quot;TABLE&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;TEMP&quot; &quot;TEXT&quot; &quot;THEN&quot; &quot;THROW&quot; &quot;TO&quot; &quot;TRANSACTION&quot; &quot;TRIGGER&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;TRY&quot; &quot;TYPE&quot; &quot;UNBOUNDED&quot; &quot;UNIQUE&quot; &quot;UPDATE&quot; &quot;UPSERT&quot; &quot;USING&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;VALUES&quot; &quot;VIEW&quot; &quot;VIRTUAL&quot; &quot;WHEN&quot; &quot;WHERE&quot; &quot;WHILE&quot; &quot;WINDOW&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;WITH&quot; &quot;WITHOUT&quot;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="rules">Rules<a class="hash-link" href="#rules" title="Direct link to heading">​</a></h3><p>Note that in many cases the grammar is more generous than the overall language and errors have to be checked on top of this, often this is done on purpose because even when it&#x27;s possible it might be very inconvenient to do checks with syntax.  For example the grammar cannot enforce non-duplicate ids in id lists, but it could enforce non-duplicate attributes in attribute lists.  It chooses to do neither as they are easily done with semantic validation.  Thus the grammar is not the final authority on what constitutes a valid program but it&#x27;s a good start.</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">program:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  opt_stmt_list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_stmt_list:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /*nil*/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | stmt_list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">stmt_list:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  stmt &#x27;;&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | stmt_list stmt &#x27;;&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  misc_attrs any_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">any_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    alter_table_add_column_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | begin_schema_region_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | begin_trans_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | call_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | close_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | commit_return_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | commit_trans_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | continue_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | create_index_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | create_proc_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | create_table_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | create_trigger_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | create_view_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | create_virtual_table_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | declare_deployable_region_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | declare_enum_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | declare_const_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | declare_group_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | declare_select_func_no_check_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | declare_func_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | declare_out_call_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | declare_proc_no_check_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | declare_proc_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | declare_interface_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | declare_schema_region_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | declare_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | delete_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | drop_index_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | drop_table_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | drop_trigger_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | drop_view_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | echo_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | emit_enums_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | emit_group_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | emit_constants_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | end_schema_region_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | enforce_normal_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | enforce_pop_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | enforce_push_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | enforce_reset_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | enforce_strict_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | explain_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | fetch_call_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | fetch_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | fetch_values_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | fetch_cursor_from_blob_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | guard_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | if_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | insert_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | leave_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | let_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | loop_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | out_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | out_union_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | out_union_parent_child_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | previous_schema_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | proc_savepoint_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | release_savepoint_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | return_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | rollback_return_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | rollback_trans_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | savepoint_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | select_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | schema_ad_hoc_migration_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | schema_resub_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | schema_unsub_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | schema_upgrade_script_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | schema_upgrade_version_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | set_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | switch_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | throw_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | trycatch_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | update_cursor_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | update_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | upsert_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | while_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | with_delete_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | with_insert_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | with_update_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | with_upsert_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">explain_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;EXPLAIN&quot; opt_query_plan explain_target</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_query_plan:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /* nil */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;QUERY PLAN&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">explain_target: select_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | update_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | delete_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | with_delete_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | with_insert_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | insert_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | upsert_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | drop_table_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | drop_view_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | drop_index_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | drop_trigger_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | begin_trans_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | commit_trans_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">previous_schema_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;@PREVIOUS_SCHEMA&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">schema_upgrade_script_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;@SCHEMA_UPGRADE_SCRIPT&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">schema_upgrade_version_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;@SCHEMA_UPGRADE_VERSION&quot; &#x27;(&#x27; &quot;integer-literal&quot; &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">set_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;SET&quot; name &quot;:=&quot; expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;SET&quot; name &quot;FROM&quot; &quot;CURSOR&quot; name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">let_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;LET&quot; name &quot;:=&quot; expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">version_attrs_opt_recreate:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /* nil */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;@RECREATE&quot;  opt_delete_plain_attr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;@RECREATE&quot; &#x27;(&#x27; name &#x27;)&#x27;  opt_delete_plain_attr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | version_attrs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_delete_plain_attr:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /* nil */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;@DELETE&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_version_attrs:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /* nil */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | version_attrs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">version_attrs:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;@CREATE&quot; version_annotation opt_version_attrs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;@DELETE&quot; version_annotation opt_version_attrs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_delete_version_attr:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /* nil */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;@DELETE&quot; version_annotation</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">drop_table_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;DROP&quot; &quot;TABLE&quot; &quot;IF&quot; &quot;EXISTS&quot; name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DROP&quot; &quot;TABLE&quot; name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">drop_view_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;DROP&quot; &quot;VIEW&quot; &quot;IF&quot; &quot;EXISTS&quot; name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DROP&quot; &quot;VIEW&quot; name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">drop_index_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;DROP&quot; &quot;INDEX&quot; &quot;IF&quot; &quot;EXISTS&quot; name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DROP&quot; &quot;INDEX&quot; name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">drop_trigger_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;DROP&quot; &quot;TRIGGER&quot; &quot;IF&quot; &quot;EXISTS&quot; name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DROP&quot; &quot;TRIGGER&quot; name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create_virtual_table_stmt: &quot;CREATE&quot; &quot;VIRTUAL&quot; &quot;TABLE&quot; opt_vtab_flags name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                           &quot;USING&quot; name opt_module_args</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                           &quot;AS&quot; &#x27;(&#x27; col_key_list &#x27;)&#x27; opt_delete_version_attr ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_module_args: /* nil */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &#x27;(&#x27; misc_attr_value_list &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &#x27;(&#x27; &quot;ARGUMENTS&quot; &quot;FOLLOWING&quot; &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create_table_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;CREATE&quot; opt_temp &quot;TABLE&quot; opt_if_not_exists name &#x27;(&#x27; col_key_list &#x27;)&#x27; opt_no_rowid version_attrs_opt_recreate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_temp:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /* nil */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;TEMP&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_if_not_exists:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /* nil */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;IF&quot; &quot;NOT&quot; &quot;EXISTS&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_no_rowid:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /* nil */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;WITHOUT&quot; &quot;ROWID&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_vtab_flags:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /* nil */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;IF&quot; &quot;NOT&quot; &quot;EXISTS&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;@EPONYMOUS&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;@EPONYMOUS&quot; &quot;IF&quot; &quot;NOT&quot; &quot;EXISTS&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;IF&quot; &quot;NOT&quot; &quot;EXISTS&quot; &quot;@EPONYMOUS&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">col_key_list:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  col_key_def</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | col_key_def &#x27;,&#x27; col_key_list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">col_key_def:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  col_def</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | pk_def</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | fk_def</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | unq_def</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | check_def</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | shape_def</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">check_def:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;CONSTRAINT&quot; name &quot;CHECK&quot; &#x27;(&#x27; expr &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;CHECK&quot; &#x27;(&#x27; expr &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">shape_def:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    shape_def_base</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | shape_def_base &#x27;(&#x27; name_list &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">shape_def_base:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    &quot;LIKE&quot; name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;LIKE&quot; name &quot;ARGUMENTS&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">col_name:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">misc_attr_key:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | name &#x27;:&#x27; name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">misc_attr_value_list:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  misc_attr_value</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | misc_attr_value &#x27;,&#x27; misc_attr_value_list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">misc_attr_value:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | any_literal</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | const_expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &#x27;(&#x27; misc_attr_value_list &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &#x27;-&#x27; num_literal</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">misc_attr:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;@ATTRIBUTE&quot; &#x27;(&#x27; misc_attr_key &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;@ATTRIBUTE&quot; &#x27;(&#x27; misc_attr_key &#x27;=&#x27; misc_attr_value &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">misc_attrs:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /* nil */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | misc_attr misc_attrs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">col_def:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  misc_attrs col_name data_type_any col_attrs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">pk_def:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;CONSTRAINT&quot; name &quot;PRIMARY&quot; &quot;KEY&quot; &#x27;(&#x27; indexed_columns &#x27;)&#x27; opt_conflict_clause</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;PRIMARY&quot; &quot;KEY&quot; &#x27;(&#x27; indexed_columns &#x27;)&#x27; opt_conflict_clause</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_conflict_clause:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /* nil */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | conflict_clause</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">conflict_clause:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;ON CONFLICT&quot; &quot;ROLLBACK&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;ON CONFLICT&quot; &quot;ABORT&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;ON CONFLICT&quot; &quot;FAIL&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;ON CONFLICT&quot; &quot;IGNORE&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;ON CONFLICT&quot; &quot;REPLACE&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_fk_options:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /* nil */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | fk_options</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">fk_options:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  fk_on_options</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | fk_deferred_options</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | fk_on_options fk_deferred_options</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">fk_on_options:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;ON&quot; &quot;DELETE&quot; fk_action</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;ON&quot; &quot;UPDATE&quot; fk_action</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;ON&quot; &quot;UPDATE&quot; fk_action &quot;ON&quot; &quot;DELETE&quot; fk_action</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;ON&quot; &quot;DELETE&quot; fk_action &quot;ON&quot; &quot;UPDATE&quot; fk_action</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">fk_action:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;SET&quot; &quot;NULL&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;SET&quot; &quot;DEFAULT&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;CASCADE&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;RESTRICT&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;NO&quot; &quot;ACTION&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">fk_deferred_options:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;DEFERRABLE&quot; fk_initial_state</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;NOT DEFERRABLE&quot; fk_initial_state</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">fk_initial_state:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /* nil */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;INITIALLY&quot; &quot;DEFERRED&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;INITIALLY&quot; &quot;IMMEDIATE&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">fk_def:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;CONSTRAINT&quot; name &quot;FOREIGN&quot; &quot;KEY&quot; &#x27;(&#x27; name_list &#x27;)&#x27; fk_target_options</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;FOREIGN&quot; &quot;KEY&quot; &#x27;(&#x27; name_list &#x27;)&#x27; fk_target_options</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">fk_target_options:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;REFERENCES&quot; name &#x27;(&#x27; name_list &#x27;)&#x27; opt_fk_options</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">unq_def:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;CONSTRAINT&quot; name &quot;UNIQUE&quot; &#x27;(&#x27; indexed_columns &#x27;)&#x27; opt_conflict_clause</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;UNIQUE&quot; &#x27;(&#x27; indexed_columns &#x27;)&#x27; opt_conflict_clause</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_unique:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /* nil */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;UNIQUE&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">indexed_column:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  expr opt_asc_desc</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">indexed_columns:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  indexed_column</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | indexed_column &#x27;,&#x27; indexed_columns</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create_index_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;CREATE&quot; opt_unique &quot;INDEX&quot; opt_if_not_exists name &quot;ON&quot; name &#x27;(&#x27; indexed_columns &#x27;)&#x27; opt_where opt_delete_version_attr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">name:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;ID&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;TEXT&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;TRIGGER&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;ROWID&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;REPLACE&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;KEY&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;VIRTUAL&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;TYPE&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;HIDDEN&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;PRIVATE&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_name:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /* nil */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">name_list:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  |  name &#x27;,&#x27; name_list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_name_list:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /* nil */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | name_list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cte_binding_list:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  cte_binding</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | cte_binding &#x27;,&#x27; cte_binding_list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cte_binding: name name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | name &quot;AS&quot; name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">col_attrs:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /* nil */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;NOT&quot; &quot;NULL&quot; opt_conflict_clause col_attrs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;PRIMARY&quot; &quot;KEY&quot; opt_conflict_clause col_attrs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;PRIMARY&quot; &quot;KEY&quot; opt_conflict_clause &quot;AUTOINCREMENT&quot; col_attrs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DEFAULT&quot; &#x27;-&#x27; num_literal col_attrs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DEFAULT&quot; num_literal col_attrs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DEFAULT&quot; const_expr col_attrs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DEFAULT&quot; str_literal col_attrs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;COLLATE&quot; name col_attrs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;CHECK&quot; &#x27;(&#x27; expr &#x27;)&#x27; col_attrs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;UNIQUE&quot; opt_conflict_clause col_attrs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;HIDDEN&quot; col_attrs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;@SENSITIVE&quot; col_attrs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;@CREATE&quot; version_annotation col_attrs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;@DELETE&quot; version_annotation col_attrs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | fk_target_options col_attrs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">version_annotation:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &#x27;(&#x27; &quot;integer-literal&quot; &#x27;,&#x27; name &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &#x27;(&#x27; &quot;integer-literal&quot; &#x27;,&#x27; name &#x27;:&#x27; name &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &#x27;(&#x27; &quot;integer-literal&quot; &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_kind:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /* nil */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &#x27;&lt;&#x27; name &#x27;&gt;&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">data_type_numeric:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;INT&quot; opt_kind</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;INTEGER&quot; opt_kind</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;REAL&quot; opt_kind</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;LONG&quot; opt_kind</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;BOOL&quot; opt_kind</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;LONG&quot; &quot;INTEGER&quot; opt_kind</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;LONG&quot; &quot;INT&quot; opt_kind</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;LONG_INT&quot; opt_kind</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;LONG_INTEGER&quot; opt_kind</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">data_type_any:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  data_type_numeric</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;TEXT&quot;  opt_kind</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;BLOB&quot;  opt_kind</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;OBJECT&quot; opt_kind</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;OBJECT&quot; &#x27;&lt;&#x27; name &quot;CURSOR&quot; &#x27;&gt;&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;OBJECT&quot; &#x27;&lt;&#x27; name &quot;SET&quot; &#x27;&gt;&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;ID&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">data_type_with_options:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  data_type_any</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | data_type_any &quot;NOT&quot; &quot;NULL&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | data_type_any &quot;@SENSITIVE&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | data_type_any &quot;@SENSITIVE&quot; &quot;NOT&quot; &quot;NULL&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | data_type_any &quot;NOT&quot; &quot;NULL&quot; &quot;@SENSITIVE&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">str_literal:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;sql-string-literal&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;c-string-literal&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">num_literal:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;integer-literal&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;long-literal&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;real-literal&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;TRUE&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;FALSE&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">const_expr:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;CONST&quot; &#x27;(&#x27; expr &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">any_literal:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  str_literal</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | num_literal</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;NULL&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;@FILE&quot; &#x27;(&#x27; str_literal &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;@PROC&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;sql-blob-literal&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">raise_expr:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;RAISE&quot; &#x27;(&#x27; &quot;IGNORE&quot; &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;RAISE&quot; &#x27;(&#x27; &quot;ROLLBACK&quot; &#x27;,&#x27;  expr &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;RAISE&quot; &#x27;(&#x27; &quot;ABORT&quot; &#x27;,&#x27;  expr &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;RAISE&quot; &#x27;(&#x27; &quot;FAIL&quot; &#x27;,&#x27;  expr &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">call:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name &#x27;(&#x27; arg_list &#x27;)&#x27; opt_filter_clause</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | name &#x27;(&#x27; &quot;DISTINCT&quot; arg_list &#x27;)&#x27; opt_filter_clause</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">basic_expr:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;@RC&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | name &#x27;.&#x27; name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | any_literal</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | const_expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &#x27;(&#x27; expr &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | call</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | window_func_inv</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | raise_expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &#x27;(&#x27; select_stmt &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &#x27;(&#x27; select_stmt &quot;IF&quot; &quot;NOTHING&quot; expr &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &#x27;(&#x27; select_stmt &quot;IF&quot; &quot;NOTHING&quot; &quot;OR&quot; &quot;NULL&quot; expr &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &#x27;(&#x27; select_stmt &quot;IF&quot; &quot;NOTHING&quot; &quot;THROW&quot;&#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;EXISTS&quot; &#x27;(&#x27; select_stmt &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;CASE&quot; expr case_list &quot;END&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;CASE&quot; expr case_list &quot;ELSE&quot; expr &quot;END&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;CASE&quot; case_list &quot;END&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;CASE&quot; case_list &quot;ELSE&quot; expr &quot;END&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;CAST&quot; &#x27;(&#x27; expr &quot;AS&quot; data_type_any &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">math_expr:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  basic_expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | math_expr &#x27;&amp;&#x27; math_expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | math_expr &#x27;|&#x27; math_expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | math_expr &quot;&lt;&lt;&quot; math_expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | math_expr &quot;&gt;&gt;&quot;  math_expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | math_expr &#x27;+&#x27; math_expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | math_expr &#x27;-&#x27; math_expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | math_expr &#x27;*&#x27; math_expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | math_expr &#x27;/&#x27; math_expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | math_expr &#x27;%&#x27; math_expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | math_expr &quot;IS NOT TRUE&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | math_expr &quot;IS NOT FALSE&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | math_expr &quot;ISNULL&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | math_expr &quot;NOTNULL&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | math_expr &quot;IS TRUE&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | math_expr &quot;IS FALSE&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &#x27;-&#x27; math_expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &#x27;~&#x27; math_expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;NOT&quot; math_expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | math_expr &#x27;=&#x27; math_expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | math_expr &quot;==&quot; math_expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | math_expr &#x27;&lt;&#x27; math_expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | math_expr &#x27;&gt;&#x27; math_expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | math_expr &quot;&lt;&gt;&quot; math_expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | math_expr &quot;!=&quot; math_expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | math_expr &quot;&gt;=&quot; math_expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | math_expr &quot;&lt;=&quot; math_expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | math_expr &quot;NOT IN&quot; &#x27;(&#x27; expr_list &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | math_expr &quot;NOT IN&quot; &#x27;(&#x27; select_stmt &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | math_expr &quot;IN&quot; &#x27;(&#x27; expr_list &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | math_expr &quot;IN&quot; &#x27;(&#x27; select_stmt &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | math_expr &quot;LIKE&quot; math_expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | math_expr &quot;NOT LIKE&quot; math_expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | math_expr &quot;MATCH&quot; math_expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | math_expr &quot;NOT MATCH&quot; math_expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | math_expr &quot;REGEXP&quot; math_expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | math_expr &quot;NOT REGEXP&quot; math_expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | math_expr &quot;GLOB&quot; math_expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | math_expr &quot;NOT GLOB&quot; math_expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | math_expr &quot;BETWEEN&quot; math_expr &quot;AND&quot; math_expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | math_expr &quot;NOT BETWEEN&quot; math_expr &quot;AND&quot; math_expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | math_expr &quot;IS NOT&quot; math_expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | math_expr &quot;IS&quot; math_expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | math_expr &quot;||&quot; math_expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | math_expr &quot;COLLATE&quot; name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">expr:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  math_expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | expr &quot;AND&quot; expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | expr &quot;OR&quot; expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">case_list:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;WHEN&quot; expr &quot;THEN&quot; expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;WHEN&quot; expr &quot;THEN&quot; expr case_list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">arg_expr: &#x27;*&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | shape_arguments</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">arg_list:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /* nil */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | arg_expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | arg_expr &#x27;,&#x27; arg_list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">expr_list:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | expr &#x27;,&#x27; expr_list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">shape_arguments:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;FROM&quot; name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;FROM&quot; name shape_def</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;FROM&quot; &quot;ARGUMENTS&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;FROM&quot; &quot;ARGUMENTS&quot; shape_def</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">column_calculation:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;COLUMNS&quot; &#x27;(&#x27; col_calcs &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;COLUMNS&quot; &#x27;(&#x27; &quot;DISTINCT&quot; col_calcs &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">col_calcs:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  col_calc</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | col_calc &#x27;,&#x27; col_calcs</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">col_calc:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | shape_def</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | name shape_def</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | name &#x27;.&#x27; name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">call_expr:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | shape_arguments</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">call_expr_list:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  call_expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | call_expr &#x27;,&#x27; call_expr_list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cte_tables:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  cte_table</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | cte_table &#x27;,&#x27; cte_tables</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cte_decl:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name &#x27;(&#x27; name_list &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | name &#x27;(&#x27; &#x27;*&#x27; &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">shared_cte:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  call_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | call_stmt &quot;USING&quot; cte_binding_list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cte_table:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  cte_decl &quot;AS&quot; &#x27;(&#x27; select_stmt &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | cte_decl &quot;AS&quot; &#x27;(&#x27; shared_cte&#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &#x27;(&#x27; call_stmt &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &#x27;(&#x27; call_stmt &quot;USING&quot; cte_binding_list &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | cte_decl &quot;LIKE&quot; &#x27;(&#x27; select_stmt &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | cte_decl &quot;LIKE&quot; name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">with_prefix:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;WITH&quot; cte_tables</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;WITH&quot; &quot;RECURSIVE&quot; cte_tables</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">with_select_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  with_prefix select_stmt_no_with</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">select_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  with_select_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | select_stmt_no_with</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">select_stmt_no_with:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  select_core_list opt_orderby opt_limit opt_offset</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">select_core_list:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  select_core</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | select_core compound_operator select_core_list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">values:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &#x27;(&#x27; insert_list &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &#x27;(&#x27; insert_list &#x27;)&#x27; &#x27;,&#x27; values</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">select_core:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;SELECT&quot; select_opts select_expr_list opt_from_query_parts opt_where opt_groupby opt_having opt_select_window</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;VALUES&quot; values</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">compound_operator:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;UNION&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;UNION ALL&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;INTERSECT&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;EXCEPT&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">window_func_inv:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name &#x27;(&#x27; arg_list &#x27;)&#x27; opt_filter_clause &quot;OVER&quot; window_name_or_defn</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_filter_clause:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /* nil */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;FILTER&quot; &#x27;(&#x27; opt_where &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">window_name_or_defn: window_defn</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">window_defn:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &#x27;(&#x27; opt_partition_by opt_orderby opt_frame_spec &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_frame_spec:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /* nil */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | frame_type frame_boundary_opts frame_exclude</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">frame_type:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;RANGE&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;ROWS&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;GROUPS&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">frame_exclude:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /* nil */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;EXCLUDE NO OTHERS&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;EXCLUDE CURRENT ROW&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;EXCLUDE GROUP&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;EXCLUDE TIES&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">frame_boundary_opts:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  frame_boundary</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;BETWEEN&quot; frame_boundary_start &quot;AND&quot; frame_boundary_end</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">frame_boundary_start:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;UNBOUNDED&quot; &quot;PRECEDING&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | expr &quot;PRECEDING&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;CURRENT ROW&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | expr &quot;FOLLOWING&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">frame_boundary_end:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  expr &quot;PRECEDING&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;CURRENT ROW&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | expr &quot;FOLLOWING&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;UNBOUNDED&quot; &quot;FOLLOWING&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">frame_boundary:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;UNBOUNDED&quot; &quot;PRECEDING&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | expr &quot;PRECEDING&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;CURRENT ROW&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_partition_by:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /* nil */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;PARTITION&quot; &quot;BY&quot; expr_list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_select_window:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /* nil */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | window_clause</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">window_clause:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;WINDOW&quot; window_name_defn_list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">window_name_defn_list:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  window_name_defn</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | window_name_defn &#x27;,&#x27; window_name_defn_list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">window_name_defn:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name &quot;AS&quot; window_defn</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">region_spec:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | name &quot;PRIVATE&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">region_list:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  region_spec &#x27;,&#x27; region_list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | region_spec</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare_schema_region_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;@DECLARE_SCHEMA_REGION&quot; name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;@DECLARE_SCHEMA_REGION&quot; name &quot;USING&quot; region_list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare_deployable_region_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;@DECLARE_DEPLOYABLE_REGION&quot;  name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;@DECLARE_DEPLOYABLE_REGION&quot; name &quot;USING&quot; region_list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">begin_schema_region_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;@BEGIN_SCHEMA_REGION&quot; name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end_schema_region_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;@END_SCHEMA_REGION&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">schema_unsub_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;@UNSUB&quot; version_annotation</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">schema_resub_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;@RESUB&quot; version_annotation</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">schema_ad_hoc_migration_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;@SCHEMA_AD_HOC_MIGRATION&quot; version_annotation</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;@SCHEMA_AD_HOC_MIGRATION&quot; &quot;FOR&quot; &quot;@RECREATE&quot; &#x27;(&#x27; name &#x27;,&#x27; name &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">emit_enums_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;@EMIT_ENUMS&quot; opt_name_list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">emit_group_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;@EMIT_GROUP&quot; opt_name_list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">emit_constants_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;@EMIT_CONSTANTS&quot; name_list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_from_query_parts:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /* nil */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;FROM&quot; query_parts</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_where:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /* nil */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;WHERE&quot; expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_groupby:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /* nil */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;GROUP&quot; &quot;BY&quot; groupby_list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">groupby_list:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  groupby_item</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | groupby_item &#x27;,&#x27; groupby_list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">groupby_item:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_asc_desc:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /* nil */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;ASC&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DESC&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_having:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /* nil */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;HAVING&quot; expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_orderby:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /* nil */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;ORDER&quot; &quot;BY&quot; orderby_list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">orderby_list:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  orderby_item</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | orderby_item &#x27;,&#x27; orderby_list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">orderby_item:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  expr opt_asc_desc</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_limit:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /* nil */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;LIMIT&quot; expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_offset:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /* nil */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;OFFSET&quot; expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">select_opts:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /* nil */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;ALL&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DISTINCT&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DISTINCTROW&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">select_expr_list:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  select_expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | select_expr &#x27;,&#x27; select_expr_list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &#x27;*&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">select_expr:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  expr opt_as_alias</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | name &#x27;.&#x27; &#x27;*&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | column_calculation</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_as_alias:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /* nil */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | as_alias</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">as_alias:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;AS&quot; name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">query_parts:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  table_or_subquery_list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | join_clause</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">table_or_subquery_list:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  table_or_subquery</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | table_or_subquery &#x27;,&#x27; table_or_subquery_list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">join_clause:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  table_or_subquery join_target_list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">join_target_list:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  join_target</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | join_target join_target_list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">table_or_subquery:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name opt_as_alias</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &#x27;(&#x27; select_stmt &#x27;)&#x27; opt_as_alias</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &#x27;(&#x27; shared_cte &#x27;)&#x27; opt_as_alias</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | table_function opt_as_alias</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &#x27;(&#x27; query_parts &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">join_type:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /*nil */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;LEFT&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;RIGHT&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;LEFT&quot; &quot;OUTER&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;RIGHT&quot; &quot;OUTER&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;INNER&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;CROSS&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">join_target: join_type &quot;JOIN&quot; table_or_subquery opt_join_cond</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_join_cond:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /* nil */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | join_cond</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">join_cond:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;ON&quot; expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;USING&quot; &#x27;(&#x27; name_list &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">table_function:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name &#x27;(&#x27; arg_list &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create_view_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;CREATE&quot; opt_temp &quot;VIEW&quot; opt_if_not_exists name &quot;AS&quot; select_stmt opt_delete_version_attr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">with_delete_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  with_prefix delete_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">delete_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;DELETE&quot; &quot;FROM&quot; name opt_where</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_insert_dummy_spec:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /*nil*/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;@DUMMY_SEED&quot; &#x27;(&#x27; expr &#x27;)&#x27; dummy_modifier</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">dummy_modifier:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /* nil */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;@DUMMY_NULLABLES&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;@DUMMY_DEFAULTS&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;@DUMMY_NULLABLES&quot; &quot;@DUMMY_DEFAULTS&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;@DUMMY_DEFAULTS&quot; &quot;@DUMMY_NULLABLES&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">insert_stmt_type:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;INSERT&quot; &quot;INTO&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;INSERT&quot; &quot;OR&quot; &quot;REPLACE&quot; &quot;INTO&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;INSERT&quot; &quot;OR&quot; &quot;IGNORE&quot; &quot;INTO&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;INSERT&quot; &quot;OR&quot; &quot;ROLLBACK&quot; &quot;INTO&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;INSERT&quot; &quot;OR&quot; &quot;ABORT&quot; &quot;INTO&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;INSERT&quot; &quot;OR&quot; &quot;FAIL&quot; &quot;INTO&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;REPLACE&quot; &quot;INTO&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">with_insert_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  with_prefix insert_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_column_spec:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /* nil */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &#x27;(&#x27; opt_name_list &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &#x27;(&#x27; shape_def &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">from_shape:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;FROM&quot; &quot;CURSOR&quot; name opt_column_spec</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;FROM&quot; name opt_column_spec</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;FROM&quot; &quot;ARGUMENTS&quot; opt_column_spec</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">insert_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  insert_stmt_type name opt_column_spec select_stmt opt_insert_dummy_spec</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | insert_stmt_type name opt_column_spec from_shape opt_insert_dummy_spec</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | insert_stmt_type name &quot;DEFAULT&quot; &quot;VALUES&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | insert_stmt_type name &quot;USING&quot; select_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | insert_stmt_type name &quot;USING&quot; expr_names opt_insert_dummy_spec</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">insert_list_item:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | shape_arguments</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">insert_list:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /* nil */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | insert_list_item</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | insert_list_item &#x27;,&#x27; insert_list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">basic_update_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;UPDATE&quot; opt_name &quot;SET&quot; update_list opt_where</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">with_update_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  with_prefix update_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">update_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;UPDATE&quot; name &quot;SET&quot; update_list opt_where opt_orderby opt_limit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">update_entry:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name &#x27;=&#x27; expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">update_list:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  update_entry</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | update_entry &#x27;,&#x27; update_list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">with_upsert_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  with_prefix upsert_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">upsert_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  insert_stmt &quot;ON CONFLICT&quot; conflict_target &quot;DO&quot; &quot;NOTHING&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | insert_stmt &quot;ON CONFLICT&quot; conflict_target &quot;DO&quot; basic_update_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">update_cursor_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;UPDATE&quot; &quot;CURSOR&quot; name opt_column_spec &quot;FROM&quot; &quot;VALUES&quot; &#x27;(&#x27; insert_list &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;UPDATE&quot; &quot;CURSOR&quot; name opt_column_spec from_shape</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;UPDATE&quot; &quot;CURSOR&quot; name &quot;USING&quot; expr_names</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">conflict_target:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /* nil */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &#x27;(&#x27; indexed_columns &#x27;)&#x27; opt_where</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">function: &quot;FUNC&quot; | &quot;FUNCTION&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare_out_call_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;DECLARE&quot; &quot;OUT&quot; call_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare_enum_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;DECLARE&quot; &quot;ENUM&quot; name data_type_numeric &#x27;(&#x27; enum_values &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">enum_values:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    enum_value</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | enum_value &#x27;,&#x27; enum_values</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">enum_value:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | name &#x27;=&#x27; expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare_const_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;DECLARE&quot; &quot;CONST&quot; &quot;GROUP&quot; name &#x27;(&#x27; const_values &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare_group_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;DECLARE&quot; &quot;GROUP&quot; name &quot;BEGIN&quot; simple_variable_decls &quot;END&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">simple_variable_decls:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  declare_simple_var_stmt &#x27;;&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | declare_simple_var_stmt &#x27;;&#x27; simple_variable_decls</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">const_values:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   const_value</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | const_value &#x27;,&#x27; const_values</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">const_value:  name &#x27;=&#x27; expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare_select_func_no_check_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;DECLARE&quot; &quot;SELECT&quot; function name &quot;NO&quot; &quot;CHECK&quot; data_type_with_options</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DECLARE&quot; &quot;SELECT&quot; function name &quot;NO&quot; &quot;CHECK&quot; &#x27;(&#x27; typed_names &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare_func_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;DECLARE&quot; function name &#x27;(&#x27; func_params &#x27;)&#x27; data_type_with_options</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DECLARE&quot; &quot;SELECT&quot; function name &#x27;(&#x27; params &#x27;)&#x27; data_type_with_options</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DECLARE&quot; function name &#x27;(&#x27; func_params &#x27;)&#x27; &quot;CREATE&quot; data_type_with_options</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DECLARE&quot; &quot;SELECT&quot; function name &#x27;(&#x27; params &#x27;)&#x27; &#x27;(&#x27; typed_names &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">procedure: &quot;PROC&quot; | &quot;PROCEDURE&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare_proc_no_check_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;DECLARE&quot; procedure name &quot;NO&quot; &quot;CHECK&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare_proc_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;DECLARE&quot; procedure name &#x27;(&#x27; params &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DECLARE&quot; procedure name &#x27;(&#x27; params &#x27;)&#x27; &#x27;(&#x27; typed_names &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DECLARE&quot; procedure name &#x27;(&#x27; params &#x27;)&#x27; &quot;USING&quot; &quot;TRANSACTION&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DECLARE&quot; procedure name &#x27;(&#x27; params &#x27;)&#x27; &quot;OUT&quot; &#x27;(&#x27; typed_names &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DECLARE&quot; procedure name &#x27;(&#x27; params &#x27;)&#x27; &quot;OUT&quot; &#x27;(&#x27; typed_names &#x27;)&#x27; &quot;USING&quot; &quot;TRANSACTION&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DECLARE&quot; procedure name &#x27;(&#x27; params &#x27;)&#x27; &quot;OUT&quot; &quot;UNION&quot; &#x27;(&#x27; typed_names &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DECLARE&quot; procedure name &#x27;(&#x27; params &#x27;)&#x27; &quot;OUT&quot; &quot;UNION&quot; &#x27;(&#x27; typed_names &#x27;)&#x27; &quot;USING&quot; &quot;TRANSACTION&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare_interface_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;DECLARE&quot; &quot;INTERFACE&quot; name &#x27;(&#x27; typed_names &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create_proc_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;CREATE&quot; procedure name &#x27;(&#x27; params &#x27;)&#x27; &quot;BEGIN&quot; opt_stmt_list &quot;END&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">inout:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;IN&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;OUT&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;INOUT&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">typed_name:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name data_type_with_options</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | shape_def</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | name shape_def</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">typed_names:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  typed_name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | typed_name &#x27;,&#x27; typed_names</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">func_param:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  param</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | name &quot;CURSOR&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">func_params:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /* nil */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | func_param</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  |  func_param &#x27;,&#x27; func_params</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">param:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name data_type_with_options</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | inout name data_type_with_options</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | shape_def</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | name shape_def</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">params:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /* nil */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | param</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  |  param &#x27;,&#x27; params</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">/* these forms are just storage */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare_simple_var_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;DECLARE&quot; name_list data_type_with_options</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DECLARE&quot; name &quot;CURSOR&quot; shape_def</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DECLARE&quot; name &quot;CURSOR&quot; &quot;LIKE&quot; select_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DECLARE&quot; name &quot;CURSOR&quot; &quot;LIKE&quot; &#x27;(&#x27; typed_names &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">/* the additional forms are just about storage */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  declare_simple_var_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DECLARE&quot; name &quot;CURSOR&quot; &quot;FOR&quot; select_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DECLARE&quot; name &quot;CURSOR&quot; &quot;FOR&quot; explain_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DECLARE&quot; name &quot;CURSOR&quot; &quot;FOR&quot; call_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DECLARE&quot; name &quot;CURSOR&quot; &quot;FETCH&quot; &quot;FROM&quot; call_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DECLARE&quot; name &quot;CURSOR&quot; &quot;FOR&quot; expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DECLARE&quot; name &quot;TYPE&quot; data_type_with_options</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">call_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;CALL&quot; name &#x27;(&#x27; &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;CALL&quot; name &#x27;(&#x27; call_expr_list &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;CALL&quot; name &#x27;(&#x27; &#x27;*&#x27; &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">while_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;WHILE&quot; expr &quot;BEGIN&quot; opt_stmt_list &quot;END&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">switch_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;SWITCH&quot; expr switch_case switch_cases</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;SWITCH&quot; expr &quot;ALL&quot; &quot;VALUES&quot; switch_case switch_cases</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">switch_case:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;WHEN&quot; expr_list &quot;THEN&quot; stmt_list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;WHEN&quot; expr_list &quot;THEN&quot; &quot;NOTHING&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">switch_cases:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  switch_case switch_cases</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;ELSE&quot; stmt_list &quot;END&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;END&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">loop_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;LOOP&quot; fetch_stmt &quot;BEGIN&quot; opt_stmt_list &quot;END&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">leave_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;LEAVE&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">return_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;RETURN&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">rollback_return_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;ROLLBACK&quot; &quot;RETURN&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">commit_return_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;COMMIT&quot; &quot;RETURN&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">throw_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;THROW&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">trycatch_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;BEGIN&quot; &quot;TRY&quot; opt_stmt_list &quot;END&quot; &quot;TRY&quot; &#x27;;&#x27; &quot;BEGIN&quot; &quot;CATCH&quot; opt_stmt_list &quot;END&quot; &quot;CATCH&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">continue_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;CONTINUE&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">fetch_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;FETCH&quot; name &quot;INTO&quot; name_list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;FETCH&quot; name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">fetch_cursor_from_blob_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;FETCH&quot; name &quot;FROM BLOB&quot; expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">fetch_values_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;FETCH&quot; name opt_column_spec &quot;FROM&quot; &quot;VALUES&quot; &#x27;(&#x27; insert_list &#x27;)&#x27; opt_insert_dummy_spec</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;FETCH&quot; name opt_column_spec from_shape opt_insert_dummy_spec</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;FETCH&quot; name &quot;USING&quot; expr_names opt_insert_dummy_spec</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">expr_names:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  expr_name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  |  expr_name &#x27;,&#x27; expr_names</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">expr_name: expr as_alias</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">fetch_call_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;FETCH&quot; name opt_column_spec &quot;FROM&quot; call_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">close_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;CLOSE&quot; name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">out_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;OUT&quot; name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">out_union_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;OUT&quot; &quot;UNION&quot; name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">out_union_parent_child_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;OUT&quot; &quot;UNION&quot; call_stmt &quot;JOIN&quot; child_results</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">child_results:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   child_result</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   | child_result &quot;AND&quot; child_results</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">child_result:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  call_stmt &quot;USING&quot; &#x27;(&#x27; name_list &#x27;)&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">if_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;IF&quot; expr &quot;THEN&quot; opt_stmt_list opt_elseif_list opt_else &quot;END&quot; &quot;IF&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_else:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /* nil */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;ELSE&quot; opt_stmt_list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">elseif_item:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;ELSE IF&quot; expr &quot;THEN&quot; opt_stmt_list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">elseif_list:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  elseif_item</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | elseif_item elseif_list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_elseif_list:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /* nil */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | elseif_list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">control_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  commit_return_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | continue_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | leave_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | return_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | rollback_return_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | throw_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">guard_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;IF&quot; expr control_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">transaction_mode:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /* nil */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;DEFERRED&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;IMMEDIATE&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;EXCLUSIVE&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">begin_trans_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;BEGIN&quot; transaction_mode &quot;TRANSACTION&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;BEGIN&quot; transaction_mode</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">rollback_trans_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;ROLLBACK&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;ROLLBACK&quot; &quot;TRANSACTION&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;ROLLBACK&quot; &quot;TO&quot; savepoint_name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;ROLLBACK&quot; &quot;TRANSACTION&quot; &quot;TO&quot; savepoint_name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;ROLLBACK&quot; &quot;TO&quot; &quot;SAVEPOINT&quot; savepoint_name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;ROLLBACK&quot; &quot;TRANSACTION&quot; &quot;TO&quot; &quot;SAVEPOINT&quot; savepoint_name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">commit_trans_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;COMMIT&quot; &quot;TRANSACTION&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;COMMIT&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">proc_savepoint_stmt:  procedure &quot;SAVEPOINT&quot; &quot;BEGIN&quot; opt_stmt_list &quot;END&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">savepoint_name:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;@PROC&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">savepoint_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;SAVEPOINT&quot; savepoint_name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">release_savepoint_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;RELEASE&quot; savepoint_name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;RELEASE&quot; &quot;SAVEPOINT&quot; savepoint_name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">echo_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;@ECHO&quot; name &#x27;,&#x27; str_literal</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">alter_table_add_column_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;ALTER&quot; &quot;TABLE&quot; name &quot;ADD&quot; &quot;COLUMN&quot; col_def</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create_trigger_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;CREATE&quot; opt_temp &quot;TRIGGER&quot; opt_if_not_exists trigger_def opt_delete_version_attr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">trigger_def:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  name trigger_condition trigger_operation &quot;ON&quot; name trigger_action</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">trigger_condition:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /* nil */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;BEFORE&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;AFTER&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;INSTEAD&quot; &quot;OF&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">trigger_operation:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;DELETE&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;INSERT&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;UPDATE&quot; opt_of</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_of:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /* nil */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;OF&quot; name_list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">trigger_action:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  opt_foreachrow opt_when_expr &quot;BEGIN&quot; trigger_stmts &quot;END&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_foreachrow:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /* nil */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;FOR EACH ROW&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_when_expr:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /* nil */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;WHEN&quot; expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">trigger_stmts:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  trigger_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | trigger_stmt  trigger_stmts</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">trigger_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  trigger_update_stmt &#x27;;&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | trigger_insert_stmt &#x27;;&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | trigger_delete_stmt &#x27;;&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | trigger_select_stmt &#x27;;&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">trigger_select_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  select_stmt_no_with</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">trigger_insert_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  insert_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">trigger_delete_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  delete_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">trigger_update_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  basic_update_stmt</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">enforcement_options:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;FOREIGN&quot; &quot;KEY&quot; &quot;ON&quot; &quot;UPDATE&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;FOREIGN&quot; &quot;KEY&quot; &quot;ON&quot; &quot;DELETE&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;JOIN&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;UPSERT&quot; &quot;STATEMENT&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;WINDOW&quot; function</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;WITHOUT&quot; &quot;ROWID&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;TRANSACTION&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;SELECT&quot; &quot;IF&quot; &quot;NOTHING&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;INSERT&quot; &quot;SELECT&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;TABLE&quot; &quot;FUNCTION&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;ENCODE&quot; &quot;CONTEXT COLUMN&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;ENCODE&quot; &quot;CONTEXT TYPE&quot; &quot;INTEGER&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;ENCODE&quot; &quot;CONTEXT TYPE&quot; &quot;LONG_INTEGER&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;ENCODE&quot; &quot;CONTEXT TYPE&quot; &quot;REAL&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;ENCODE&quot; &quot;CONTEXT TYPE&quot; &quot;BOOL&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;ENCODE&quot; &quot;CONTEXT TYPE&quot; &quot;TEXT&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;ENCODE&quot; &quot;CONTEXT TYPE&quot; &quot;BLOB&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;IS TRUE&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;CAST&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;SIGN FUNCTION&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &quot;CURSOR HAS ROW&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">enforce_strict_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;@ENFORCE_STRICT&quot; enforcement_options</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">enforce_normal_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;@ENFORCE_NORMAL&quot; enforcement_options</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">enforce_reset_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;@ENFORCE_RESET&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">enforce_push_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;@ENFORCE_PUSH&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">enforce_pop_stmt:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  &quot;@ENFORCE_POP&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="appendix-3-control-directives">Appendix 3: Control Directives<a class="hash-link" href="#appendix-3-control-directives" title="Direct link to heading">​</a></h2><p>The control directives are those statements that begin with <code>@</code> and they are distinguished from other statements because they influence the compiler rather than the program logic.  Some of these are of great importance and discussed elsewhere.</p><p>The complete list (as of this writing) is:</p><p><code>@ENFORCE_STRICT</code>
<code>@ENFORCE_NORMAL</code></p><ul><li>These enable or disable more strict semanic checking the sub options are<ul><li><code>FOREIGN KEY ON UPDATE</code>: all FK&#x27;s must choose some <code>ON UPDATE</code> strategy</li><li><code>FOREIGN KEY ON DELETE</code>: all FK&#x27;s must choose some <code>ON DELETE</code> strategy</li><li><code>PROCEDURE</code>: all procedures must be declared before they are called (eliminating the vanilla <code>C</code> call option)</li><li><code>JOIN</code>: all joins must be ANSI style, the form <code>FROM A,B</code> is not allowed (replace with <code>A INNER JOIN B</code></li><li><code>WINDOW FUNC</code>: window functions are disallowed (useful if targeting old versions of SQLite)</li><li><code>UPSERT STATEMENT</code>: the upsert form is disallowed (useful if targeting old versions of SQLite)</li></ul></li></ul><p><code>@SENSITIVE</code></p><ul><li>marks a column or variable as &#x27;sensitive&#x27; for privacy purposes, this behaves somewhat like nullability (See Chapter 3) in that it is radioactive, contaminating anything it touches</li><li>the intent of this annotation is to make it clear where sensitive data is being returned or consumed in your procedures</li><li>this information appears in the JSON output for further codegen or for analysis (See Chapter 13)</li></ul><p><code>@DECLARE_SCHEMA_REGION</code>
<code>@DECLARE_DEPLOYABLE_REGION</code>
<code>@BEGIN_SCHEMA_REGION</code>
<code>@END_SCHEMA_REGION</code></p><ul><li>These directives control the declaration of schema regions and allow you to place things into those regions -- see <a href="https://cgsql.dev/cql-guide/ch10" target="_blank" rel="noopener noreferrer">Chapter 10</a></li></ul><p><code>@SCHEMA_AD_HOC_MIGRATION</code></p><ul><li>Allows for the creation of a ad hoc migration step at a given schema version, (See Chapter 10)</li></ul><p><code>@ECHO</code></p><ul><li>Emits text into the C output stream, useful for emiting things like function prototypes or preprocessor directives</li><li>e.g. `echo C, &#x27;#define foo bar&#x27;</li></ul><p><code>@RECREATE</code>
<code>@CREATE</code>
<code>@DELETE</code></p><ul><li>used to mark the schema version where an object is created or deleted, or alternatively indicate the the object is always dropped and recreated when it changes (See Chapter 10)</li></ul><p><code>@SCHEMA_UPGRADE_VERSION</code></p><ul><li>used to indicate that the code that follows is part of a migration script for the indicated schema version</li><li>this has the effect of making the schema appear to be how it existed at the indicated version</li><li>the idea here is that migration procedures operate on previous versions of the schema where (e.g.) some columns/tables hadn&#x27;t been deleted yet</li></ul><p><code>@PREVIOUS_SCHEMA</code></p><ul><li>indicates the start of the previous version of the schema for comparison (See Chapter 11)</li></ul><p><code>@SCHEMA_UPGRADE_SCRIPT</code></p><ul><li>CQL emits a schema upgrade script as part of its upgrade features, this script declares tables in their final form but also creates the same tables as they existed when they were first created</li><li>this directive instructs CQL to ignore the incompatible creations, the first declaration controls</li><li>the idea here is that the upgrade script is in the business of getting you to the finish line in an orderly fashion and some of the interim steps are just not all the way there yet</li><li>note that the upgrade script recapitulates the version history, it does not take you directly to the finish line, this is so that all instances get to the same place the same way (and this fleshes out any bugs in migration)</li></ul><p><code>@DUMMY_NULLABLES</code>
<code>@DUMMY_DEFAULTS</code>
<code>@DUMMY_SEED</code></p><ul><li>these control the creation of dummy data for <code>insert</code> and <code>fetch</code> statements (See Chapters 5 and 12)</li></ul><p><code>@FILE</code></p><ul><li>a string literal that corresponds to the current file name with a prefix stripped (to remove build lab junk in the path)</li></ul><p><code>@ATTRIBUTE</code></p><ul><li><p>the main purpose of <code>@attribute</code> is to appear in the JSON output so that it can control later codegen stages in whatever way you deem appropriate</p></li><li><p>the nested nature of attribute values is sufficiently flexible than you could encode an arbitrary LISP program in an attribute, so really anything you might need to express is possible</p></li><li><p>there are a number of attributes known to the compiler which I list below (complete as of this writing)</p></li><li><p><code>cql:autodrop=(table1, table2, ...)</code> when present the indicated tables, which must be temp tables, are dropped when the results of the procedure have been fetched into a rowset</p></li><li><p><code>cql:identity=(column1, column2, ...)</code> the indicated columns are used to create a row comparator for the rowset corresponding to the procedure, this appears in a C macro of the form <code>procedure_name_row_same(rowset1, row1, rowset2, row2)</code></p></li><li><p><code>cql:suppress_getters</code> the annotated procedure should not emit its related column getter functions.</p><ul><li>Useful if you only indend to call the procedure from CQL.</li><li>Saves code generation and removes the possibility of C code using the getters.</li></ul></li><li><p><code>cql:suppress_result_set</code> the annotated procedure should not emit its related &quot;fetch results&quot; function.</p><ul><li>Useful if you only indend to call the procedure from CQL.</li><li>Saves code generation and removes the possibility of C code using the result set or getters.</li><li>Implies <code>cql:suppress_getters</code>; since there is no result set, getters would be redundant.</li><li>Note: an <code>OUT UNION</code> procedure cannot have a suppressed result set since all such a procedure does is produce a result set. This attribute is ignored for out union procedures.</li></ul></li><li><p><code>cql:private</code> the annotated procedure will be static in the generated C</p><ul><li>Because the generated function is <code>static</code> it cannot be called from other modules and therefore will not go in any CQL exports file (that would be moot since you couldn&#x27;t call it).</li><li>This attribute also implies <code>cql:suppress_result_set</code> since only CQL code in the same translation unit could possibly call it and hence the result set procedure is useless to other C code.</li></ul></li><li><p><code>cql:generate_copy</code> the code generation for the annotated procedure will produce a <code>[procedure_name]_copy</code> function that can make complete or partial copies of its result set.</p></li><li><p><code>cql:base_fragment=frag_name</code> used for base fragments (See Chapter 14)</p></li><li><p><code>cql:extension_fragment=frag_name</code> used for extension fragments (See Chapter 14)</p></li><li><p><code>cql:assembly_fragment=frag_name</code> used for assembly fragments (See Chapter 14)</p></li><li><p><code>cql:no_table_scan</code> for query plan processing, indicates that the table in question should never be table scanned in any plan (for better diagnostics)</p></li><li><p><code>cql:autotest=([many forms])</code> declares various autotest features (See Chapter 12)</p></li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="appendix-4-cql-error-codes">Appendix 4: CQL Error Codes<a class="hash-link" href="#appendix-4-cql-error-codes" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0001-operands-must-be-an-integer-type-not-real">CQL0001: operands must be an integer type, not real<a class="hash-link" href="#cql0001-operands-must-be-an-integer-type-not-real" title="Direct link to heading">​</a></h3><p>integer math operators like &lt;&lt; &gt;&gt; &amp; and | are not compatible with real-valued arguments</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0002-left-operand-cannot-be-an-object-in-operator">CQL0002: left operand cannot be an object in &#x27;operator&#x27;<a class="hash-link" href="#cql0002-left-operand-cannot-be-an-object-in-operator" title="Direct link to heading">​</a></h3><p>Most arithmetic operators (e.g. +, -, *) do not work on objects.  Basically comparison is all you can do.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0003-left-operand-cannot-be-an-object-in-operator">CQL0003: left operand cannot be an object in &#x27;operator&#x27;<a class="hash-link" href="#cql0003-left-operand-cannot-be-an-object-in-operator" title="Direct link to heading">​</a></h3><p>Most arithmetic operators (e.g. +, -, *) do not work on objects.  Basically comparison is all you can do.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0004-left-operand-cannot-be-a-blob-in-operator">CQL0004: left operand cannot be a blob in &#x27;operator&#x27;<a class="hash-link" href="#cql0004-left-operand-cannot-be-a-blob-in-operator" title="Direct link to heading">​</a></h3><p>Most arithmetic operators (e.g. +, -, *) do not work on blobs.  Basically comparison is all you can do.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0005-right-operand-cannot-be-a-blob-in-operator">CQL0005: right operand cannot be a blob in &#x27;operator&#x27;<a class="hash-link" href="#cql0005-right-operand-cannot-be-a-blob-in-operator" title="Direct link to heading">​</a></h3><p>Most arithmetic operators (e.g. +, -, *) do not work on blobs.  Basically comparison is all you can do.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0007-left-operand-cannot-be-a-string-in-operator">CQL0007: left operand cannot be a string in &#x27;operator&#x27;<a class="hash-link" href="#cql0007-left-operand-cannot-be-a-string-in-operator" title="Direct link to heading">​</a></h3><p>Most arithmetic operators (e.g. +, -, *) do not work on strings.  Basically comparison is all you can do.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0008-right-operand-cannot-be-a-string-in-operator">CQL0008: right operand cannot be a string in &#x27;operator&#x27;<a class="hash-link" href="#cql0008-right-operand-cannot-be-a-string-in-operator" title="Direct link to heading">​</a></h3><p>Most arithmetic operators (e.g. +, -, *) do not work on strings.  Basically comparison is all you can do.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0009-incompatible-types-in-expression-subject">CQL0009: incompatible types in expression &#x27;subject&#x27;<a class="hash-link" href="#cql0009-incompatible-types-in-expression-subject" title="Direct link to heading">​</a></h3><p>The expression type indicated by subject required a TEXT as the next item and found something else.
This could be a binary operator, part of a CASE expression, the parts of an IN expression or any other
place where several expressions might need to be compatible with each other.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0010-incompatible-types-in-expression-subject">CQL0010: incompatible types in expression &#x27;subject&#x27;<a class="hash-link" href="#cql0010-incompatible-types-in-expression-subject" title="Direct link to heading">​</a></h3><p>The expression type indicated by subject required an OBJECT as the next item and found something else.
This could be a binary operator, part of a CASE expression, the parts of an IN expression or any other
place where several expressions might need to be compatible with each other.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0011-incompatible-types-in-expression-subject">CQL0011: incompatible types in expression &#x27;subject&#x27;<a class="hash-link" href="#cql0011-incompatible-types-in-expression-subject" title="Direct link to heading">​</a></h3><p>The expression type indicated by subject required a BLOB as the next item and found something else.
This could be a binary operator, part of a CASE expression, the parts of an IN expression or any other
place where several expressions might need to be compatible with each other.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0012-incompatible-types-in-expression-subject">CQL0012: incompatible types in expression &#x27;subject&#x27;<a class="hash-link" href="#cql0012-incompatible-types-in-expression-subject" title="Direct link to heading">​</a></h3><p>The expression type indicated by subject required a numeric as the next item and found something else.
This could be a binary operator, part of a CASE expression, the parts of an IN expression or any other
place where several expressions might need to be compatible with each other.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0013-cannot-assigncopy-possibly-null-expression-to-not-null-target-target">CQL0013: cannot assign/copy possibly null expression to not null target &#x27;target&#x27;<a class="hash-link" href="#cql0013-cannot-assigncopy-possibly-null-expression-to-not-null-target-target" title="Direct link to heading">​</a></h3><p>Here assign/copy can be the simplest case of assigning to a local variable or an OUT parameter but this error also appears when calling functions.  You should think of the IN arguments as requiring that the actual argument be assignable to the formal variable and OUT arguments requiring that the formal be assignable to the actual argument variable.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0014-cannot-assigncopy-sensitive-expression-to-not-null-target-target">CQL0014: cannot assign/copy sensitive expression to not null target &#x27;target&#x27;<a class="hash-link" href="#cql0014-cannot-assigncopy-sensitive-expression-to-not-null-target-target" title="Direct link to heading">​</a></h3><p>Here assign/copy can be the simplest case of assigning to a local variable or an OUT parameter but this error also appears when calling functions.  You should think of the IN arguments as requiring that the actual argument be assignable to the formal variable and OUT arguments requiring that the formal be assignable to the actual argument variable.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0015-expected-numeric-expression-context">CQL0015: expected numeric expression &#x27;context&#x27;<a class="hash-link" href="#cql0015-expected-numeric-expression-context" title="Direct link to heading">​</a></h3><p>Many SQL clauses require a numeric expression such as WHERE/HAVING/LIMIT/OFFSET.  This expression indicates the expression in the given context is not a numeric.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0016-duplicate-table-name-in-join-table">CQL0016: duplicate table name in join &#x27;table&#x27;<a class="hash-link" href="#cql0016-duplicate-table-name-in-join-table" title="Direct link to heading">​</a></h3><p>When this error is produced it means the result of the join would have the same table twice with no disambiguation between the two places.  The conflicting name is provided.  To fix this, make an alias both tables.
e.g.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> parent_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> T2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> child_id</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> foo </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> T1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">INNER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">JOIN</span><span class="token plain"> foo </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> T2 </span><span class="token keyword" style="font-style:italic">ON</span><span class="token plain"> T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> T2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">parent_id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0017-index-was-present-but-now-it-does-not-exist-use-delete-instead-index">CQL0017: index was present but now it does not exist (use <code>@delete</code> instead) &#x27;index&#x27;<a class="hash-link" href="#cql0017-index-was-present-but-now-it-does-not-exist-use-delete-instead-index" title="Direct link to heading">​</a></h3><p>The named index is in the previous schema bit it is not in the current schema.  All entities need some kind of tombstone in the  schema so that they can be correctly deleted if they are still present.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0018-duplicate-index-name-index">CQL0018: duplicate index name &#x27;index&#x27;<a class="hash-link" href="#cql0018-duplicate-index-name-index" title="Direct link to heading">​</a></h3><p>An index with the indicated name already exists.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0019-create-index-table-name-not-found-table_name">CQL0019: create index table name not found &#x27;table_name&#x27;<a class="hash-link" href="#cql0019-create-index-table-name-not-found-table_name" title="Direct link to heading">​</a></h3><p>The table part of a CREATE INDEX statement was not a valid table name.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0020-duplicate-constraint-name-in-table-constraint_name">CQL0020: duplicate constraint name in table &#x27;constraint_name&#x27;<a class="hash-link" href="#cql0020-duplicate-constraint-name-in-table-constraint_name" title="Direct link to heading">​</a></h3><p>A table contains two constraints with the same name.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0021-foreign-key-refers-to-non-existent-table-table_name">CQL0021: foreign key refers to non-existent table &#x27;table_name&#x27;<a class="hash-link" href="#cql0021-foreign-key-refers-to-non-existent-table-table_name" title="Direct link to heading">​</a></h3><p>The table in a foreign key REFERENCES clause is not a valid table.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0022-exact-type-of-both-sides-of-a-foreign-key-must-match-expected-expected_type-found-actual_type-key_name">CQL0022: exact type of both sides of a foreign key must match (expected expected_type; found actual_type) &#x27;key_name&#x27;<a class="hash-link" href="#cql0022-exact-type-of-both-sides-of-a-foreign-key-must-match-expected-expected_type-found-actual_type-key_name" title="Direct link to heading">​</a></h3><p>The indicated foreign key has at least one column with a different type than corresponding column in the table it references.
This usually means that you have picked the wrong table or column in the foreign key declaration.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0023-number-of-columns-on-both-sides-of-a-foreign-key-must-match">CQL0023: number of columns on both sides of a foreign key must match<a class="hash-link" href="#cql0023-number-of-columns-on-both-sides-of-a-foreign-key-must-match" title="Direct link to heading">​</a></h3><p>The number of column in the foreign key must be the same as the number of columns specified in the foreign table.
This usually means a column is missing in the REFERENCES part of the declaration.</p><hr><p>CQL0024: no longer in use</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0025-version-number-in-annotation-must-be-positive">CQL0025: version number in annotation must be positive<a class="hash-link" href="#cql0025-version-number-in-annotation-must-be-positive" title="Direct link to heading">​</a></h3><p>In an <code>@create</code> or <code>@delete</code> annotation, the version number must be &gt; 0.
This error usually means there is a typo in the version number.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0026-duplicate-version-annotation">CQL0026: duplicate version annotation<a class="hash-link" href="#cql0026-duplicate-version-annotation" title="Direct link to heading">​</a></h3><p>There can only be one <code>@create</code>, <code>@delete</code>, or <code>@recreate</code> annotation for any given table/column.  More than one <code>@create</code> is redundant.
This error usually means the <code>@create</code> was cut/paste to make an <code>@delete</code> and then not edited or something like that.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0027-a-procedure-can-appear-in-only-one-annotation-procedure_name">CQL0027: a procedure can appear in only one annotation &#x27;procedure_name&#x27;<a class="hash-link" href="#cql0027-a-procedure-can-appear-in-only-one-annotation-procedure_name" title="Direct link to heading">​</a></h3><p>The indicated migration procedure e.g. the foo in <code>@create(5, foo)</code> appears in another annotation.  Migration steps should happen exactly once.
This probably means the annotation was cut/paste and the migration proc was not removed.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0028-fk-reference-must-be-exactly-one-column-with-the-correct-type-column_name">CQL0028: FK reference must be exactly one column with the correct type &#x27;column_name&#x27;<a class="hash-link" href="#cql0028-fk-reference-must-be-exactly-one-column-with-the-correct-type-column_name" title="Direct link to heading">​</a></h3><p>When a foreign key is specified in the column definition it is the entire foreign key.  That means the references part of the declaration can only be for that one column.
If you need more columns, you have to declare the foreign key independently.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0029-autoincrement-column-must-be-long_integer-primary-key-column-name">CQL0029: autoincrement column must be <!-- -->[LONG_]<!-- -->INTEGER PRIMARY KEY &#x27;column name&#x27;<a class="hash-link" href="#cql0029-autoincrement-column-must-be-long_integer-primary-key-column-name" title="Direct link to heading">​</a></h3><p>SQLite is very fussy about autoincrement columns.  The column in question must be either a LONG INTEGER or an INTEGER and it must be PRIMARY KEY.
In fact, CQL will rewrite LONG INTEGER into INTEGER because only that exact form is supported, but SQLite INTEGERs can hold LONG values so that&#x27;s ok.
Any other autoincrement form results in this error.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0030-a-column-attribute-was-specified-twice-on-the-same-column-column_name">CQL0030: a column attribute was specified twice on the same column &#x27;column_name&#x27;<a class="hash-link" href="#cql0030-a-column-attribute-was-specified-twice-on-the-same-column-column_name" title="Direct link to heading">​</a></h3><p>This error indicates a pattern like &quot;id text not null not null&quot; was found.
The same attribute shouldn&#x27;t appear twice.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0031-column-cant-be-primary-key-and-also-unique-key-column">CQL0031: column can&#x27;t be primary key and also unique key &#x27;column&#x27;<a class="hash-link" href="#cql0031-column-cant-be-primary-key-and-also-unique-key-column" title="Direct link to heading">​</a></h3><p>In a column definition, the column can only be marked with at most one of PRIMARY KEY or UNIQUE</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0032-created-columns-must-be-at-the-end-and-must-be-in-version-order-column">CQL0032: created columns must be at the end and must be in version order&quot;, &#x27;column&#x27;<a class="hash-link" href="#cql0032-created-columns-must-be-at-the-end-and-must-be-in-version-order-column" title="Direct link to heading">​</a></h3><p>The SQLite ALTER TABLE ADD COLUMN statement is used to add new columns to the schema.  This statement puts the columns at the end of the table.
In order to make the CQL schema align as closely as possible to the actual sqlite schema you will get you are required to add
columns where SQLite will put them.  This will help a lot if you ever connect to such a database and start doing <code>select * from &lt;somewhere with creates&gt;</code></p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0033-columns-in-a-table-marked-recreate-cannot-have-create-or-delete-column">CQL0033: columns in a table marked @recreate cannot have @create or <code>@delete</code>, &#x27;column&#x27;<a class="hash-link" href="#cql0033-columns-in-a-table-marked-recreate-cannot-have-create-or-delete-column" title="Direct link to heading">​</a></h3><p>If the table is using the <code>@recreate</code> plan then you can add and remove columns (and other things freely)  you don&#x27;t need to mark columns with <code>@create</code> or <code>@delete</code> just add/remove them.
This error prevents the build up of useless annotations.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0034-createdelete-version-numbers-can-only-be-applied-to-columns-that-are-nullable-or-have-a-default-value-column">CQL0034: create/delete version numbers can only be applied to columns that are nullable or have a default value &#x27;column&#x27;<a class="hash-link" href="#cql0034-createdelete-version-numbers-can-only-be-applied-to-columns-that-are-nullable-or-have-a-default-value-column" title="Direct link to heading">​</a></h3><p>Any new column added to a schema must have a default value or be nullable so that its initial state is clear
and so that all existing insert statements do not have to be updated to include it.  Either make the column
nullable or give it a default value.</p><p>Similarly, any column being deleted must be nullable or have a default value.  The column can&#x27;t actually be deleted
(not all versions of SQLite support this) so it will only be &quot;deprecated&quot;.  But if the column is not null and has no default
then it would be impossible to write a correct insert statement for the table with the deleted column.</p><p>As a consequence you can neither add nor remove columns that are not null and have no default.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0035-column-delete-version-cant-be--column-create-version-column">CQL0035: column delete version can&#x27;t be &lt;= column create version&quot;, &#x27;column&#x27;<a class="hash-link" href="#cql0035-column-delete-version-cant-be--column-create-version-column" title="Direct link to heading">​</a></h3><p>You can&#x27;t <code>@delete</code> a column in a version before it was even created.  Probably there is a typo in one or both of the versions.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0036-column-delete-version-cant-be--the-table-create-version-column">CQL0036: column delete version can&#x27;t be &lt;= the table create version &#x27;column&#x27;<a class="hash-link" href="#cql0036-column-delete-version-cant-be--the-table-create-version-column" title="Direct link to heading">​</a></h3><p>The indicated column is being deleted in a version that is before the table it is found in was even created.  Probably there is a typo in the delete version.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0037-column-delete-version-cant-be--the-table-delete-version">CQL0037: column delete version can&#x27;t be &gt;= the table delete version<a class="hash-link" href="#cql0037-column-delete-version-cant-be--the-table-delete-version" title="Direct link to heading">​</a></h3><p>The indicated column is being deleted in a version that is after the table has already been deleted.  This would be redundant.  Probably one or both have a typo in their delete version.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0038-column-create-version-cant-be--the-table-create-version-column">CQL0038: column create version can&#x27;t be <code>&lt;=</code> the table create version &#x27;column&#x27;<a class="hash-link" href="#cql0038-column-create-version-cant-be--the-table-create-version-column" title="Direct link to heading">​</a></h3><p>The indicated column is being created in a version that is before the table it is found in was even created.  Probably there is a typo in the delete version.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0039-column-create-version-cant-be--the-table-delete-version-column">CQL0039: column create version can&#x27;t be <code>&gt;=</code> the table delete version &#x27;column&#x27;<a class="hash-link" href="#cql0039-column-create-version-cant-be--the-table-delete-version-column" title="Direct link to heading">​</a></h3><p>The indicated column is being created in a version that that is after it has already been supposedly deleted.  Probably there is a typo in one or both of the version numbers.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0040-table-can-only-have-one-autoinc-column-column">CQL0040: table can only have one autoinc column &#x27;column&#x27;<a class="hash-link" href="#cql0040-table-can-only-have-one-autoinc-column-column" title="Direct link to heading">​</a></h3><p>The indicated column is the second column to be marked with AUTOINCREMENT in its table.  There can only be one such column.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0041-tables-cannot-have-object-columns-column">CQL0041: tables cannot have object columns &#x27;column&#x27;<a class="hash-link" href="#cql0041-tables-cannot-have-object-columns-column" title="Direct link to heading">​</a></h3><p>The OBJECT data type is only for use in parameters and local variables.  SQLite has no storage for object references.
The valid data types include <code>INTEGER</code>, <code>LONG INTEGER</code>, <code>REAL</code>, <code>BOOL</code>, <code>TEXT</code>, <code>BLOB</code></p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0042-left-operand-must-be-a-string-in-likematchglob">CQL0042: left operand must be a string in &#x27;LIKE/MATCH/GLOB&#x27;<a class="hash-link" href="#cql0042-left-operand-must-be-a-string-in-likematchglob" title="Direct link to heading">​</a></h3><p>The indicated operator can only be used to compare two strings.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0043-right-operand-must-be-a-string-in-likematchglob">CQL0043: right operand must be a string in &#x27;LIKE/MATCH/GLOB&#x27;<a class="hash-link" href="#cql0043-right-operand-must-be-a-string-in-likematchglob" title="Direct link to heading">​</a></h3><p>The indicated operator can only be used to compare two strings.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0044-operator-may-only-appear-in-the-context-of-a-sql-statement-match">CQL0044: operator may only appear in the context of a SQL statement &#x27;MATCH&#x27;<a class="hash-link" href="#cql0044-operator-may-only-appear-in-the-context-of-a-sql-statement-match" title="Direct link to heading">​</a></h3><p>The MATCH operator is a complex sqlite primitive.  It can only appear within SQL expressions.
See the CQL documentation about it being a two-headed-beast when it comes to expression evaluation.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0045-blob-operand-not-allowed-in-operator">CQL0045: blob operand not allowed in &#x27;operator&#x27;<a class="hash-link" href="#cql0045-blob-operand-not-allowed-in-operator" title="Direct link to heading">​</a></h3><p>None of the unary math operators e.g. &#x27;-&#x27; and &#x27;~&#x27; allow blobs as an operand.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0046-object-operand-not-allowed-in-operator">CQL0046: object operand not allowed in &#x27;operator&#x27;<a class="hash-link" href="#cql0046-object-operand-not-allowed-in-operator" title="Direct link to heading">​</a></h3><p>None of the unary math operators e.g. &#x27;-&#x27; and &#x27;~&#x27; allow objects as an operand.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0047-string-operand-not-allowed-in-operator">CQL0047: string operand not allowed in &#x27;operator&#x27;<a class="hash-link" href="#cql0047-string-operand-not-allowed-in-operator" title="Direct link to heading">​</a></h3><p>None of the unary math operators e.g. &#x27;-&#x27; and &#x27;~&#x27; allow strings as an operand.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0051-argument-can-only-be-used-in-count-">CQL0051: argument can only be used in count(<em>) &#x27;</em>&#x27;<a class="hash-link" href="#cql0051-argument-can-only-be-used-in-count-" title="Direct link to heading">​</a></h3><p>The &#x27;<em>&#x27; special operator can only appear in the COUNT function.
e.g. `select count(</em>) from some_table`
It is not a valid function argument in any other context.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0052-select--cannot-be-used-with-no-from-clause">CQL0052: select * cannot be used with no FROM clause<a class="hash-link" href="#cql0052-select--cannot-be-used-with-no-from-clause" title="Direct link to heading">​</a></h3><p>Select statements of the form <code>select 1, &#x27;foo&#x27;;</code> are <code>valid but select &#x27;*&#x27;;</code> is not.
The <code>*</code> shortcut for columns only makes sense if there is something to select from.
e.g. <code>select * from some_table;</code> is valid.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0053-select-table-cannot-be-used-with-no-from-clause">CQL0053: select <!-- -->[table]<!-- -->.* cannot be used with no FROM clause<a class="hash-link" href="#cql0053-select-table-cannot-be-used-with-no-from-clause" title="Direct link to heading">​</a></h3><p>Select statements of the form <code>select 1, &#x27;foo&#x27;;</code> are <code>valid but select &#x27;T.*&#x27;;</code> is not.
The <code>T.*</code> shortcut for all the columns from table T only makes sense if there is
something to select form.
e.g. <code>select T.* from some_table T;</code> is valid.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0054-table-not-found-table">CQL0054: table not found &#x27;table&#x27;<a class="hash-link" href="#cql0054-table-not-found-table" title="Direct link to heading">​</a></h3><p>The indicated table was used in a select statement like <code>select T.* from ...</code> but no such table was present in the <code>FROM</code> clause.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0055-all-columns-in-the-select-must-have-a-name">CQL0055: all columns in the select must have a name<a class="hash-link" href="#cql0055-all-columns-in-the-select-must-have-a-name" title="Direct link to heading">​</a></h3><p>Referring to the select statement on the failing line, that select statement was used in a context where all the columns must have a name.
Examples include defining a view, a cursor, or creating a result set from a procedure.  The failing code might look something like this.
<code>select 1, 2 B;</code>  it needs to look like this <code>select 1 A, 2 B</code>;</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0056-null-expression-has-no-type-to-imply-a-needed-type-variable">CQL0056: NULL expression has no type to imply a needed type &#x27;variable&#x27;<a class="hash-link" href="#cql0056-null-expression-has-no-type-to-imply-a-needed-type-variable" title="Direct link to heading">​</a></h3><p>In some contexts the type of a constant is used to imply the type of the expression.  The NULL literal cannot be used in such contexts
because it has no specific type.</p><p>In a SELECT statement the NULL literal has no type.  If the type of the column cannot be inferred then it must be declared specifically.</p><p>In a  LET statement, the same situation arises  <code>LET x := NULL;</code>  doesn&#x27;t specify what type &#x27;x&#x27; is to be.</p><p>You can fix this error by changing the <code>NULL</code> to something like <code>CAST(NULL as TEXT)</code>.</p><p>A common place this problem happens is in defining a view or returning a result set from a stored procedure.  In those cases
all the columns must have a name and a type.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0057-if-multiple-selects-all-must-have-the-same-column-count">CQL0057: if multiple selects, all must have the same column count<a class="hash-link" href="#cql0057-if-multiple-selects-all-must-have-the-same-column-count" title="Direct link to heading">​</a></h3><p>If a stored procedure might return one of several result sets, each of the select statements it might return must have the same number of columns.
Likewise, if several select results are being combined with <code>UNION</code> or <code>UNION ALL</code> they must all have the same number of columns.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0058-if-multiple-selects-all-column-names-must-be-identical-so-they-have-unambiguous-names-error-in-column-n-x-vs-y">CQL0058: if multiple selects, all column names must be identical so they have unambiguous names; error in column N: &#x27;X&#x27; vs. &#x27;Y&#x27;<a class="hash-link" href="#cql0058-if-multiple-selects-all-column-names-must-be-identical-so-they-have-unambiguous-names-error-in-column-n-x-vs-y" title="Direct link to heading">​</a></h3><p>If a stored procedure might return one of several result sets, each of the select statements must have the same column names for its result.
Likewise, if several select results are being combined with <code>UNION</code> or <code>UNION ALL</code> they must all have the same column names.</p><p>This is important so that there can be one unambiguous column name for every column for group of select statements.</p><p>e.g.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> A</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> B</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">union</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"> A</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Would provoke this error.  In this case the error would report that the problem was in column 2 and that error was &#x27;B&#x27; vs. &#x27;C&#x27;</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0059-a-variable-name-might-be-ambiguous-with-a-column-name-this-is-an-anti-pattern-name">CQL0059: a variable name might be ambiguous with a column name, this is an anti-pattern &#x27;name&#x27;<a class="hash-link" href="#cql0059-a-variable-name-might-be-ambiguous-with-a-column-name-this-is-an-anti-pattern-name" title="Direct link to heading">​</a></h3><p>The referenced name is the name of a local or a global in the same scope as the name of a column.  This can lead to surprising results as it is not clear which name takes priority (previously the variable did rather than the column, now it&#x27;s an error).</p><p>example:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- this is now an error, in all cases the argument would have been selected</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> id </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> bar T1 </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> T1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To correct this, rename the local/global.  Or else pick a more distinctive column name, but usually the local is the problem.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0060-referenced-table-can-be-independently-recreated-so-it-cannot-be-used-in-a-foreign-key-referenced_table">CQL0060: referenced table can be independently recreated so it cannot be used in a foreign key, &#x27;referenced_table&#x27;<a class="hash-link" href="#cql0060-referenced-table-can-be-independently-recreated-so-it-cannot-be-used-in-a-foreign-key-referenced_table" title="Direct link to heading">​</a></h3><p>The referenced table is marked recreate so it must be in the same recreate
group as the current table because the referenced table might be recreated away leaving all the
foreign key references in current table as orphans.</p><p>So we check the following:
If the referenced table is marked recreate then any of the following result in CQL0060</p><ul><li>the referenced table is in no group, OR</li><li>the containing table is not recreate at all (non-recreate table can&#x27;t reference recreate tables at all), OR</li><li>the containing table is in no recreate group (it&#x27;s recreate but not in any group so they might not rev together), OR</li><li>the recreate groups of the two tables are different (it&#x27;s in a recreate group but not same one so they my not rev together)</li></ul><p>The referenced table is a recreate table and one of the 4 above conditions was not met.  Either don&#x27;t reference it or
else put the current table and the referenced table into the same recreate group.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0061-if-multiple-selects-all-columns-must-be-an-exact-type-match-expected-expected_type-found-actual_type-column">CQL0061: if multiple selects, all columns must be an exact type match (expected expected_type; found actual_type) &#x27;column&#x27;<a class="hash-link" href="#cql0061-if-multiple-selects-all-columns-must-be-an-exact-type-match-expected-expected_type-found-actual_type-column" title="Direct link to heading">​</a></h3><p>In a stored proc with multiple possible selects providing the result, all of the columns of all the selects must be an exact type match.</p><p>e.g.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> x </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> A</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> B</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"> A</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">4.0</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Would provoke this error.  In this case &#x27;B&#x27; would be regarded as the offending column and the error is reported on the second B.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0062-if-multiple-selects-all-columns-must-be-an-exact-type-match-including-nullability-expected-expected_type-found-actual_type-column">CQL0062: if multiple selects, all columns must be an exact type match (including nullability) (expected expected_type; found actual_type) &#x27;column&#x27;<a class="hash-link" href="#cql0062-if-multiple-selects-all-columns-must-be-an-exact-type-match-including-nullability-expected-expected_type-found-actual_type-column" title="Direct link to heading">​</a></h3><p>In a stored proc with multiple possible selects providing the result, all of the columns of all the selects must be an exact type match.
This error indicates that the specified column differs by nullability.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0063-cant-mix-and-match-out-statement-with-selectcall-for-return-values-procedure_name">CQL0063: can&#x27;t mix and match out statement with select/call for return values &#x27;procedure_name&#x27;<a class="hash-link" href="#cql0063-cant-mix-and-match-out-statement-with-selectcall-for-return-values-procedure_name" title="Direct link to heading">​</a></h3><p>If the procedure is using SELECT to create a result set it cannot also use the OUT keyword
to create a one-row result set.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0064-object-variables-may-not-appear-in-the-context-of-a-sql-statement">CQL0064: object variables may not appear in the context of a SQL statement<a class="hash-link" href="#cql0064-object-variables-may-not-appear-in-the-context-of-a-sql-statement" title="Direct link to heading">​</a></h3><p>SQLite doesn&#x27;t understand object references, so that means you cannot try to use a variable or parameter of type object inside of a SQL statement.</p><p>e.g.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">X object</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> X </span><span class="token operator" style="color:rgb(137, 221, 255)">is</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this example X is an object parameter, but even to use X for an <code>is null</code> check in a select statement would require binding an object which is not possible.</p><p>On the other hand this compiles fine.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">X object</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> is_null </span><span class="token keyword" style="font-style:italic">bool</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> is_null :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> X </span><span class="token operator" style="color:rgb(137, 221, 255)">is</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This is another example of XQL being a two-headed beast.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0065-identifier-is-ambiguous-name">CQL0065: identifier is ambiguous &#x27;name&#x27;<a class="hash-link" href="#cql0065-identifier-is-ambiguous-name" title="Direct link to heading">​</a></h3><p>There is more than one variable/column with indicated name in equally near scopes.  The most common reason for this is that there are two column in a join with the same name and that name has not been qualified elsewhere.</p><p>e.g.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> A</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> A</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> T1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">INNER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">JOIN</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> A</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> T2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>There are two possible columns named <code>A</code>.  Fix this by using <code>T1.A</code> or <code>T2.A</code>.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0066-if-a-table-is-marked-recreate-its-indices-must-be-in-its-schema-region-index_name">CQL0066: if a table is marked <code>@recreate</code>, its indices must be in its schema region &#x27;index_name&#x27;<a class="hash-link" href="#cql0066-if-a-table-is-marked-recreate-its-indices-must-be-in-its-schema-region-index_name" title="Direct link to heading">​</a></h3><p>If a table is marked <code>@recreate</code> that means that when it changes it is dropped and created during schema maintenance.  Of course when it is dropped its indices are also dropped.  So the indices must also be recreated when the table changes.  So with such a table it makes no sense to have indices that are in a different schema region.  This can only work if they are all always visible together.</p><p>Tables on the <code>@create</code> plan are not dropped so their indices can be maintained separately.  So they get a little extra flexibility.</p><p>To fix this error move the offending index into the same schema region as the table.  And probably put them physically close for maintenance sanity.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0067-cursor-was-not-used-with-fetch-cursor--cursor_name">CQL0067: cursor was not used with &#x27;fetch <!-- -->[cursor]<!-- -->&#x27;  &#x27;cursor_name&#x27;<a class="hash-link" href="#cql0067-cursor-was-not-used-with-fetch-cursor--cursor_name" title="Direct link to heading">​</a></h3><p>The code is trying to access fields in the named cursor but the automatic field generation form was not used so there are no such fields.</p><p>e.g.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> a </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> b </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> A</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- C.A and C.B not created (!)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">A</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- error</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Correct usage looks like this:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> A</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- automatically creates C.A and C.B</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">A</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0068-field-not-found-in-cursor-field">CQL0068: field not found in cursor &#x27;field&#x27;<a class="hash-link" href="#cql0068-field-not-found-in-cursor-field" title="Direct link to heading">​</a></h3><p>The indicated field is not a valid field in a cursor expression.</p><p>e.g.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> A</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- automatically creates C.A and C.B</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">X</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- C has A and B, but no X</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0069-name-not-found-name">CQL0069: name not found &#x27;name&#x27;<a class="hash-link" href="#cql0069-name-not-found-name" title="Direct link to heading">​</a></h3><p>The indicated name could not be resolved in the scope in which it appears.
Probably there is a typo.  But maybe the name you need isn&#x27;t available in
the scope you are trying to use it in.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0070-incompatible-object-type-incompatible_type">CQL0070: incompatible object type &#x27;incompatible_type&#x27;<a class="hash-link" href="#cql0070-incompatible-object-type-incompatible_type" title="Direct link to heading">​</a></h3><p>Two expressions of type object are holding a different object type e.g.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> x object</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">Foo</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> y object</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">Bar</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> x :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here the message would report that &#x27;Bar&#x27; is incompatible. The message generally
refers to the 2nd object type as the first one was ok by default then the
second one caused the problem.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0071-first-operand-cannot-be-a-blob-in-betweennot-between">CQL0071: first operand cannot be a blob in &#x27;BETWEEN/NOT BETWEEN&#x27;<a class="hash-link" href="#cql0071-first-operand-cannot-be-a-blob-in-betweennot-between" title="Direct link to heading">​</a></h3><p>The BETWEEN operator works on numerics and strings only.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0072-first-operand-cannot-be-a-blob-in-betweennot-between">CQL0072: first operand cannot be a blob in &#x27;BETWEEN/NOT BETWEEN&#x27;<a class="hash-link" href="#cql0072-first-operand-cannot-be-a-blob-in-betweennot-between" title="Direct link to heading">​</a></h3><p>The BETWEEN operator works on numerics and strings only.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0073-cast-may-only-appear-in-the-context-of-sql-statement">CQL0073: CAST may only appear in the context of SQL statement<a class="hash-link" href="#cql0073-cast-may-only-appear-in-the-context-of-sql-statement" title="Direct link to heading">​</a></h3><p>The CAST function does highly complex and subtle conversions, including date/time functions and other things.  It&#x27;s not possibly to emulate this accurately and there is no sqlite helper to do the job directly from a C call.  Consequently it&#x27;s only supported in the context of CQL statements.  It can be used in normal expressions by using the nested <code>SELECT</code> form <code>(select ...)</code></p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0074-too-few-arguments-provided-coalesce">CQL0074: too few arguments provided &#x27;coalesce&#x27;<a class="hash-link" href="#cql0074-too-few-arguments-provided-coalesce" title="Direct link to heading">​</a></h3><p>There must be at least two arguments in a call to <code>coalesce</code>.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0075-incorrect-number-of-arguments-ifnull">CQL0075: incorrect number of arguments &#x27;ifnull&#x27;<a class="hash-link" href="#cql0075-incorrect-number-of-arguments-ifnull" title="Direct link to heading">​</a></h3><p>The  <code>ifnull</code> function requires exactly two arguments.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0076-null-literal-is-useless-in-function-ifnullcoalesce">CQL0076: NULL literal is useless in function &#x27;ifnull/coalesce&#x27;<a class="hash-link" href="#cql0076-null-literal-is-useless-in-function-ifnullcoalesce" title="Direct link to heading">​</a></h3><p>Adding a NULL literal to <code>IFNULL</code> or <code>COALESCE</code> is a no-op.  It&#x27;s most likely an error.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0077-encountered-arg-known-to-be-not-null-before-the-end-of-the-list-rendering-the-rest-useless-expression">CQL0077: encountered arg known to be not null before the end of the list, rendering the rest useless &#x27;expression&#x27;<a class="hash-link" href="#cql0077-encountered-arg-known-to-be-not-null-before-the-end-of-the-list-rendering-the-rest-useless-expression" title="Direct link to heading">​</a></h3><p>In an <code>IFNULL</code> or <code>COALESCE</code> call, only the last argument may be known to be not null.  If a not null argument comes earlier in the list, then none of the others could ever be used.  That is almost certainly an error.  The
most egregious form of this error is if the first argument is known to be not null in which case the entire
<code>IFNULL</code> or <code>COALESCE</code> can be removed.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0078-not-in-select--is-only-allowed-inside-of-select-lists-where-on-and-having-clauses">CQL0078: <!-- -->[not]<!-- --> in (select ...) is only allowed inside of select lists, where, on, and having clauses<a class="hash-link" href="#cql0078-not-in-select--is-only-allowed-inside-of-select-lists-where-on-and-having-clauses" title="Direct link to heading">​</a></h3><p>The (select...) option for <code>IN</code> or <code>NOT IN</code> only makes sense in certain expression contexts.    Other uses are most likely errors.  It cannot appear in a loose expression because it fundamentally requires sqlite to process it.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0079-function-got-incorrect-number-of-arguments-name">CQL0079: function got incorrect number of arguments &#x27;name&#x27;<a class="hash-link" href="#cql0079-function-got-incorrect-number-of-arguments-name" title="Direct link to heading">​</a></h3><p>The indicated function was called with the wrong number of arguments.  There are various functions supported each with different rules.  See the SQLite documentation for more information about the specified function.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0080-function-may-not-appear-in-this-context-name">CQL0080: function may not appear in this context &#x27;name&#x27;<a class="hash-link" href="#cql0080-function-may-not-appear-in-this-context-name" title="Direct link to heading">​</a></h3><p>Many functions can only appear in certain contexts.  For instance most aggregate functions are limited to the select list or the HAVING clause.  They cannot appear in, for instance, a WHERE, or ON clause.  The particulars vary by function.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0081-aggregates-only-make-sense-if-there-is-a-from-clause-name">CQL0081: aggregates only make sense if there is a FROM clause &#x27;name&#x27;<a class="hash-link" href="#cql0081-aggregates-only-make-sense-if-there-is-a-from-clause-name" title="Direct link to heading">​</a></h3><p>The indicated aggregate function was used in a select statement with no tables.  For instance</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">MAX</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">7</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Doesn&#x27;t make any sense.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0082-argument-must-be-numeric-average">CQL0082: argument must be numeric &#x27;AVERAGE&#x27;<a class="hash-link" href="#cql0082-argument-must-be-numeric-average" title="Direct link to heading">​</a></h3><p>The argument of AVERAGE must be numeric.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0083-argument-must-be-numeric-sum">CQL0083: argument must be numeric &#x27;SUM&#x27;<a class="hash-link" href="#cql0083-argument-must-be-numeric-sum" title="Direct link to heading">​</a></h3><p>The argument of SUM must be numeric.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0084-second-argument-must-be-a-string-in-function-group_concat">CQL0084: second argument must be a string in function &#x27;group_concat&#x27;<a class="hash-link" href="#cql0084-second-argument-must-be-a-string-in-function-group_concat" title="Direct link to heading">​</a></h3><p>The second argument of group_concat is the separator, it must be a string.  The first argument will be converted to a string.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0085-all-arguments-must-be-strings-strftime">CQL0085: all arguments must be strings &#x27;strftime&#x27;<a class="hash-link" href="#cql0085-all-arguments-must-be-strings-strftime" title="Direct link to heading">​</a></h3><p>The <code>strftime</code> function does complex data formatting.  All the arguments are strings.  See the sqlite documentation for more details on the options (there are many).</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0086-first-argument-must-be-a-string-in-function-function">CQL0086: first argument must be a string in function &#x27;function&#x27;<a class="hash-link" href="#cql0086-first-argument-must-be-a-string-in-function-function" title="Direct link to heading">​</a></h3><p>The first argument of the function is the formatting string.  The other arguments are variable and many complex conversions will apply.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0087-first-argument-must-be-of-type-real-function">CQL0087: first argument must be of type real &#x27;function&#x27;<a class="hash-link" href="#cql0087-first-argument-must-be-of-type-real-function" title="Direct link to heading">​</a></h3><p>The first argument of the function (e.g. round) should be of type &#x27;real&#x27;.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0088-user-function-may-not-appear-in-the-context-of-a-sql-statement-function_name">CQL0088: user function may not appear in the context of a SQL statement &#x27;function_name&#x27;<a class="hash-link" href="#cql0088-user-function-may-not-appear-in-the-context-of-a-sql-statement-function_name" title="Direct link to heading">​</a></h3><p>External C functions declared with <code>declare function ...</code> are not for use in sqlite.  They may not appear inside statements.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0089-user-function-may-only-appear-in-the-context-of-a-sql-statement-function_name">CQL0089: user function may only appear in the context of a SQL statement &#x27;function_name&#x27;<a class="hash-link" href="#cql0089-user-function-may-only-appear-in-the-context-of-a-sql-statement-function_name" title="Direct link to heading">​</a></h3><p>SQLite user defined functions (or builtins) declared with  <code>declare select function</code> may only appear inside of sql statements.  In the case of user defined functions they must be added to sqlite by the appropriate C APIs before they can be used in CQL stored procs (or any other context really).   See the sqlite documentation on how to add user defined functions. <a href="http://www.sqlite.org/c3ref/create_function.html" target="_blank" rel="noopener noreferrer">Create Or Redefine SQL Functions</a></p><hr><p>CQL0090: -- more specific errors are now generated</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0091-stored-procs-that-deal-with-result-sets-or-cursors-cannot-be-invoked-as-functions-name">CQL0091: stored procs that deal with result sets or cursors cannot be invoked as functions &#x27;name&#x27;<a class="hash-link" href="#cql0091-stored-procs-that-deal-with-result-sets-or-cursors-cannot-be-invoked-as-functions-name" title="Direct link to heading">​</a></h3><p>The function syntax for procs cannot be used on procedures that return a result set.  Such procedures already have a result and it isn&#x27;t even a scalar result.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0092-raise-may-only-be-used-in-a-trigger-statement">CQL0092: RAISE may only be used in a trigger statement<a class="hash-link" href="#cql0092-raise-may-only-be-used-in-a-trigger-statement" title="Direct link to heading">​</a></h3><p>SQLite only supports this kind of control flow in the context of triggers, certain trigger predicates might need to unconditionally fail and complex logic can be implemented in this way.  However this sort of thing is not really recommended.  In any case this is not a general purpose construct.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0093-raise-2nd-argument-must-be-a-string">CQL0093: RAISE 2nd argument must be a string<a class="hash-link" href="#cql0093-raise-2nd-argument-must-be-a-string" title="Direct link to heading">​</a></h3><p>Only forms with a string as the second argument are supported by SQLite.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0094-function-not-yet-implemented-function">CQL0094: function not yet implemented &#x27;function&#x27;<a class="hash-link" href="#cql0094-function-not-yet-implemented-function" title="Direct link to heading">​</a></h3><p>The indicated function is not implemented in CQL.  Possibly you intended to declare it with <code>declare function</code> as an external function or <code>declare select function</code> as a sqlite builtin.  Note not all sqlite builtins are automatically declared.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0095-tableview-not-defined-name">CQL0095: table/view not defined &#x27;name&#x27;<a class="hash-link" href="#cql0095-tableview-not-defined-name" title="Direct link to heading">​</a></h3><p>The indicated name is neither a table nor a view.  It is possible that the table/view is now deprecated with <code>@delete</code> and therefore will appear to not exist in the current context.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0096-join-using-column-not-found-on-the-left-side-of-the-join-column_name">CQL0096: join using column not found on the left side of the join &#x27;column_name&#x27;<a class="hash-link" href="#cql0096-join-using-column-not-found-on-the-left-side-of-the-join-column_name" title="Direct link to heading">​</a></h3><p>In the <code>JOIN ... USING(x,y,z)</code> form, all the columns in the using clause must appear on both sides of the join.  Here the indicated name is not present on the left side of the join.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0097-join-using-column-not-found-on-the-right-side-of-the-join-column_name">CQL0097: join using column not found on the right side of the join &#x27;column_name&#x27;<a class="hash-link" href="#cql0097-join-using-column-not-found-on-the-right-side-of-the-join-column_name" title="Direct link to heading">​</a></h3><p>In the <code>JOIN ... USING(x,y,z)</code> form, all the columns in the using clause must appear on both sides of the join.  Here the indicated name is not present on the right side of the join.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0098-leftright-column-types-in-join-using-do-not-match-exactly-column_name">CQL0098: left/right column types in join USING(...) do not match exactly &#x27;column_name&#x27;<a class="hash-link" href="#cql0098-leftright-column-types-in-join-using-do-not-match-exactly-column_name" title="Direct link to heading">​</a></h3><p>In the <code>JOIN ... USING(x,y,z)</code> form, all the columns in the using clause must appear on both sides of the join and have the same data type.  Here the data types differ in the named column.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0099-having-clause-requires-group-by-clause">CQL0099: HAVING clause requires GROUP BY clause<a class="hash-link" href="#cql0099-having-clause-requires-group-by-clause" title="Direct link to heading">​</a></h3><p>The <code>HAVING</code> clause makes no sense unless there is also a <code>GROUP BY</code> clause.  SQLite enforces this as does CQL.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0100-duplicate-common-table-name-name">CQL0100: duplicate common table name &#x27;name&#x27;<a class="hash-link" href="#cql0100-duplicate-common-table-name-name" title="Direct link to heading">​</a></h3><p>In a <code>WITH</code> clause, the indicated common table name was defined more than once.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0101-too-few-column-names-specified-in-common-table-expression-name">CQL0101: too few column names specified in common table expression &#x27;name&#x27;<a class="hash-link" href="#cql0101-too-few-column-names-specified-in-common-table-expression-name" title="Direct link to heading">​</a></h3><p>In a <code>WITH</code> clause the indicated common table expression doesn&#x27;t include enough column names to capture the result of the <code>select</code> statement it is associated with.</p><p>e.g.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">WITH</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> A</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">`</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The select statement produces two columns the <code>foo</code> declaration specifies one.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0102-too-many-column-names-specified-in-common-table-expression-name">CQL0102: too many column names specified in common table expression &#x27;name&#x27;<a class="hash-link" href="#cql0102-too-many-column-names-specified-in-common-table-expression-name" title="Direct link to heading">​</a></h3><p>In a <code>WITH</code> clause the indicated common table expression has more  column names than the <code>select</code> expression it is associated with.</p><p>e.g.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">WITH</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">`</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The select statement produces one column the <code>foo</code> declaration specifies two.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0103-duplicate-tableview-name-name">CQL0103: duplicate table/view name &#x27;name&#x27;<a class="hash-link" href="#cql0103-duplicate-tableview-name-name" title="Direct link to heading">​</a></h3><p>The indicated table or view must be unique in its context.  The version at the indicated line number is a duplicate of a previous declaration.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0104-view-was-present-but-now-it-does-not-exist-use-delete-instead-name">CQL0104: view was present but now it does not exist (use <code>@delete</code> instead) &#x27;name&#x27;<a class="hash-link" href="#cql0104-view-was-present-but-now-it-does-not-exist-use-delete-instead-name" title="Direct link to heading">​</a></h3><p>During schema validation, CQL found a view that used to exist but is now totally gone.  The correct procedure is to mark the view with <code>@delete</code> (you can also make it stub with the same name to save a little space).  This is necessary so that CQL can know what views should be deleted on client devices during an upgrade.  If the view is eradicated totally there would be no way to know that the view should be deleted if it exists.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0105-object-was-a-view-but-is-now-a-table-name">CQL0105: object was a view but is now a table &#x27;name&#x27;<a class="hash-link" href="#cql0105-object-was-a-view-but-is-now-a-table-name" title="Direct link to heading">​</a></h3><p>Converting a view into a table, or otherwise creating a table with the same name as a view is not legal.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0106-trigger-was-present-but-now-it-does-not-exist-use-delete-instead-name">CQL0106: trigger was present but now it does not exist (use <code>@delete</code> instead) &#x27;name&#x27;<a class="hash-link" href="#cql0106-trigger-was-present-but-now-it-does-not-exist-use-delete-instead-name" title="Direct link to heading">​</a></h3><p>During schema validation, CQL found a trigger that used to exist but is now totally gone.  The correct procedure is to mark the trigger with <code>@delete</code> (you can also make it stub with the same name to save a little space).  This is necessary so that CQL can know what triggers should be deleted on client devices during an upgrade.  If the trigger is eradicated totally there would be no way to know that the trigger should be deleted if it exists.  That would be bad.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0107-delete-version-cant-be--create-version-name">CQL0107: delete version can&#x27;t be &lt;= create version &#x27;name&#x27;<a class="hash-link" href="#cql0107-delete-version-cant-be--create-version-name" title="Direct link to heading">​</a></h3><p>Attempting to declare that an object has been deleted before it was created is an error.  Probably there is a typo in one or both of the version numbers of the named object.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0108-table-in-drop-statement-does-not-exist-table_name">CQL0108: table in drop statement does not exist &#x27;table_name&#x27;<a class="hash-link" href="#cql0108-table-in-drop-statement-does-not-exist-table_name" title="Direct link to heading">​</a></h3><p>The indicated table was not declared anywhere.  Note that CQL requires that you declare all tables you will work with, even if all you intend to do with the table is drop it.  When you put a <code>CREATE TABLE</code> statement in global scope this only declares a table, it doesn&#x27;t actually create the table. See the documentation on DDL for more information.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0109-cannot-drop-a-view-with-drop-table-view_name">CQL0109: cannot drop a view with drop table &#x27;view_name&#x27;<a class="hash-link" href="#cql0109-cannot-drop-a-view-with-drop-table-view_name" title="Direct link to heading">​</a></h3><p>The object named in a <code>DROP TABLE</code> statement must be a table, not a view.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0110-view-in-drop-statement-does-not-exist-view_name">CQL0110: view in drop statement does not exist &#x27;view_name&#x27;<a class="hash-link" href="#cql0110-view-in-drop-statement-does-not-exist-view_name" title="Direct link to heading">​</a></h3><p>The indicated view was not declared anywhere.  Note that CQL requires that you declare all views you will work with, even if all you intend to do with the view is drop it.  When you put a <code>CREATE VIEW</code> statement in global scope this only declares a view, it doesn&#x27;t actually create the view.  See the documentation on DDL for more information.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0111-cannot-drop-a-table-with-drop-view-name">CQL0111: cannot drop a table with drop view &#x27;name&#x27;<a class="hash-link" href="#cql0111-cannot-drop-a-table-with-drop-view-name" title="Direct link to heading">​</a></h3><p>The object named in a <code>DROP VIEW</code> statement must be a view, not a table.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0112-index-in-drop-statement-was-not-declared-index_name">CQL0112: index in drop statement was not declared &#x27;index_name&#x27;<a class="hash-link" href="#cql0112-index-in-drop-statement-was-not-declared-index_name" title="Direct link to heading">​</a></h3><p>The indicated index was not declared anywhere.  Note that CQL requires that you declare all indices you will work with, even if all you intend to do with the index is drop it.  When you put a <code>CREATE INDEX</code> statement in global scope this only declares an index, it doesn&#x27;t actually create the index.  See the documentation on DDL for more information.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0113-trigger-in-drop-statement-was-not-declared-name">CQL0113: trigger in drop statement was not declared &#x27;name&#x27;<a class="hash-link" href="#cql0113-trigger-in-drop-statement-was-not-declared-name" title="Direct link to heading">​</a></h3><p>The indicated trigger was not declared anywhere.  Note that CQL requires that you declare all triggers you will work with, even if all you intend to do with the trigger is drop it.  When you put a <code>CREATE TRIGGER</code> statement in global scope this only declares a trigger, it doesn&#x27;t actually create the trigger.  See the documentation on DDL for more information.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0114-current-schema-cant-go-back-to-recreate-semantics-for-table_name">CQL0114: current schema can&#x27;t go back to recreate semantics for &#x27;table_name&#x27;<a class="hash-link" href="#cql0114-current-schema-cant-go-back-to-recreate-semantics-for-table_name" title="Direct link to heading">​</a></h3><p>The indicated table was previously marked with <code>@create</code> indicating it has precious content and should be upgraded carefully.  The current schema marks the same table with <code>@recreate</code> meaning it has discardable content and should be upgraded by dropping it and recreating it.  This transition is not allowed.  If the table really is non-precious now you can mark it with <code>@delete</code> and then make a new similar table with <code>@recreate</code>.  This really shouldn&#x27;t happen very often if at all.  Probably the error is due to a typo or wishful thinking.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0115-current-create-version-not-equal-to-previous-create-version-for-table">CQL0115: current create version not equal to previous create version for &#x27;table&#x27;<a class="hash-link" href="#cql0115-current-create-version-not-equal-to-previous-create-version-for-table" title="Direct link to heading">​</a></h3><p>The indicated table was previously marked with <code>@create</code> at some version (x) and now it is being created at some different version (y !=x ).  This not allowed (if it were then objects might be created in the wrong/different order during upgrade which would cause all kinds of problems).</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0116-current-delete-version-not-equal-to-previous-delete-version-for-table">CQL0116: current delete version not equal to previous delete version for &#x27;table&#x27;<a class="hash-link" href="#cql0116-current-delete-version-not-equal-to-previous-delete-version-for-table" title="Direct link to heading">​</a></h3><p>The indicated table was previously marked with <code>@delete</code> at some version (x) and now it is being deleted at some different version (y != x).  This not allowed (if it were then objects might be deleted in the wrong/different order during upgrade which would cause all kinds of problems).</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0117-delete-procedure-changed-in-object-table_name">CQL0117: <code>@delete</code> procedure changed in object &#x27;table_name&#x27;<a class="hash-link" href="#cql0117-delete-procedure-changed-in-object-table_name" title="Direct link to heading">​</a></h3><p>The <code>@delete</code> attribute can optional include a &quot;migration proc&quot; that is run when the upgrade happens.  Once set, this proc can never be changed.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0118-create-procedure-changed-in-object-table_name">CQL0118: <code>@create</code> procedure changed in object &#x27;table_name&#x27;<a class="hash-link" href="#cql0118-create-procedure-changed-in-object-table_name" title="Direct link to heading">​</a></h3><p>The <code>@create</code> attribute can optional include a &quot;migration proc&quot; that is run when the upgrade happens.  Once set, this proc can never be changed.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0119-column-name-is-different-between-previous-and-current-schema-name">CQL0119: column name is different between previous and current schema &#x27;name&#x27;<a class="hash-link" href="#cql0119-column-name-is-different-between-previous-and-current-schema-name" title="Direct link to heading">​</a></h3><p>Since there is no sqlite operation that allows for columns to be renamed, attempting to rename a column is not allowed.</p><p>NOTE: you can also get this error if you remove a column entirely, or add a column in the middle of the list somewhere.</p><p>Since columns (also) cannot be reordered during upgrade, CQL expects to find all the columns in exactly the same order in the previous and new schema.  Any reordering, or deletion could easily look like an erroneous rename.  New columns must appear at the end of any existing columns.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0120-column-type-is-different-between-previous-and-current-schema-name">CQL0120: column type is different between previous and current schema &#x27;name&#x27;<a class="hash-link" href="#cql0120-column-type-is-different-between-previous-and-current-schema-name" title="Direct link to heading">​</a></h3><p>It is not possible to change the data type of a column during an upgrade, SQLite provides no such options.  Attempting to do so results in an error.  This includes nullability.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0121-column-current-create-version-not-equal-to-previous-create-version-name">CQL0121: column current create version not equal to previous create version &#x27;name&#x27;<a class="hash-link" href="#cql0121-column-current-create-version-not-equal-to-previous-create-version-name" title="Direct link to heading">​</a></h3><p>The indicated column was previously marked with <code>@create</code> at some version (x) and now it is being created at some different version (y !=x ).  This not allowed (if it were then objects might be created in the wrong/different order during upgrade which would cause all kinds of problems).</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0122-column-current-delete-version-not-equal-to-previous-delete-version-name">CQL0122: column current delete version not equal to previous delete version &#x27;name&#x27;<a class="hash-link" href="#cql0122-column-current-delete-version-not-equal-to-previous-delete-version-name" title="Direct link to heading">​</a></h3><p>The indicated column was previously marked with <code>@delete</code> at some version (x) and now it is being deleted at some different version (y != x).  This not allowed (if it were then objects might be deleted in the wrong/different order during upgrade which would cause all kinds of problems).</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0123-column-delete-procedure-changed-name">CQL0123: column <code>@delete</code> procedure changed &#x27;name&#x27;<a class="hash-link" href="#cql0123-column-delete-procedure-changed-name" title="Direct link to heading">​</a></h3><p>The <code>@delete</code> attribute can optional include a &quot;migration proc&quot; that is run when the upgrade happens.  Once set, this proc can never be changed.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0124-column-create-procedure-changed-name">CQL0124: column <code>@create</code> procedure changed &#x27;name&#x27;<a class="hash-link" href="#cql0124-column-create-procedure-changed-name" title="Direct link to heading">​</a></h3><p>The <code>@create</code> attribute can optional include a &quot;migration proc&quot; that is run when the upgrade happens.  Once set, this proc can never be changed.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0125-column-current-default-value-not-equal-to-previous-default-value-column">CQL0125: column current default value not equal to previous default value &#x27;column&#x27;<a class="hash-link" href="#cql0125-column-current-default-value-not-equal-to-previous-default-value-column" title="Direct link to heading">​</a></h3><p>The default value of a column may not be changed in later versions of the schema.  There is no SQLite operation that would allow this.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0126-table-was-present-but-now-it-does-not-exist-use-delete-instead-table">CQL0126: table was present but now it does not exist (use <code>@delete</code> instead) &#x27;table&#x27;<a class="hash-link" href="#cql0126-table-was-present-but-now-it-does-not-exist-use-delete-instead-table" title="Direct link to heading">​</a></h3><p>During schema validation, CQL found a table that used to exist but is now totally gone.  The correct procedure is to mark the table with <code>@delete</code>.  This is necessary so that CQL can know what tables should be deleted on client devices during an upgrade.  If the table is eradicated totally there would be no way to know that the table should be deleted if it exists.  That would be bad.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0127-object-was-a-table-but-is-now-a-view-name">CQL0127: object was a table but is now a view &#x27;name&#x27;<a class="hash-link" href="#cql0127-object-was-a-table-but-is-now-a-view-name" title="Direct link to heading">​</a></h3><p>The indicated object was a table in the previous schema but is now a view in the current schema.  This transformation is not allowed.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0128-table-has-a-column-that-is-different-in-the-previous-and-current-schema-column">CQL0128: table has a column that is different in the previous and current schema &#x27;column&#x27;<a class="hash-link" href="#cql0128-table-has-a-column-that-is-different-in-the-previous-and-current-schema-column" title="Direct link to heading">​</a></h3><p>The indicated column changed in one of its more exotic attributes, examples:</p><ul><li>its <code>FOREIGN KEY</code> rules changed in some way</li><li>its <code>PRIMARY KEY</code> status changed</li><li>its <code>UNIQUE</code> status changed</li></ul><p>Basically the long form description of the column is now different and it isn&#x27;t different in one of the usual way like type or default value.  This error is the catch all for all the other ways a column could change such as &quot;the FK rule for what happens when an update fk violation occurs is now different&quot; -- there are dozens of such errors and they aren&#x27;t very helpful anyway.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0129-a-column-was-removed-from-the-table-rather-than-marked-with-delete-column_name">CQL0129: a column was removed from the table rather than marked with <code>@delete</code> &#x27;column_name&#x27;<a class="hash-link" href="#cql0129-a-column-was-removed-from-the-table-rather-than-marked-with-delete-column_name" title="Direct link to heading">​</a></h3><p>During schema validation, CQL found a column that used to exist but is now totally gone.  The correct procedure is to mark the column with <code>@delete</code>.  This is necessary so that CQL can know what columns existed during any version of the schema, thereby allowing them to be used in migration scripts during an upgrade.  If the column is eradicated totally there would be no way to know that the exists, and should no longer be used.  That would be bad.</p><p>Of course <code>@recreate</code> tables will never get this error because they can be altered at whim.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0130-table-has-columns-added-without-marking-them-create-column_name">CQL0130: table has columns added without marking them <code>@create</code> &#x27;column_name&#x27;<a class="hash-link" href="#cql0130-table-has-columns-added-without-marking-them-create-column_name" title="Direct link to heading">​</a></h3><p>The indicated column was added but it was not marked with <code>@create</code>.  The table in question is not on the <code>@recreate</code> plan so this is an error.  Add a suitable <code>@create</code> annotation to the column declaration.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0131-table-has-newly-added-columns-that-are-marked-both-create-and-delete-column_name">CQL0131: table has newly added columns that are marked both <code>@create</code> and <code>@delete</code> &#x27;column_name&#x27;<a class="hash-link" href="#cql0131-table-has-newly-added-columns-that-are-marked-both-create-and-delete-column_name" title="Direct link to heading">​</a></h3><p>The indicated column was simultaneously marked <code>@create</code> and <code>@delete</code>.  That&#x27;s surely some kind of typo.  Creating a column and deleting it in the same version is weird.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0132-table-has-a-facet-that-is-different-in-the-previous-and-current-schema-table_name">CQL0132: table has a facet that is different in the previous and current schema &#x27;table_name&#x27;<a class="hash-link" href="#cql0132-table-has-a-facet-that-is-different-in-the-previous-and-current-schema-table_name" title="Direct link to heading">​</a></h3><p>The indicated table has changes in one of its non-column features.  These changes might be:</p><ul><li>a primary key declaration</li><li>a unique key declaration</li><li>a foreign key declaration</li></ul><p>None of these are allowed to change.  Of course <code>@recreate</code> tables will never get this error because they can be altered at whim.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0133-non-column-facets-have-been-removed-from-the-table-name">CQL0133: non-column facets have been removed from the table &#x27;name&#x27;<a class="hash-link" href="#cql0133-non-column-facets-have-been-removed-from-the-table-name" title="Direct link to heading">​</a></h3><p>The error indicates that the table has had some stuff removed from it.  The &quot;stuff&quot; might be:</p><ul><li>a primary key declaration</li><li>a unique key declaration</li><li>a foreign key declaration</li></ul><p>Since there is no way to change any of the constraints after the fact, they may not be changed at all if the table is on the <code>@create</code> plan.  Of course <code>@recreate</code> tables will never get this error because they can be altered at whim.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0134-table-has-a-new-non-column-facet-in-the-current-schema-table_name">CQL0134: table has a new non-column facet in the current schema &#x27;table_name&#x27;<a class="hash-link" href="#cql0134-table-has-a-new-non-column-facet-in-the-current-schema-table_name" title="Direct link to heading">​</a></h3><p>The error indicates that the table has had some stuff added to it.  The &quot;stuff&quot; might be:</p><ul><li>a primary key declaration</li><li>a unique key declaration</li><li>a foreign key declaration</li></ul><p>Since there is no way to change any of the constraints after the fact, they may not be changed at all if the table is on the <code>@create</code> plan.  Of course <code>@recreate</code> tables will never get this error because they can be altered at whim.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0135-table-create-statement-attributes-different-than-previous-version-table_name">CQL0135: table create statement attributes different than previous version &#x27;table_name&#x27;<a class="hash-link" href="#cql0135-table-create-statement-attributes-different-than-previous-version-table_name" title="Direct link to heading">​</a></h3><p>The &#x27;flags&#x27; on the <code>CREATE TABLE</code> statement changed between versions.  These flags capture the options like the<code>TEMP</code> in <code>CREATE TEMP TABLE</code> and the <code>IF NOT EXISTS</code>.   Changing these is not allowed.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0136-trigger-already-exists-trigger_name">CQL0136: trigger already exists &#x27;trigger_name&#x27;<a class="hash-link" href="#cql0136-trigger-already-exists-trigger_name" title="Direct link to heading">​</a></h3><p>Trigger names may not be duplicated.  Probably there is copy/pasta going on here.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0137-tableview-not-found-name">CQL0137: table/view not found &#x27;name&#x27;<a class="hash-link" href="#cql0137-tableview-not-found-name" title="Direct link to heading">​</a></h3><p>In a <code>CREATE TRIGGER</code> statement, the indicated name is neither a table or a view.  Either a table or
a view was expected in this context.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0138-a-trigger-on-a-view-must-be-the-instead-of-form-name">CQL0138: a trigger on a view must be the INSTEAD OF form &#x27;name&#x27;<a class="hash-link" href="#cql0138-a-trigger-on-a-view-must-be-the-instead-of-form-name" title="Direct link to heading">​</a></h3><p>In a <code>CREATE TRIGGER</code> statement, the named target of the trigger was a view but the trigger type is not <code>INSTEAD OF</code>.  Only <code>INSTEAD OF</code> can be applied to views because views are not directly mutable so none of the other types make sense.  e.g. there can be no delete operations, on a view, so <code>BEFORE DELETE</code> or <code>AFTER DELETE</code> are not really a thing.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0139-temp-objects-may-not-have-versioning-annotations-object_name">CQL0139: temp objects may not have versioning annotations &#x27;object_name&#x27;<a class="hash-link" href="#cql0139-temp-objects-may-not-have-versioning-annotations-object_name" title="Direct link to heading">​</a></h3><p>The indicated object is a temporary.  Since temporary  do not survive sessions it makes no sense to try to version them for schema upgrade.
They are always recreated on demand.  If you need to remove one, simply delete it entirely, it requires no tombstone.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0140-columns-in-a-temp-table-may-not-have-versioning-attributes-column_name">CQL0140: columns in a temp table may not have versioning attributes &#x27;column_name&#x27;<a class="hash-link" href="#cql0140-columns-in-a-temp-table-may-not-have-versioning-attributes-column_name" title="Direct link to heading">​</a></h3><p>The indicated column is part of a temporary table.  Since temp tables do not survive sessions it makes no sense to try to version their columns for schema upgrade.  They are always recreated on demand.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0141-table-has-an-autoincrement-column-it-cannot-also-be-without-rowid-table_name">CQL0141: table has an AUTOINCREMENT column; it cannot also be WITHOUT ROWID &#x27;table_name&#x27;<a class="hash-link" href="#cql0141-table-has-an-autoincrement-column-it-cannot-also-be-without-rowid-table_name" title="Direct link to heading">​</a></h3><p>SQLite uses its <code>ROWID</code> internally for <code>AUTOINCREMENT</code> columns.  Therefore <code>WITHOUT ROWID</code> is not a possibility if <code>AUTOINCREMENT</code> is in use.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0142-duplicate-column-name-column_name">CQL0142: duplicate column name &#x27;column_name&#x27;<a class="hash-link" href="#cql0142-duplicate-column-name-column_name" title="Direct link to heading">​</a></h3><p>In a <code>CREATE TABLE</code> statement, the indicated column was defined twice.  This is probably a copy/pasta issue.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0143-more-than-one-primary-key-in-table-table_name">CQL0143: more than one primary key in table &#x27;table_name&#x27;<a class="hash-link" href="#cql0143-more-than-one-primary-key-in-table-table_name" title="Direct link to heading">​</a></h3><p>The indicated table has more than one column with the <code>PRIMARY KEY</code> attribute or multiple <code>PRIMARY KEY</code> constraints, or a combination of these things.  You&#x27;ll have to decide which one is really intended to be primary.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0144-cannot-alter-a-view-view_name">CQL0144: cannot alter a view &#x27;view_name&#x27;<a class="hash-link" href="#cql0144-cannot-alter-a-view-view_name" title="Direct link to heading">​</a></h3><p>In an <code>ALTER TABLE</code> statement, the table to be altered is actually a view.  This is not allowed.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0144-table-in-alter-statement-does-not-exist-table_name">CQL0144: table in alter statement does not exist &#x27;table_name&#x27;<a class="hash-link" href="#cql0144-table-in-alter-statement-does-not-exist-table_name" title="Direct link to heading">​</a></h3><p>In an <code>ALTER TABLE</code> statement, the table to be altered was not defined, or perhaps was marked with <code>@delete</code> and is no longer usable in the current schema version.</p><p>NOTE: <code>ALTER TABLE</code> is typically not used directly; the automated schema upgrade script generation system uses it.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0145-version-annotations-not-valid-in-alter-statement-column_name">CQL0145: version annotations not valid in alter statement &#x27;column_name&#x27;<a class="hash-link" href="#cql0145-version-annotations-not-valid-in-alter-statement-column_name" title="Direct link to heading">​</a></h3><p>In an <code>ALTER TABLE</code> statement, the attributes on the column may not include <code>@create</code> or <code>@delete</code>.  Those annotations go on the columns declaration in the corresponding <code>CREATE TABLE</code> statement.</p><p>NOTE: <code>ALTER TABLE</code> is typically not used directly; the automated schema upgrade script generation system uses it.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0146-adding-an-auto-increment-column-is-not-allowed-column_name">CQL0146: adding an auto increment column is not allowed &#x27;column_name&#x27;<a class="hash-link" href="#cql0146-adding-an-auto-increment-column-is-not-allowed-column_name" title="Direct link to heading">​</a></h3><p>In an <code>ALTER TABLE</code> statement, the attributes on the column may not include <code>AUTOINCREMENT</code>.  SQLite does not support the addition of new <code>AUTOINCREMENT</code> columns.</p><p>NOTE: <code>ALTER TABLE</code> is typically not used directly; the automated schema upgrade script generation system uses it.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0147-adding-a-not-nullable-column-with-no-default-value-is-not-allowed-column_name">CQL0147: adding a not nullable column with no default value is not allowed &#x27;column_name&#x27;<a class="hash-link" href="#cql0147-adding-a-not-nullable-column-with-no-default-value-is-not-allowed-column_name" title="Direct link to heading">​</a></h3><p>In an <code>ALTER TABLE</code> statement the attributes on the named column must include a default value or else the column must be nullable.  This is so that SQLite knows what value to put on existing rows when the column is added and also so that any existing insert statements will not suddenly all become invalid.  If the column is nullable or has a default value then the existing insert statements that don&#x27;t specify the column will continue to work, using either NULL or the default.</p><p>NOTE: <code>ALTER TABLE</code> is typically not used directly; the automated schema upgrade script generation system uses it.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0148-added-column-must-already-be-reflected-in-declared-schema-with-create-exact-name-match-required-column_name">CQL0148: added column must already be reflected in declared schema, with <code>@create</code>, exact name match required &#x27;column_name&#x27;<a class="hash-link" href="#cql0148-added-column-must-already-be-reflected-in-declared-schema-with-create-exact-name-match-required-column_name" title="Direct link to heading">​</a></h3><p>In CQL loose schema is a declaration, it does not actually create anything unless placed inside of a procedure.  A column that is added with <code>ALTER TABLE</code> is not actually declared as part of the schema by the <code>ALTER</code>.  Rather the schema declaration is expected to include any columns you plan to add.  Normally the way this all happens is that you put <code>@create</code> notations on a column in the schema and the automatic schema upgrader then creates suitable <code>ALTER TABLE</code> statements to arrange for that column to be added.  If you manually write an <code>ALTER TABLE</code> statement it isn&#x27;t allowed to add columns at whim; in some sense it must be creating the reality already described in the declaration.  This is exactly what the automated schema upgrader does -- it declares the end state and then alters the world to get to that state.</p><p>It&#x27;s important to remember that from CQL&#x27;s perspective the schema is fixed for any given compilation, so runtime alterations to it are not really part of the type system.  They can&#x27;t be.  Even <code>DROP TABLE</code> does not remove the table from type system -- it can&#x27;t -- the most likely situation is that you are about to recreate that same table again for another iteration with the proc that creates it.</p><p>This particular error is saying that the column you are trying to add does not exist in the declared schema.</p><p>NOTE: <code>ALTER TABLE</code> is typically not used directly; the automated schema upgrade script generation system uses it.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0149-added-column-must-be-an-exact-match-for-the-column-type-declared-in-the-table-column_name">CQL0149: added column must be an exact match for the column type declared in the table &#x27;column_name&#x27;<a class="hash-link" href="#cql0149-added-column-must-be-an-exact-match-for-the-column-type-declared-in-the-table-column_name" title="Direct link to heading">​</a></h3><p>In CQL loose schema is a declaration, it does not actually create anything unless placed inside of a procedure.  A column that is added with <code>ALTER TABLE</code> is not actually declared as part of the schema by the <code>ALTER</code>.  Rather the schema declaration is expected to include any columns you plan to add.  Normally the way this all happens is that you put <code>@create</code> notations on a column in the schema and the automatic schema upgrader then creates suitable <code>ALTER TABLE</code> statements to arrange for that column to be added.  If you manually write an <code>ALTER TABLE</code> statement it isn&#x27;t allowed to add columns at whim; in some sense it must be creating the reality already described in the declaration.  This is exactly what the automated schema upgrader does -- it declares the end state and then alters the world to get to that state.</p><p>It&#x27;s important to remember that from CQL&#x27;s perspective the schema is fixed for any given compilation, so runtime alterations to it are not really part of the type system.  They can&#x27;t be.  Even <code>DROP TABLE</code> does not remove the table from type system -- it can&#x27;t -- the most likely situation is that you are about to recreate that same table again for another iteration with the proc that creates it.</p><p>This particular error is saying that the column you are trying to add exists in the declared schema, but its definition is different than you have specified in the <code>ALTER TABLE</code> statement.</p><p>NOTE: <code>ALTER TABLE</code> is typically not used directly; the automated schema upgrade script generation system uses it.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0150-expected-numeric-expression-in-if-predicate">CQL0150: expected numeric expression in IF predicate<a class="hash-link" href="#cql0150-expected-numeric-expression-in-if-predicate" title="Direct link to heading">​</a></h3><p>In an <code>IF</code> statement the condition (predicate) must be a numeric.  The body of the <code>IF</code> runs if the value is not null and not zero.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0151-table-in-delete-statement-does-not-exist-table_name">CQL0151: table in delete statement does not exist &#x27;table_name&#x27;<a class="hash-link" href="#cql0151-table-in-delete-statement-does-not-exist-table_name" title="Direct link to heading">​</a></h3><p>In a <code>DELETE</code> statement, the indicated table does not exist. Probably it&#x27;s a spelling mistake, or else the table has been marked with <code>@delete</code> and may no longer be used in <code>DELETE</code> statements.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0152-cannot-delete-from-a-view-view_name">CQL0152: cannot delete from a view &#x27;view_name&#x27;<a class="hash-link" href="#cql0152-cannot-delete-from-a-view-view_name" title="Direct link to heading">​</a></h3><p>In a <code>DELETE</code> statement, the target of the delete must be a table, but the indicated name is a view.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0153-duplicate-target-column-name-in-update-statement-column_name">CQL0153: duplicate target column name in update statement &#x27;column_name&#x27;<a class="hash-link" href="#cql0153-duplicate-target-column-name-in-update-statement-column_name" title="Direct link to heading">​</a></h3><p>In an <code>UPDATE</code> statement, you can only specify any particular column to update once.</p><p>e.g. <code>UPDATE coordinates set x = 1, x = 3;</code>  will produce this error. <code>UPDATE coordinates set x = 1, y = 3;</code> might be correct.</p><p>This error is most likely caused by a typo or a copy/pasta of the column names, especially if they were written one per line.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0154-table-in-update-statement-does-not-exist-table_name">CQL0154: table in update statement does not exist &#x27;table_name&#x27;<a class="hash-link" href="#cql0154-table-in-update-statement-does-not-exist-table_name" title="Direct link to heading">​</a></h3><p>In an <code>UPDATE</code> statement, the target table does not exist.  Probably it&#x27;s a spelling mistake, or else the table has been marked with <code>@delete</code> and may no longer be used in <code>UPDATE</code> statements.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0155-cannot-update-a-view-view_name">CQL0155: cannot update a view &#x27;view_name&#x27;<a class="hash-link" href="#cql0155-cannot-update-a-view-view_name" title="Direct link to heading">​</a></h3><p>In an <code>UPDATE</code> statement, the target of the update must be a table but the name of a view was provided.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0156-seed-expression-must-be-a-non-nullable-integer">CQL0156: seed expression must be a non-nullable integer<a class="hash-link" href="#cql0156-seed-expression-must-be-a-non-nullable-integer" title="Direct link to heading">​</a></h3><p>The <code>INSERT</code> statement statement supports the notion of synthetically generated values for dummy data purposes.  A &#x27;seed&#x27; integer is used to derive the values.  That seed (in the <code>@seed()</code> position) must be a non-null integer.</p><p>The most common reason for this error is that the seed is an input parameter and it was not declared <code>NOT NULL</code>.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0157-count-of-columns-differs-from-count-of-values">CQL0157: count of columns differs from count of values<a class="hash-link" href="#cql0157-count-of-columns-differs-from-count-of-values" title="Direct link to heading">​</a></h3><p>In an <code>INSERT</code> statement of the form <code>INSERT INTO foo(a, b, c) VALUES(x, y, z)</code> the number of values (x, y, z) must
be the same as the number of columns (a, b, c).  Note that there are many reasons you might not have to specify all the columns of the table but whichever columns you do specify should have values.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0158-required-column-missing-in-insert-statement-column_name">CQL0158: required column missing in INSERT statement &#x27;column_name&#x27;<a class="hash-link" href="#cql0158-required-column-missing-in-insert-statement-column_name" title="Direct link to heading">​</a></h3><p>In an <code>INSERT</code> statement such as <code>INSERT INTO foo(a,b,c) VALUES(x,yz)</code> this error is indicating that there is a column in <code>foo</code> (the one indicated in the error) which was not in the list (i.e. not one of a, b, c) and that column is neither nullable, nor does it have a default value.  In order to insert a row a value must be provided.  To fix this include the indicated column in your insert statement.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0159-cannot-add-an-index-to-a-virtual-table-table_name">CQL0159: cannot add an index to a virtual table &#x27;table_name&#x27;<a class="hash-link" href="#cql0159-cannot-add-an-index-to-a-virtual-table-table_name" title="Direct link to heading">​</a></h3><p>Adding an index to a virtual table isn&#x27;t possible, the virtual table includes whatever indexing its module provides, no further indexing is possible.</p><p>From the SQLite documentation: &quot;One cannot create additional indices on a virtual table. (Virtual tables can have indices but that must be built into the virtual table implementation. Indices cannot be added separately using CREATE INDEX statements.)&quot;</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0160-table-in-insert-statement-does-not-exist-table_name">CQL0160: table in insert statement does not exist &#x27;table_name&#x27;<a class="hash-link" href="#cql0160-table-in-insert-statement-does-not-exist-table_name" title="Direct link to heading">​</a></h3><p>In an <code>INSERT</code> statement attempting to insert into the indicated table name is not possible because there is no such table.
This error might happen because of a typo, or it might happen because the indicated table has been marked with <code>@delete</code> and is logically hidden.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0161-cannot-insert-into-a-view-view_name">CQL0161: cannot insert into a view &#x27;view_name&#x27;<a class="hash-link" href="#cql0161-cannot-insert-into-a-view-view_name" title="Direct link to heading">​</a></h3><p>In an <code>INSERT</code> statement attempting to insert into the indicated name is not possible because that name is a view not a table.  Inserting into views is not supported.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0162-cannot-add-a-trigger-to-a-virtual-table-table_name">CQL0162: cannot add a trigger to a virtual table &#x27;table_name&#x27;<a class="hash-link" href="#cql0162-cannot-add-a-trigger-to-a-virtual-table-table_name" title="Direct link to heading">​</a></h3><p>Adding a trigger to a virtual table isn&#x27;t possible.</p><p>From the SQLite documentation: &quot;One cannot create a trigger on a virtual table.&quot;</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0163-from-arguments-construct-is-only-valid-inside-a-procedure">CQL0163: FROM ARGUMENTS construct is only valid inside a procedure<a class="hash-link" href="#cql0163-from-arguments-construct-is-only-valid-inside-a-procedure" title="Direct link to heading">​</a></h3><p>Several statements support the <code>FROM ARGUMENTS</code> sugar format like <code>INSERT INTO foo(a,b,c) FROM ARGUMENTS</code> which causes the arguments of the current procedure to be used as the values.  This error is complaining that you have used this form but the statement does not occur inside of a procedure so there can be no arguments.  This form does not make sense outside of any procedure.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0164-cannot-use-alter-table-on-a-virtual-table-table_name">CQL0164: cannot use ALTER TABLE on a virtual table &#x27;table_name&#x27;<a class="hash-link" href="#cql0164-cannot-use-alter-table-on-a-virtual-table-table_name" title="Direct link to heading">​</a></h3><p>This is not supported by SQLite.</p><p>From the SQLite documentation: &quot;One cannot run ALTER TABLE ... ADD COLUMN commands against a virtual table.&quot;</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0165-fetch-values-is-only-for-value-cursors-not-for-sqlite-cursors-cursor_name">CQL0165: fetch values is only for value cursors, not for sqlite cursors &#x27;cursor_name&#x27;<a class="hash-link" href="#cql0165-fetch-values-is-only-for-value-cursors-not-for-sqlite-cursors-cursor_name" title="Direct link to heading">​</a></h3><p>Cursors come in two flavors.  There are &quot;statement cursors&quot; which are built from something like this:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- or --</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>That is, they come from a SQLite statement and you can fetch values from that statement.  The second type comes from procedural values like this.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> my_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">values</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the second example <code>C</code>&#x27;s data type will be the same as the columns in <code>my_table</code> and we will fetch its values from <code>1,2,3</code> -- this version has no database backing at all, it&#x27;s just data.</p><p>This error says that you declared the cursor in the first form (with a SQL statement) but then you tried to fetch it using the second form, the one for data. These forms don&#x27;t mix.   If you need a value cursor for a row you can copy data from one cursor into another.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0166-count-of-columns-differs-from-count-of-values">CQL0166: count of columns differs from count of values<a class="hash-link" href="#cql0166-count-of-columns-differs-from-count-of-values" title="Direct link to heading">​</a></h3><p>In a value cursor, declared something like this:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> my_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">values</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The type of the cursor ( in this case from <code>my_table</code>) requires a certain number of columns, but that doesn&#x27;t match the number that were provided in the values.</p><p>To fix this you&#x27;ll need to add/remove values so that the type match.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0167-required-column-missing-in-fetch-statement-column_name">CQL0167: required column missing in FETCH statement &#x27;column_name&#x27;<a class="hash-link" href="#cql0167-required-column-missing-in-fetch-statement-column_name" title="Direct link to heading">​</a></h3><p>In a value cursor, declared something like this:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> my_table</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">values</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This error is saying that there is some other field in the table &#x27;d&#x27; and it was not specified in the values.  Nor was there a usable dummy data for that column that could be used.  You need to provide a value for the missing column.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0168-cql-has-no-good-way-to-generate-dummy-blobs-not-supported-for-now">CQL0168: CQL has no good way to generate dummy blobs; not supported for now<a class="hash-link" href="#cql0168-cql-has-no-good-way-to-generate-dummy-blobs-not-supported-for-now" title="Direct link to heading">​</a></h3><p>In a value cursor with dummy data specified, one of the columns in the cursor is of type blob.  There&#x27;s no good way to create dummy data for blobs so that isn&#x27;t supported.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0169-enum-not-found-enum_name">CQL0169: enum not found &#x27;enum_name&#x27;<a class="hash-link" href="#cql0169-enum-not-found-enum_name" title="Direct link to heading">​</a></h3><p>The indicated name was used in a context where an enumerated type name was expected but there is no such type.</p><p>Perhaps the enum was not included (missing a #include) or else there is a typo.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0170-cast-is-redundant-remove-to-reduce-code-size-expression">CQL0170: cast is redundant, remove to reduce code size &#x27;expression&#x27;<a class="hash-link" href="#cql0170-cast-is-redundant-remove-to-reduce-code-size-expression" title="Direct link to heading">​</a></h3><p>The operand of the <code>CAST</code> expression is already the type that it is being cast to.  The cast will
do nothing but waste space in the binary and make the code less clear.  Remove it.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0171-name-not-found-name">CQL0171: name not found &#x27;name&#x27;<a class="hash-link" href="#cql0171-name-not-found-name" title="Direct link to heading">​</a></h3><p>In a scoped name list, like the columns of a cursor (for a fetch), or the columns of a particular table (for an index) a name appeared that did not belong to the universe of legal names.  Trying to make a table index using a column that is not in the table would produce this error.  There are many instances where a list of names belongs to some limited scope.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0172-name-list-has-duplicate-name-name">CQL0172: name list has duplicate name &#x27;name&#x27;<a class="hash-link" href="#cql0172-name-list-has-duplicate-name-name" title="Direct link to heading">​</a></h3><p>In a scoped name list, like the columns of a cursor (for a fetch), or the columns of a particular table (for an index) a name appeared twice in the list where the names must be unique.  Trying to make a table index using the same column twice would produce this error.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0173-variable-not-found-variable_name">CQL0173: variable not found &#x27;variable_name&#x27;<a class="hash-link" href="#cql0173-variable-not-found-variable_name" title="Direct link to heading">​</a></h3><p>In a <code>SET</code> statement, the target of the assignment is not a valid variable name in that scope.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0174-cannot-set-a-cursor-cursor_name">CQL0174: cannot set a cursor &#x27;cursor_name&#x27;<a class="hash-link" href="#cql0174-cannot-set-a-cursor-cursor_name" title="Direct link to heading">​</a></h3><p>In a <code>SET</code> statement, the target of the assignment is a cursor variable, you cannot assign to a cursor variable.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0175-duplicate-parameter-name-parameter_name">CQL0175: duplicate parameter name &#x27;parameter_name&#x27;<a class="hash-link" href="#cql0175-duplicate-parameter-name-parameter_name" title="Direct link to heading">​</a></h3><p>In a parameter list for a function or a procedure, the named parameter appears more than once.  The formal names for function arguments must be unique.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0176-indicated-procedure-or-group-already-has-a-recreate-action-name">CQL0176: indicated procedure or group already has a recreate action &#x27;name&#x27;<a class="hash-link" href="#cql0176-indicated-procedure-or-group-already-has-a-recreate-action-name" title="Direct link to heading">​</a></h3><p>There can only be one migration rule for a table or group, the indicated item already has such an action.  If you need more than one migration action you can
create a containing procedure that dispatches to other migrators.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0177-global-constants-must-be-either-constant-numeric-expressions-or-string-literals-constant_definition">CQL0177: global constants must be either constant numeric expressions or string literals &#x27;constant_definition&#x27;<a class="hash-link" href="#cql0177-global-constants-must-be-either-constant-numeric-expressions-or-string-literals-constant_definition" title="Direct link to heading">​</a></h3><p>Global constants must be either a combination other constants for numeric expressions or else string literals.  The indicated expression was not one of those.</p><p>This can happen if the expression uses variables, or has other problems that prevent it from evaluating, or if a function is used that is not supported.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0178-proc-has-no-result-like_name">CQL0178: proc has no result &#x27;like_name&#x27;<a class="hash-link" href="#cql0178-proc-has-no-result-like_name" title="Direct link to heading">​</a></h3><p>In an argument list, the <code>LIKE</code> construct was used to create arguments that are the same as the return type of the named procedure.  However the named procedure does not produce a result set and therefore has no columns to mimic.  Probably the name is wrong.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0179-shared-fragments-must-consist-of-exactly-one-top-level-statement-procedure_name">CQL0179: shared fragments must consist of exactly one top level statement &#x27;procedure_name&#x27;<a class="hash-link" href="#cql0179-shared-fragments-must-consist-of-exactly-one-top-level-statement-procedure_name" title="Direct link to heading">​</a></h3><p>Any shared fragment can have only one statement.  There are three valid forms -- IF/ELSE, WITH ... SELECT, and SELECT.</p><p>This error indicates the named procedure, which is a shared fragment, has more than one statement.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0180-duplicate-column-name-in-result-not-allowed-column_name">CQL0180: duplicate column name in result not allowed &#x27;column_name&#x27;<a class="hash-link" href="#cql0180-duplicate-column-name-in-result-not-allowed-column_name" title="Direct link to heading">​</a></h3><p>In a procedure that returns a result either with a loose <code>SELECT</code> statement or in a place where the result of a <code>SELECT</code> is captured with a <code>FETCH</code> statement the named column appears twice in the projection of the <code>SELECT</code> in question.  The column names must be unique in order to have consistent cursor field names or consistent access functions for the result set of the procedure.  One instance of the named column must be renamed with something like <code>select T1.foo first_foo, T2.foo second_foo</code>.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0181-autodrop-temp-table-does-not-exist-name">CQL0181: autodrop temp table does not exist &#x27;name&#x27;<a class="hash-link" href="#cql0181-autodrop-temp-table-does-not-exist-name" title="Direct link to heading">​</a></h3><p>In a <code>cql:autodrop</code> annotation, the given name is unknown entirely.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0182-autodrop-target-is-not-a-table-name">CQL0182: autodrop target is not a table &#x27;name&#x27;<a class="hash-link" href="#cql0182-autodrop-target-is-not-a-table-name" title="Direct link to heading">​</a></h3><p>In a <code>cql:autodrop</code> annotation, the given name is not a table (it&#x27;s probably a view).</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0183-autodrop-target-must-be-a-temporary-table-name">CQL0183: autodrop target must be a temporary table &#x27;name&#x27;<a class="hash-link" href="#cql0183-autodrop-target-must-be-a-temporary-table-name" title="Direct link to heading">​</a></h3><p>In a <code>cql:autodrop</code> annotation, the given name is a table but it is not a temp table.  The annotation is only valid on temp tables, it&#x27;s not for &quot;durable&quot; tables.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0184-stored-procedures-cannot-be-nested-name">CQL0184: stored procedures cannot be nested &#x27;name&#x27;<a class="hash-link" href="#cql0184-stored-procedures-cannot-be-nested-name" title="Direct link to heading">​</a></h3><p>The <code>CREATE PROCEDURE</code> statement may not appear inside of another stored procedure.  The named procedure appears in a nested context.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0185-proc-name-conflicts-with-func-name-name">CQL0185: proc name conflicts with func name &#x27;name&#x27;<a class="hash-link" href="#cql0185-proc-name-conflicts-with-func-name-name" title="Direct link to heading">​</a></h3><p>In a <code>CREATE PROCEDURE</code> statement, the given name conflicts with an already declared function (<code>DECLARE FUNCTION</code> or <code>DECLARE SELECT FUNCTION</code>).  You&#x27;ll have to choose a different name.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0186-duplicate-stored-proc-name-name">CQL0186: duplicate stored proc name &#x27;name&#x27;<a class="hash-link" href="#cql0186-duplicate-stored-proc-name-name" title="Direct link to heading">​</a></h3><p>In a <code>CREATE PROCEDURE</code> statement, the indicated name already corresponds to a created (not just declared) stored procedure.  You&#x27;ll have to choose a different name.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0187-schema_upgrade_version-not-declared-or-doesnt-match-upgrade-version-n-for-proc-name">CQL0187: @schema_upgrade_version not declared or doesn&#x27;t match upgrade version <code>N</code> for proc &#x27;name&#x27;<a class="hash-link" href="#cql0187-schema_upgrade_version-not-declared-or-doesnt-match-upgrade-version-n-for-proc-name" title="Direct link to heading">​</a></h3><p>The named procedure was declared as a schema migration procedure in an <code>@create</code> or <code>@delete</code> annotation for schema version <code>N</code>.  In order to correctly type check such a procedure it must be compiled in the context of schema version <code>N</code>.  This restriction is required so that the tables and columns the procedure sees are the ones that existed in version <code>N</code> not the ones that exist in the most recent version as usual.</p><p>To create this condition, the procedure must appear in a file that begins with the line:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token variable" style="color:rgb(191, 199, 213)">@schema_upgrade_version</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">N</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And this declaration must come before any <code>CREATE TABLE</code> statements.  If there is no such declaration, or if it is for the wrong version, then this error will be generated.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0188-procedure-is-supposed-to-do-schema-migration-but-it-doesnt-have-any-dml-name">CQL0188: procedure is supposed to do schema migration but it doesn&#x27;t have any DML &#x27;name&#x27;<a class="hash-link" href="#cql0188-procedure-is-supposed-to-do-schema-migration-but-it-doesnt-have-any-dml-name" title="Direct link to heading">​</a></h3><p>The named procedure was declared as a schema migration procedure in an <code>@create</code> or <code>@delete</code> annotation, however the procedure does not have any DML in it.  That can&#x27;t be right.  Some kind of data reading and writing is necessary.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0189-procedure-declarationsdefinitions-do-not-match-name">CQL0189: procedure declarations/definitions do not match &#x27;name&#x27;<a class="hash-link" href="#cql0189-procedure-declarationsdefinitions-do-not-match-name" title="Direct link to heading">​</a></h3><p>The named procedure was previously declared with a <code>DECLARE PROCEDURE</code> statement but when the <code>CREATE PROCEDURE</code> was encountered, it did not match the previous declaration.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0190-duplicate-column-name-name">CQL0190: duplicate column name &#x27;name&#x27;<a class="hash-link" href="#cql0190-duplicate-column-name-name" title="Direct link to heading">​</a></h3><p>In a context with a typed name list (e.g. <code>id integer, t text</code>) the named column occurs twice.  Typed name lists happen in many contexts, but a common one is the type of the result in a declared procedure statement or declared function statement.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0191-declared-functions-must-be-top-level-function_name">CQL0191: declared functions must be top level &#x27;function_name&#x27;<a class="hash-link" href="#cql0191-declared-functions-must-be-top-level-function_name" title="Direct link to heading">​</a></h3><p>A <code>DECLARE FUNCTION</code> statement for the named function is happening inside of a procedure.  This is not legal.  To correct this move the declaration outside of the procedure.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0192-func-name-conflicts-with-proc-name-name">CQL0192: func name conflicts with proc name &#x27;name&#x27;<a class="hash-link" href="#cql0192-func-name-conflicts-with-proc-name-name" title="Direct link to heading">​</a></h3><p>The named function in a <code>DECLARE FUNCTION</code> statement conflicts with an existing declared or created procedure.  One or the other must be renamed to resolve this issue.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0193-duplicate-function-name-name">CQL0193: duplicate function name &#x27;name&#x27;<a class="hash-link" href="#cql0193-duplicate-function-name-name" title="Direct link to heading">​</a></h3><p>The named function in a <code>DECLARE FUNCTION</code> statement conflicts with an existing declared function, or it was declared twice.  One or the other declaration must be renamed or removed to resolve this issue.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0194-declared-procedures-must-be-top-level-name">CQL0194: declared procedures must be top level &#x27;name&#x27;<a class="hash-link" href="#cql0194-declared-procedures-must-be-top-level-name" title="Direct link to heading">​</a></h3><p>A <code>DECLARE PROCEDURE</code> statement for the named procedure is itself happening inside of a procedure.  This is not legal.  To correct this move the declaration outside of the procedure.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0195-proc-name-conflicts-with-func-name-name">CQL0195: proc name conflicts with func name &#x27;name&#x27;<a class="hash-link" href="#cql0195-proc-name-conflicts-with-func-name-name" title="Direct link to heading">​</a></h3><p>The named procedure in a <code>DECLARE PROCEDURE</code> statement conflicts with an existing declared function.  One or the other declaration must be renamed or removed to resolve this issue.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0196-procedure-declarationsdefinitions-do-not-match-name">CQL0196: procedure declarations/definitions do not match &#x27;name&#x27;<a class="hash-link" href="#cql0196-procedure-declarationsdefinitions-do-not-match-name" title="Direct link to heading">​</a></h3><p>The named procedure was previously declared with a <code>DECLARE PROCEDURE</code> statement.  Now there is another declaration and it does not match the previous declaration</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0197-duplicate-variable-name-in-the-same-scope-name">CQL0197: duplicate variable name in the same scope &#x27;name&#x27;<a class="hash-link" href="#cql0197-duplicate-variable-name-in-the-same-scope-name" title="Direct link to heading">​</a></h3><p>In a <code>DECLARE</code> statement, a variable of the same name already exists in that scope.  Note that CQL does not have block level scope, all variables are procedure level, so they are in scope until the end of the procedure.  To resolve this problem, either re-use the old variable if appropriate or rename the new variable.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0198-global-variable-hides-tableview-name-name">CQL0198: global variable hides table/view name &#x27;name&#x27;<a class="hash-link" href="#cql0198-global-variable-hides-tableview-name-name" title="Direct link to heading">​</a></h3><p>In a <code>DECLARE</code> statement, the named variable is a global (declared outside of any procedure) and has the same name as a table or view.  This creates a lot of confusion and is therefore disallowed.  To correct the problem, rename the variable.  Global variables generally are problematic, but sometimes necessary.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0199-cursor-requires-a-procedure-that-returns-a-result-set-via-select-procedure_name">CQL0199: cursor requires a procedure that returns a result set via select &#x27;procedure_name&#x27;<a class="hash-link" href="#cql0199-cursor-requires-a-procedure-that-returns-a-result-set-via-select-procedure_name" title="Direct link to heading">​</a></h3><p>In a <code>DECLARE</code> statement that declares a <code>CURSOR FOR CALL</code> the procedure that is being called does not produce a result set with the <code>SELECT</code> statement.  As it has no row results it is meaningless to try to put a cursor on it.  Probably the error is due to a copy/pasta of the procedure name.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0200-variable-is-not-a-cursor-another_cursor">CQL0200: variable is not a cursor &#x27;another_cursor&#x27;<a class="hash-link" href="#cql0200-variable-is-not-a-cursor-another_cursor" title="Direct link to heading">​</a></h3><p>In a <code>DECLARE</code> statement that declares a <code>CURSOR LIKE</code> another cursor, the indicated name is a variable but it is not a cursor, so we cannot make another cursor like it.  Probably the error is due to a typo in the &#x27;like_name&#x27;.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0201-expanding-from-arguments-there-is-no-argument-matching-required_arg">CQL0201: expanding FROM ARGUMENTS, there is no argument matching &#x27;required_arg&#x27;<a class="hash-link" href="#cql0201-expanding-from-arguments-there-is-no-argument-matching-required_arg" title="Direct link to heading">​</a></h3><p>In an <code>INSERT</code> or <code>FETCH</code> statement using the form <code>FROM ARGUMENTS(LIKE [name])</code>
The shape <code>[name]</code> had columns that did not appear in as arguments to the current procedure.
Maybe arguments are missing or maybe the name in the <code>like</code> part is the wrong name.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0202-must-be-a-cursor-proc-table-or-view-like_name">CQL0202: must be a cursor, proc, table, or view &#x27;like_name&#x27;<a class="hash-link" href="#cql0202-must-be-a-cursor-proc-table-or-view-like_name" title="Direct link to heading">​</a></h3><p>In a <code>DECLARE</code> statement that declares a <code>CURSOR LIKE</code> some other name, the indicated name is not the name of any of the things that might have a valid shape to copy, like other cursors, procedures, tables, or views.  Probably there is a typo in the name.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0203-cursor-requires-a-procedure-that-returns-a-cursor-with-out-cursor_name">CQL0203: cursor requires a procedure that returns a cursor with OUT &#x27;cursor_name&#x27;<a class="hash-link" href="#cql0203-cursor-requires-a-procedure-that-returns-a-cursor-with-out-cursor_name" title="Direct link to heading">​</a></h3><p>In the <code>DECLARE [cursor_name] CURSOR FETCH FROM CALL &lt;something&gt;</code> form, the code is trying to create the named cursor by calling a procedure that doesn&#x27;t actually produce a single row result set with the <code>OUT</code> statement.  The procedure is valid (that would be a different error) so it&#x27;s likely that the wrong procedure is being called rather than being an outright typo.  Or perhaps the procedure was changed such that it no longer produces a single row result set.</p><p>This form is equivalent to:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">cursor_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">LIKE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">procedure</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">FETCH</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">cursor_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">procedure</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">args</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>It&#x27;s the declaration that&#x27;s failing here, not the call.</p><hr><p>CQL0204 : Unused.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0205-not-a-cursor-name">CQL0205: not a cursor &#x27;name&#x27;<a class="hash-link" href="#cql0205-not-a-cursor-name" title="Direct link to heading">​</a></h3><p>The indicated name appeared in a context where the name of a cursor was
expected, but the name does not refer to a cursor.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0206-duplicate-name-in-list-name">CQL0206: duplicate name in list &#x27;name&#x27;<a class="hash-link" href="#cql0206-duplicate-name-in-list-name" title="Direct link to heading">​</a></h3><p>There are many contexts where a list of names appears in the CQL grammar and the list must not contain duplicate names.  Some examples are:</p><ul><li>the column names in a <code>JOIN ... USING(x,y,z,...)</code> clause</li><li>the fetched variables in a <code>FETCH [cursor] INTO x,y,z...</code> statement</li><li>the column names listed in a common table expression <code>CTE(x,y,z,...) as (SELECT ...)</code></li><li>the antecedent schema region names in <code>@declare_schema_region &lt;name&gt; USING x,y,z,...</code></li></ul><p>The indicated name was duplicated in such a context.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0207-expected-a-variable-name-for-out-or-inout-argument-param_name">CQL0207: expected a variable name for OUT or INOUT argument &#x27;param_name&#x27;<a class="hash-link" href="#cql0207-expected-a-variable-name-for-out-or-inout-argument-param_name" title="Direct link to heading">​</a></h3><p>In a procedure call, the indicated parameter of the procedure is an OUT or INOUT parameter but the call site doesn&#x27;t have a variable in that position in the argument list.</p><p>Example:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> x </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- the constant 1 cannot be used in the out position when calling foo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> &#x27;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0208-shared-fragments-cannot-have-any-out-or-inout-parameters-param_name">CQL0208: shared fragments cannot have any out or in/out parameters &#x27;param_name&#x27;<a class="hash-link" href="#cql0208-shared-fragments-cannot-have-any-out-or-inout-parameters-param_name" title="Direct link to heading">​</a></h3><p>A shared fragment will be expanded into the body of a SQL select statement, as such it can have no side-effects such as out arguments.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0209-proc-out-parameter-arg-must-be-an-exact-type-match-expected-expected_type-found-actual_type-param_name">CQL0209: proc out parameter: arg must be an exact type match (expected expected_type; found actual_type) &#x27;param_name&#x27;<a class="hash-link" href="#cql0209-proc-out-parameter-arg-must-be-an-exact-type-match-expected-expected_type-found-actual_type-param_name" title="Direct link to heading">​</a></h3><p>In a procedure call, the indicated parameter is in an &#x27;out&#x27; position, it is a viable local variable but it is not an exact type match for the parameter.  The type of variable used to capture out parameters must be an exact match.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> x </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> y </span><span class="token keyword" style="font-style:italic">real</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- y is a real variable, not an integer.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The above produces:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">CQL0209: </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> parameter: arg must be an exact </span><span class="token keyword" style="font-style:italic">type</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">match</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">expected </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> found </span><span class="token keyword" style="font-style:italic">real</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;y&#x27;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0210-proc-out-parameter-arg-must-be-an-exact-type-match-even-nullability">CQL0210: proc out parameter: arg must be an exact type match (even nullability)<a class="hash-link" href="#cql0210-proc-out-parameter-arg-must-be-an-exact-type-match-even-nullability" title="Direct link to heading">​</a></h3><p>(expected expected_type; found actual_type) &#x27;variable_name&#x27;</p><p>In a procedure call, the indicated parameter is in an &#x27;out&#x27; position, it is a viable local variable of the correct type but the nullability does not match.  The type of variable used to capture out parameters must be an exact match.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> x </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> y </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- y is nullable but foo is expecting not null.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The above produces:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">CQL0210: </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> parameter: arg must be an exact </span><span class="token keyword" style="font-style:italic">type</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">match</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">even nullability</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">expected </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> notnull</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> found </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;y&#x27;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0211-procedure-without-trailing-out-parameter-used-as-function-procedure_name">CQL0211: procedure without trailing OUT parameter used as function &#x27;procedure_name&#x27;<a class="hash-link" href="#cql0211-procedure-without-trailing-out-parameter-used-as-function-procedure_name" title="Direct link to heading">​</a></h3><p>In a function call, the target of the function call was a procedure, procedures can be used like functions but their last parameter must be marked <code>out</code>. That will be the return value.  In this case the last argument was not marked as <code>out</code> and so the call is invalid.</p><p>Example:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> y </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> y :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- foo does not have an out argument at the end</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0212-too-few-arguments-provided-to-procedure-name">CQL0212: too few arguments provided to procedure &#x27;name&#x27;<a class="hash-link" href="#cql0212-too-few-arguments-provided-to-procedure-name" title="Direct link to heading">​</a></h3><p>In a procedure call to the named procedure, not enough arguments were provided to make the call.  One or more arguments may have been omitted or perhaps the called procedure has changed such that it now requires more arguments.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0213-procedure-had-errors-cant-call-procedure_name">CQL0213: procedure had errors, can&#x27;t call. &#x27;procedure_name&#x27;<a class="hash-link" href="#cql0213-procedure-had-errors-cant-call-procedure_name" title="Direct link to heading">​</a></h3><p>In a procedure call to the named procedure, the target of the call had compilation errors.  As a consequence this call cannot be checked and therefore must be marked in error, too.  Fix the errors in the named procedure.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0214-procedures-with-results-can-only-be-called-using-a-cursor-in-global-context-name">CQL0214: procedures with results can only be called using a cursor in global context &#x27;name&#x27;<a class="hash-link" href="#cql0214-procedures-with-results-can-only-be-called-using-a-cursor-in-global-context-name" title="Direct link to heading">​</a></h3><p>The named procedure results a result set, either with the <code>SELECT</code> statement or the <code>OUT</code> statement.  However it is being called from outside of any procedure.  Because of this, its result cannot then be returned anywhere.  As a result, at the global level the result must be capture with a cursor.</p><p>Example:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- this is not valid</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- C captures the result of foo, this is ok.</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0215-value-cursors-are-not-used-with-fetch-c-or-fetch-c-into-cursor_name">CQL0215: value cursors are not used with FETCH C, or FETCH C INTO &#x27;cursor_name&#x27;<a class="hash-link" href="#cql0215-value-cursors-are-not-used-with-fetch-c-or-fetch-c-into-cursor_name" title="Direct link to heading">​</a></h3><p>In a <code>FETCH</code> statement of the form <code>FETCH [cursor]</code> or <code>FETCH [cursor] INTO</code> the named cursor
is a value cursor.  These forms of the <code>FETCH</code> statement apply only to statement cursors.</p><p>Example:good</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- value cursor shaped like a table</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">--ok, C is fetched from the select results</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Example: bad</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- value cursor shaped like a table</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- invalid, there is no source for fetching a value cursor</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- ok assuming bar is made up of 3 integers</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">values</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>statement cursors come from SQL statements and can be fetched</li><li>value cursors are of a prescribed shape and can only be loaded from value sources</li></ul><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0216-fetch-variable-not-found-cursor_name">CQL0216: FETCH variable not found &#x27;cursor_name&#x27;<a class="hash-link" href="#cql0216-fetch-variable-not-found-cursor_name" title="Direct link to heading">​</a></h3><p>In a <code>FETCH</code> statement,  the indicated name, which is supposed to be a cursor, is not in fact a valid name at all.</p><p>Probably there is a typo in the name.  Or else the declaration is entirely missing.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0217-number-of-variables-did-not-match-count-of-columns-in-cursor-cursor_name">CQL0217: number of variables did not match count of columns in cursor &#x27;cursor_name&#x27;<a class="hash-link" href="#cql0217-number-of-variables-did-not-match-count-of-columns-in-cursor-cursor_name" title="Direct link to heading">​</a></h3><p>In a <code>FETCH [cursor] INTO [variables]</code> the number of variables specified did not match the number of columns in the named cursor.  Perhaps the source of the cursor (a select statement or some such) has changed.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0218-continue-must-be-inside-of-a-loop-or-while-statement">CQL0218: continue must be inside of a &#x27;loop&#x27; or &#x27;while&#x27; statement<a class="hash-link" href="#cql0218-continue-must-be-inside-of-a-loop-or-while-statement" title="Direct link to heading">​</a></h3><p>The <code>CONTINUE</code> statement may only appear inside of looping constructs.  CQL only has two <code>LOOP FETCH ...</code> and <code>WHILE</code></p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0219-leave-must-be-inside-of-a-loop-while-or-switch-statement">CQL0219: leave must be inside of a &#x27;loop&#x27;, &#x27;while&#x27;, or &#x27;switch&#x27; statement<a class="hash-link" href="#cql0219-leave-must-be-inside-of-a-loop-while-or-switch-statement" title="Direct link to heading">​</a></h3><p>The <code>LEAVE</code> statement may only appear inside of looping constructs or the switch statement.</p><p>CQL has two loop types: <code>LOOP FETCH ...</code> and <code>WHILE</code> and of course the <code>SWITCH</code> statement.</p><p>The errant <code>LEAVE</code> statement is not in any of those.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0220-savepoint-has-not-been-mentioned-yet-probably-wrong-name">CQL0220: savepoint has not been mentioned yet, probably wrong &#x27;name&#x27;<a class="hash-link" href="#cql0220-savepoint-has-not-been-mentioned-yet-probably-wrong-name" title="Direct link to heading">​</a></h3><p>In a <code>ROLLBACK</code> statement that is rolling back to a named savepoint, the indicated savepoint was never mentioned before.  It should have appeared previously in a <code>SAVEPOINT</code> statement.  This probably means there is a typo in the name.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0221-savepoint-has-not-been-mentioned-yet-probably-wrong-name">CQL0221: savepoint has not been mentioned yet, probably wrong &#x27;name&#x27;<a class="hash-link" href="#cql0221-savepoint-has-not-been-mentioned-yet-probably-wrong-name" title="Direct link to heading">​</a></h3><p>In a <code>RELEASE SAVEPOINT</code> statement that is rolling back to a named savepoint, the indicated savepoint was never mentioned before.  It should have appeared previously in a <code>SAVEPOINT</code> statement.  This probably means there is a typo in the name.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0222-out-cursor-statement-only-makes-sense-inside-of-a-procedure">CQL0222: out cursor statement only makes sense inside of a procedure<a class="hash-link" href="#cql0222-out-cursor-statement-only-makes-sense-inside-of-a-procedure" title="Direct link to heading">​</a></h3><p>The statement form <code>OUT [cursor_name]</code> makes a procedure that returns a single row result set.  It doesn&#x27;t make any
sense to do this outside of any procedure because there is no procedure to return that result.  Perhaps the <code>OUT</code> statement was mis-placed.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0223-cursor-was-not-fetched-with-the-auto-fetch-syntax-fetch-cursor-cursor_name">CQL0223: cursor was not fetched with the auto-fetch syntax &#x27;fetch <!-- -->[cursor]<!-- -->&#x27; &#x27;cursor_name&#x27;<a class="hash-link" href="#cql0223-cursor-was-not-fetched-with-the-auto-fetch-syntax-fetch-cursor-cursor_name" title="Direct link to heading">​</a></h3><p>The statement form <code>OUT [cursor_name]</code> makes a procedure that returns a single row result set that corresponds to the current value of the cursor.  If the cursor never held values directly then there is nothing to return.</p><p>Example:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- error C was never fetched</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> z</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- error C was used to load x, y, z so it&#x27;s not holding any data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- create storage in C to hold bar columns (e.g. C.x, C,y, C.z)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- ok, C holds data</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">out</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0224-a-call-statement-inside-sql-may-call-only-a-shared-fragment-ie-attributecqlshared_fragment">CQL0224: a CALL statement inside SQL may call only a shared fragment i.e. @attribute(cql:shared_fragment)<a class="hash-link" href="#cql0224-a-call-statement-inside-sql-may-call-only-a-shared-fragment-ie-attributecqlshared_fragment" title="Direct link to heading">​</a></h3><p>Inside of a WITH clause you can create a CTE by calling a shared fragment like so:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">WITH</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  my_shared_something(*) AS (CALL shared_proc(5))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">SELECT * from my shared_something;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>or you can use a nested select expression like</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain"> SELECT * FROM (CALL shared_proc(5)) as T;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>However <code>shared_proc</code> must define a shareable fragment, like so:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">@attribute(cql:shared_fragment)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create proc shared_proc(lim_ integer)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   select * from somewhere limit lim_;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here the target of the CALL is not a shared fragment.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0225-switching-to-previous-schema-validation-mode-must-be-outside-of-any-proc">CQL0225: switching to previous schema validation mode must be outside of any proc<a class="hash-link" href="#cql0225-switching-to-previous-schema-validation-mode-must-be-outside-of-any-proc" title="Direct link to heading">​</a></h3><p>The <code>@previous_schema</code> directive says that any schema that follows should be compared against what was declared before this point.  This gives CQL the opportunity to detect changes in schema that are not supportable.</p><p>The previous schema directive must be outside of any stored procedure.</p><p>Example:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token variable" style="color:rgb(191, 199, 213)">@previous_schema</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- ok here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token variable" style="color:rgb(191, 199, 213)">@previous</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">schema</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- nope</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0226-schema-upgrade-declaration-must-be-outside-of-any-proc">CQL0226: schema upgrade declaration must be outside of any proc<a class="hash-link" href="#cql0226-schema-upgrade-declaration-must-be-outside-of-any-proc" title="Direct link to heading">​</a></h3><p>The <code>@schema_upgrade_script</code> directive tells CQL that the code that follows is intended to upgrade schema from one version to another.  This kind of script is normally generated by the <code>--rt schema_upgrade</code> option discussed elsewhere.  When processing such a script, a different set of rules are used for DDL analysis.  In particular, it&#x27;s normal to declare the final versions of tables but have DDL that creates the original version and more DDL to upgrade them from wherever they are to the final version (as declared).  Ordinarily these duplicate definitions would produce errors.  This directive allows those duplications.</p><p>This error is reporting that the directive happened inside of a stored procedure, this is not allowed.</p><p>Example:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token variable" style="color:rgb(191, 199, 213)">@schema_upgrade_script</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- ok here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token variable" style="color:rgb(191, 199, 213)">@schema_upgrade_script</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- nope</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0227-schema-upgrade-declaration-must-come-before-any-tables-are-declared">CQL0227: schema upgrade declaration must come before any tables are declared<a class="hash-link" href="#cql0227-schema-upgrade-declaration-must-come-before-any-tables-are-declared" title="Direct link to heading">​</a></h3><p>The <code>@schema_upgrade_script</code> directive tells CQL that the code that follows is intended to upgrade schema from one version to another.  This kind of script is normally generated by the <code>--rt schema_upgrade</code> option discussed elsewhere.  When processing such a script, a different set of rules are used for DDL analysis.  In particular, it&#x27;s normal to declare the final versions of tables but have DDL that creates the original version and more DDL to upgrade them from wherever they are to the final version (as declared).  Ordinarily these duplicate definitions would produce errors.  This directive allows those duplications.</p><p>In order to do its job properly the directive must come before any tables are created with DDL.  This error tells you that the directive came too late in the stream. Or perhaps there were two such directives and one is late in the stream.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0228-schema-upgrade-version-must-be-a-positive-integer">CQL0228: schema upgrade version must be a positive integer<a class="hash-link" href="#cql0228-schema-upgrade-version-must-be-a-positive-integer" title="Direct link to heading">​</a></h3><p>When authoring a schema migration procedure that was previously declared in an <code>@create</code> or <code>@delete</code> directive, the code in that procedure expects to see the schema as it existed at the version it is to migrate.  The <code>@schema_upgrade_version</code> directive allows you to set the visible schema version to something other than the latest. There can only be one such directive.</p><p>This error says that the version you are trying to view is not a positive integer version (e.g version -2)</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0229-schema-upgrade-version-declaration-may-only-appear-once">CQL0229: schema upgrade version declaration may only appear once<a class="hash-link" href="#cql0229-schema-upgrade-version-declaration-may-only-appear-once" title="Direct link to heading">​</a></h3><p>When authoring a schema migration procedure that was previously declared in an <code>@create</code> or <code>@delete</code> directive, the code in that procedure expects to see the schema as it existed at the version it is to migrate.  The <code>@schema_upgrade_version</code> directive allows you to set the visible schema version to something other than the latest.  There can only be one such directive.</p><p>This error says that a second <code>@schema_upgrade_version</code> directive has been found.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0230-schema-upgrade-version-declaration-must-be-outside-of-any-proc">CQL0230: schema upgrade version declaration must be outside of any proc<a class="hash-link" href="#cql0230-schema-upgrade-version-declaration-must-be-outside-of-any-proc" title="Direct link to heading">​</a></h3><p>When authoring a schema migration procedure that was previously declared in an <code>@create</code> or <code>@delete</code> directive, the code in that procedure expects to see the schema as it existed at the version it is to migrate.  The <code>@schema_upgrade_version</code> directive allows you to set the visible schema version to something other than the latest.  There can only be one such directive.</p><p>This error says that the <code>@schema_upgrade_version</code> directive was found inside of a stored procedure.  This is not allowed.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0231-schema-upgrade-version-declaration-must-come-before-any-tables-are-declared">CQL0231: schema upgrade version declaration must come before any tables are declared<a class="hash-link" href="#cql0231-schema-upgrade-version-declaration-must-come-before-any-tables-are-declared" title="Direct link to heading">​</a></h3><p>When authoring a schema migration procedure that was previously declared in an <code>@create</code> or <code>@delete</code> directive, the code in that procedure expects to see the schema as it existed at the version it is to migrate.  The <code>@schema_upgrade_version</code> directive allows you to set the visible schema version to something other than the latest.  There can only be one such directive.</p><p>This error says that the <code>@schema_upgrade_version</code> directive came after tables were already declared.  This is not allowed, the directive must come before any DDL.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0232-nested-select-expression-must-return-exactly-one-column">CQL0232: nested select expression must return exactly one column<a class="hash-link" href="#cql0232-nested-select-expression-must-return-exactly-one-column" title="Direct link to heading">​</a></h3><p>In a <code>SELECT</code> expression like <code>set x := (select id from bar)</code> the select statement must return exactly one column as in the example provided.  Note that a runtime error will ensue if the statement returns zero rows, or more than one row,  so this form is very limited.  To fix this error change your select statement to return exactly one column.  Consider how many rows you will get very carefully also, that cannot be checked at compile time.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0233-procedure-previously-declared-as-schema-upgrade-proc-it-can-have-no-args-procedure_name">CQL0233: procedure previously declared as schema upgrade proc, it can have no args &#x27;procedure_name&#x27;<a class="hash-link" href="#cql0233-procedure-previously-declared-as-schema-upgrade-proc-it-can-have-no-args-procedure_name" title="Direct link to heading">​</a></h3><p>When authoring a schema migration procedure that was previously declared in an <code>@create</code> or <code>@delete</code> directive that procedure will be called during schema migration with no context available.  Therefore, the schema migration proc is not allowed to have any arguments.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0234-autodrop-annotation-can-only-go-on-a-procedure-that-returns-a-result-set-procedure_name">CQL0234: autodrop annotation can only go on a procedure that returns a result set &#x27;procedure_name&#x27;<a class="hash-link" href="#cql0234-autodrop-annotation-can-only-go-on-a-procedure-that-returns-a-result-set-procedure_name" title="Direct link to heading">​</a></h3><p>The named procedure has the <code>autodrop</code> annotation (to automatically drop a temporary table) but the procedure in question doesn&#x27;t return a result set so it has no need of the autodrop feature.  The purpose that that feature is to drop the indicated temporary tables once all the select results have been fetched.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0235-too-many-arguments-provided-to-procedure-procedure_name">CQL0235: too many arguments provided to procedure &#x27;procedure_name&#x27;<a class="hash-link" href="#cql0235-too-many-arguments-provided-to-procedure-procedure_name" title="Direct link to heading">​</a></h3><p>In a <code>CALL</code> statement, or a function call, the named procedure takes fewer arguments than were provided. This error might be due to some copy/pasta going on or perhaps the argument list of the procedure/function changed to fewer items.
To fix this, consult the argument list and adjust the call accordingly.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0236-autodrop-annotation-can-only-go-on-a-procedure-that-uses-the-database-name">CQL0236: autodrop annotation can only go on a procedure that uses the database &#x27;name&#x27;<a class="hash-link" href="#cql0236-autodrop-annotation-can-only-go-on-a-procedure-that-uses-the-database-name" title="Direct link to heading">​</a></h3><p>The named procedure has the <code>autodrop</code> annotation (to automatically drop a temporary table) but the procedure in question doesn&#x27;t even use the database at all, much less the named table.  This annotation is therefore redundant.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0237-strict-fk-validation-requires-that-some-on-update-option-be-selected-for-every-foreign-key">CQL0237: strict FK validation requires that some ON UPDATE option be selected for every foreign key<a class="hash-link" href="#cql0237-strict-fk-validation-requires-that-some-on-update-option-be-selected-for-every-foreign-key" title="Direct link to heading">​</a></h3><p><code>@enforce_strict</code> has been use to enable strict foreign key enforcement.  When enabled every foreign key must have an action for the <code>ON UPDATE</code> rule.  You can specify <code>NO ACTION</code> but you can&#x27;t simply leave the action blank.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0238-strict-fk-validation-requires-that-some-on-delete-option-be-selected-for-every-foreign-key">CQL0238: strict FK validation requires that some ON DELETE option be selected for every foreign key<a class="hash-link" href="#cql0238-strict-fk-validation-requires-that-some-on-delete-option-be-selected-for-every-foreign-key" title="Direct link to heading">​</a></h3><p><code>@enforce_strict</code> has been use to enable strict foreign key enforcement.  When enabled every foreign key must have an action for the <code>ON DELETE</code> rule.  You can specify <code>NO ACTION</code> but you can&#x27;t simply leave the action blank.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0239-annotation-column-does-not-exist-in-result-set-column_name">CQL0239: &#x27;annotation&#x27; column does not exist in result set &#x27;column_name&#x27;<a class="hash-link" href="#cql0239-annotation-column-does-not-exist-in-result-set-column_name" title="Direct link to heading">​</a></h3><p>The <code>@attribute(cql:identity=(col1, col2, ...))</code> form has been used to list the identity columns of a stored procedures result set.  These columns must exist in the result set and they must be unique.  The indicated column name is not part of the result of the procedure that is being annotated.</p><p>The <code>@attribute(cql:vault_sensitive=(col1, col2, ...)</code> form has been used to list the columns of a stored procedures
result set. These columns must exist in the result set. The indicated column name will be encoded if they are sensitive
and the cursor that produced the result_set is a DML.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0240-identity-annotation-can-only-go-on-a-procedure-that-returns-a-result-set-procedure_name">CQL0240: identity annotation can only go on a procedure that returns a result set &#x27;procedure_name&#x27;<a class="hash-link" href="#cql0240-identity-annotation-can-only-go-on-a-procedure-that-returns-a-result-set-procedure_name" title="Direct link to heading">​</a></h3><p>The <code>@attribute(cql:identity=(col1, col2,...))</code> form has been used to list the identity columns of a stored procedures result set.  These columns must exist in the result set and they must be unique.  In this case, the named procedure doesn&#x27;t even return a result set.  Probably there is a copy/pasta going on.  The identity attribute can likely be removed.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0241-concat-may-only-appear-in-the-context-of-sql-statement">CQL0241: CONCAT may only appear in the context of SQL statement<a class="hash-link" href="#cql0241-concat-may-only-appear-in-the-context-of-sql-statement" title="Direct link to heading">​</a></h3><p>The SQLite <code>||</code> operator has complex string conversion rules making it impossible to faithfully emulate.  Since there is no helper function for doing concatenations, CQL choses to support this operator only in contexts where it will be evaluated by SQLite.  That is, inside of some SQL statement.</p><p>Examples:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> X </span><span class="token keyword" style="font-style:italic">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> X :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;foo&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">||</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;bar&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">   </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- error</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> X :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;foo&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">||</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;bar&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- ok</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If concatenation is required in some non-sql context, use the <code>(select ..)</code> expression form to let SQLite do the evaluation.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0242-lossy-conversion-from-type-type">CQL0242: lossy conversion from type &#x27;type&#x27;<a class="hash-link" href="#cql0242-lossy-conversion-from-type-type" title="Direct link to heading">​</a></h3><p>There is an explicit (<code>set x := y</code>) or implicit assignment (e.g. conversion of a parameter) where the storage for the
target is a smaller numeric type than the expression that is being stored.   This usually means a variable that should
have been declared <code>LONG</code> is instead declared <code>INTEGER</code> or that you are typing to pass a LONG to a procedure that expects an <code>INTEGER</code></p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0243-blob-operand-must-be-converted-to-string-first-in-">CQL0243: blob operand must be converted to string first in &#x27;||&#x27;<a class="hash-link" href="#cql0243-blob-operand-must-be-converted-to-string-first-in-" title="Direct link to heading">​</a></h3><p>We explicitly do not wish to support string concatenation for blobs that holds non-string data. If the blob contains string data, make your intent clear by converting it to string first using <code>CAST</code> before doing the concatenation.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0244-unknown-schema-region-region">CQL0244: unknown schema region &#x27;region&#x27;<a class="hash-link" href="#cql0244-unknown-schema-region-region" title="Direct link to heading">​</a></h3><p>In a <code>@declare_schema_region</code> statement one of the USING regions is not a valid region name.  Or in <code>@begin_schema_region</code> the region name is not valid.  This probably means there is a typo in your code.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0245-schema-region-already-defined-region">CQL0245: schema region already defined &#x27;region&#x27;<a class="hash-link" href="#cql0245-schema-region-already-defined-region" title="Direct link to heading">​</a></h3><p>The indicated region was previously defined, it cannot be redefined.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0246-schema-regions-do-not-nest-end-the-current-region-before-starting-a-new-one">CQL0246: schema regions do not nest; end the current region before starting a new one<a class="hash-link" href="#cql0246-schema-regions-do-not-nest-end-the-current-region-before-starting-a-new-one" title="Direct link to heading">​</a></h3><p>Another <code>@begin_schema_region</code> directive was encountered before the previous <code>@end_schema_region</code> was found.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0247-you-must-begin-a-schema-region-before-you-can-end-one">CQL0247: you must begin a schema region before you can end one<a class="hash-link" href="#cql0247-you-must-begin-a-schema-region-before-you-can-end-one" title="Direct link to heading">​</a></h3><p>An <code>@end_schema_region</code> directive was encountered but there was no corresponding <code>@begin_schema_region</code> directive.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0248-schema-region-directives-may-not-appear-inside-of-a-procedure">CQL0248: schema region directives may not appear inside of a procedure<a class="hash-link" href="#cql0248-schema-region-directives-may-not-appear-inside-of-a-procedure" title="Direct link to heading">​</a></h3><p>All of the <code>*_schema_region</code> directives must be used at the top level of your program, where tables are typically declared.  They do not belong inside of procedures.  If you get this error, move the directive out of the procedure near the DDL that it affects.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0249-function-is-not-a-table-valued-function-function_name">CQL0249: function is not a table-valued-function &#x27;function_name&#x27;<a class="hash-link" href="#cql0249-function-is-not-a-table-valued-function-function_name" title="Direct link to heading">​</a></h3><p>The indicated identifier appears in the context of a table, it is a function, but it is not a table-valued function.  Either the declaration is wrong (use  something like <code>declare select function foo(arg text) (id integer, t text)</code>) or the name is wrong.  Or both.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0250-table-valued-function-not-declared-function_name">CQL0250: table-valued function not declared &#x27;function_name&#x27;<a class="hash-link" href="#cql0250-table-valued-function-not-declared-function_name" title="Direct link to heading">​</a></h3><p>In a select statement, there is a reference to the indicated table-valued-function.  For instance:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- the above error happens if my_function has not been declared</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- as a table valued function</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> my_function</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>However , <code>my_function</code> has not been declared as a function at all.  A correct declaration might look like this:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> my_function</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b </span><span class="token keyword" style="font-style:italic">int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> c </span><span class="token keyword" style="font-style:italic">int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                                   </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x </span><span class="token keyword" style="font-style:italic">int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> y </span><span class="token keyword" style="font-style:italic">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Either there is a typo in the name or the declaration is missing, or both...</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0251-fragment-must-end-with-exactly-select--from-cte">CQL0251: fragment must end with exactly &#x27;SELECT * FROM CTE&#x27;<a class="hash-link" href="#cql0251-fragment-must-end-with-exactly-select--from-cte" title="Direct link to heading">​</a></h3><p>Query fragments have an exact prescription for their shape.  This prescription includes <code>select * from CTE</code> as the final query where CTE is the common table expression that they define.  This the error message includes the specific name that is required in this context.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0252-proc-literal-can-only-appear-inside-of-procedures">CQL0252: @PROC literal can only appear inside of procedures<a class="hash-link" href="#cql0252-proc-literal-can-only-appear-inside-of-procedures" title="Direct link to heading">​</a></h3><p>An @PROC literal was used outside of any procedure.  It cannot be resolved if it isn&#x27;t inside a procedure.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0253-base-fragment-must-have-only-a-single-cte-named-the-same-as-the-fragment-name">CQL0253: base fragment must have only a single CTE named the same as the fragment &#x27;name&#x27;<a class="hash-link" href="#cql0253-base-fragment-must-have-only-a-single-cte-named-the-same-as-the-fragment-name" title="Direct link to heading">​</a></h3><p>Query fragments have an exact prescription for their shape.  This prescription includes  <code>select * from CTE</code> where CTE is the single common table expression with the same name as the base query.</p><p>This error says that the final select came from something other than the single CTE that is the base name or there was more than one CTE in the fragment.</p><p>You can also get this error if you have an extension fragment but you accidentally marked it as a base fragment.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0254-switching-to-previous-schema-validation-mode-not-allowed-if-schema_upgrade_version-was-used">CQL0254: switching to previous schema validation mode not allowed if <code>@schema_upgrade_version</code> was used<a class="hash-link" href="#cql0254-switching-to-previous-schema-validation-mode-not-allowed-if-schema_upgrade_version-was-used" title="Direct link to heading">​</a></h3><p>When authoring a schema migration script (a stored proc named in an <code>@create</code> or <code>@delete</code> annotation) you must create that procedure in a file that is marked with <code>@schema_upgrade_verison</code> specifying the schema version it is upgrading.  If you do this, then the proc (correctly) only sees the schema as it existed at that version.  However that makes the schema unsuitable for analysis using <code>@previous_schema</code> because it could be arbitrarily far in the past.  This error prevents you from combining those features.  Previous schema validation should only happen against the current schema.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0255-fragment-name-is-not-a-previously-declared-base-fragment-bad_fragment_name">CQL0255: fragment name is not a previously declared base fragment &#x27;bad_fragment_name&#x27;<a class="hash-link" href="#cql0255-fragment-name-is-not-a-previously-declared-base-fragment-bad_fragment_name" title="Direct link to heading">​</a></h3><p>In an extension or assembly fragment declaration, the specified base fragment name has not been previously defined and that is not allowed.</p><p>Probably there is a typo, or the declarations are in the wrong order. The base fragment has to come first.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0256-fragment-name-conflicts-with-existing-base-fragment-name">CQL0256: fragment name conflicts with existing base fragment &#x27;NAME&#x27;<a class="hash-link" href="#cql0256-fragment-name-conflicts-with-existing-base-fragment-name" title="Direct link to heading">​</a></h3><p>Extension query fragment can only be created with a custom procedure name different from all existing base fragment names otherwise we throw this error.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0257-argument-must-be-a-string-or-numeric-in-function">CQL0257: argument must be a string or numeric in &#x27;function&#x27;<a class="hash-link" href="#cql0257-argument-must-be-a-string-or-numeric-in-function" title="Direct link to heading">​</a></h3><p>The indicated function (usually min or max) only works on strings and numerics.  <code>NULL</code> literals, blobs, or objects
are not allowed in this context.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0258-extension-fragment-must-add-exactly-one-cte-found-extra-named-name">CQL0258: extension fragment must add exactly one CTE; found extra named &#x27;name&#x27;<a class="hash-link" href="#cql0258-extension-fragment-must-add-exactly-one-cte-found-extra-named-name" title="Direct link to heading">​</a></h3><p>The extension fragment includes more than one additional CTE, it must have exactly one.</p><p>In the following example, <code>ext2</code> is not valid,  you have to stop at <code>ext1</code></p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- example bad extension fragment</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@attribute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cql:extension_fragment</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">core</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> test_bad_extension_fragment_three</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    core</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">z</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">nullable</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;a&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">nullable</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain">L</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ext1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">z</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> core</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> extra1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> core </span><span class="token keyword" style="font-style:italic">left</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">outer</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">join</span><span class="token plain"> extra1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ext2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">z</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> core</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> extra2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> core </span><span class="token keyword" style="font-style:italic">left</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">outer</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">join</span><span class="token plain"> extra2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> ext2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0259-extension-fragment-cte-must-select-t-from-base-cte">CQL0259: extension fragment CTE must select T.* from base CTE<a class="hash-link" href="#cql0259-extension-fragment-cte-must-select-t-from-base-cte" title="Direct link to heading">​</a></h3><p>For the select expression in extension fragment, it must include all columns from the base table. This error indicates the select expression doesn&#x27;t select from the base table. It should look like this</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> core</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> core</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here core is the name of its base table.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0260-extension-fragment-cte-must-be-a-simple-left-outer-join-from-table_name">CQL0260: extension fragment CTE must be a simple left outer join from &#x27;table_name&#x27;<a class="hash-link" href="#cql0260-extension-fragment-cte-must-be-a-simple-left-outer-join-from-table_name" title="Direct link to heading">​</a></h3><p>Extension fragments may add columns to the result, to do this without lose any rows you must always left outer join to the new data that you with to include.  There is a specific prescription for this.  It has
to look like this:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token variable" style="color:rgb(191, 199, 213)">@attribute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cql:extension_fragment</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">core</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> an_extension</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    core</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">z</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">nullable</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;a&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">nullable</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain">L</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ext1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">z</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> core</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> extra_column </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> core </span><span class="token keyword" style="font-style:italic">left</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">outer</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">join</span><span class="token plain"> extra_stuff</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> ext1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here extension <code>ext1</code> is adding <code>extra_column</code> which came from <code>extra_stuff</code>.  There could have
been any desired join condition or indeed any join expression at all but it has to begin with <code>from core left outer join</code> so that all the core columns will be present and now rows can be removed.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0261-cursor-did-not-originate-from-a-sqlite-statement-it-only-has-values-cursor_name">CQL0261: cursor did not originate from a SQLite statement, it only has values &#x27;cursor_name&#x27;<a class="hash-link" href="#cql0261-cursor-did-not-originate-from-a-sqlite-statement-it-only-has-values-cursor_name" title="Direct link to heading">​</a></h3><p>The form:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">SET</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">CURSOR</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">cursor_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Is used to wrap a cursor in an object so that it can be returned for forwarded.  This is the so-called &quot;boxing&quot; operation
on the cursor.  The object can then be &quot;unboxed&quot; later to make a cursor again.  However the point of this is to
keep reading forward on the cursor perhaps in another procedure.  You can only read forward on a cursor that
has an associated SQLite statement.  That is the cursor was created with something like this</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">CURSOR</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FOR</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If the cursor isn&#x27;t of this form it&#x27;s just values, you can&#x27;t move it forward and so &quot;boxing&quot; it is of no value.  Hence not allowed.
You can return the cursor values with <code>OUT</code> instead.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0262-like--arguments-used-on-a-procedure-with-no-arguments-procedure_name">CQL0262: LIKE ... ARGUMENTS used on a procedure with no arguments &#x27;procedure_name&#x27;<a class="hash-link" href="#cql0262-like--arguments-used-on-a-procedure-with-no-arguments-procedure_name" title="Direct link to heading">​</a></h3><p>The LIKE <!-- -->[procedure]<!-- --> ARGUMENTS form creates a shape for use in a cursor or procedure arguments.</p><p>The indicated name is a procedure with no arguments so it cannot be used to make a shape.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0263-non-ansi-joins-are-forbidden-if-strict-join-mode-is-enabled">CQL0263: non-ANSI joins are forbidden if strict join mode is enabled.<a class="hash-link" href="#cql0263-non-ansi-joins-are-forbidden-if-strict-join-mode-is-enabled" title="Direct link to heading">​</a></h3><p>You can enable strict enforcement of joins to avoid the form</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> A</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>which sometimes confuses people (the above is exactly the same as</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> A </span><span class="token keyword" style="font-style:italic">inner</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">join</span><span class="token plain"> B </span><span class="token keyword" style="font-style:italic">on</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Usually there are constraints on the join also in the WHERE clause but there don&#x27;t have to be.</p><p><code>@enforce_strict join</code> turns on this mode.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0264-duplicate-assembly-fragments-of-base-fragment">CQL0264: duplicate assembly fragments of base fragment<a class="hash-link" href="#cql0264-duplicate-assembly-fragments-of-base-fragment" title="Direct link to heading">​</a></h3><p>For each base fragment, it only allows to exist one assembly fragment of that base fragment.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0265-assembly-fragment-can-only-have-one-cte">CQL0265: assembly fragment can only have one CTE<a class="hash-link" href="#cql0265-assembly-fragment-can-only-have-one-cte" title="Direct link to heading">​</a></h3><p>Assembly fragment can only have one base table CTE.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0266-extension-fragment-name-conflicts-with-existing-fragment">CQL0266: extension fragment name conflicts with existing fragment<a class="hash-link" href="#cql0266-extension-fragment-name-conflicts-with-existing-fragment" title="Direct link to heading">​</a></h3><p>Two or more extension fragments share the same name.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0267-extension-fragments-of-same-base-fragment-share-the-same-cte-column">CQL0267: extension fragments of same base fragment share the same cte column<a class="hash-link" href="#cql0267-extension-fragments-of-same-base-fragment-share-the-same-cte-column" title="Direct link to heading">​</a></h3><p>Two or more extension fragments which have the same base fragments share the same name for one of their unique columns. E.g. the base table is <code>core(x,y)</code> and one extension table is <code>plugin_one(x,y,z)</code> and another is <code>plugin_two(x,y,z)</code>.
Here, z in both extension fragments share the same name but may refer to different values.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0268-extensionassembly-fragment-must-have-the-cte-columns-same-as-the-base-fragment">CQL0268: extension/assembly fragment must have the CTE columns same as the base fragment<a class="hash-link" href="#cql0268-extensionassembly-fragment-must-have-the-cte-columns-same-as-the-base-fragment" title="Direct link to heading">​</a></h3><p> Extension and assembly fragments have an exact prescription for their shape. For each extension and assembly fragment, the first CTE must be a stub for their base table. This error means this stub in extension/assembly fragment differs from the definition of the base table.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0269-at-least-part-of-this-unique-key-is-redundant-with-previous-unique-keys">CQL0269: at least part of this unique key is redundant with previous unique keys<a class="hash-link" href="#cql0269-at-least-part-of-this-unique-key-is-redundant-with-previous-unique-keys" title="Direct link to heading">​</a></h3><p>The new unique key must have at least one column that is not in a previous key AND it must not have all the columns from any previous key.</p><p>e.g:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t1 </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  a </span><span class="token keyword" style="font-style:italic">int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  b long</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  c </span><span class="token keyword" style="font-style:italic">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  d </span><span class="token keyword" style="font-style:italic">real</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">UNIQUE</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">UNIQUE</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- INVALID  (a, b) is already unique key</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">UNIQUE</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- INVALID (b, a) is the same as (a, b)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">UNIQUE</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> d</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- INVALID subset (b, a) is already unique key</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">UNIQUE</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- INVALID a is part of (a, b) key</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">UNIQUE</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- VALID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">UNIQUE</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">d</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- VALID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">UNIQUE</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> d</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- VALID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0270-use-fetch-from-for-procedures-that-returns-a-cursor-with-out-cursor">CQL0270: use FETCH FROM for procedures that returns a cursor with OUT &#x27;cursor&#x27;<a class="hash-link" href="#cql0270-use-fetch-from-for-procedures-that-returns-a-cursor-with-out-cursor" title="Direct link to heading">​</a></h3><p>If you are calling a procedure that returns a value cursor (using <code>OUT</code>) then you accept that cursor using the pattern</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">CURSOR</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FETCH</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The pattern</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">CURSOR</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FOR</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Is used for procedures that provide a full <code>select</code> statement.</p><p>Note that in the former cause you don&#x27;t then use <code>fetch</code> on the cursor.  There is at most one row anyway and it&#x27;s fetched for you so a fetch would be useless.  In the second case you fetch as many rows as there are and/or you want.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0271-offset-clause-may-only-be-used-if-limit-is-also-present">CQL0271: OFFSET clause may only be used if LIMIT is also present<a class="hash-link" href="#cql0271-offset-clause-may-only-be-used-if-limit-is-also-present" title="Direct link to heading">​</a></h3><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> foo </span><span class="token keyword" style="font-style:italic">offset</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Is not supported by SQLite.  <code>OFFSET</code> may only be used if <code>LIMIT</code> is also present.  Also, both should be small because offset is not cheap.  There is no way to do offset other than to read and ignore the indicated number of rows.  So something like <code>offset 1000</code> is always horrible.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0272-columns-referenced-in-the-foreign-key-statement-should-match-exactly-a-unique-key-in-parent-table">CQL0272: columns referenced in the foreign key statement should match exactly a unique key in parent table<a class="hash-link" href="#cql0272-columns-referenced-in-the-foreign-key-statement-should-match-exactly-a-unique-key-in-parent-table" title="Direct link to heading">​</a></h3><p>If you&#x27;re creating a table t2 with foreign keys on table t1, then the set of t1&#x27;s columns reference in the foreign key statement for table t2 should be:</p><ul><li>A primary key in <code>t1</code></li></ul><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">g:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">primary</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">primary</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">foreign</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">references</span><span class="token plain"> t1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>A unique key in <code>t1</code></li></ul><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">g:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">unique</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">primary</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">foreign</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">references</span><span class="token plain"> t1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>A group of unique key in <code>t1</code></li></ul><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">g:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b </span><span class="token keyword" style="font-style:italic">int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">unique</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b </span><span class="token keyword" style="font-style:italic">int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">foreign</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">references</span><span class="token plain"> t1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>A group of primary key in <code>t1</code></li></ul><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">g:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b </span><span class="token keyword" style="font-style:italic">int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">primary</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b </span><span class="token keyword" style="font-style:italic">int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">foreign</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">references</span><span class="token plain"> t1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>A unique index in <code>t1</code></li></ul><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">g:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b </span><span class="token keyword" style="font-style:italic">int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">unique</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">index</span><span class="token plain"> unq </span><span class="token keyword" style="font-style:italic">on</span><span class="token plain"> t1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a </span><span class="token keyword" style="font-style:italic">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b </span><span class="token keyword" style="font-style:italic">int</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">foreign</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">references</span><span class="token plain"> t1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0273-autotest-attribute-has-incorrect-format--in-dummy_test">CQL0273: autotest attribute has incorrect format (...) in &#x27;dummy_test&#x27;<a class="hash-link" href="#cql0273-autotest-attribute-has-incorrect-format--in-dummy_test" title="Direct link to heading">​</a></h3><p>In a <code>cql:autotest</code> annotation, the given <strong>dummy_test</strong> info (table name, column name, column value) has incorrect format.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0274-autotest-attribute-dummy_test-has-non-existent-table">CQL0274: autotest attribute &#x27;dummy_test&#x27; has non existent table<a class="hash-link" href="#cql0274-autotest-attribute-dummy_test-has-non-existent-table" title="Direct link to heading">​</a></h3><p>In a <code>cql:autotest</code> annotation, the given table name for <strong>dummy_test</strong> attribute does not exist.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0275-autotest-attribute-dummy_test-has-non-existent-column">CQL0275: autotest attribute &#x27;dummy_test&#x27; has non existent column<a class="hash-link" href="#cql0275-autotest-attribute-dummy_test-has-non-existent-column" title="Direct link to heading">​</a></h3><p>In a <code>cql:autotest</code> annotation, the given column name for <strong>dummy_test</strong> attribute does not exist.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0276-autotest-attribute-dummy_test-has-invalid-value-type-in">CQL0276: autotest attribute &#x27;dummy_test&#x27; has invalid value type in<a class="hash-link" href="#cql0276-autotest-attribute-dummy_test-has-invalid-value-type-in" title="Direct link to heading">​</a></h3><p>In a <code>cql:autotest</code> annotation, the given column value&#x27;s type for <strong>dummy_test</strong> attribute does not match the column type.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0277-autotest-has-incorrect-format">CQL0277: autotest has incorrect format<a class="hash-link" href="#cql0277-autotest-has-incorrect-format" title="Direct link to heading">​</a></h3><p>In a <code>cql:autotest</code> annotation, the format is incorrect.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0278-autotest-attribute-name-is-not-valid">CQL0278: autotest attribute name is not valid<a class="hash-link" href="#cql0278-autotest-attribute-name-is-not-valid" title="Direct link to heading">​</a></h3><p>In a <code>cql:autotest</code> annotation, the given attribute name is not valid.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0279-columns-referenced-in-an-upsert-conflict-target-must-exactly-match-a-unique-key-the-target-table">CQL0279: columns referenced in an UPSERT conflict target must exactly match a unique key the target table<a class="hash-link" href="#cql0279-columns-referenced-in-an-upsert-conflict-target-must-exactly-match-a-unique-key-the-target-table" title="Direct link to heading">​</a></h3><p>If you&#x27;re doing an UPSERT on table <code>T</code>, the columns listed in the conflict target should be:</p><ul><li>A primary key in <code>T</code></li><li>A unique key in <code>T</code></li><li>A group of unique key in <code>T</code></li><li>A group of primary key in <code>T</code></li><li>A unique index in <code>T</code></li></ul><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0280-upsert-statement-requires-a-where-clause-if-the-insert-clause-uses-select">CQL0280: upsert statement requires a where clause if the insert clause uses select<a class="hash-link" href="#cql0280-upsert-statement-requires-a-where-clause-if-the-insert-clause-uses-select" title="Direct link to heading">​</a></h3><p>When the <code>INSERT</code> statement to which the UPSERT is attached takes its values from a <code>SELECT</code> statement, there is a potential parsing ambiguity. The SQLite parser might not be able to tell if the <code>ON</code> keyword is introducing the UPSERT or if it is the <code>ON</code> clause of a join. To work around this, the <code>SELECT</code> statement should always include a <code>WHERE</code> clause, even if that <code>WHERE</code> clause is just <code>WHERE 1</code> (always true).   Note: The CQL parser doesn&#x27;t have this ambiguity because it treats &quot;ON CONFLICT&quot; as a single token so this is CQL reporting that SQLite might have trouble with the query as written.</p><p>e.g:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> foo </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> id </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> bar </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">on</span><span class="token plain"> conflict</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"> nothing</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0281-upsert-statement-does-not-include-table-name-in-the-update-statement">CQL0281: upsert statement does not include table name in the update statement<a class="hash-link" href="#cql0281-upsert-statement-does-not-include-table-name-in-the-update-statement" title="Direct link to heading">​</a></h3><p>The UPDATE statement of and UPSERT should not include the table name because the name is already known from the INSERT statement part of the UPSERT
e.g:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> foo </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> id </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> bar </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">on</span><span class="token plain"> conflict</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">update</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> id</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0282-update-statement-require-table-name">CQL0282: update statement require table name<a class="hash-link" href="#cql0282-update-statement-require-table-name" title="Direct link to heading">​</a></h3><p>The UPDATE statement should always include a table name except if the UPDATE statement is part of an UPSERT statement.</p><p>e.g:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">update</span><span class="token plain"> foo </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> id</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">values</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">update</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> id</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0283-upsert-syntax-only-support-insert-into">CQL0283: upsert syntax only support INSERT INTO<a class="hash-link" href="#cql0283-upsert-syntax-only-support-insert-into" title="Direct link to heading">​</a></h3><p>The INSERT statement part of an UPSERT statement can only uses INSERT INTO ...</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">e</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">g:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">values</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">on</span><span class="token plain"> conflict </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"> nothing</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">values</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">on</span><span class="token plain"> conflict </span><span class="token keyword" style="font-style:italic">do</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">update</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> id</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0284-ad-hoc-schema-migration-directive-must-provide-a-procedure-to-run">CQL0284: ad hoc schema migration directive must provide a procedure to run<a class="hash-link" href="#cql0284-ad-hoc-schema-migration-directive-must-provide-a-procedure-to-run" title="Direct link to heading">​</a></h3><p><code>@schema_ad_hoc_migration</code> must provide both a version number and a migrate procedure name.
This is unlike the other version directives like <code>@create</code> where the version number is optional.  This
is because the whole point of this migrator is to invoke a procedure of your choice.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0285-ad-hoc-schema-migration-directive-version-number-changed-procedure_name">CQL0285: ad hoc schema migration directive version number changed &#x27;procedure_name&#x27;<a class="hash-link" href="#cql0285-ad-hoc-schema-migration-directive-version-number-changed-procedure_name" title="Direct link to heading">​</a></h3><p>In <code>@schema_ad_hoc_migration</code> you cannot change the version number of the directive once
it has been added to the schema because this could cause inconsistencies when upgrading.</p><p>You can change the body of the method if you need to but this is also not recommended because
again there could be inconsistencies.  However careful replacement and compensation is possible.  This is like
going to 110% on the reactor... possible, but not recommended.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0286-ad-hoc-schema-migration-directive-was-removed-this-is-not-allowed-procedure_name">CQL0286: ad hoc schema migration directive was removed; this is not allowed &#x27;procedure_name&#x27;<a class="hash-link" href="#cql0286-ad-hoc-schema-migration-directive-was-removed-this-is-not-allowed-procedure_name" title="Direct link to heading">​</a></h3><p>An <code>@schema_ad_hoc_migration</code> cannot be removed because it could cause inconsistencies on upgrade.</p><p>You can change the body of the method if you need to but this is also not recommended because
again there could be inconsistencies.  However careful replacement and compensation is possible.  This is like
going to 110% on the reactor... possible, but not recommended.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0287-extensionassembly-fragment-must-add-stub-">CQL0287: extension/assembly fragment must add stub &quot;<a class="hash-link" href="#cql0287-extensionassembly-fragment-must-add-stub-" title="Direct link to heading">​</a></h3><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0288-extensionassembly-fragment-stub-for-base-cte-column-must-be-">CQL0288: extension/assembly fragment stub for base CTE column must be &quot;<a class="hash-link" href="#cql0288-extensionassembly-fragment-stub-for-base-cte-column-must-be-" title="Direct link to heading">​</a></h3><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0289-upsert-statement-are-forbidden-if-strict-upsert-statement-mode-is-enabled">CQL0289: upsert statement are forbidden if strict upsert statement mode is enabled<a class="hash-link" href="#cql0289-upsert-statement-are-forbidden-if-strict-upsert-statement-mode-is-enabled" title="Direct link to heading">​</a></h3><p><code>@enforce_strict</code> has been use to enable strict upsert statement enforcement.  When enabled all sql statement should not use the upsert statement. This is because sqlite version running in some iOS and Android version is old. Upsert statement was added to sqlite in the version <strong>3.24.0 (2018-06-04)</strong>.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0290-fragments-can-only-have-one-statement-in-the-statement-list-and-it-must-be-a-withselect">CQL0290: fragments can only have one statement in the statement list and it must be a WITH...SELECT<a class="hash-link" href="#cql0290-fragments-can-only-have-one-statement-in-the-statement-list-and-it-must-be-a-withselect" title="Direct link to heading">​</a></h3><p>All of the extendable query fragment types consist of a procedure with exactly one statement and that statement is a WITH...SELECT statement.  If you have more than one statement or some other type of statement you&#x27;ll get this error.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0291-region-links-into-the-middle-of-a-deployable-region-you-must-point-to-the-root-of-deployable_region-not-into-the-middle-error_region">CQL0291: region links into the middle of a deployable region; you must point to the root of <code>&lt;deployable_region&gt;</code> not into the middle: <code>&lt;error_region&gt;</code><a class="hash-link" href="#cql0291-region-links-into-the-middle-of-a-deployable-region-you-must-point-to-the-root-of-deployable_region-not-into-the-middle-error_region" title="Direct link to heading">​</a></h3><p>Deployable regions have an &quot;inside&quot; that is in some sense &quot;private&quot;.  In order to keep the consistent (and independently deployable) you can&#x27;t peek into the middle of such
a region, you have to depend on the root (i.e. <code>&lt;deployable_region&gt;</code> itself).  This allows the region to remain independently deployable and for its internal logical regions to be reorganized in whatever manner makes sense.</p><p>To fix this error probably you should change <code>error_region</code> so that it depends directly on <code>deployable_region</code></p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0292-explain-statement-is-only-available-in-dev-mode-because-its-result-set-may-vary-between-sqlite-versions">CQL0292: explain statement is only available in dev mode because its result set may vary between sqlite versions<a class="hash-link" href="#cql0292-explain-statement-is-only-available-in-dev-mode-because-its-result-set-may-vary-between-sqlite-versions" title="Direct link to heading">​</a></h3><p>The EXPLAIN statement is intended for interactive debugging only. It helps engineer understand how Sqlite will execute their query and the cost attached to it. This is why this grammar is only available in dev mode in CQL and should never be used in production.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0293-only-explain-query-plan--statement-is-supported">CQL0293: only <!-- -->[EXPLAIN QUERY PLAN ...]<!-- --> statement is supported<a class="hash-link" href="#cql0293-only-explain-query-plan--statement-is-supported" title="Direct link to heading">​</a></h3><p>CQL only support <!-- -->[EXPLAIN QUERY PLAN stmt]<!-- --> sql statement.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0294-window-function-invocations-can-only-appear-in-the-select-list-of-a-select-statement">CQL0294: window function invocations can only appear in the select list of a select statement<a class="hash-link" href="#cql0294-window-function-invocations-can-only-appear-in-the-select-list-of-a-select-statement" title="Direct link to heading">​</a></h3><p>Not all SQLite builtin function can be used as a window function.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0295-window-name-is-not-defined">CQL0295: window name is not defined<a class="hash-link" href="#cql0295-window-name-is-not-defined" title="Direct link to heading">​</a></h3><p>Window name referenced in the select list should be defined in the Window clause of the same select statement.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0296-window-name-definition-is-not-used">CQL0296: window name definition is not used<a class="hash-link" href="#cql0296-window-name-definition-is-not-used" title="Direct link to heading">​</a></h3><p>Window name defined in the window clause of a select statement should always be used within that statement.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0297-from-shape-is-redundant-if-column-list-is-empty">CQL0297: FROM <!-- -->[shape]<!-- --> is redundant if column list is empty<a class="hash-link" href="#cql0297-from-shape-is-redundant-if-column-list-is-empty" title="Direct link to heading">​</a></h3><p>In this form:</p><p><code>insert into YourTable() FROM your_cursor;</code></p><p>The <code>()</code> means no columns are being specified, the cursor will never be used.  The only source of columns is maybe dummy data (if it was specified) or the default values or null.  In no case will the cursor be used.  If you really want this use <code>FROM VALUES()</code> and don&#x27;t implicate a cursor or an argument bundle.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0298-cannot-read-from-a-cursor-without-fields-cursor_name">CQL0298: cannot read from a cursor without fields &#x27;cursor_name&#x27;<a class="hash-link" href="#cql0298-cannot-read-from-a-cursor-without-fields-cursor_name" title="Direct link to heading">​</a></h3><p>The cursor in question has no storage associated with it.  It was loaded with something like:</p><p><code>fetch C into x, y, z;</code></p><p>You can only use a cursor as a source of data if it was fetched with its own storage like</p><p><code>fetch C</code></p><p>This results in a structure for the cursor.  This gives you C.x, C.y, C.z etc.</p><p>If you fetched the cursor into variables then you have to use the variables for any inserting.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0299-cursor-has-too-few-fields-shape_name">CQL0299: <!-- -->[cursor]<!-- --> has too few fields, &#x27;shape_name&#x27;<a class="hash-link" href="#cql0299-cursor-has-too-few-fields-shape_name" title="Direct link to heading">​</a></h3><p>The named shape was used in a fetch statement but the number of columns fetched is smaller than the number required by the statement we are processing.</p><p>If you need to use the cursor plus some other data then you can&#x27;t use this form, you&#x27;ll have to use each field individually like <code>from values(C.x, C.y, C.z, other_stuff)</code>.</p><p>The shape with too few fields might be the source or the target of the statement.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0300-argument-must-be-an-integer-between-1-and-max-integer-in-function-function_name">CQL0300: argument must be an integer (between 1 and max integer) in function &#x27;function_name&#x27;<a class="hash-link" href="#cql0300-argument-must-be-an-integer-between-1-and-max-integer-in-function-function_name" title="Direct link to heading">​</a></h3><p>The argument of the function should be an integer.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0301-second-argument-must-be-an-integer-between-0-and-max-integer-in-function-function_name">CQL0301: second argument must be an integer (between 0 and max integer) in function &#x27;function_name&#x27;<a class="hash-link" href="#cql0301-second-argument-must-be-an-integer-between-0-and-max-integer-in-function-function_name" title="Direct link to heading">​</a></h3><p>The second argument of the function should be an integer between 0 and INTEGER_MAX.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0302-first-and-third-arguments-must-be-compatible-in-function-function_name">CQL0302: first and third arguments must be compatible in function &#x27;function_name&#x27;<a class="hash-link" href="#cql0302-first-and-third-arguments-must-be-compatible-in-function-function_name" title="Direct link to heading">​</a></h3><p>The first and third arguments of the function have to be of the same type because the third argument provide a default value in cause the first argument is NULL.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0303-second-argument-must-be-an-integer-between-1-and-max-integer-in-function-function_name">CQL0303: second argument must be an integer between 1 and max integer in function &#x27;function_name&#x27;<a class="hash-link" href="#cql0303-second-argument-must-be-an-integer-between-1-and-max-integer-in-function-function_name" title="Direct link to heading">​</a></h3><p>The second argument of the function must be and integer between 1 and INTEGER_MAX.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0304-distinct-may-only-be-used-with-one-explicit-argument-in-an-aggregate-function">CQL0304: DISTINCT may only be used with one explicit argument in an aggregate function<a class="hash-link" href="#cql0304-distinct-may-only-be-used-with-one-explicit-argument-in-an-aggregate-function" title="Direct link to heading">​</a></h3><p>The keyword DISTINCT can only be used with one argument in an aggregate function.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0305-distinct-may-only-be-used-in-function-that-are-aggregated-or-user-defined">CQL0305: DISTINCT may only be used in function that are aggregated or user defined<a class="hash-link" href="#cql0305-distinct-may-only-be-used-in-function-that-are-aggregated-or-user-defined" title="Direct link to heading">​</a></h3><p>Only aggregated functions and user defined functions can use the keyword DISTINCT. Others type of functions are not allowed to use it.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0306-filter-clause-may-only-be-used-in-function-that-are-aggregated-or-user-defined">CQL0306: FILTER clause may only be used in function that are aggregated or user defined<a class="hash-link" href="#cql0306-filter-clause-may-only-be-used-in-function-that-are-aggregated-or-user-defined" title="Direct link to heading">​</a></h3><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0307-return-statement-should-be-in-a-procedure-and-not-at-the-top-level">CQL0307: return statement should be in a procedure and not at the top level<a class="hash-link" href="#cql0307-return-statement-should-be-in-a-procedure-and-not-at-the-top-level" title="Direct link to heading">​</a></h3><p>There are basically two checks here both of which have to do with the &quot;nesting level&quot; at which the <code>return</code> occurs.</p><p>A loose <code>return</code> statement (not in a procedure) is meaningless so that produce an error.  There is nothing to return from.</p><p>If the return statement is not inside of an &quot;if&quot; or something like that then it will run unconditionally.  Nothing should follow the return (see CQL0308) so if we didn&#x27;t fall afoul of CQL0308 and we&#x27;re at the top level then the return is the last thing in the proc, in which case it is totally redundant.</p><p>Both these situations produce an error.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0308-statement-should-be-the-last-thing-in-a-statement-list">CQL0308: statement should be the last thing in a statement list<a class="hash-link" href="#cql0308-statement-should-be-the-last-thing-in-a-statement-list" title="Direct link to heading">​</a></h3><p>Control flow will exit the containing procedure after a <code>return</code> statement, so any statements that follow in its statement list will certainly not run.  So the return statement must be the last statement, otherwise there are dead/unreachable statements which is most likely done by accident.</p><p>To fix this probably the things that came after the return should be deleted.  Or alternately there was a condition on the return that should have been added but wasn&#x27;t, so the return should have been inside a nested statement list (like the body of an <code>if</code> maybe).</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0309-new-table-must-be-added-with-createnumber-or-later-table_name">CQL0309: new table must be added with @create(<!-- -->[number]<!-- -->) or later &#x27;table_name&#x27;<a class="hash-link" href="#cql0309-new-table-must-be-added-with-createnumber-or-later-table_name" title="Direct link to heading">​</a></h3><p>The indicated table was newly added -- it is not present in the previous schema.  However the version number it was added at is in the past.  The new table must appear at the current schema version or later.  That version is provided in the error message.</p><p>To fix this, change the <code>@create</code> annotation on the table to be at the indicated version or later.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0310-new-column-must-be-added-with-createnumber-or-later-column_name">CQL0310: new column must be added with @create(<!-- -->[number]<!-- -->) or later&quot; &#x27;column_name&#x27;<a class="hash-link" href="#cql0310-new-column-must-be-added-with-createnumber-or-later-column_name" title="Direct link to heading">​</a></h3><p>The indicated column was newly added -- it is not present in the previous schema.  However the version number it was added at is in the past.  The new column must appear at the current schema version or later.  That version is provided in the error message.</p><p>To fix this, change the <code>@create</code> annotation on the table to be at the indicated version or later.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0311-objects-deployment-region-changed-from-previous_region-to-current_region-object_name">CQL0311: object&#x27;s deployment region changed from &#x27;&lt;previous_region&gt;&#x27; to &#x27;&lt;current_region&gt;&#x27; &#x27;object_name&#x27;<a class="hash-link" href="#cql0311-objects-deployment-region-changed-from-previous_region-to-current_region-object_name" title="Direct link to heading">​</a></h3><p>An object may not move between deployment regions, because users of the schema will depend on its contents.  New objects can be added to a deployment region but nothing can move from one region to another.  The indicated object appears to be moving.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0312-window-function-invocation-are-forbidden-if-strict-window-function-mode-is-enabled">CQL0312: window function invocation are forbidden if strict window function mode is enabled<a class="hash-link" href="#cql0312-window-function-invocation-are-forbidden-if-strict-window-function-mode-is-enabled" title="Direct link to heading">​</a></h3><p><code>@enforce_strict</code> has been use to enable strict window function enforcement.  When enabled all sql statement should not invoke window function. This is because sqlite version running in some iOS version is old. Window function was added to SQLite in the version <strong>3.25.0 (2018-09-15)</strong>.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0313-blob-literals-may-only-appear-in-the-context-of-a-sql-statement">CQL0313: blob literals may only appear in the context of a SQL statement<a class="hash-link" href="#cql0313-blob-literals-may-only-appear-in-the-context-of-a-sql-statement" title="Direct link to heading">​</a></h3><p>CQL (currently)  limits use of blob literals to inside of SQL fragments.  There&#x27;s no easy way to get a blob
constant variable into the data section so any implementation would be poor.  These don&#x27;t come up very often
in any case so this is a punt basically.  You can fake it with (select x&#x27;1234&#x27;) which makes it clear that
you are doing something expensive.  This is not recommended.  Better to pass the blob you need into CQL
rather than cons it from a literal.  Within SQL it&#x27;s just text and SQLite does the work as usual so that poses no
problems.  And of course non-literal blobs (as args) work find and are bound as usual.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0314-select-function-does-not-require-a-declaration-it-is-a-cql-built-in">CQL0314: select function does not require a declaration, it is a CQL built-in<a class="hash-link" href="#cql0314-select-function-does-not-require-a-declaration-it-is-a-cql-built-in" title="Direct link to heading">​</a></h3><p>CQL built-in function does not require a select function declaration. You can used it directly in your SQL statement.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0315-mandatory-column-with-no-default-value-in-insert-into-name-default-values-statement">CQL0315: mandatory column with no default value in INSERT INTO name DEFAULT VALUES statement.<a class="hash-link" href="#cql0315-mandatory-column-with-no-default-value-in-insert-into-name-default-values-statement" title="Direct link to heading">​</a></h3><p>Columns on a table must have default value or be nullable in order to use INSERT INTO <code>&lt;table&gt;</code> DEFAULT VALUES statement.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0316-upsert-clause-is-not-compatible-with-default-values">CQL0316: upsert-clause is not compatible with DEFAULT VALUES<a class="hash-link" href="#cql0316-upsert-clause-is-not-compatible-with-default-values" title="Direct link to heading">​</a></h3><p>INSERT statement with DEFAULT VALUES can not be used in a upsert statement.  This form is not supported by SQLite.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0317-char-function-arguments-must-be-integer">CQL0317: char function arguments must be integer<a class="hash-link" href="#cql0317-char-function-arguments-must-be-integer" title="Direct link to heading">​</a></h3><p>All parameters of the built-In scalar CQL functions <code>char(...)</code> must be of type integer.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0318-more-than-one-fragment-annotation-on-procedure-procedure_name">CQL0318: more than one fragment annotation on procedure &#x27;procedure_name&#x27;<a class="hash-link" href="#cql0318-more-than-one-fragment-annotation-on-procedure-procedure_name" title="Direct link to heading">​</a></h3><p>The indicated procedure has several cql:*_fragment annotations such as cql:base_fragment and cql:extension_fragment.  You can have at most one of these.</p><p>example:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token variable" style="color:rgb(191, 199, 213)">@attribute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cql:assembly_fragment</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@attribute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cql:base_fragment</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">goo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> mixed_frag_types3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id_ </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0319-name-of-the-assembly-procedure-must-match-the-name-of-the-base-fragment-procedure_name">CQL0319: name of the assembly procedure must match the name of the base fragment &#x27;procedure_name&#x27;<a class="hash-link" href="#cql0319-name-of-the-assembly-procedure-must-match-the-name-of-the-base-fragment-procedure_name" title="Direct link to heading">​</a></h3><p>The name of the procedure that carries the assembly attribute (cql:assembly_fragment) has to match the name of the base fragment.  This is because the code that is generated for the extension fragments refers to some shared code that is generated in the assembly fragment.  If the assembly fragment were allowed to have a distinct name the linkage could never work.</p><p>example:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- correct example</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- note: &#x27;foo&#x27; must be a valid base fragment, declared elsewhere</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@attribute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cql:assembly_fragment</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id_ </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- incorrect example</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@attribute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cql:assembly_fragment</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id_ </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0320-extension-fragment-cte-must-have-a-from-clause-and-no-other-top-level-clauses-frag_name">CQL0320: extension fragment CTE must have a FROM clause and no other top level clauses &#x27;frag_name&#x27;<a class="hash-link" href="#cql0320-extension-fragment-cte-must-have-a-from-clause-and-no-other-top-level-clauses-frag_name" title="Direct link to heading">​</a></h3><p>In the extension fragment form that uses <code>LEFT OUTER JOIN</code> to add columns you cannot include top level restrictions/changes like <code>WHERE</code>, <code>ORDER BY</code>, <code>LIMIT</code> and so forth.  Any of these would remove or reorder the rows from the core fragment and that is not allowed, you can only add columns.  Hence you must have a <code>FROM</code> clause and you can have no other top level clauses.  You can use any clauses you like in a nested select to get your additional columns.</p><p>Note: you could potentially add rows with a <code>LEFT OUTER JOIN</code> and a generous <code>ON</code> clause. That&#x27;s allowed but not recommended. The <code>ON</code> clause can&#x27;t be forbidden because it&#x27;s essential in the normal case.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0321-migration-proc-not-allowed-on-object-object_name">CQL0321: migration proc not allowed on object &#x27;object_name&#x27;<a class="hash-link" href="#cql0321-migration-proc-not-allowed-on-object-object_name" title="Direct link to heading">​</a></h3><p>The indicated name is an index or a trigger. These objects may not have a migration script associated with them when they are deleted.</p><p>The reason for this is that both these types of objects are attached to a table and the table itself might be deleted.  If the table is deleted it becomes impossible to express even a tombstone for the deleted trigger or index without getting errors.  As a consequence the index/trigger must be completely removed.  But if there had been a migration procedure on it then some upgrade sequences would have run it, but others would not (anyone who upgraded after the table was deleted would not get the migration procedure).  To avoid this problem, migration procedures are not allowed on indices and triggers.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0322-fragment-parameters-must-be-exactly-arguments-procedure_name">CQL0322: fragment parameters must be exactly &#x27;<!-- -->[arguments]<!-- -->&#x27; &#x27;procedure_name&#x27;<a class="hash-link" href="#cql0322-fragment-parameters-must-be-exactly-arguments-procedure_name" title="Direct link to heading">​</a></h3><p>The named procedure is an extension fragment or an assembly fragment. It must have exactly the same arguments as the base fragment.  These arguments are provided.</p><p>Recall that the code for the procedure that does the select comes from the assembly fragment, so its arguments are in some sense the only ones that matter.  But the extension fragments are also allowed to use the arguments.  Of course we must ensure that the extension fragments do not use any arguments that aren&#x27;t in the assembly, and so the only choice we have is to make sure the extensions conform to the base.  And so for that to work the assembly also has to conform to the base.  So the base fragment must define the args for all the other fragments.</p><p>You could imagine a scheme where the extension fragments are allowed to use a subset of the parameters defined in the base but if that were the case you might have names that mean different things in different fragments and then you could get errors or different semantics when the fragments were assembled. To avoid all of these problems, and for simplicity, we demand that the arguments of all fragments match exactly.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0323-calls-to-undeclared-procedures-are-forbidden-declaration-missing-or-typo-procedure">CQL0323: calls to undeclared procedures are forbidden; declaration missing or typo &#x27;procedure&#x27;<a class="hash-link" href="#cql0323-calls-to-undeclared-procedures-are-forbidden-declaration-missing-or-typo-procedure" title="Direct link to heading">​</a></h3><p>If you get this error it means that there is a typo in the name of the procedure you are trying to call, or else the declaration for the
procedure is totally missing.  Maybe a necessary <code>#include</code> needs to be added to the compiland.</p><p>Previously if you attempted to call an unknown CQL would produce a generic function call. If you need to do this, especially a function with varargs,
then you must declare the function  with something like:</p><p><code>DECLARE PROCEDURE printf NO CHECK;</code></p><p>This option only works for void functions.  For more complex signatures check <code>DECLARE FUNCTION</code> and <code>DECLARE SELECT FUNCTION</code>.  Usually these will require a
simple wrapper to call from CQL.</p><p>In all cases there must be some kind of declaration,to avoid mysterious linker failures or argument signature mismatches.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0324-referenced-table-was-created-in-a-later-version-so-it-cannot-be-used-in-a-foreign-key-referenced_table">CQL0324: referenced table was created in a later version so it cannot be used in a foreign key &#x27;referenced_table&#x27;<a class="hash-link" href="#cql0324-referenced-table-was-created-in-a-later-version-so-it-cannot-be-used-in-a-foreign-key-referenced_table" title="Direct link to heading">​</a></h3><p>In a foreign key, we enforce the following rules:</p><ul><li><code>@recreate</code> tables can see any version they like, if the name is in scope that&#x27;s good enough</li><li>other tables may only &quot;see&quot; the same version or an earlier version.</li></ul><p>Normal processing can&#x27;t actually get into this state because if you tried to create the referencing
table with the smaller version number first you would get errors because the name of the referenced
table doesn&#x27;t yet exist.  But if you created them at the same time and you made a typo in the version
number of the referenced table such that it was accidentally bigger you&#x27;d create a weirdness.
So we check for that situation here and reject it to prevent that sort of typo.</p><p>If you see this error there is almost certainly a typo in the version number of the referenced table; it should be fixed.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0325-ok_table_scan-attribute-must-be-a-name">CQL0325: ok_table_scan attribute must be a name<a class="hash-link" href="#cql0325-ok_table_scan-attribute-must-be-a-name" title="Direct link to heading">​</a></h3><p>The values for the attribute <code>ok_table_scan</code> can only be names.</p><p>CQL attributes can have a variety of values but in this case the attribute refers to the names
of tables so no other type of attribute is reasonable.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0326-table-name-in-ok_table_scan-does-not-exist-table_name">CQL0326: table name in ok_table_scan does not exist &#x27;table_name&#x27;<a class="hash-link" href="#cql0326-table-name-in-ok_table_scan-does-not-exist-table_name" title="Direct link to heading">​</a></h3><p>The names provided to <code>ok_table_scan</code> attribute should be names of existing tables.</p><p>The attribute indicates tables that are ok to scan in this procedure even though they
are typically not ok to scan due to &#x27;no_table_scan&#x27;.  Therefore the attribute must
refer to an existing table.  There is likely a typo in the the table name that needs
to be corrected.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0327-a-value-should-not-be-assigned-to-attribute_name-attribute">CQL0327: a value should not be assigned to &#x27;attribute_name&#x27; attribute<a class="hash-link" href="#cql0327-a-value-should-not-be-assigned-to-attribute_name-attribute" title="Direct link to heading">​</a></h3><p>The attribute <code>attribute_name</code> doesn&#x27;t take a value.</p><p>When marking a statement with <code>@attribute(cql:&lt;attribute_name&gt;)</code> there is no need
for an attribute value.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0328-attribute_name-attribute-may-only-be-added-to-a-statement_name">CQL0328: &#x27;attribute_name&#x27; attribute may only be added to a &#x27;statement_name&#x27;<a class="hash-link" href="#cql0328-attribute_name-attribute-may-only-be-added-to-a-statement_name" title="Direct link to heading">​</a></h3><p>The <code>attribute_name</code> attribute can only be assigned to specific statements.</p><p>The marking <code>@attribute(cql:&lt;attribute_name&gt;)</code> only makes sense on specific statement. It&#x27;s likely
been put somewhere strange, If it isn&#x27;t obviously on the wrong thing, look into
possibly how the source is after macro expansion.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0329-ok_table_scan-attribute-can-only-be-used-in-a-create-procedure-statement">CQL0329: ok_table_scan attribute can only be used in a create procedure statement<a class="hash-link" href="#cql0329-ok_table_scan-attribute-can-only-be-used-in-a-create-procedure-statement" title="Direct link to heading">​</a></h3><p>The <code>ok_table_scan</code> can only be placed on a create procedure statement.</p><p>The marking <code>@attribute(cql:ok_table_scan=...)</code> indicates that the procedure may scan
the indicated tables. This marking doesn&#x27;t make sense on other kinds of statements.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0330-fragment-must-start-with-exactly-select--from-cte">CQL0330: fragment must start with exactly &#x27;SELECT * FROM CTE&#x27;<a class="hash-link" href="#cql0330-fragment-must-start-with-exactly-select--from-cte" title="Direct link to heading">​</a></h3><p>Query fragments have an exact prescription for their shape.  This prescription includes <code>select * from CTE</code> in the
first branch of the UNION ALL operator when using that form.  Here CTE
is the common table expression that they define.  This the error message includes the
specific name that is required in this context.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0331-extension-fragment-cte-must-have-not-have-order-by-or-limit-clauses-frag_name">CQL0331: extension fragment CTE must have not have ORDER BY or LIMIT clauses &#x27;frag_name&#x27;<a class="hash-link" href="#cql0331-extension-fragment-cte-must-have-not-have-order-by-or-limit-clauses-frag_name" title="Direct link to heading">​</a></h3><p>In the extension fragment form that uses <code>UNION ALL</code> to add rows you cannot include the top level operators <code>ORDER BY</code>, or <code>LIMIT</code>  Any of these would remove or reorder the rows from the core fragment and that is not allowed, you can only add new rows.
You can use any clauses you like in a nested selects as they will not remove rows from the base query.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0332-all-extension-fragments-that-use-union-all-must-come-before-those-that-use-left-outer-join-frag_name">CQL0332: all extension fragments that use UNION ALL must come before those that use LEFT OUTER JOIN &#x27;frag_name&#x27;<a class="hash-link" href="#cql0332-all-extension-fragments-that-use-union-all-must-come-before-those-that-use-left-outer-join-frag_name" title="Direct link to heading">​</a></h3><p>Query fragments that add rows using the UNION ALL form have no way to refer columns that may have been added before
them in the part of the query that adds rows (the second and subsequent branches of UNION ALL).  As a result,
in order to get a assembled query that makes sense the row-adding form must always come before any columns
were added.  Hence all of these fragments must come before any of the LEFT OUTER JOIN form.</p><p>If you get this error, you should re-order your fragments such that the UNION ALL form comes before any
LEFT OUTER JOIN fragments.  The offending fragment is named in the error.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0333-all-the-compound-operators-in-this-cte-must-be-union-all">CQL0333: all the compound operators in this CTE must be UNION ALL<a class="hash-link" href="#cql0333-all-the-compound-operators-in-this-cte-must-be-union-all" title="Direct link to heading">​</a></h3><p>The compound operators in CTE must and always be an UNION ALL.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0334-dummy_seed-dummy_nullables-dummy_defaults-many-only-be-used-with-a-single-values-row">CQL0334: @dummy_seed @dummy_nullables @dummy_defaults many only be used with a single VALUES row<a class="hash-link" href="#cql0334-dummy_seed-dummy_nullables-dummy_defaults-many-only-be-used-with-a-single-values-row" title="Direct link to heading">​</a></h3><p>Dummy insert feature makes only sense when it&#x27;s used in a VALUES clause that is not part of a compound select statement.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0336-select-statement-with-values-clause-requires-a-non-empty-list-of-values">CQL0336: select statement with VALUES clause requires a non empty list of values<a class="hash-link" href="#cql0336-select-statement-with-values-clause-requires-a-non-empty-list-of-values" title="Direct link to heading">​</a></h3><p>VALUES clause requires at least a value for each of the values list. Empty values list are not supported.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0337-number-of-columns-values-for-each-row-should-be-identical-in-values-clause">CQL0337: number of columns values for each row should be identical in VALUES clause<a class="hash-link" href="#cql0337-number-of-columns-values-for-each-row-should-be-identical-in-values-clause" title="Direct link to heading">​</a></h3><p>The number of values for each values list in VALUES clause should always be the same.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0338-name-of-a-migration-procedure-may-not-end-in-_crc-procedure_name">CQL0338: name of a migration procedure may not end in &#x27;_crc&#x27; &#x27;procedure_name&#x27;<a class="hash-link" href="#cql0338-name-of-a-migration-procedure-may-not-end-in-_crc-procedure_name" title="Direct link to heading">​</a></h3><p>To avoid name conflicts in the upgrade script, migration procedures are not allowed to end in &#x27;_crc&#x27;
this suffix is reserved for internal use.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0339-without-rowid-tables-are-forbidden-if-strict-without-rowid-mode-is-enabled">CQL0339: WITHOUT ROWID tables are forbidden if strict without rowid mode is enabled<a class="hash-link" href="#cql0339-without-rowid-tables-are-forbidden-if-strict-without-rowid-mode-is-enabled" title="Direct link to heading">​</a></h3><p><code>@enforce_strict</code> has been used to enable strict <code>WITHOUT ROWID</code> enforcement. When enabled no CREATE TABLE statement can have WITHOUT ROWID clause.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0340-from-arguments-used-in-a-procedure-with-no-arguments-procedure_name">CQL0340: FROM ARGUMENTS used in a procedure with no arguments &#x27;procedure_name&#x27;<a class="hash-link" href="#cql0340-from-arguments-used-in-a-procedure-with-no-arguments-procedure_name" title="Direct link to heading">​</a></h3><p>The named procedure has a call that uses the FROM ARGUMENTS pattern but it doesn&#x27;t have any arguments.
This is almost certainly a cut/paste from a different location that needs to be adjusted.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0341-argument-must-be-a-variable-in-function-function_name">CQL0341: argument must be a variable in function &#x27;function_name&#x27;<a class="hash-link" href="#cql0341-argument-must-be-a-variable-in-function-function_name" title="Direct link to heading">​</a></h3><p>The argument for the CQL builtin function &#x27;function_name&#x27; should always be a variable. It can not be an expression for example</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0342-cursor-arguments-must-have-identical-column-count-function_name">CQL0342: cursor arguments must have identical column count &#x27;function_name&#x27;<a class="hash-link" href="#cql0342-cursor-arguments-must-have-identical-column-count-function_name" title="Direct link to heading">​</a></h3><p>The number of column in the cursor arguments must be identical to accurately do diffing between two cursors.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0343-all-arguments-must-be-blob-cql_get_blob_size">CQL0343: all arguments must be blob &#x27;cql_get_blob_size&#x27;<a class="hash-link" href="#cql0343-all-arguments-must-be-blob-cql_get_blob_size" title="Direct link to heading">​</a></h3><p>The argument for the CQL builtin function cql_get_blob_size should always be of type blob</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0344-argument-must-be-a-nullable-type-but-not-constant-null-in-function">CQL0344: argument must be a nullable type (but not constant NULL) in &#x27;function&#x27;<a class="hash-link" href="#cql0344-argument-must-be-a-nullable-type-but-not-constant-null-in-function" title="Direct link to heading">​</a></h3><p>Functions like <code>ifnull_crash</code> only make sense if the argument is nullable.  If it&#x27;s already
not null the operation is uninteresting/redundant.</p><p>The most likely cause is that the function call in question is vestigial and you can simply remove it.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0345-arguments-must-be-of-type-blob-function_name">CQL0345: arguments must be of type blob &#x27;function_name&#x27;<a class="hash-link" href="#cql0345-arguments-must-be-of-type-blob-function_name" title="Direct link to heading">​</a></h3><p>The indicated function accepts only a single argument of type blob.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0346-expression-must-be-of-type-objectt-cursor-where-t-is-a-valid-shape-name-variable">CQL0346: expression must be of type <code>object&lt;T cursor&gt;</code> where T is a valid shape name &#x27;variable&#x27;<a class="hash-link" href="#cql0346-expression-must-be-of-type-objectt-cursor-where-t-is-a-valid-shape-name-variable" title="Direct link to heading">​</a></h3><p>It&#x27;s possible to take the statement associated with a statement cursor and store it in an object variable. Using the form:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> X</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The object variable &#x27;X&#x27; must be declared as follows:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> X object</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">T </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Where <code>T</code> refers to a named object with a shape, like a table, a view, or a stored procedure that returns a result set. This type <code>T</code> must match the shape of the cursor exactly i.e. having the column names and types.</p><p>The reverse operation, storing a statement cursor in a variable is also possible with this form:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> X </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This has similar constraints on the variable <code>X</code>.</p><p>This error indicates that the variable in question (<code>X</code> in this example) is not a typed object variable so it can&#x27;t be the source of a cursor, or accept a cursor.</p><p>See Chapter 5 of the CQL Programming Language.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0347-select-function-may-not-return-type-object-function_name">CQL0347: select function may not return type OBJECT &#x27;function_name&#x27;<a class="hash-link" href="#cql0347-select-function-may-not-return-type-object-function_name" title="Direct link to heading">​</a></h3><p>The indicated function was declared with <code>DECLARE SELECT FUNCTION</code> meaning it is to be used in the
context of SQLite statements. However, SQLite doesn&#x27;t understand functions that return type object
at all.  Therefore declaration is illegal.</p><p>When working with pointer type through SQLite it is often possibly to encode the object as an long integer assuming
it can pass through unchanged with no retain/release semantics or any such thing.  If that is practical
you can move objects around by returning long integers.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0348-collate-applied-to-a-non-text-column-column_name">CQL0348: collate applied to a non-text column &#x27;column_name&#x27;<a class="hash-link" href="#cql0348-collate-applied-to-a-non-text-column-column_name" title="Direct link to heading">​</a></h3><p>Collation order really only makes sense on text fields.  Possibly blob fields but we&#x27;re taking a stand on blob
for now.  This can be relaxed later if that proves to be a mistake.  For now, only text</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0349-column-definitions-may-not-come-after-constraints-column_name">CQL0349: column definitions may not come after constraints &#x27;column_name&#x27;<a class="hash-link" href="#cql0349-column-definitions-may-not-come-after-constraints-column_name" title="Direct link to heading">​</a></h3><p>In a CREATE TABLE statement, the indicated column name came after a constraint.  SQLite expects all the column definitions
to come before any constraint definitions.  You must move the offending column definition above the constraints.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0350-statement-must-appear-inside-of-a-proc-savepoint-block">CQL0350: statement must appear inside of a PROC SAVEPOINT block<a class="hash-link" href="#cql0350-statement-must-appear-inside-of-a-proc-savepoint-block" title="Direct link to heading">​</a></h3><p>The <code>ROLLBACK RETURN</code> and <code>COMMIT RETURN</code> forms are only usable inside of a <code>PROC SAVEPOINT</code> block
because they rollback or commit the savepoint that was created at the top level.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0351-statement-should-be-in-a-procedure-and-at-the-top-level">CQL0351: statement should be in a procedure and at the top level<a class="hash-link" href="#cql0351-statement-should-be-in-a-procedure-and-at-the-top-level" title="Direct link to heading">​</a></h3><p>The indicated statement may only appear inside procedure and not nested.  The classic example
of this is the <code>PROC SAVEPOINT</code> form which can only be used at the top level of procedures.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0352-use-commit-return-or-rollback-return-in-within-a-proc-savepoint-block">CQL0352: use COMMIT RETURN or ROLLBACK RETURN in within a proc savepoint block<a class="hash-link" href="#cql0352-use-commit-return-or-rollback-return-in-within-a-proc-savepoint-block" title="Direct link to heading">​</a></h3><p>The normal <code>RETURN</code> statement cannot be used inside of <code>PROC SAVEPOINT</code> block, you have to
indicate if you want to commit or rollback the savepoint when you return.  This makes
it impossible to forget to do so which is in some sense the whole point of <code>PROC SAVEPOINT</code>.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0353-evaluation-of-constant-failed">CQL0353: evaluation of constant failed<a class="hash-link" href="#cql0353-evaluation-of-constant-failed" title="Direct link to heading">​</a></h3><p>The constant expression could not be evaluated.  This is most likely because it includes an operator that is
not supported or a function call which is not support.  Very few functions can be used in constant expressions
The supported functions include <code>iif</code>, which is rewritten; <code>abs</code>; <code>ifnull</code>, <code>nullif</code>, and <code>coalesce</code>.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0354-duplicate-enum-member-enum_name">CQL0354: duplicate enum member &#x27;enum_name&#x27;<a class="hash-link" href="#cql0354-duplicate-enum-member-enum_name" title="Direct link to heading">​</a></h3><p>While processing a <code>declare enum</code> statement the indicated member of the enum appeared twice.</p><p>This is almost certainly a copy/paste of the same enum member twice.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0355-evaluation-failed-enum_name">CQL0355: evaluation failed &#x27;enum_name&#x27;<a class="hash-link" href="#cql0355-evaluation-failed-enum_name" title="Direct link to heading">​</a></h3><p>While processing a <code>declare enum</code> statement the indicated member of the enum could not be evaluated as a constant expression.</p><p>There could be a non-constant in the expression or there could be a divide-by-zero error.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0356-enum-definitions-do-not-match-name">CQL0356: enum definitions do not match &#x27;name&#x27;<a class="hash-link" href="#cql0356-enum-definitions-do-not-match-name" title="Direct link to heading">​</a></h3><p>The two described <code>declare enum</code> statements have the same name but they are not identical.</p><p>The error output contains the full text of both declarations to compare.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0357-enum-does-not-contain-enum_name">CQL0357: enum does not contain &#x27;enum_name&#x27;<a class="hash-link" href="#cql0357-enum-does-not-contain-enum_name" title="Direct link to heading">​</a></h3><p>The indicated member is not part of the enumeration.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0358-declared-enums-must-be-top-level-enum">CQL0358: declared enums must be top level &#x27;enum&#x27;<a class="hash-link" href="#cql0358-declared-enums-must-be-top-level-enum" title="Direct link to heading">​</a></h3><p>A <code>DECLARE ENUM</code> statement for the named enum is happening inside of a procedure.  This is not legal.</p><p>To correct this move the declaration outside of the procedure.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0359-duplicate-type-declaration-type_name">CQL0359: duplicate type declaration &#x27;type_name&#x27;<a class="hash-link" href="#cql0359-duplicate-type-declaration-type_name" title="Direct link to heading">​</a></h3><p>The name of a declared type should always be unique.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0360-unknown-type-type_name">CQL0360: unknown type &#x27;type_name&#x27;<a class="hash-link" href="#cql0360-unknown-type-type_name" title="Direct link to heading">​</a></h3><p>The indicated name is not a valid type name.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0361-return-data-type-in-a-create-function-declaration-can-only-be-text-blob-or-object">CQL0361: return data type in a create function declaration can only be Text, Blob or Object<a class="hash-link" href="#cql0361-return-data-type-in-a-create-function-declaration-can-only-be-text-blob-or-object" title="Direct link to heading">​</a></h3><p>Return data type in a create function definition can only be TEXT, BLOB or OBJECT.</p><p>These are the only reference types and so CREATE makes sense only with those types.  An integer, for instance, can&#x27;t start with a +1 reference count.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0362-hidden-column-attribute-must-be-the-first-attribute-if-present">CQL0362: HIDDEN column attribute must be the first attribute if present<a class="hash-link" href="#cql0362-hidden-column-attribute-must-be-the-first-attribute-if-present" title="Direct link to heading">​</a></h3><p>In order to ensure that SQLite will parse HIDDEN as part of the type it has to come before any other attributes like NOT NULL.</p><p>This limitation is due to the fact that CQL and SQLite use slightly different parsing approaches for attributes and in SQLite
HIDDEN isn&#x27;t actually an attribute.  The safest place to put the attribute is right after the type name and before any other
attributes as it is totally unambiguous there so CQL enforces this.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0363-all-arguments-must-be-names-vault_sensitive">CQL0363: all arguments must be names &#x27;vault_sensitive&#x27;<a class="hash-link" href="#cql0363-all-arguments-must-be-names-vault_sensitive" title="Direct link to heading">​</a></h3><p>vault_sensitive attribution only allow names. Integer, string literal, c string or blob are not allowed, only IDs should be provided.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0364-vault_sensitive-annotation-can-only-go-on-a-procedure-that-uses-the-database">CQL0364: vault_sensitive annotation can only go on a procedure that uses the database<a class="hash-link" href="#cql0364-vault_sensitive-annotation-can-only-go-on-a-procedure-that-uses-the-database" title="Direct link to heading">​</a></h3><p>The named procedure has the <code>vault_sensitive</code> annotation to automatically encode sensitive value in the result set. Encoding value require the database, but the procedure in question doesn&#x27;t even use the database at all.  This annotation is therefore useless.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0365-enforce_pop-used-but-there-is-nothing-to-pop">CQL0365: @enforce_pop used but there is nothing to pop<a class="hash-link" href="#cql0365-enforce_pop-used-but-there-is-nothing-to-pop" title="Direct link to heading">​</a></h3><p>Each <code>@enforce_pop</code> should match an <code>@enforce_push</code>, but there is nothing to pop on the stack now.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0366-transaction-operations-disallowed-while-strict-transaction-enforcement-is-on">CQL0366: transaction operations disallowed while STRICT TRANSACTION enforcement is on<a class="hash-link" href="#cql0366-transaction-operations-disallowed-while-strict-transaction-enforcement-is-on" title="Direct link to heading">​</a></h3><p><code>@enforce_strict transaction</code> has been used, while active no transaction operations are allowed.  Savepoints may be used.  This is
typically done to prevent transactions from being used in any ad hoc way because they don&#x27;t nest and typically need to be used
with some &quot;master plan&quot; in mind.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0367-an-attribute-was-specified-twice-attribute_name">CQL0367: an attribute was specified twice &#x27;attribute_name&#x27;<a class="hash-link" href="#cql0367-an-attribute-was-specified-twice-attribute_name" title="Direct link to heading">​</a></h3><p>In the indicated type declaration, the indicated attribute was specified twice.  This is almost certainly happening because the line in question looks like this
<code>declare x type_name not null;</code> but <code>type_name</code> is already <code>not null</code>.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0368-strict-select-if-nothing-requires-that-all-select--expressions-include-if-nothing">CQL0368: strict select if nothing requires that all (select ...) expressions include &#x27;if nothing&#x27;<a class="hash-link" href="#cql0368-strict-select-if-nothing-requires-that-all-select--expressions-include-if-nothing" title="Direct link to heading">​</a></h3><p><code>@enforce_strict select if nothing</code> has been enabled.  This means that select expressions must include
<code>if nothing throw</code> (the old default) <code>if nothing [value]</code> or <code>if nothing or null [value]</code>.  This options exists
because commonly the case where a row does not exist is not handled correctly when <code>(select ...)</code> is used
without the <code>if nothing</code> options.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0369-select--if-nothing-construct-is-for-use-in-top-level-expressions-not-inside-of-other-dml">CQL0369: (SELECT ... IF NOTHING) construct is for use in top level expressions, not inside of other DML<a class="hash-link" href="#cql0369-select--if-nothing-construct-is-for-use-in-top-level-expressions-not-inside-of-other-dml" title="Direct link to heading">​</a></h3><p>This form allows for error control of (select...) expressions.  But SQLite does not
understand the form at all, so it can only appear at the top level of expressions where
CQL can strip it out. Here are some examples:</p><p>good:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">set</span><span class="token plain"> x :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> foo </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> bar </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> baz </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> nothing </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> foo </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> bar </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> baz </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> nothing </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>bad:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> foo </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> bar </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> something </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> somewhere </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> nothing </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">delete</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> foo </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> something </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> somewhere </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> nothing </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Basically if you are already in a SQL context, the form isn&#x27;t usable because SQLite
simply doesn&#x27;t understand if nothing at all. This error makes it so that you&#x27;ll
get a build time failure from CQL rather than a run time failure from SQLite.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0370-due-to-a-memory-leak-bug-in-old-sqlite-versions-the-select-part-of-an-insert-must-not-have-a-top-level-join-or-compound-operator-use-with-and-a-cte-or-a-nested-select-to-work-around-this">CQL0370: due to a memory leak bug in old SQLite versions, the select part of an insert must not have a top level join or compound operator. Use WITH and a CTE, or a nested select to work around this.<a class="hash-link" href="#cql0370-due-to-a-memory-leak-bug-in-old-sqlite-versions-the-select-part-of-an-insert-must-not-have-a-top-level-join-or-compound-operator-use-with-and-a-cte-or-a-nested-select-to-work-around-this" title="Direct link to heading">​</a></h3><p>There is an unfortunate memory leak in older versions of SQLite (research pending on particular versions, but 3.28.0 has it).  It causes this pattern to leak:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- must be autoinc table</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> x </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  pk </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">primary</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">key</span><span class="token plain"> autoincrement</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- any join will do (this is a minimal repro)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> x</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> pk </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> t1 </span><span class="token keyword" style="font-style:italic">inner</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">join</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> t2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can workaround this with a couple of fairly simple rewrites.  This form is probably the cleanest.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">cte </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">pk</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"> anything you need</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> x</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> cte</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Simply wrapping your desired select in a nested select also suffices.  So long as the top level is simple.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">insert</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">into</span><span class="token plain"> x</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> anything you need</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0371-table-valued-function-used-in-a-leftrightcross-context-this-would-hit-a-sqlite-bug--wrap-it-in-a-cte-instead">CQL0371: table valued function used in a left/right/cross context; this would hit a SQLite bug.  Wrap it in a CTE instead.<a class="hash-link" href="#cql0371-table-valued-function-used-in-a-leftrightcross-context-this-would-hit-a-sqlite-bug--wrap-it-in-a-cte-instead" title="Direct link to heading">​</a></h3><p>This error is generated by <code>@enforce_strict table function</code>. It is there to allow safe use of Table Valued Functions (TVFs)
even though there was a bug in SQLite prior to v 3.31.0 when joining against them.  The bug appears when the TVF is on
the right of a left join. For example:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> foo </span><span class="token keyword" style="font-style:italic">left</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">join</span><span class="token plain"> some_tvf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In this case the join becomes an INNER join even though you wrote a left join.  Likewise</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> some_tvf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">right</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">join</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Becomes an inner join even though you wrote a right join.  The same occurs when a TVF is on either side of a cross join.</p><p>The workaround is very simple.  You don&#x27;t want the TVF to be the target of the join directly.  Instead:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">with</span><span class="token plain"> tvf_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> some_tvf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> foo </span><span class="token keyword" style="font-style:italic">left</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">join</span><span class="token plain"> tvf_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>OR</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> foo </span><span class="token keyword" style="font-style:italic">left</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">join</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> some_tvf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0372-select--if-nothing-or-null-null-is-redundant-use-select--if-nothing-null-instead">CQL0372: SELECT ... IF NOTHING OR NULL NULL is redundant; use SELECT ... IF NOTHING NULL instead.<a class="hash-link" href="#cql0372-select--if-nothing-or-null-null-is-redundant-use-select--if-nothing-null-instead" title="Direct link to heading">​</a></h3><p>It is always the case that <code>SELECT ... IF NOTHING OR NULL NULL</code> is equivalent to <code>SELECT ... IF NOTHING NULL</code>. As such, do not do this:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> foo </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> bar </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> baz </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> nothing </span><span class="token operator" style="color:rgb(137, 221, 255)">or</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Do this instead:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> foo </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> bar </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> baz </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> nothing </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0373-comparing-against-null-always-yields-null-use-is-and-is-not-instead">CQL0373: comparing against NULL always yields NULL; use IS and IS NOT instead.<a class="hash-link" href="#cql0373-comparing-against-null-always-yields-null-use-is-and-is-not-instead" title="Direct link to heading">​</a></h3><p>Attempting to check if some value <code>x</code> is NULL via <code>x = NULL</code> or <code>x == NULL</code>, or isn&#x27;t NULL via <code>x &lt;&gt; NULL</code> or <code>x != NULL</code>, will always produce NULL regardless of the value of <code>x</code>. Instead, use <code>x IS NULL</code> or <code>x IS NOT NULL</code> to get the expected boolean result.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0374-select-expression-is-equivalent-to-null">CQL0374: SELECT expression is equivalent to NULL.<a class="hash-link" href="#cql0374-select-expression-is-equivalent-to-null" title="Direct link to heading">​</a></h3><p>CQL found a redundant select operation (e.g., <code>set x := (select NULL);</code>).</p><p>There is no need to write a select expression that always evaluates to NULL. Simply use NULL instead (e.g., <code>set x := NULL;</code>).</p><hr><p>CQL 0375 : unused, this was added to prevent merge conflicts at the end on literally every checkin</p><hr><p>CQL 0376 : unused, this was added to prevent merge conflicts at the end on literally every checkin</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0377-table-transitioning-from-recreate-to-create-must-use-createnncqlfrom_recreate-table-name">CQL0377: table transitioning from <code>@recreate</code> to <code>@create</code> must use <code>@create(nn,cql:from_recreate)</code> &#x27;table name&#x27;<a class="hash-link" href="#cql0377-table-transitioning-from-recreate-to-create-must-use-createnncqlfrom_recreate-table-name" title="Direct link to heading">​</a></h3><p>The indicated table is moving from <code>@recreate</code> to <code>@create</code> meaning it will now be schema managed in an
upgradable fashion.  When this happens end-user databases might have some stale version of the table
from a previous installation.  This stale version must get a one-time cleanup in order to ensure that the
now current schema is correctly applied.  The <code>cql:from_recreate</code> annotation does this.  It is required
because otherwise there would be no record that this table &quot;used to be recreate&quot; and therefore might have
an old version still in the database.</p><p>A correct table might look something like this:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> correct_migration_to_create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">primary</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> t </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(191, 199, 213)">@create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">7</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> cql:from_recreate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0378-built-in-migration-procedure-not-valid-in-this-context-name">CQL0378: built-in migration procedure not valid in this context &#x27;name&#x27;<a class="hash-link" href="#cql0378-built-in-migration-procedure-not-valid-in-this-context-name" title="Direct link to heading">​</a></h3><p>The indicated name is a valid built-in migration procedure but it is not valid on
this kind of item.  For instance <code>cql:from_recreate</code> can only be applied to tables.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0379-unknown-built-in-migration-procedure-name">CQL0379: unknown built-in migration procedure &#x27;name&#x27;<a class="hash-link" href="#cql0379-unknown-built-in-migration-procedure-name" title="Direct link to heading">​</a></h3><p>Certain schema migration steps are built-in.  Currently the only one is <code>cql:from_recreate</code> for
moving to <code>@create</code> from <code>@recreate</code>.  Others may be added in the future.  The <code>cql:</code> prefix
ensures that this name cannot conflict with a valid user migration procedure.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0380-when-expression-cannot-be-evaluated-to-a-constant">CQL0380: WHEN expression cannot be evaluated to a constant<a class="hash-link" href="#cql0380-when-expression-cannot-be-evaluated-to-a-constant" title="Direct link to heading">​</a></h3><p>In a <code>SWITCH</code> statement each expression each expression in a <code>WHEN</code> clause must be made up
of constants and simple numeric math operations.  See the reference on the <code>const(..)</code> expression
for the valid set.</p><p>It&#x27;s most likely that a variable or function call appears in the errant expression.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0381-case-expression-must-be-a-not-null-integral-type">CQL0381: case expression must be a not-null integral type<a class="hash-link" href="#cql0381-case-expression-must-be-a-not-null-integral-type" title="Direct link to heading">​</a></h3><p>The <code>SWITCH</code> statement can only switch over integers or long integers.  It will be translated
directly to the C switch statement form.  <code>TEXT</code>, <code>REAL</code>, <code>BLOB</code>, <code>BOOL</code>, and <code>OBJECT</code> cannot
be used in this way.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0382-type-of-a-when-expression-is-bigger-than-the-type-of-the-switch-expression">CQL0382: type of a WHEN expression is bigger than the type of the SWITCH expression<a class="hash-link" href="#cql0382-type-of-a-when-expression-is-bigger-than-the-type-of-the-switch-expression" title="Direct link to heading">​</a></h3><p>The <code>WHEN</code> expression evaluates to a <code>LONG INTEGER</code> but the expression in the <code>SWITCH</code> is <code>INTEGER</code>.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0383-switch--all-values-is-useless-with-an-else-clause">CQL0383: switch ... ALL VALUES is useless with an ELSE clause<a class="hash-link" href="#cql0383-switch--all-values-is-useless-with-an-else-clause" title="Direct link to heading">​</a></h3><p>The <code>ALL VALUES</code> form of switch means that:</p><ul><li>the <code>SWITCH</code> expression is an enumerated type</li><li>the <code>WHEN</code> cases will completely cover the values of the enum</li></ul><p>If you allow the <code>ELSE</code> form then <code>ALL VALUES</code> becomes meaningless because of
course they are all covered.  So with <code>ALL VALUES</code> there can be no <code>ELSE</code>.</p><p>You can list items that have no action with this form:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">WHEN</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">10</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">15</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"> NOTHING </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- explicitly do nothing in these cases so they are still covered</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>No code is generated for such cases.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0384-switch-statement-did-not-have-any-actual-statements-in-it">CQL0384: switch statement did not have any actual statements in it<a class="hash-link" href="#cql0384-switch-statement-did-not-have-any-actual-statements-in-it" title="Direct link to heading">​</a></h3><p>Either there were no <code>WHEN</code> clauses at all, or they were all <code>WHEN ... THEN NOTHING</code> so
there is no actual code to execute.  You need to add some cases that do work.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0385-when-clauses-contain-duplicate-values-value">CQL0385: WHEN clauses contain duplicate values &#x27;value&#x27;<a class="hash-link" href="#cql0385-when-clauses-contain-duplicate-values-value" title="Direct link to heading">​</a></h3><p>In a <code>SWITCH</code> statement all of the values in the <code>WHEN</code> clauses must be unique.  The indicated
errant entry is a duplicate.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0386-switch--all-values-is-used-but-the-switch-expression-is-not-an-enum-type">CQL0386: SWITCH ... ALL VALUES is used but the switch expression is not an enum type<a class="hash-link" href="#cql0386-switch--all-values-is-used-but-the-switch-expression-is-not-an-enum-type" title="Direct link to heading">​</a></h3><p>In a <code>SWITCH</code> statement with <code>ALL VALUES</code> specified the switch expression was not an enumerated type.
<code>ALL VALUES</code> is used to ensure that there is a case for every value of an enumerated type
so this switch cannot be so checked.  Either correct the expression, or remove <code>ALL VALUES</code>.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0387-a-value-exists-in-the-enum-that-is-not-present-in-the-switch-enum_member">CQL0387: a value exists in the enum that is not present in the switch &#x27;enum_member&#x27;<a class="hash-link" href="#cql0387-a-value-exists-in-the-enum-that-is-not-present-in-the-switch-enum_member" title="Direct link to heading">​</a></h3><p>In a <code>SWITCH</code> statement with <code>ALL VALUES</code> specified the errant enum member did not appear
in any <code>WHEN</code> clause.  All members must be specified when <code>ALL VALUES</code> is used.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0388-a-value-exists-in-the-switch-that-is-not-present-in-the-enum-numeric_value">CQL0388: a value exists in the switch that is not present in the enum &#x27;numeric_value&#x27;<a class="hash-link" href="#cql0388-a-value-exists-in-the-switch-that-is-not-present-in-the-enum-numeric_value" title="Direct link to heading">​</a></h3><p>In a <code>SWITCH</code> statement with <code>ALL VALUES</code> specified the errant integer value appeared in
in a <code>WHEN</code> clause.  This value is not part of the members of the enum.  Note that enum members
that begin with &#x27;_&#x27; are ignored as they are, by convention, considered to be pseudo-members.
e.g. in <code>declare enum v integer (v0 = 0, v1 =1, v2 =2, _count = 3)</code> <code>_count</code> is a pseudo-member.</p><p>The errant entry should probably be removed. Alternatively, <code>ALL VALUES</code> isn&#x27;t appropriate as the
domain of the switch is actually bigger than the domain of the enumeration.  One of these
changes must happen.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0389-declare-out-requires-that-the-procedure-be-already-declared">CQL0389: DECLARE OUT requires that the procedure be already declared<a class="hash-link" href="#cql0389-declare-out-requires-that-the-procedure-be-already-declared" title="Direct link to heading">​</a></h3><p>The purpose of the <code>DECLARE OUT</code> form is to automatically declare the out parameters for that procedure.</p><p>This cannot be done if the type of the procedure is not yet known.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0390-declare-out-call-used-on-a-procedure-with-no-missing-out-arguments">CQL0390: DECLARE OUT CALL used on a procedure with no missing OUT arguments<a class="hash-link" href="#cql0390-declare-out-call-used-on-a-procedure-with-no-missing-out-arguments" title="Direct link to heading">​</a></h3><p>The <code>DECLARE OUT CALL</code> form was used, but the procedure has no <code>OUT</code> arguments that need
any implicit declaration.  Either they have already all been declared or else there are no
<code>OUT</code> arguments at all, or even no arguments of any kind.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0391-close-cannot-be-used-on-a-boxed-cursor">CQL0391: CLOSE cannot be used on a boxed cursor<a class="hash-link" href="#cql0391-close-cannot-be-used-on-a-boxed-cursor" title="Direct link to heading">​</a></h3><p>When a cursor is boxed—i.e., wrapped in an object—the lifetime of the box and underlying statement are automatically managed via reference counting. Accordingly, it does not make sense to manually call CLOSE on such a cursor as it may be retained elsewhere. Instead, to allow the box to be freed and the underlying statement to be finalized, set all references to the cursor to NULL.</p><p>Note: As with all other objects, boxed cursors are automatically released when they fall out of scope. You only have to set a reference to NULL if you want to release the cursor sooner, for some reason.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0392-when-deleting-a-virtual-table-you-must-specify-deletenn-cqlmodule_must_not_be_deleted_see_docs_for_cql0392-as-a-reminder-not-to-delete-the-module-for-this-virtual-table">CQL0392: when deleting a virtual table you must specify @delete(nn, cql:module_must_not_be_deleted_see_docs_for_CQL0392) as a reminder not to delete the module for this virtual table<a class="hash-link" href="#cql0392-when-deleting-a-virtual-table-you-must-specify-deletenn-cqlmodule_must_not_be_deleted_see_docs_for_cql0392-as-a-reminder-not-to-delete-the-module-for-this-virtual-table" title="Direct link to heading">​</a></h3><p>When the schema upgrader runs, if the virtual table is deleted it will attempt to do <code>DROP TABLE IF EXISTS</code> on the indicated table.  This table
is a virtual table.  SQLite will attempt to initialize the table even when you simply try to drop it.  For that to work the module must still
be present.  This means modules can never be deleted!  This attribute is here to remind you of this fact so that you are not tempted to
delete the module for the virtual table when you delete the table.  You may, however, replace it with a shared do-nothing stub.</p><p>The attribute itself does nothing other than hopefully cause you to read this documentation.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0393-user-function-cannot-appear-in-a-constraint-expression-function_name">CQL0393: user function cannot appear in a constraint expression &#x27;function_name&#x27;<a class="hash-link" href="#cql0393-user-function-cannot-appear-in-a-constraint-expression-function_name" title="Direct link to heading">​</a></h3><p><code>CHECK</code> expressions and partial indexes (<code>CREATE INDEX</code> with a <code>WHERE</code> clause) require that the expressions
be deterministic.  User defined functions may or may not be deterministic. Since there is at this time no way
to declare them one way or the otherw UDFs cannot appear inside these constraints to avoid potentially
weird bugs.  This is likely to change in the future when there is a way to declare deterministic UDFs.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0394-nested-select-expressions-may-not-appear-inside-of-a-constraint-expression">CQL0394: nested select expressions may not appear inside of a constraint expression<a class="hash-link" href="#cql0394-nested-select-expressions-may-not-appear-inside-of-a-constraint-expression" title="Direct link to heading">​</a></h3><p>SQLite does not allow the use of correlated subqueries or other embedded select statements inside of
a CHECK expression or the WHERE clauses of a partial index.  This would require additional joins
on every such operation which would be far too expensive.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0395-table-valued-functions-may-not-be-used-in-an-expression-context-function_name">CQL0395: table valued functions may not be used in an expression context &#x27;function_name&#x27;<a class="hash-link" href="#cql0395-table-valued-functions-may-not-be-used-in-an-expression-context-function_name" title="Direct link to heading">​</a></h3><p>A table valued function should be used like a table e.g.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- this is right</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> table_valued_func</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Not like a value e.g.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- this is wrong</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> table_valued_func</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- this is also wrong</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> table_valued_func</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0396-versioning-attributes-may-not-be-used-on-ddl-inside-a-procedure">CQL0396: versioning attributes may not be used on DDL inside a procedure<a class="hash-link" href="#cql0396-versioning-attributes-may-not-be-used-on-ddl-inside-a-procedure" title="Direct link to heading">​</a></h3><p>If you are putting DDL inside of a procedure then that is going to run regardless of any <code>@create</code>,
<code>@delete</code>, or <code>@recreate</code> attributes;</p><p>DDL in entires do not get versioning attributes, attributes are reserved for schema declarations outside
of any procedure.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0397-object-is-an-orphan-because-its-table-is-deleted-remove-rather-than-delete-object_name">CQL0397: object is an orphan because its table is deleted. Remove rather than @delete &#x27;object_name&#x27;<a class="hash-link" href="#cql0397-object-is-an-orphan-because-its-table-is-deleted-remove-rather-than-delete-object_name" title="Direct link to heading">​</a></h3><p>This error is about either a trigger or an index. In both cases you are trying to use <code>@delete</code> on the index/trigger
but the table that the named  object is based on is itself deleted, so the object is an orphan.
Because of this, the orphaned object doesn&#x27;t need, or no longer needs, an <code>@delete</code> tombstone because
when the table is dropped, all of its orphaned indices and triggers will also be dropped.</p><p>To fix this error, remove the named object entirely rather than marking it <code>@delete</code>.</p><p>Note: if the index/trigger was previously deleted and now the table is also deleted, it is now safe to remove
the index/trigger <code>@delete</code> tombstone and this error reminds you to do so.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0398-a-compound-select-cannot-be-ordered-by-the-result-of-an-expression">CQL0398: a compound select cannot be ordered by the result of an expression<a class="hash-link" href="#cql0398-a-compound-select-cannot-be-ordered-by-the-result-of-an-expression" title="Direct link to heading">​</a></h3><p>When specifying an <code>ORDER BY</code> for a compound select, you may only order by indices (e.g., <code>3</code>) or names (e.g., <code>foo</code>) that correspond to an output column, not by the result of an arbitrary expression (e.g., <code>foo + bar</code>).</p><p>For example, this is allowed:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> y </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> t0 </span><span class="token keyword" style="font-style:italic">UNION</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">ALL</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> y </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> t1 </span><span class="token keyword" style="font-style:italic">ORDER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">BY</span><span class="token plain"> y</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The equivalent using an index is also allowed:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> y </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> t0 </span><span class="token keyword" style="font-style:italic">UNION</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">ALL</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> y </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> t1 </span><span class="token keyword" style="font-style:italic">ORDER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">BY</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This seemingly equivalent version containing an arbitrary expression, however, is not:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> y </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> t0 </span><span class="token keyword" style="font-style:italic">UNION</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">ALL</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> y </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> t1 </span><span class="token keyword" style="font-style:italic">ORDER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">BY</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0399-table-must-leave-recreate-management-with-createnn-or-later-table_name">CQL0399: table must leave @recreate management with @create(nn) or later &#x27;table_name&#x27;<a class="hash-link" href="#cql0399-table-must-leave-recreate-management-with-createnn-or-later-table_name" title="Direct link to heading">​</a></h3><p>The indicated table changed from <code>@recreate</code> to <code>@create</code> but it did so in a past schema version.  The change
must happen in the current schema version.  That version is indicated by the value of nn.</p><p>To fix this you can change the <code>@create</code> annotation so that it matches the number in this error message</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0400-encode-context-column-cant-be-sensitive">CQL0400: encode context column can&#x27;t be sensitive<a class="hash-link" href="#cql0400-encode-context-column-cant-be-sensitive" title="Direct link to heading">​</a></h3><p>The encode context column will be used to encode sensitive fields, it can&#x27;t be exposed to encode functions</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0401-encode-context-column-must-be-specified-if-strict-encode-context-column-mode-is-enabled">CQL0401: encode context column must be specified if strict encode context column mode is enabled<a class="hash-link" href="#cql0401-encode-context-column-must-be-specified-if-strict-encode-context-column-mode-is-enabled" title="Direct link to heading">​</a></h3><p>encode context column must be specified in vault_sensitive attribute with format:
@attribute(cql:vault_sensitive=(encode_context_col, (col1, col2, ...))</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0402-encode-context-column-in-vault_sensitive-attribute-must-match-the-specified-type-in-strict-mode">CQL0402: encode context column in vault_sensitive attribute must match the specified type in strict mode<a class="hash-link" href="#cql0402-encode-context-column-in-vault_sensitive-attribute-must-match-the-specified-type-in-strict-mode" title="Direct link to heading">​</a></h3><p>encode context column must match the specified type in vault_sensitive attribute with format:
@attribute(cql:vault_sensitive=(encode_context_col, (col1, col2, ...))</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0403-operator-may-not-be-used-because-it-is-not-supported-on-old-versions-of-sqlite-operator">CQL0403: operator may not be used because it is not supported on old versions of SQLite, &#x27;operator&#x27;<a class="hash-link" href="#cql0403-operator-may-not-be-used-because-it-is-not-supported-on-old-versions-of-sqlite-operator" title="Direct link to heading">​</a></h3><p>The indicated operator has been suppressed with <code>@enforce_strict is true</code> because it is not available
on older versions of sqlite.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0404-procedure-cannot-be-both-a-normal-procedure-and-an-unchecked-procedure-procedure_name">CQL0404: procedure cannot be both a normal procedure and an unchecked procedure, &#x27;procedure_name&#x27;<a class="hash-link" href="#cql0404-procedure-cannot-be-both-a-normal-procedure-and-an-unchecked-procedure-procedure_name" title="Direct link to heading">​</a></h3><p>The construct:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> printf </span><span class="token keyword" style="font-style:italic">NO</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">CHECK</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Is used to tell CQL about an external procedure that might take any combination of arguments.  The canonical example is
<code>printf</code>. All the arguments are converted from CQL types to basic C types when making the call (e.g. TEXT variables
become temporary C strings).  Once a procedure has been declared in this way it can&#x27;t then also be declared as a
normal CQL procedure via <code>CREATE</code> or <code>DECLARE PROCEDURE</code>.  Likewise a normal procedure can&#x27;t be redeclared with the <code>NO CHECK</code>
pattern.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0405-procedure-of-an-unknown-type-used-in-an-expression-procedure_name">CQL0405: procedure of an unknown type used in an expression &#x27;procedure_name&#x27;<a class="hash-link" href="#cql0405-procedure-of-an-unknown-type-used-in-an-expression-procedure_name" title="Direct link to heading">​</a></h3><p>If a procedure has no known type—that is, it was originally declared with <code>NO
CHECK</code>, and has not been subsequently re-declared with <code>DECLARE FUNCTION</code> or
<code>DECLARE SELECT FUNCTION</code>—it is not possible to use it in an expression. You
must either declare the type before using it or call the procedure outside of an
expression via a <code>CALL</code> statement:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROCEDURE</span><span class="token plain"> some_external_proc </span><span class="token keyword" style="font-style:italic">NO</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">CHECK</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- This works even though `some_external_proc` has no known type</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- because we&#x27;re using a CALL statement.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> some_external_proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Hello!&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FUNCTION</span><span class="token plain"> some_external_proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">t </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- Now that we&#x27;ve declared the type, we can use it in an expression.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">let result :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> some_external_proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Hello!&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0406-substr-uses-1-based-indices-the-2nd-argument-of-substr-may-not-be-zero">CQL0406: substr uses 1 based indices, the 2nd argument of substr may not be zero&quot;<a class="hash-link" href="#cql0406-substr-uses-1-based-indices-the-2nd-argument-of-substr-may-not-be-zero" title="Direct link to heading">​</a></h3><p>A common mistake with substr is to assume it uses zero based indices like C does.  It does not.  In fact
the result when using 0 as the second argument is not well defined.  If you want the first
<code>n</code> characters of a string you use <code>substr(haystack, 1, n)</code>.</p><hr><p>CQL 0407 : unused, this was added to prevent merge conflicts at the end on literally every checkin</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0408-encode-context-column-can-be-only-specified-once">CQL0408: encode context column can be only specified once<a class="hash-link" href="#cql0408-encode-context-column-can-be-only-specified-once" title="Direct link to heading">​</a></h3><p>The encode context column can be only specified once in @vault_sensitive attribute</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0409-cannot-use-is-null-or-is-not-null-on-a-value-of-a-not-null-type-nonnull_expr">CQL0409: cannot use IS NULL or IS NOT NULL on a value of a NOT NULL type &#x27;nonnull_expr&#x27;<a class="hash-link" href="#cql0409-cannot-use-is-null-or-is-not-null-on-a-value-of-a-not-null-type-nonnull_expr" title="Direct link to heading">​</a></h3><p>If the left side of an <code>IS NULL</code> or <code>IS NOT NULL</code> expression is of a <code>NOT NULL</code>
type, the answer will always be the same (<code>FALSE</code> or <code>TRUE</code>, respectively). Such
a check often indicates confusion that may lead to unexpected behavior (e.g.,
checking, incorrectly, if a cursor has a row via <code>cursor IS NOT NULL</code>).</p><p><strong>NOTE</strong>: Cursor fields of cursors without a row and uninitialized variables of
a NOT NULL reference type are exceptions to the above rule: Something may be
NULL even if it is of a NOT NULL type in those cases. CQL will eventually
eliminate these exceptions. In the cursor case, one can check whether or not a
cursor has a row by using the cursor-as-boolean-expression syntax (e.g., <code>IF
cursor THEN ... END IF;</code>, <code>IF NOT cursor ROLLBACK RETURN;</code>, et cetera). In the
uninitialized variables case, writing code that checks for initialization is not
recommended (and, indeed, use before initialization will soon be impossible
anyway): One should simply always initialize the variable.</p><hr><p>CQL 0410 : unused, this was added to prevent merge conflicts at the end on literally every checkin</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0411-duplicate-flag-in-substitution-flag">CQL0411: duplicate flag in substitution &#x27;flag&#x27;<a class="hash-link" href="#cql0411-duplicate-flag-in-substitution-flag" title="Direct link to heading">​</a></h3><p>The same flag cannot be used more than once per substitution within a format
string.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0412-cannot-combine--flag-with-space-flag">CQL0412: cannot combine &#x27;+&#x27; flag with space flag<a class="hash-link" href="#cql0412-cannot-combine--flag-with-space-flag" title="Direct link to heading">​</a></h3><p>It is not sensible to use both the <code>+</code> flag and the space flag within the same
substitution (e.g., <code>%+ d</code>) as it is equivalent to just using the <code>+</code> flag
(e.g., <code>%+d</code>).</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0413-width-required-when-using-flag-in-substitution-flag">CQL0413: width required when using flag in substitution &#x27;flag&#x27;<a class="hash-link" href="#cql0413-width-required-when-using-flag-in-substitution-flag" title="Direct link to heading">​</a></h3><p>The flag used (<code>-</code> or <code>0</code>) for a substitution within a format string does not
make sense unless accompanied by a width (e.g., <code>%-10d</code>).</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0414-l-length-specifier-has-no-effect-consider-ll-instead">CQL0414: &#x27;l&#x27; length specifier has no effect; consider &#x27;ll&#x27; instead<a class="hash-link" href="#cql0414-l-length-specifier-has-no-effect-consider-ll-instead" title="Direct link to heading">​</a></h3><p>The use of the <code>l</code> length specifier within a format string, e.g. <code>%ld</code>, has no
effect in SQLite. If the argument is to be a <code>LONG</code>, use <code>ll</code> instead (e.g.,
<code>%lld</code>). If the argument is to be an <code>INTEGER</code>, simply omit the length specifier
entirely (e.g., <code>%d</code>).</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0415-length-specifier-cannot-be-combined-with--flag">CQL0415: length specifier cannot be combined with &#x27;!&#x27; flag<a class="hash-link" href="#cql0415-length-specifier-cannot-be-combined-with--flag" title="Direct link to heading">​</a></h3><p>Length specifiers are only for use with integer type specifiers (e.g. <code>%lld</code>)
and the <code>!</code> flag is only for use with non-integer type specifiers (e.g. <code>%!10s</code>
and <code>%!f</code>). It therefore makes no sense to use both within the same
substitution.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0416-type-specifier-not-allowed-in-cql-type_specifier">CQL0416: type specifier not allowed in CQL &#x27;type_specifier&#x27;<a class="hash-link" href="#cql0416-type-specifier-not-allowed-in-cql-type_specifier" title="Direct link to heading">​</a></h3><p>The type specifier used is accepted by SQLite, but it would be either useless or
unsafe if used within the context of CQL.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0417-unrecognized-type-specifier-type_specifier">CQL0417: unrecognized type specifier &#x27;type_specifier&#x27;<a class="hash-link" href="#cql0417-unrecognized-type-specifier-type_specifier" title="Direct link to heading">​</a></h3><p>The type specifier used within the format string is not known to SQLite.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0418-type-specifier-combined-with-inappropriate-flags-type_specifier">CQL0418: type specifier combined with inappropriate flags &#x27;type_specifier&#x27;<a class="hash-link" href="#cql0418-type-specifier-combined-with-inappropriate-flags-type_specifier" title="Direct link to heading">​</a></h3><p>The type specifier provided does not make sense given one or more flags that
appear within the same substitution. For example, it makes no sense to have a
substitution like <code>%+u</code>: the <code>+</code> indicates the sign of the number will be shown,
while the <code>u</code> indicates the number will be shown as an unsigned integer.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0419-type-specifier-cannot-be-combined-with-length-specifier-type_specifier">CQL0419: type specifier cannot be combined with length specifier &#x27;type_specifier&#x27;<a class="hash-link" href="#cql0419-type-specifier-cannot-be-combined-with-length-specifier-type_specifier" title="Direct link to heading">​</a></h3><p>The type specifier provided cannot be used with a length specifier. For example,
<code>%lls</code> makes no sense because <code>ll</code> only makes sense with integer types and <code>s</code>
is a type specifier for strings.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0420-incomplete-substitution-in-format-string">CQL0420: incomplete substitution in format string<a class="hash-link" href="#cql0420-incomplete-substitution-in-format-string" title="Direct link to heading">​</a></h3><p>The format string ends with a substitution that is incomplete. This can be the
case if a format string ends with a <code>%</code> (e.g., <code>&quot;%d %s %&quot;</code>). If the intent is to
have a literal <code>%</code> printed, use <code>%%</code> instead (e.g., &quot;%d %s %%&quot;`).</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0421-first-argument-must-be-a-string-literal-function">CQL0421: first argument must be a string literal &#x27;function&#x27;<a class="hash-link" href="#cql0421-first-argument-must-be-a-string-literal-function" title="Direct link to heading">​</a></h3><p>The first argument to the function must be a string literal.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0422-more-arguments-provided-than-expected-by-format-string-function">CQL0422: more arguments provided than expected by format string &#x27;function&#x27;<a class="hash-link" href="#cql0422-more-arguments-provided-than-expected-by-format-string-function" title="Direct link to heading">​</a></h3><p>More arguments were provided to the function than its format string indicates
are necessary. The most likely cause for this problem is that the format string
is missing a substitution.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0423-fewer-arguments-provided-than-expected-by-format-string-function">CQL0423: fewer arguments provided than expected by format string &#x27;function&#x27;<a class="hash-link" href="#cql0423-fewer-arguments-provided-than-expected-by-format-string-function" title="Direct link to heading">​</a></h3><p>Fewer arguments were provided to the function than its format string indicates
are necessary. The most likely cause for this problem is that an argument was
accidentally omitted.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0424-procedure-with-inout-parameter-used-as-function-procedure_name">CQL0424: procedure with INOUT parameter used as function &#x27;procedure_name&#x27;<a class="hash-link" href="#cql0424-procedure-with-inout-parameter-used-as-function-procedure_name" title="Direct link to heading">​</a></h3><p>If a procedure has an <code>INOUT</code> parameter, it cannot be used as a function: It may
only be called via a <code>CALL</code> statement.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0425-procedure-with-non-trailing-out-parameter-used-as-function-procedure_name">CQL0425: procedure with non-trailing OUT parameter used as function &#x27;procedure_name&#x27;<a class="hash-link" href="#cql0425-procedure-with-non-trailing-out-parameter-used-as-function-procedure_name" title="Direct link to heading">​</a></h3><p>For a procedure to be used as a function, it must have exactly one <code>OUT</code>
parameter, and that parameter must be the last parameter of the procedure. In
all other cases, procedures with one or more <code>OUT</code> parameters may only be called
via a <code>CALL</code> statement.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0426-out-or-inout-argument-cannot-be-used-again-in-same-call-variable">CQL0426: OUT or INOUT argument cannot be used again in same call &#x27;variable&#x27;<a class="hash-link" href="#cql0426-out-or-inout-argument-cannot-be-used-again-in-same-call-variable" title="Direct link to heading">​</a></h3><p>When a variable is passed as an <code>OUT</code> or <code>INOUT</code> argument, it may not be used as
another argument within the same procedure call. It can, however, be used within
a <em>subexpression</em> of another argument. For example:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PROC</span><span class="token plain"> some_proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">IN</span><span class="token plain"> a </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">OUT</span><span class="token plain"> b </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">BEGIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> t </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- This is NOT legal.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> some_proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- This, however, is perfectly fine.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CALL</span><span class="token plain"> some_proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">some_other_proc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0427-like-cte-form-may-only-be-used-inside-a-shared-fragment-at-the-top-level-ie-attributecqlshared_fragment-procedure_name">CQL0427: LIKE CTE form may only be used inside a shared fragment at the top level i.e. @attribute(cql:shared_fragment) &#x27;procedure_name&#x27;<a class="hash-link" href="#cql0427-like-cte-form-may-only-be-used-inside-a-shared-fragment-at-the-top-level-ie-attributecqlshared_fragment-procedure_name" title="Direct link to heading">​</a></h3><p>When creating a shared fragment you can specify &quot;table parameters&quot; by defining their shape like so:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">@attribute(cql:shared_fragment)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create proc shared_proc(lim_ integer)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   with source(*) LIKE any_shape</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   select * from source limit lim_;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>However this LIKE form only makes sense withing a shared fragment, and only as a top level CTE in such a fragment.  So either:</p><ul><li>the LIKE appeared outside of any procedure</li><li>the LIKE appeared in a procedure, but that procedure is not a shared fragment</li><li>the LIKE appeared in a nested WITH clause</li></ul><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0428-duplicate-binding-of-table-in-callusing-clause-table_name">CQL0428: duplicate binding of table in CALL/USING clause &#x27;table_name&#x27;<a class="hash-link" href="#cql0428-duplicate-binding-of-table-in-callusing-clause-table_name" title="Direct link to heading">​</a></h3><p>In a CALL clause to access a shared fragment there is a duplicate table name in the USING portion.</p><p>Example:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">my_cte(*) AS (call my_fragment(1) USING something as param1, something_else as param1),</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here <code>param1</code> is supposed to take on the value of both <code>something</code> and <code>something_else</code>.  Each parameter
may appear only once in the <code>USING</code> clause.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0429-called-procedure-has-no-table-arguments-but-a-using-clause-is-present-procedure_name">CQL0429: called procedure has no table arguments but a USING clause is present &#x27;procedure_name&#x27;<a class="hash-link" href="#cql0429-called-procedure-has-no-table-arguments-but-a-using-clause-is-present-procedure_name" title="Direct link to heading">​</a></h3><p>In a CALL clause to access a shared fragment there are table bindings but the shared fragment that
is being called does not have any table bindings.</p><p>Example:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">@attribute(cql:shared_fragment)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create proc my_fragment(lim integer not null)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> select * from a_location limit lim;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- here we try to use my_fragment with table parameter but it has none</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">with</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  my_cte(*) AS (call my_fragment(1) USING something as param)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  select * from my_cte;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0430-no-actual-table-was-provided-for-the-table-parameter-table_name">CQL0430: no actual table was provided for the table parameter &#x27;table_name&#x27;<a class="hash-link" href="#cql0430-no-actual-table-was-provided-for-the-table-parameter-table_name" title="Direct link to heading">​</a></h3><p>In a CALL clause to access a shared fragment the table bindings are missing a table parameter.</p><p>Example:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">@attribute(cql:shared_fragment)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create proc my_fragment(lim integer not null)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> with source LIKE source_shape</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> select * from source limit lim;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- here we try to use my_fragment but no table was specified to play the role of &quot;source&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">with</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  my_cte(*) AS (call my_fragment(1))</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  select * from my_cte;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0431-an-actual-table-was-provided-for-a-table-parameter-that-does-not-exist-table_name">CQL0431: an actual table was provided for a table parameter that does not exist &#x27;table_name&#x27;<a class="hash-link" href="#cql0431-an-actual-table-was-provided-for-a-table-parameter-that-does-not-exist-table_name" title="Direct link to heading">​</a></h3><p>In a CALL clause to access a shared fragment the table bindings refer to a table parameter
that does not exist.</p><p>Example:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">@attribute(cql:shared_fragment)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create proc my_fragment(lim integer not null)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> with source LIKE source_shape</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> select * from source limit lim;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- here we try to use my_fragment but there is a table name &quot;soruce&quot; that doesn&#x27;t match source</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">with</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  my_cte(*) AS (call my_fragment(1) USING something as soruce)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  select * from my_cte;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0432-table-provided-must-have-the-same-number-of-columns-as-the-table-parameter-table_name">CQL0432: table provided must have the same number of columns as the table parameter &#x27;table_name&#x27;<a class="hash-link" href="#cql0432-table-provided-must-have-the-same-number-of-columns-as-the-table-parameter-table_name" title="Direct link to heading">​</a></h3><p>In a CALL clause to access a shared fragment the table bindings are trying to use a table
that has the wrong number of columns.  The column count, names, and types must be compatible.
Extra columns for instance are not allowed because they might create ambiguities that were not
present in the shared fragment.</p><p>Example:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">@attribute(cql:shared_fragment)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create proc my_fragment(lim integer not null)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> with source LIKE (select 1 x, 2 y)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> select * from source limit lim;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- here we try to use my_fragment but we provided 3 columns not 2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">with</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  my_source(*) AS (select 1 x, 2 y, 3 z),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  my_cte(*) AS (call my_fragment(1) USING my_source as source)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  select * from my_cte;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here <code>my_fragment</code> wants a <code>source</code> table with 2 columns (x, y).  But 3 were provided.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0433-table-argument-formal_name-requires-column-column_name-but-it-is-missing-in-provided-table-actual_name">CQL0433: table argument &#x27;formal_name&#x27; requires column &#x27;column_name&#x27; but it is missing in provided table &#x27;actual_name&#x27;<a class="hash-link" href="#cql0433-table-argument-formal_name-requires-column-column_name-but-it-is-missing-in-provided-table-actual_name" title="Direct link to heading">​</a></h3><p>In a CALL clause to access a shared fragment the table bindings are trying to use a table
that is missing a required column.</p><p>Example:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">@attribute(cql:shared_fragment)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create proc my_fragment(lim integer not null)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> with source LIKE (select 1 x, 2 y)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> select * from source limit lim;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- here we try to use my_fragment but we passed in a table with (w,x) not (x,y)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">with</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  my_source(*) AS (select 1 w, 2 x),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  my_cte(*) AS (call my_fragment(1) USING my_source as source)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  select * from my_cte;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0434-shared-fragments-may-not-be-called-outside-of-a-sql-statement-procedure_name">CQL0434: shared fragments may not be called outside of a SQL statement &#x27;procedure_name&#x27;<a class="hash-link" href="#cql0434-shared-fragments-may-not-be-called-outside-of-a-sql-statement-procedure_name" title="Direct link to heading">​</a></h3><p>The indicated name is the name of a shared fragment, these fragments may be used inside
of SQL code (e.g. select statements) but they have no meaning in a normal call outside
of a SQL statement.</p><p>Example:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">@attribute(cql:shared_fragment)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create proc my_fragment(lim integer not null)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> select * from somewhere limit lim;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">call my_fragment();</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here <code>my_fragment</code> is being used like a normal procedure. This is not valid.  A correct
use of a fragment might look something like this:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">with</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  (call my_fragment())</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  select * from my_fragment;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0435-must-use-qualified-form-to-avoid-ambiguity-with-alias-column">CQL0435: must use qualified form to avoid ambiguity with alias &#x27;column&#x27;<a class="hash-link" href="#cql0435-must-use-qualified-form-to-avoid-ambiguity-with-alias-column" title="Direct link to heading">​</a></h3><p>In a SQLite <code>SELECT</code> expression, <code>WHERE</code>, <code>GROUP BY</code>, <code>HAVING</code>, and <code>WINDOW</code>
clauses see the columns of the <code>FROM</code> clause before they see any aliases in the
expression list. For example, assuming some table <code>t</code> has columns <code>x</code> and <code>y</code>,
the following two expressions are equivalent:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">SELECT x AS y FROM t WHERE y &gt; 100</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">SELECT x AS y FROM t WHERE t.y &gt; 100</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In the first expression, the use of <code>y &gt; 100</code> makes it seem as though the <code>y</code>
referred to could be the <code>y</code> resulting from <code>x as y</code> in the expression list, but
that is not the case. To avoid such confusion, CQL requires the use of the
qualified form <code>t.y &gt; 100</code> instead.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0436-alias-referenced-from-where-group-by-having-or-window-clause">CQL0436: alias referenced from WHERE, GROUP BY, HAVING, or WINDOW clause<a class="hash-link" href="#cql0436-alias-referenced-from-where-group-by-having-or-window-clause" title="Direct link to heading">​</a></h3><p>Unlike many databases (e.g., PostgreSQL and SQL Server), SQLite allows the
aliases of a <code>SELECT</code> expression list to be referenced from clauses that are
evaluated <em>before</em> the expression list. It does this by replacing all such alias
references with the expressions to which they are equivalent. For example,
assuming <code>t</code> does <em>not</em> have a column <code>x</code>, the following two expressions are
equivalent:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">SELECT a + b AS x FROM t WHERE x &gt; 100</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">SELECT a + b AS x FROM t WHERE a + b &gt; 100</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This can be convenient, but it is also error-prone. As mentioned above, the
above equivalency only holds if <code>x</code> is <em>not</em> a column in <code>t</code>: If <code>x</code> <em>is</em> a
column in <code>t</code>, the <code>WHERE</code> clause would be equivalent to <code>t.x &gt; 100</code> instead,
and there would be no syntactically obvious way to know this without first
manually determining all of the columns present in <code>t</code>.</p><p>To avoid such confusion, CQL disallows referencing expression list aliases from
<code>WHERE</code>, <code>GROUP BY</code>, <code>HAVING</code>, and <code>WINDOW</code> clauses altogether. Instead, one
should simply use the expression to which the alias is equivalent (as is done in
the second example above).</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0437-common-table-name-shadows-previously-declared-table-or-view-name">CQL0437: common table name shadows previously declared table or view &#x27;name&#x27;<a class="hash-link" href="#cql0437-common-table-name-shadows-previously-declared-table-or-view-name" title="Direct link to heading">​</a></h3><p>The name of a common table expression may not shadow a previously declared table
or view. To rectify the problem, simply use a different name.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0438-variable-possibly-used-before-initialization-name">CQL0438: variable possibly used before initialization &#x27;name&#x27;<a class="hash-link" href="#cql0438-variable-possibly-used-before-initialization-name" title="Direct link to heading">​</a></h3><p>The variable indicated must be initialized before it is used because it is of
a reference type (<code>BLOB</code>, <code>OBJECT</code>, or <code>TEXT</code>) that is also <code>NOT NULL</code>.</p><p>CQL is usually smart enough to issue this error only in cases where
initialization is truly lacking. Be sure to verify that the variable will be
initialized before it is used for all possible code paths.</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0439-nonnull-reference-out-parameter-possibly-not-always-initialized-name">CQL0439: nonnull reference OUT parameter possibly not always initialized &#x27;name&#x27;<a class="hash-link" href="#cql0439-nonnull-reference-out-parameter-possibly-not-always-initialized-name" title="Direct link to heading">​</a></h3><p>The parameter indicated must be initialized before the procedure returns because
it is of a reference type (<code>BLOB</code>, <code>OBJECT</code>, or <code>TEXT</code>) that is also <code>NOT NULL</code>.</p><p>CQL is usually smart enough to issue this error only in cases where
initialization is truly lacking. Be sure to verify that the parameter will be
initialized both before the end of the procedure and before all cases of
<code>RETURN</code> and <code>ROLLBACK RETURN</code>. (Initialization before <code>THROW</code> is not required.)</p><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0440-fragments-may-not-have-an-empty-body-procedure_name">CQL0440: fragments may not have an empty body &#x27;procedure_name&#x27;<a class="hash-link" href="#cql0440-fragments-may-not-have-an-empty-body-procedure_name" title="Direct link to heading">​</a></h3><p>The indicated procedure is one of the fragment types but has an empty body.
This is not valid for any fragment type.</p><p>Example:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">@attribute(cql:shared_fragment)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create proc my_fragment(lim integer not null)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  /* something has to go here */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><hr><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0441-shared-fragments-may-only-have-if-select-or--withselect-at-the-top-level-procedure_name">CQL0441: shared fragments may only have IF, SELECT, or  WITH...SELECT at the top level &#x27;procedure_name&#x27;<a class="hash-link" href="#cql0441-shared-fragments-may-only-have-if-select-or--withselect-at-the-top-level-procedure_name" title="Direct link to heading">​</a></h3><p>A shared fragment may consist of just one SELECT statement (including WITH...SELECT)
or it can be an IF/ELSE statement that has a series of compatible select statements.
There are no other valid options.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0442-shared-fragments-with-conditionals-must-include-an-else-clause-procedure_name">CQL0442: shared fragments with conditionals must include an else clause &#x27;procedure_name&#x27;<a class="hash-link" href="#cql0442-shared-fragments-with-conditionals-must-include-an-else-clause-procedure_name" title="Direct link to heading">​</a></h3><p>In shared fragment with conditionals (i.e. it has an IF statement at the top) the fragment
must have an ELSE block so that it is guaranteed to create chunk of SQL text in its expansion.
When no rows are required you can do so with something like:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">IF ... THEN</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ELSE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   select 1 x, &#x27;2&#x27; y WHERE 0;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">END IF;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If the <code>ELSE</code> condition indicates that some join should not happen you might generate default values
or NULLs for the join result like so:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">IF ... THEN</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ELSE</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  select input_stuff.*, NULL x, -1 y;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">END IF;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0443-shared-fragments-with-conditionals-must-have-exactly-one-select-or-withselect-in-each-statement-list-procedure_name">CQL0443: shared fragments with conditionals must have exactly one SELECT or WITH...SELECT in each statement list &#x27;procedure_name&#x27;<a class="hash-link" href="#cql0443-shared-fragments-with-conditionals-must-have-exactly-one-select-or-withselect-in-each-statement-list-procedure_name" title="Direct link to heading">​</a></h3><p>In a shared fragment with conditionals the top level statement is an &quot;IF&quot;.  All of the statement lists in
the IF must have exactly one valid select statement.  This error indicates that a statement list has the wrong number
or type of statement.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0444-this-use-of-the-named-shared-fragment-is-not-legal-because-of-name-conflict-procedure_name">CQL0444: this use of the named shared fragment is not legal because of name conflict &#x27;procedure_name&#x27;<a class="hash-link" href="#cql0444-this-use-of-the-named-shared-fragment-is-not-legal-because-of-name-conflict-procedure_name" title="Direct link to heading">​</a></h3><p>This error will be followed by additional diagnostic information about the call chain that is problematic.  For instance:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">Procedure innermost has a different CTE that is also named foo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">The above originated from CALL inner USING foo AS source</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">The above originated from CALL middle USING foo AS source</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">The above originated from CALL outer USING foo AS source</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This indicates that you are trying to call <code>outer</code> which in turn calls <code>middle</code> which in turn called <code>inner</code>.  The conflict
happened when the <code>foo</code> parameter was passed in to <code>inner</code> because it already has a CTE named <code>foo</code> that means something else.</p><p>The way to fix this problem is to rename the CTE in probably the outermost call as that is likely the one you control.
Renaming it in the innermost procedure might also be wise if that procedure is using a common name likely to conflict.</p><p>It is wise to name the CTEs in shared fragments such that they are unlikely to eclipse outer CTEs that will be needed as table parameters.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0445-attributecqltry_is_proc_body-accepts-no-values">CQL0445: @attribute(cql:try_is_proc_body) accepts no values<a class="hash-link" href="#cql0445-attributecqltry_is_proc_body-accepts-no-values" title="Direct link to heading">​</a></h3><p>The attribute <code>cql:try_is_proc_body</code> cannot be used with any values (e.g.,
<code>cql:try_is_proc_body=(...)</code>).</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0446-attributecqltry_is_proc_body-cannot-be-used-more-than-once-per-procedure">CQL0446: @attribute(cql:try_is_proc_body) cannot be used more than once per procedure<a class="hash-link" href="#cql0446-attributecqltry_is_proc_body-cannot-be-used-more-than-once-per-procedure" title="Direct link to heading">​</a></h3><p>The purpose of <code>cql:try_is_proc_body</code> is to indicate that a particular <code>TRY</code>
block contains what should be considered to be the true body of the procedure.
As it makes no sense for a procedure to have multiple bodies,
<code>cql:try_is_proc_body</code> must appear only once within any given procedure.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0447-virtual-table-table-claims-to-be-eponymous-but-its-module-name-module-differs-from-its-table-name">CQL0447: virtual table &#x27;table&#x27; claims to be eponymous but its module name &#x27;module&#x27; differs from its table name<a class="hash-link" href="#cql0447-virtual-table-table-claims-to-be-eponymous-but-its-module-name-module-differs-from-its-table-name" title="Direct link to heading">​</a></h3><p>By definition, an eponymous virtual table has the same name as its module.  If you use the @eponymous notation
on a virtual table, you must also make the module and table name match.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0448-table-was-marked-delete-but-it-needs-to-be-marked-recreate-delete-table">CQL0448: table was marked @delete but it needs to be marked @recreate @delete &#x27;table&#x27;<a class="hash-link" href="#cql0448-table-was-marked-delete-but-it-needs-to-be-marked-recreate-delete-table" title="Direct link to heading">​</a></h3><p>The indicated table was on the recreate plan and was then deleted by adding an <code>@delete(version)</code> attribute.</p><p>However, the previous <code>@recreate</code> annotation was removed.  This would make the table look like
it was a baseline table that had been deleted, and it isn&#x27;t.  To correctly drop a table on
the <code>@recreate</code> you leave the recreate directive as it was and simply add <code>@delete</code>.  No
version information is required because the table is on the recreate plan anyway.</p><p>Example:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">create table dropping_this</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  f1 integer,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  f2 text</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">) @recreate(optional_group) @delete;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This error indicates that the <code>@recreate(optional_group)</code> annotation was removed.  You should
put it back.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0449-recreate-group-annotation-changed-in-table-table_name">CQL0449: recreate group annotation changed in table &#x27;table_name&#x27;<a class="hash-link" href="#cql0449-recreate-group-annotation-changed-in-table-table_name" title="Direct link to heading">​</a></h3><p>The table in question either went to a different group or else it lost a group name.</p><p>This is not allowed because of the possible FK violations such motion can have.  Tables in
a recreate group can refer each other via FK but this isn&#x27;t allowed across groups.  The
problem here is that if a group is allowed to move then it will be updated as part of its
new group.   However, when the upgrade runs there could be a stale copy of the old table,
likely there is in fact.  That copy could refer to keys in tables that are going away.
This would cause the upgrade to fail because of FK violations.</p><p>To do this correctly in general we would have to allow the notion of deleting the table
in its old group and then creating it in its new group but this is quite a bizarre situation.</p><p>The net of this is that moving groups can cause very complex and strange failures and
so we don&#x27;t allow it.</p><p>It&#x27;s ok for a recreate table that had no group to move into some group. Tables with
no group are already known to have no FKs other than possibly to themselves.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0450-a-shared-fragment-used-like-a-function-must-be-a-simple-select-with-no-from-clause">CQL0450: a shared fragment used like a function must be a simple SELECT with no FROM clause<a class="hash-link" href="#cql0450-a-shared-fragment-used-like-a-function-must-be-a-simple-select-with-no-from-clause" title="Direct link to heading">​</a></h3><p>When using a shared fragment like an expression, the shared fragment must consist of a
simple SELECT without a FROM clause. That SELECT, however, may contain a nested SELECT
expression which, itself, may have a FROM clause.</p><p>Additional constraints:</p><ul><li>the target of the call is a shared fragment<ul><li>the target therefore a single select statement</li><li>the target therefore has no out-arguments</li></ul></li><li>the target has no select clauses other than the select list, e.g. no FROM, WHERE, LIMIT etc.</li><li>the target returns exactly one column, i.e. it&#x27;s just one SQL expression</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0451-procedure-as-function-call-is-not-compatible-with-distinct-or-filter-clauses">CQL0451: procedure as function call is not compatible with DISTINCT or filter clauses<a class="hash-link" href="#cql0451-procedure-as-function-call-is-not-compatible-with-distinct-or-filter-clauses" title="Direct link to heading">​</a></h3><p>Certain built-in functions like <code>COUNT</code> can be used with <code>DISTINCT</code> or <code>FILTER</code> options like so:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">select count(distinct ...);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">select sum(...) filter(where ...) over (...)</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>These options are not valid when calling a procedure as a function and so they generate errors if used.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0452-function-may-not-be-used-in-sql-because-it-is-not-supported-on-old-versions-of-sqlite-function">CQL0452: function may not be used in SQL because it is not supported on old versions of SQLite &#x27;function&#x27;<a class="hash-link" href="#cql0452-function-may-not-be-used-in-sql-because-it-is-not-supported-on-old-versions-of-sqlite-function" title="Direct link to heading">​</a></h3><p>Due to an enabled enforcement (e.g., <code>@enforce_strict sign function;</code>), the
indicated function may not be used within SQL because it is not supported on old
versions of SQLite.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0453-blob-type-is-not-a-valid-table-table_name">CQL0453: blob type is not a valid table &#x27;table_name&#x27;<a class="hash-link" href="#cql0453-blob-type-is-not-a-valid-table-table_name" title="Direct link to heading">​</a></h3><p>The CQL forms <code>SET [blob] FROM CURSOR [cursor]</code> and <code>FETCH [cursor] FROM [blob]</code> require
that the blob variable be declared with a type kind and the type of the blob
matches a suitable table.</p><p>In this case the blob was declared like so:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">DECLARE blob_var blob&lt;table_name&gt;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>But the named table <code>table_name</code> is not a table.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0454-cursor-was-not-declared-for-storage-cursor_name">CQL0454: cursor was not declared for storage &#x27;cursor_name&#x27;<a class="hash-link" href="#cql0454-cursor-was-not-declared-for-storage-cursor_name" title="Direct link to heading">​</a></h3><p>The CQL forms <code>SET [blob] FROM CURSOR [cursor]</code> and <code>FETCH [cursor] FROM [blob]</code> require
that the cursor variable have storage associated with it.  This means it must
be a value cursor or else a cursor that was fetched using the <code>fetch C</code> form
and not the <code>fetch C into [variables]</code> form.</p><p>The indicated cursor was either not fetched at all, or else is using only
the <code>fetch into</code> form so it does not have storage that could be used to
create a blob.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0455-blob-variable-must-have-a-type-kind-for-type-safety-blob_name">CQL0455: blob variable must have a type kind for type safety, &#x27;blob_name&#x27;<a class="hash-link" href="#cql0455-blob-variable-must-have-a-type-kind-for-type-safety-blob_name" title="Direct link to heading">​</a></h3><p>The CQL forms <code>SET [blob] FROM CURSOR [cursor]</code> and <code>FETCH [cursor] FROM [blob]</code> require
that the blob variable be declared with a type kind and the type of the blob
matches a suitable table.</p><p>In this case the blob was declared like so:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">DECLARE blob_name blob;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>But it must be:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">DECLARE blob_name blob&lt;table_name&gt;;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Where <code>table_name</code> is a suitable table.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0456-blob-type-is-a-view-not-a-table-view_name">CQL0456: blob type is a view, not a table &#x27;view_name&#x27;<a class="hash-link" href="#cql0456-blob-type-is-a-view-not-a-table-view_name" title="Direct link to heading">​</a></h3><p>The CQL forms <code>SET [blob] FROM CURSOR [cursor]</code> and <code>FETCH [cursor] FROM [blob]</code> require
that the blob variable be declared with a type kind and the type of the blob
matches a suitable table.</p><p>In this case the blob was declared like:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">DECLARE blob_var blob&lt;view_name&gt;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Where the named type <code>view_name</code> is a view, not a table.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0457-the-indicated-table-is-not-marked-with-attributecqlblob_storage-table_name">CQL0457: the indicated table is not marked with @attribute(cql:blob_storage) &#x27;table_name&#x27;<a class="hash-link" href="#cql0457-the-indicated-table-is-not-marked-with-attributecqlblob_storage-table_name" title="Direct link to heading">​</a></h3><p>The CQL forms <code>SET [blob] FROM CURSOR [cursor]</code> and <code>FETCH [cursor] FROM [blob]</code> require
that the blob variable be declared with a type kind and the type of the blob
matches a suitable table.</p><p>In this case the blob was declared like:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">DECLARE blob_var blob&lt;table_name&gt;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>but the indicated table is missing the necessary attribute <code>@attribute(cql:blob_storage)</code>.</p><p>This attribute is necessary so that CQL can enforce additional rules on the table
to ensure that it is viable for blob storage.  For instance, the table can have no
primary key, no foreign keys, and may not be used in normal SQL statements.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0458-the-indicated-table-may-only-be-used-for-blob-storage-table_name">CQL0458: the indicated table may only be used for blob storage &#x27;table_name&#x27;<a class="hash-link" href="#cql0458-the-indicated-table-may-only-be-used-for-blob-storage-table_name" title="Direct link to heading">​</a></h3><p>The indicated table has been marked with <code>@attribute(cql:blob_storage)</code>.  This means
that it isn&#x27;t a real table -- it will have no SQL schema.  Since it&#x27;s only a storage
shape, it cannot be used in normal operations that use tables such as <code>DROP TABLE</code>,
<code>CREATE INDEX</code>, or inside of <code>SELECT</code> statements.</p><p>The <code>CREATE TABLE</code> construct is used to declare a blob storage type because it&#x27;s the
natural way to define a structure in SQL and also because the usual versioning rules are
helpful for such tables.  But otherwise, blob storage isn&#x27;t really a table at all.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0459-table-is-not-suitable-for-use-as-blob-storage-reason-table_name">CQL0459: table is not suitable for use as blob storage: <!-- -->[reason]<!-- --> &#x27;table_name&#x27;<a class="hash-link" href="#cql0459-table-is-not-suitable-for-use-as-blob-storage-reason-table_name" title="Direct link to heading">​</a></h3><p>The indicated table was marked with <code>@attribute(cql:blob_storage)</code>.  This indicates
that the table is going to be used to define the shape of blobs that could be
stored in the database. It isn&#x27;t going to be a &quot;real&quot; table.</p><p>There are a number of reasons why a table might not be a valid as blob storage.</p><p>For instance:</p><ul><li>it has a primary key</li><li>it has foreign keys</li><li>it has constraints</li><li>it is a virtual table</li></ul><p>This error indicates that one of these items is present. The specific cause
is included in the text of the message.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0460-field-of-a-nonnull-reference-type-accessed-before-verifying-that-the-cursor-has-a-row-cursorfield">CQL0460: field of a nonnull reference type accessed before verifying that the cursor has a row &#x27;cursor.field&#x27;<a class="hash-link" href="#cql0460-field-of-a-nonnull-reference-type-accessed-before-verifying-that-the-cursor-has-a-row-cursorfield" title="Direct link to heading">​</a></h3><p>If a cursor has a field of a nonnull reference type (e.g., <code>TEXT NOT NULL</code>), it
is necessary to verify that the cursor has a row before accessing the field
(unless the cursor has been fetched in such a way that it <em>must</em> have a row,
e.g., via <code>FETCH ... FROM VALUES</code> or <code>LOOP FETCH</code>). The reason for this is that,
should the cursor <em>not</em> have a row, the field will be <code>NULL</code> despite the nonnull
type.</p><p>Assume we have the following:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> t </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> requires_text_notnull</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The following code is <strong>illegal</strong>:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> c </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- ILLEGAL because `c` may not have a row and thus</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- `c.x` may be `NULL`</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> requires_text_notnull</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To fix it, the cursor must be verified to have a row before the field is
accessed:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> c </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> c </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- legal due to the above check</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> requires_text_notnull</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Alternatively, one can perform a &quot;negative&quot; check by returning (or using another
control flow statement) when the cursor does not have a row:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> c </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> c </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> some_logging_function</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;no rows in t&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">return</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- legal as we would have returned if `c` did not</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- have a row</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> requires_text_notnull</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If you are sure that a row <em>must</em> be present, you can throw to make that
explicit:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> c </span><span class="token keyword" style="font-style:italic">cursor</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> t</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">fetch</span><span class="token plain"> c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> c throw</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- legal as we would have thrown if `c` did not</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- have a row</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> requires_text_notnull</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">c</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0461-fetch-from-blob-operand-is-not-a-blob">CQL0461: fetch from blob operand is not a blob<a class="hash-link" href="#cql0461-fetch-from-blob-operand-is-not-a-blob" title="Direct link to heading">​</a></h3><p>The blob operand in the form <code>FETCH [cursor] FROM BLOB [blob]</code>
must be a blob.  The given expression is of some other type.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0462-group-declared-variables-must-be-top-level-name">CQL0462: group declared variables must be top level &#x27;name&#x27;<a class="hash-link" href="#cql0462-group-declared-variables-must-be-top-level-name" title="Direct link to heading">​</a></h3><p>A <code>DECLARE GROUP</code> statement for the named enum is happening inside of a procedure.  This is not legal.</p><p>To correct this, move the declaration outside of the procedure.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="cql0463-variable-definitions-do-not-match-in-group-name">CQL0463: variable definitions do not match in group &#x27;name&#x27;<a class="hash-link" href="#cql0463-variable-definitions-do-not-match-in-group-name" title="Direct link to heading">​</a></h4><p>The two described <code>DECLARE GROUP</code> statements have the same name but they are not identical.</p><p>The error output contains the full text of both declarations to compare.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0464-group-not-found-group_name">CQL0464: group not found &#x27;group_name&#x27;<a class="hash-link" href="#cql0464-group-not-found-group_name" title="Direct link to heading">​</a></h3><p>The indicated name was used in a context where a variable group name was expected but there is no such group.</p><p>Perhaps the group was not included (missing an #include) or else there is a typo.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0465-unsubresub-directive-must-provide-a-table-or-view-name">CQL0465: @unsub/@resub directive must provide a table or view name<a class="hash-link" href="#cql0465-unsubresub-directive-must-provide-a-table-or-view-name" title="Direct link to heading">​</a></h3><p>The indicated schema subscription directive did not provide a table.  The
directive is meaningless without one.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0466-the-tableview-named-in-an-unsubresub-directive-does-not-exist-name">CQL0466: the table/view named in an @unsub/@resub directive does not exist &#x27;name&#x27;<a class="hash-link" href="#cql0466-the-tableview-named-in-an-unsubresub-directive-does-not-exist-name" title="Direct link to heading">​</a></h3><p>The indicated name is not a valid table or view.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0467-unsubresub-versions-must-be-in-non-decreasing-order">CQL0467: @unsub/@resub versions must be in non-decreasing order<a class="hash-link" href="#cql0467-unsubresub-versions-must-be-in-non-decreasing-order" title="Direct link to heading">​</a></h3><p>All of the schema subscription management directions must be in the order in which
they should be applied. The version numbers can never go backward.</p><p>This error might indicate directives that are trying to restate past subscriptions.
The correct approach is to undo an @unsub with a @resub and vice versa.  Any existing
directives should remain forever for logically consistent upgrade scripts.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0468-attributecqlshared_fragment-may-only-be-placed-on-a-create-proc-statement-proc_name">CQL0468: @attribute(cql:shared_fragment) may only be placed on a CREATE PROC statement &#x27;proc_name&#x27;<a class="hash-link" href="#cql0468-attributecqlshared_fragment-may-only-be-placed-on-a-create-proc-statement-proc_name" title="Direct link to heading">​</a></h3><p>In order to use a shared fragment the compiler must see the full body of the fragment, this is
because the fragment will be inlined into the SQL in which it appears.  As a consequence it
makes no sense to try to apply the attribute to a procedure declaration.  Instead put the
shared fragment you want to use somewhere where it can be #included in full.</p><p>example error:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token variable" style="color:rgb(191, 199, 213)">@attribute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cql:shared_fragment</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x </span><span class="token keyword" style="font-style:italic">integer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> y</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">with</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Instead, include the entire body like so (this example is ultra simple).</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token variable" style="color:rgb(191, 199, 213)">@attribute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cql:shared_fragment</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- the procedure body must be present</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0469-tableview-is-already-deleted-name">CQL0469: table/view is already deleted &#x27;name&#x27;<a class="hash-link" href="#cql0469-tableview-is-already-deleted-name" title="Direct link to heading">​</a></h3><p>In an @unsub/@resub directive, the indicated table/view has already been deleted. It can no longer
be managed via subscriptions.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0470-tableview-not-yet-created-at-indicated-version-name">CQL0470: table/view not yet created at indicated version &#x27;name&#x27;<a class="hash-link" href="#cql0470-tableview-not-yet-created-at-indicated-version-name" title="Direct link to heading">​</a></h3><p>In an @unsub/@resub directive, the indicated table/view has an @create directive that comes later
than the @unsub/@resub.  It&#x27;s meaningless to unsubscribe or resubscribe before the
table is even created.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0471-tableview-has-another-unsubresub-at-this-version-number-name">CQL0471: table/view has another @unsub/@resub at this version number &#x27;name&#x27;<a class="hash-link" href="#cql0471-tableview-has-another-unsubresub-at-this-version-number-name" title="Direct link to heading">​</a></h3><p>It doesn&#x27;t make sense to @unsub in the same version that you @resub (as that
would be redundant); likewise for @resub.  And it also makes no sense to @unsub or @resub
twice in the same version.  This error indicates there are two subscription operations on the
same table/view in the same version.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0472-tableview-is-already-unsubscribed-name">CQL0472: table/view is already unsubscribed &#x27;name&#x27;<a class="hash-link" href="#cql0472-tableview-is-already-unsubscribed-name" title="Direct link to heading">​</a></h3><p>In an @unsub directive, the indicated table/view has already been unsubscribed. It doesn&#x27;t need
another unsubscription.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0473-unsub-is-invalid-because-the-tableview-is-still-used-by-name">CQL0473: @unsub is invalid because the table/view is still used by &#x27;name&#x27;<a class="hash-link" href="#cql0473-unsub-is-invalid-because-the-tableview-is-still-used-by-name" title="Direct link to heading">​</a></h3><p>This error indicates that you are attempting to @unsub a table/view while there are still other
tables/views that refer to it (e.g. by FK).  You must @unsub all of those as well
in order to safely @unsub the present table/view.  All such dependencies  will be listed.  Note that
some of those might, in turn, have the same issue.  In short, a whole subtree has to
be removed in order to do this operation safely.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0474-resub-is-invalid-because-the-tableview-references-name">CQL0474: @resub is invalid because the table/view references &#x27;name&#x27;<a class="hash-link" href="#cql0474-resub-is-invalid-because-the-tableview-references-name" title="Direct link to heading">​</a></h3><p>This error indicates that you are attempting to @resub a table/view while there are other
tables/views to which it refers that have not also been resubscribed.  Those items must
first be resubscribed, thus creating a path to add the present table/view.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0475-unsubresub-directives-did-not-match-between-current-and-previous-schema">CQL0475: @unsub/@resub directives did not match between current and previous schema<a class="hash-link" href="#cql0475-unsubresub-directives-did-not-match-between-current-and-previous-schema" title="Direct link to heading">​</a></h3><p>When validating the previous schema, the compiler enforces that all previous @unsub
and @resub directives remained in the current schema, in the same order, with
no changes. Any deviation results in this error indicating the offending directive.</p><p>This error message includes extra information to indicate the nature of the mistake.
An example might be</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">looking for @unsub (1, foo)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">found @unsub(2, foo)</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The reasons for a difference can be complicated: perhaps a directive was removed,
or one was added in the middle, or one was changed.  Any of these will result
in a deviation and none are legal.</p><p>The only allowable change is to add additional directives at the end, possibly
undoing the effect of previous directives.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0476-previous-schema-had-more-unsubresub-directives-than-the-current-schema">CQL0476: previous schema had more unsub/resub directives than the current schema<a class="hash-link" href="#cql0476-previous-schema-had-more-unsubresub-directives-than-the-current-schema" title="Direct link to heading">​</a></h3><p>When validating the previous schema, the compiler enforces that all previous @unsub
and @resub directives remained in the current schema, in the same order, with
no changes.</p><p>This error means that the previous schema matched the current schema until the indicated
point, however there should be more directives in the current schema to continue
matching.</p><p>The most likely cause of this error is that some directives were deleted in
the current schema.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0477-interface-name-conflicts-with-func-name-name">CQL0477: interface name conflicts with func name &#x27;name&#x27;<a class="hash-link" href="#cql0477-interface-name-conflicts-with-func-name-name" title="Direct link to heading">​</a></h3><p>In a <code>DECLARE INTERFACE</code> statement, the given name conflicts with an already declared function (<code>DECLARE FUNCTION</code> or <code>DECLARE SELECT FUNCTION</code>).  You&#x27;ll have to choose a different name.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0478-interface-name-conflicts-with-procedure-name-name">CQL0478: interface name conflicts with procedure name &#x27;name&#x27;<a class="hash-link" href="#cql0478-interface-name-conflicts-with-procedure-name-name" title="Direct link to heading">​</a></h3><p>In a <code>DECLARE INTERFACE</code> statement, the indicated name already corresponds to a created or declared stored procedure.  You&#x27;ll have to choose a different name.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0479-interface-declarations-do-not-match-name">CQL0479: interface declarations do not match &#x27;name&#x27;<a class="hash-link" href="#cql0479-interface-declarations-do-not-match-name" title="Direct link to heading">​</a></h3><p>The interface was previously declared with a <code>DECLARE INTERFACE</code> statement but when subsequent <code>DECLARE INTERFACE</code> was encountered, it did not match the previous declaration.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0480-declared-interface-must-be-top-level-name">CQL0480: declared interface must be top level &#x27;name&#x27;<a class="hash-link" href="#cql0480-declared-interface-must-be-top-level-name" title="Direct link to heading">​</a></h3><p>A <code>DECLARE INTERFACE</code> statement is happening inside of a procedure.  This is not legal.  To correct this move the declaration outside of the procedure.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0481-proc-name-conflicts-with-interface-name-name">CQL0481: proc name conflicts with interface name &#x27;name&#x27;<a class="hash-link" href="#cql0481-proc-name-conflicts-with-interface-name-name" title="Direct link to heading">​</a></h3><p>In a <code>CREATE PROCEDURE</code> / <code>DECLARE PROCEDURE</code> statement, the given name conflicts with an already declared interface (<code>DECLARE INTERFACE</code>).  You&#x27;ll have to choose a different name.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0482-interface-not-found-name">CQL0482: interface not found &#x27;name&#x27;<a class="hash-link" href="#cql0482-interface-not-found-name" title="Direct link to heading">​</a></h3><p>Interface with the name provided in <code>cql:implements</code> attribute does not exist</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0483-procedure-results-should-include-all-columns-defined-by-the-interface-name">CQL0483: procedure results should include all columns defined by the interface &#x27;name&#x27;<a class="hash-link" href="#cql0483-procedure-results-should-include-all-columns-defined-by-the-interface-name" title="Direct link to heading">​</a></h3><p>Procedure should return at least all columns defined by the interface.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0484-name-of-the-column-must-match-the-name-of-the-column-defined-by-interface">CQL0484: name of the column must match the name of the column defined by interface<a class="hash-link" href="#cql0484-name-of-the-column-must-match-the-name-of-the-column-defined-by-interface" title="Direct link to heading">​</a></h3><p>Procedure should return at least all columns defined by the interface and column names should be the same (and defined in the same order).</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0485-column-types-returned-by-proc-need-to-be-the-same-as-defined-on-the-interface">CQL0485: column types returned by proc need to be the same as defined on the interface<a class="hash-link" href="#cql0485-column-types-returned-by-proc-need-to-be-the-same-as-defined-on-the-interface" title="Direct link to heading">​</a></h3><p>Procedure should return at least all columns defined by the interface and column type should be the same.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql0486-function-cannot-be-both-a-normal-function-and-an-unchecked-function-function_name">CQL0486: function cannot be both a normal function and an unchecked function, &#x27;function_name&#x27;<a class="hash-link" href="#cql0486-function-cannot-be-both-a-normal-function-and-an-unchecked-function-function_name" title="Direct link to heading">​</a></h3><p>The same function cannot be declared as a function with unchecked parameters with the <code>NO CHECK</code> clause and then redeclared with typed parameters, or vice versa.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">--- Declaration of an external function foo with unchecked parameters.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FUNCTION</span><span class="token plain"> foo </span><span class="token keyword" style="font-style:italic">NO</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">CHECK</span><span class="token plain"> t </span><span class="token keyword" style="font-style:italic">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">--- A redeclaration of foo with typed paramters. This would be invalid if the previous declaration exists.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">FUNCTION</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> t </span><span class="token keyword" style="font-style:italic">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Make sure the redeclaration of the function is consistent with the original declaration, or remove the redeclaration.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="appendix-5-json-schema-grammar">Appendix 5: JSON Schema Grammar<a class="hash-link" href="#appendix-5-json-schema-grammar" title="Direct link to heading">​</a></h2><p>What follows is taken from the JSON validation grammar with the tree building rules removed.</p><p>Snapshot as of Tue May 31 09:23:31 PDT 2022</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="rules-1">Rules<a class="hash-link" href="#rules-1" title="Direct link to heading">​</a></h3><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">json_schema: &#x27;{&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;tables&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_tables &#x27;]&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;virtualTables&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_virtual_tables &#x27;]&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;views&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_views &#x27;]&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;indices&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_indices &#x27;]&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;triggers&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_triggers &#x27;]&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;attributes&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_attribute_list &#x27;]&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;queries&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_queries &#x27;]&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;inserts&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_inserts &#x27;]&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;generalInserts&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_inserts_general &#x27;]&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;updates&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_updates &#x27;]&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;deletes&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_deletes &#x27;]&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;general&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_generals &#x27;]&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;interfaces&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_interfaces &#x27;]&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;regions&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_regions &#x27;]&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;adHocMigrationProcs&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_ad_hoc_migrations &#x27;]&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;enums&quot;&#x27; &#x27;:&#x27;  &#x27;[&#x27; opt_enums &#x27;]&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;constantGroups&quot;&#x27; &#x27;:&#x27;  &#x27;[&#x27; opt_const_groups &#x27;]&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;subscriptions&quot;&#x27; &#x27;:&#x27;  &#x27;[&#x27; opt_subscriptions &#x27;]&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;}&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">BOOL_LITERAL: &#x27;0&#x27; | &#x27;1&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_tables: | tables</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">tables: table | table &#x27;,&#x27; tables</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">table: &#x27;{&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;name&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;crc&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;isTemp&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;ifNotExists&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;withoutRowid&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;isAdded&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       opt_added_version</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;isDeleted&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       opt_deleted_version</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;isRecreated&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       opt_recreate_group_name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       opt_unsub_version</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       opt_resub_version</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       opt_region_info</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       opt_table_indices</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       opt_attributes</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;columns&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; columns &#x27;]&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;primaryKey&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_column_names &#x27;]&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;primaryKeySortOrders&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_sort_order_names &#x27;]&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       opt_primary_key_name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;foreignKeys&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_foreign_keys &#x27;]&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;uniqueKeys&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_unique_keys &#x27;]&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;checkExpressions&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_check_expressions &#x27;]&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;}&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_primary_key_name:  | &#x27;&quot;primaryKeyName&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_virtual_tables: | virtual_tables</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">virtual_tables: virtual_table | virtual_table &#x27;,&#x27; virtual_tables</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">virtual_table: &#x27;{&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;name&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;crc&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;isTemp&quot;&#x27; &#x27;:&#x27; &#x27;0&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;ifNotExists&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;withoutRowid&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;isAdded&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       opt_added_version</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;isDeleted&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       opt_deleted_version</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;isRecreated&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       opt_region_info</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;isVirtual&quot;&#x27; &#x27;:&#x27; &#x27;1&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;isEponymous&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;module&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       opt_module_args</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       opt_attributes</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;columns&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; columns &#x27;]&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;primaryKey&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_column_names &#x27;]&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;primaryKeySortOrders&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_sort_order_names &#x27;]&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;foreignKeys&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_foreign_keys &#x27;]&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;uniqueKeys&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_unique_keys &#x27;]&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;checkExpressions&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_check_expressions &#x27;]&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;}&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_module_args: | &#x27;&quot;moduleArgs&quot;&#x27; &#x27;:&#x27;  STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_added_version: | &#x27;&quot;addedVersion&quot;&#x27; &#x27;:&#x27; any_integer &#x27;,&#x27; opt_added_migration_proc</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_added_migration_proc: | &#x27;&quot;addedMigrationProc&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_unsub_version: | &#x27;&quot;unsubscribedVersion&quot;&#x27; &#x27;:&#x27; any_integer &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_resub_version: | &#x27;&quot;resubscribedVersion&quot;&#x27; &#x27;:&#x27; any_integer &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_deleted_version: | &#x27;&quot;deletedVersion&quot;&#x27; &#x27;:&#x27; any_integer &#x27;,&#x27; opt_deleted_migration_proc</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_deleted_migration_proc: | &#x27;&quot;deletedMigrationProc&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_recreate_group_name: | &#x27;&quot;recreateGroupName&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_index_names: | index_names</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">index_names: STRING_LITERAL | STRING_LITERAL &#x27;,&#x27; index_names</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_arg_names: | arg_names</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">arg_names: STRING_LITERAL | STRING_LITERAL &#x27;,&#x27; arg_names</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_column_names: | column_names</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">column_names: STRING_LITERAL | STRING_LITERAL &#x27;,&#x27; column_names</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_table_names: | table_names</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">table_names: STRING_LITERAL | STRING_LITERAL &#x27;,&#x27; table_names</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_view_names: | view_names</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">view_names: STRING_LITERAL | STRING_LITERAL &#x27;,&#x27; view_names</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_procedure_names: | procedure_names</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">procedure_names: STRING_LITERAL | STRING_LITERAL &#x27;,&#x27; procedure_names</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_sort_order_names: | sort_order_names</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">sort_order_names: STRING_LITERAL | STRING_LITERAL &#x27;,&#x27; sort_order_names</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">columns: column | column &#x27;,&#x27; columns</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">column: &#x27;{&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;&quot;name&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        opt_attributes</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;&quot;type&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        opt_kind</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        opt_is_sensitive</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;&quot;isNotNull&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;&quot;isAdded&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        opt_added_version</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;&quot;isDeleted&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        opt_deleted_version</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        opt_default_value</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        opt_collate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        opt_check_expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;&quot;isPrimaryKey&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;&quot;isUniqueKey&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;&quot;isAutoIncrement&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;}&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_collate : | &#x27;&quot;collate&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_check_expr: | &#x27;&quot;checkExpr&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27; &#x27;&quot;checkExprArgs&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_arg_names &#x27;]&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_default_value: | &#x27;&quot;defaultValue&quot;&#x27; &#x27;:&#x27; any_literal &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_foreign_keys : | foreign_keys</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_kind: | &#x27;&quot;kind&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_is_sensitive: | &#x27;&quot;isSensitive&quot;&#x27; &#x27;:&#x27; &#x27;1&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">foreign_keys :  foreign_key | foreign_key &#x27;,&#x27; foreign_keys</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">foreign_key : &#x27;{&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">               opt_name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">               &#x27;&quot;columns&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; column_names &#x27;]&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">               &#x27;&quot;referenceTable&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">               &#x27;&quot;referenceColumns&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; column_names &#x27;]&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">               &#x27;&quot;onUpdate&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">               &#x27;&quot;onDelete&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">               &#x27;&quot;isDeferred&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              &#x27;}&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_unique_keys :  | unique_keys</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">unique_keys : unique_key | unique_key &#x27;,&#x27; unique_keys</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">unique_key:  &#x27;{&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              opt_name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              &#x27;&quot;columns&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; column_names &#x27;]&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              &#x27;&quot;sortOrders&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; sort_order_names &#x27;]&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">             &#x27;}&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_check_expressions: | check_expressions</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">check_expressions: check_expression | check_expression &#x27;,&#x27; check_expressions</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">check_expression: &#x27;{&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                   opt_name</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                   &#x27;&quot;checkExpr&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                   &#x27;&quot;checkExprArgs&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; &#x27;]&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                  &#x27;}&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_name: | &#x27;&quot;name&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_table_indices: | table_indices</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">table_indices: &#x27;&quot;indices&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_index_names &#x27;]&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_attributes:  | attributes</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">attributes: &#x27;&quot;attributes&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; attribute_list &#x27;]&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_attribute_list: | attribute_list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">attribute_list: attribute | attribute &#x27;,&#x27; attribute_list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">attribute:  &#x27;{&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">             &#x27;&quot;name&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">             &#x27;&quot;value&quot;&#x27; &#x27;:&#x27; attribute_value</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &#x27;}&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">attribute_array: &#x27;[&#x27; opt_attribute_value_list &#x27;]&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_attribute_value_list: | attribute_value_list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">attribute_value_list: attribute_value | attribute_value &#x27;,&#x27; attribute_value_list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">attribute_value: any_literal | attribute_array</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">any_integer: BOOL_LITERAL | INT_LITERAL</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">any_literal:  BOOL_LITERAL |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              INT_LITERAL | &#x27;-&#x27; INT_LITERAL |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              LONG_LITERAL | &#x27;-&#x27; LONG_LITERAL |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              REAL_LITERAL | &#x27;-&#x27; REAL_LITERAL |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              STRING_LITERAL | NULL_LITERAL</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">num_literal:  BOOL_LITERAL |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              INT_LITERAL | &#x27;-&#x27; INT_LITERAL |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              LONG_LITERAL | &#x27;-&#x27; LONG_LITERAL |</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              REAL_LITERAL | &#x27;-&#x27; REAL_LITERAL</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_views: | views</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">views: view | view &#x27;,&#x27; views</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">view:  &#x27;{&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;name&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;crc&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;isTemp&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;isDeleted&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       opt_deleted_version</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       opt_region_info</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       opt_attributes</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       projection</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;select&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;selectArgs&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; &#x27;]&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       dependencies</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;}&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_region_info: | &#x27;&quot;region&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27; |  &#x27;&quot;region&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27; &#x27;&quot;deployedInRegion&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_projection: | projection</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">projection: &#x27;&quot;projection&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; projected_columns &#x27;]&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">projected_columns: projected_column | projected_column &#x27;,&#x27; projected_columns</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">projected_column: &#x27;{&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                   &#x27;&quot;name&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                   &#x27;&quot;type&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                   opt_kind</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                   opt_is_sensitive</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                   &#x27;&quot;isNotNull&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                  &#x27;}&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_indices:  | indices</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">indices: index  | index &#x27;,&#x27; indices</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">index: &#x27;{&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;&quot;name&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;&quot;crc&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;&quot;table&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;&quot;isUnique&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;&quot;ifNotExists&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;&quot;isDeleted&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        opt_deleted_version</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        opt_region_info</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        opt_partial_index_where</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        opt_attributes</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;&quot;columns&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; column_names &#x27;]&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;&quot;sortOrders&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; sort_order_names &#x27;]&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;}&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_partial_index_where: | &#x27;&quot;where&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_triggers: | triggers</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">triggers: trigger | trigger &#x27;,&#x27; triggers</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">trigger: &#x27;{&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          &#x27;&quot;name&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          &#x27;&quot;crc&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          &#x27;&quot;target&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          &#x27;&quot;isTemp&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          &#x27;&quot;ifNotExists&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          &#x27;&quot;isDeleted&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          opt_deleted_version</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          before_after_instead &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          delete_insert_update &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          opt_for_each_row</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          opt_when_expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          &#x27;&quot;statement&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          &#x27;&quot;statementArgs&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_arg_names &#x27;]&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          opt_region_info</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          opt_attributes</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          dependencies</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;}&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">before_after_instead: &#x27;&quot;isBeforeTrigger&quot;&#x27; &#x27;:&#x27; &#x27;1&#x27; | &#x27;&quot;isAfterTrigger&quot;&#x27; &#x27;:&#x27; &#x27;1&#x27;  | &#x27;&quot;isInsteadOfTrigger&quot;&#x27; &#x27;:&#x27; &#x27;1&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">delete_insert_update: &#x27;&quot;isDeleteTrigger&quot;&#x27; &#x27;:&#x27; &#x27;1&#x27; | &#x27;&quot;isInsertTrigger&quot;&#x27; &#x27;:&#x27; &#x27;1&#x27; | &#x27;&quot;isUpdateTrigger&quot;&#x27; &#x27;:&#x27; &#x27;1&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_for_each_row: | &#x27;&quot;forEachRow&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_when_expr: | &#x27;&quot;whenExpr&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27; &#x27;&quot;whenExprArgs&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_arg_names &#x27;]&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">dependencies: opt_insert_tables</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            opt_update_tables</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            opt_delete_tables</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            opt_from_tables</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            opt_uses_procedures</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            opt_uses_views</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &#x27;&quot;usesTables&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_table_names &#x27;]&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_uses_views: | &#x27;&quot;usesViews&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_view_names &#x27;]&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_insert_tables: | &#x27;&quot;insertTables&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_table_names &#x27;]&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_update_tables: | &#x27;&quot;updateTables&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_table_names &#x27;]&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_delete_tables: | &#x27;&quot;deleteTables&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_table_names &#x27;]&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_from_tables: | &#x27;&quot;fromTables&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_table_names &#x27;]&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_uses_procedures : | &#x27;&quot;usesProcedures&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_procedure_names &#x27;]&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_queries: | queries ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">queries: query | query &#x27;,&#x27; queries ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">query: &#x27;{&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;name&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;definedInFile&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;args&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_args &#x27;]&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       dependencies &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       opt_region_info</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       opt_attributes</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       projection</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;statement&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;&quot;statementArgs&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_arg_names &#x27;]&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">       &#x27;}&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_args: | args</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">args: arg | arg &#x27;,&#x27; args</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">arg: &#x27;{&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &#x27;&quot;name&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &#x27;&quot;argOrigin&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &#x27;&quot;type&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      opt_kind</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      opt_is_sensitive</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &#x27;&quot;isNotNull&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &#x27;}&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_inserts: | inserts</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">inserts: insert | insert &#x27;,&#x27; inserts</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">insert : &#x27;{&#x27; insert_details &#x27;,&#x27; &#x27;&quot;values&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_values &#x27;]&#x27; &#x27;}&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_inserts_general: | inserts_general</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">inserts_general: insert_general | insert_general &#x27;,&#x27; inserts_general</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">insert_details:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;name&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;definedInFile&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;args&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_args &#x27;]&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         dependencies &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         opt_region_info</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         opt_attributes</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;table&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;statement&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;statementArgs&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_arg_names &#x27;]&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;statementType&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;columns&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; column_names &#x27;]&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">insert_general : &#x27;{&#x27; insert_details &#x27;}&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_values: | values</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">values: value | value &#x27;,&#x27; values</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">value:  &#x27;{&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;value&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;valueArgs&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_arg_names &#x27;]&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        &#x27;}&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_updates: | updates</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">updates: update | update &#x27;,&#x27; updates</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">update : &#x27;{&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;name&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;definedInFile&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;args&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_args &#x27;]&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         dependencies &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         opt_region_info</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         opt_attributes</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;table&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;statement&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;statementArgs&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_arg_names &#x27;]&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;}&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_deletes: | deletes</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">deletes: delete | delete &#x27;,&#x27; deletes</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">delete : &#x27;{&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;name&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;definedInFile&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;args&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_args &#x27;]&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         dependencies &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         opt_region_info</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         opt_attributes</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;table&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;statement&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;&quot;statementArgs&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_arg_names &#x27;]&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;}&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_generals: | generals</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">generals: general | general &#x27;,&#x27; generals</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">general: &#x27;{&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          &#x27;&quot;name&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          &#x27;&quot;definedInFile&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          &#x27;&quot;args&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_complex_args &#x27;]&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          dependencies &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          opt_regions</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          opt_attributes</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          opt_projection</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          opt_result_contract</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          &#x27;&quot;usesDatabase&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;}&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_result_contract: | &#x27;&quot;hasSelectResult&quot;&#x27; &#x27;:&#x27; &#x27;1&#x27; &#x27;,&#x27; | &#x27;&quot;hasOutResult&quot;&#x27; &#x27;:&#x27; &#x27;1&#x27; &#x27;,&#x27; | &#x27;&quot;hasOutUnionResult&quot;&#x27; &#x27;:&#x27;&#x27;1&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_complex_args: | complex_args</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">complex_args: complex_arg | complex_arg &#x27;,&#x27; complex_args</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">complex_arg: &#x27;{&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              binding</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              &#x27;&quot;name&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              &#x27;&quot;argOrigin&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              &#x27;&quot;type&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              opt_kind</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              opt_is_sensitive</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              &#x27;&quot;isNotNull&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">             &#x27;}&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">binding: | &#x27;&quot;binding&quot;&#x27; &#x27;:&#x27; &#x27;&quot;inout&quot;&#x27; &#x27;,&#x27; | &#x27;&quot;binding&quot;&#x27; &#x27;:&#x27; &#x27;&quot;out&quot;&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_enums: | enums</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">enums: enum | enum &#x27;,&#x27; enums</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">enum: &#x27;{&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &#x27;&quot;name&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &#x27;&quot;type&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &#x27;&quot;isNotNull&quot;&#x27; &#x27;:&#x27; &#x27;1&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &#x27;&quot;values&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; enum_values &#x27;]&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &#x27;}&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">enum_values: enum_value | enum_value &#x27;,&#x27; enum_values</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">enum_value: &#x27;{&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">             &#x27;&quot;name&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">             &#x27;&quot;value&quot;&#x27; &#x27;:&#x27; num_literal</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &#x27;}&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_interfaces: | interfaces</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">interfaces: interface | interface &#x27;,&#x27; interfaces</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">interface: &#x27;{&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          &#x27;&quot;name&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          &#x27;&quot;definedInFile&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          &#x27;&quot;projection&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; projected_columns &#x27;]&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;}&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_subscriptions: | subscriptions</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">subscriptions: subscription | subscription &#x27;,&#x27; subscriptions</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">subscription: &#x27;{&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     &#x27;&quot;type&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     &#x27;&quot;table&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     opt_region_info</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     &#x27;&quot;version&quot;&#x27; &#x27;:&#x27; any_integer</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     &#x27;}&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_const_groups: | const_groups</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">const_groups: const_group | const_group &#x27;,&#x27; const_groups</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">const_group: &#x27;{&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &#x27;&quot;name&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &#x27;&quot;values&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; const_values &#x27;]&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      &#x27;}&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">const_values: const_value | const_value &#x27;,&#x27; const_values</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">const_value: &#x27;{&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">             &#x27;&quot;name&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">             &#x27;&quot;type&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">             opt_kind</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">             &#x27;&quot;isNotNull&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">             &#x27;&quot;value&quot;&#x27; &#x27;:&#x27; num_literal</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &#x27;}&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &#x27;{&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">             &#x27;&quot;name&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">             &#x27;&quot;type&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">             opt_kind</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">             &#x27;&quot;isNotNull&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">             &#x27;&quot;value&quot;&#x27; &#x27;:&#x27; STRING_LITERAL</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            &#x27;}&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_regions: | regions</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">regions: region | region &#x27;,&#x27; regions</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">region:  &#x27;{&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          &#x27;&quot;name&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          &#x27;&quot;isDeployableRoot&quot;&#x27; &#x27;:&#x27; BOOL_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          &#x27;&quot;deployedInRegion&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          &#x27;&quot;using&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_region_names &#x27;]&#x27; &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          &#x27;&quot;usingPrivately&quot;&#x27; &#x27;:&#x27; &#x27;[&#x27; opt_bool_list &#x27;]&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         &#x27;}&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_region_names: | region_names</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">region_names: STRING_LITERAL | STRING_LITERAL &#x27;,&#x27; region_names</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_bool_list: | bool_list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">bool_list: BOOL_LITERAL | BOOL_LITERAL &#x27;,&#x27; bool_list</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">opt_ad_hoc_migrations: | ad_hoc_migrations</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ad_hoc_migrations: ad_hoc_migration | ad_hoc_migration &#x27;,&#x27; ad_hoc_migrations</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">ad_hoc_migration: &#x27;{&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                  &#x27;&quot;name&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                  &#x27;&quot;crc&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                  opt_attributes</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                  &#x27;&quot;version&quot;&#x27; &#x27;:&#x27; any_integer</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                  &#x27;}&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  | &#x27;{&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                  &#x27;&quot;name&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                  &#x27;&quot;crc&quot;&#x27; &#x27;:&#x27; STRING_LITERAL &#x27;,&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                  opt_attributes</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                  &#x27;&quot;onRecreateOf&quot;&#x27; &#x27;:&#x27; STRING_LITERAL</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                  &#x27;}&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="appendix-6-cql-in-20-minutes">Appendix 6: CQL In 20 Minutes<a class="hash-link" href="#appendix-6-cql-in-20-minutes" title="Direct link to heading">​</a></h2><p>What follows is a series of examples intended to illustrate the most important features of
the CQL language. This appendix was significantly influenced by a similar article on Python
at <a href="https://learnxinyminutes.com/docs/python/" target="_blank" rel="noopener noreferrer">https://learnxinyminutes.com/docs/python/</a></p><p>Also of interest:</p><ul><li><a href="http://sqlite.org" target="_blank" rel="noopener noreferrer">http://sqlite.org</a></li><li><a href="https://learnxinyminutes.com/docs/sql" target="_blank" rel="noopener noreferrer">https://learnxinyminutes.com/docs/sql</a></li></ul><p>And with no further delay, CQL in 20 minutes...</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Single line comments start with two dashes</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">/* C style comments also work</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> *</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> * C pre-processor features like #include and #define are generally available</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> * CQL is typically run through the C pre-processor before it is compile.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">/**********************************************************</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> * 1. Primitive Datatypes and Operators</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> *********************************************************/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- You have numbers</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">3     -- an integer</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">3L    -- a long integer</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">3.5   -- a real literal</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">0x10  -- 16 in hex</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Math is what you would expect</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">1 + 1     --&gt; 2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">8 - 1     --&gt; 7</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">10 * 2    --&gt; 20</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">35.0 / 5  --&gt; 7.0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Modulo operation, same as C and SQLite</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">7 % 3    --&gt; 1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-7 % 3   --&gt; -1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">7 % -3   --&gt; 1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-7 % 3   --&gt; -1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Bitwise operators bind left to right like in SQLite</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">1 | 4 &amp; 3  --&gt;  1  (not 0)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Enforce precedence with parentheses</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">1 + 3 * 2    --&gt; 7</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">(1 + 3) * 2  --&gt; 8</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Use true and false for bools, nullable bool is possible</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">true    --&gt; how to true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">false   --&gt; how to false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">null    --&gt; null means &quot;unknown&quot; in CQL like SQLite</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Negate with not</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">not true   --&gt; false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">not false  --&gt; true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">not null   --&gt; null (not unknown is unknown)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Logical Operators</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">1 and 0 --&gt; 0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">0 or 1  --&gt; 1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">0 and x --&gt; 0 and x not evaluated</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">1 or x  --&gt; 1 and x not evaluated</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Remember null is &quot;unknown&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">null or false  --&gt; null</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">null or true   --&gt; true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">null and false --&gt; false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">null and true  --&gt; null</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Non-zero values are truthy</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">0        --&gt; false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">4        --&gt; true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-6       --&gt; true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">0 and 2  --&gt; 0 (false)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-5 or 0  --&gt; 1 (true)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Equality is == or =</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">1 == 1       --&gt; true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">1 = 1        --&gt; true  (= and == are the same thing)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2 == 1       --&gt; false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Note that null is not equal to anything (like SQL)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">null == 1    --&gt; null (hence not true)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">null == null --&gt; null (hence not true)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;x&quot; == &quot;x&quot;   --&gt; true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- IS lets you compare against null</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">1 IS 1       --&gt; true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2 IS 1       --&gt; false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">null IS 1    --&gt; false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">null IS null --&gt; true  (Unknown is Unknown?  Yes it is!)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;x&quot; IS &quot;x&quot;   --&gt; true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- x IS NOT y is the same as NOT (x IS y)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">1 IS NOT 1       --&gt; false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2 IS NOT 1       --&gt; true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">null IS NOT 1    --&gt; true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">null IS NOT null --&gt; false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;x&quot; IS NOT &quot;x&quot;   --&gt; false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Inequality is != or &lt;&gt;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">1 != 1       --&gt; false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2 &lt;&gt; 1       --&gt; true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">null != 1    --&gt; null</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">null &lt;&gt; null --&gt; null</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- More comparisons</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">1 &lt; 10    --&gt; true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">1 &gt; 10    --&gt; false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2 &lt;= 2    --&gt; true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2 &gt;= 2    --&gt; true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">10 &lt; null --&gt; null</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- To test if a value is in a range</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">1 &lt; 2 and 2 &lt; 3  --&gt; true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2 &lt; 3 and 3 &lt; 2  --&gt; false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- BETWEEN makes this look nicer</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">2 between 1 and 3 --&gt; true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">3 between 2 and 2 --&gt; false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Strings are created with &quot;x&quot; or &#x27;x&#x27;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;This is a string.\n&quot;           -- can have C style escapes (no embedded nulls)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;Th\x69s is a string.\n&quot;        -- even hex literals</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">&#x27;This isn&#x27;&#x27;t a C style string&#x27;  -- use &#x27;&#x27; to escape single quote ONLY</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">/**********************************************************</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> * 2. Simple Variables</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> *********************************************************/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- CQL can call simple libc methods with a no-check declaration</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- we&#x27;ll need this for later examples so we can do something</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- with our expressions (i.e. print them)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare procedure printf no check;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">call printf(&quot;I&#x27;m CQL. Nice to meet you!\n&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Variables are declared with DECLARE.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Keywords and identifiers are not case sensitive.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare x integer not null;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- You can call it X, it is the same thing.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">set X := 0;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- All variables begin with a null value if allowed, else a zero value.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare y integer not null;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">if y == 0 then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  call printf(&quot;Yes, this will run.\n&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end if;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- A nullable variable (i.e. not marked with not null) is initialized to null</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare z real;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">if z is null then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  call printf(&quot;Yes, this will run.\n&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end if;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- The various types</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare a_blob blob;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare a_string text;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare a_real real;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare an_int integer;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare a_long long;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare an_object object;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- There are some typical SQL synonyms</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare an_int int;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare a_long long integer;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare a_long long int;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare a_long long_int;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- The basic types can be tagged to make them less miscible</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare m real&lt;meters&gt;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare kg real&lt;kilos&gt;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">set m := kg;  -- error!</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Object variables can also be tagged so that they are not mixed-up easily</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare dict object&lt;dict&gt; not null;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare list object&lt;list&gt; not null;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">set dict := create_dict();  -- an external function that creates a dict</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">set dict := create_list();  -- error</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">set list := create_list();  -- ok</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">set list := dict;           -- error</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Implied type initialization</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">LET i := 1;      -- integer not null</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">LET l := 1L;     -- long not null</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">LET t := &quot;x&quot;;    -- text not null</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">LET b := x IS y; -- bool not null</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">LET b := x = y;  -- bool (maybe not null depending on x/y)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- The psuedo function &quot;nullable&quot; converts the type of its arg to the nullable</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- version of the same thing.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">LET n_i := nullable(1);   -- nullable integer variable initialized to 1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">LET l_i := nullable(1L);  -- nullable long variable initialized to 1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">/**********************************************************</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> * 3. Control Flow</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> *********************************************************/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Just make a variable</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare some_var integer not null;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">set some_var := 5</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Here is an IF statement</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">if some_var &gt; 10 then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    call printf(&quot;some_var is totally bigger than 10.\n&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">else if some_var &lt; 10 then  -- else if is optional</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    call printf(&quot;some_var is smaller than 10.\n&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">else -- else is optional</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    call printf(&quot;some_var is indeed 10.\n&quot;)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end if;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- WHILE loops iterate as usual</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare i integer not null;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">set i := 0;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">while i &lt; 5</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   call printf(&quot;%d\n&quot;, i);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   set i := i + 1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Use LEAVE to end a loop early</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare i integer not null;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">set i := 0;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">while i &lt; 500</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   if i &gt;= 5 then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     -- we are not going to get anywhere near 500</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     leave;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   end if;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   call printf(&quot;%d\n&quot;, i);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   set i := i + 1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Use CONTINUE to go back to the loop test</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare i integer not null;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">set i := 0;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">while i &lt; 500</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   set i := i + 1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   if i % 2 then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     -- Note: we to do this after &quot;i&quot; is incremented!</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     -- to avoid an infinite loop</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     continue;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   end if;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   -- odd numbers will not be printed because of continue above</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   call printf(&quot;%d\n&quot;, i);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> /**********************************************************</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> * 4. Complex Expression Forms</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> *********************************************************/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> -- Case is an expression, so it is more like the C &quot;?:&quot; operator</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> -- than a switch statement.  It is like &quot;?:&quot; on steroids.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> case i              -- a switch expression is optional</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   when 1 then &quot;one&quot; -- one or more cases</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   when 2 then &quot;two&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   else &quot;other&quot;      -- else is optional</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> end;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Case with no common expression is a series of independent tests</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">case</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   when i == 1 then &quot;i = one&quot;   -- booleans could be completely unrelated</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   when j == 2 then &quot;j = two&quot;   -- first match wins</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   else &quot;other&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- If nothing matches the cases, the result is null.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- The following expression yields null because 7 is not 1.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">case 7 when 1 then &quot;one&quot; end</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Case is just an expression, so it can nest</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">case X</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  when 1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    case y when 1 &quot;x:1 y:1&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">           else &quot;x:1 y:other&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  else</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    case when z == 1 &quot;x:other z:1&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         else &quot;x:other z:other&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    end</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- IN is used to test for membership</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">5 IN (1, 2, 3, 4, 5)  --&gt; true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">7 IN (1, 2)           --&gt; false</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">null in (1, 2, 3)     --&gt; null</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">null in (1, null, 3)  --&gt; null  (null == null is not true)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">7 NOT IN (1, 2)       --&gt; true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">null not in (null, 3) --&gt; null</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">/**********************************************************</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> * 4. Working with and &quot;getting rid of&quot; null</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> *********************************************************/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Null can be annoying, you might need a not null value.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- In most operations null is radioactive:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">null + x     --&gt; null</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">null * x     --&gt; null</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">null == null --&gt; null</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- IS and IS NOT always return 0 or 1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">null is 1     -&gt; 0</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">1 is not null -&gt; 1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- COALESCE returns the first non null arg, or the last arg if all were null.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- If the last arg is not null, you get a non null result for sure.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- The following is never null, but it&#x27;s false if either x or y is null</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">COALESCE(x==y, false) -&gt; thought excercise: how is this different than x IS y?</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- IFNULL is coalesce with 2 args only (COALESCE is more general)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">IFNULL(x, -1) --&gt; use -1 if x is null</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- The reverse, NULLIF, converts a sentinel value to unknown, more exotic</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">NULLIF(x, -1) --&gt; if x is -1 then use null</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- the else part of a case can get rid of nulls</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">CASE when x == y then 1 else 0 end;  --&gt; true iff x = y and neither is null</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- CASE can be used to give you a default value after various tests</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- The following expression is never null; &quot;other&quot; is returned if x is null.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">CASE when x &gt; 0 then &quot;pos&quot; when x &lt; 0 then &quot;neg&quot; else &quot;other&quot; end;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- You can &quot;throw&quot; out of the current procedure (see exceptions below)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare x integer not null;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">set x := ifnull_throw(nullable_int_expr); -- returns non null, throws if null</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- If you have already tested the expression then control flow analysis</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- improves its type to &quot;not null&quot;.  Many common check patterns are recognized.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">if nullable_int_expr is not null then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -- nullable_int_expression is known to be not null in this context</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  set x := nullable_int_expr;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end if;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">/**********************************************************</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> * 5. Tables, Views, Indices, Triggers</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> *********************************************************/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Most forms of data definition language DDL are supported.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- &quot;Loose&quot; DDL (outside of any procedure) simply declares</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- schema, it does not actually create it; the schema is assumed to</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- exist as you specified.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create table T1(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  id integer primary key,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  t text,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  r real</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create table T2(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  id integer primary key references T1(id),</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  l long,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  b blob</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- CQL can take a series of schema declarations (DDL) and</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- automatically create a procedure that will materialize</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- that schema and even upgrade previous versions of the schema.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- This system is discussed in Chapter 10 of The Guide.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- To actually create tables and other schema you need</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- procedures that look like the below:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create proc make_tables()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  create table T1 if not exists (</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    id integer primary key,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    t text,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    r real</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  );</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Views are supported</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create view V1 as (select * from T1);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Triggers are supported</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create trigger if not exists trigger1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  before delete on T1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  delete from T2 where id = old.id;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Indices are supported</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create index I1 on T1(t);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create index I2 on T1(r);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- The various drop forms are supported</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">drop index I1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">drop index I2;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">drop view V1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">drop table T2;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">drop table T1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- A complete discussion of DDL is out of scope, refer to sqlite.org</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">/**********************************************************</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> * 6. Selecting Data</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> *********************************************************/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- We will use this scratch variable in the following examples</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare rr real;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- First observe CQL is a two-headed language</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">set rr := 1+1;           -- this is evaluated in generated C code</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">set rr := (select 1+1);  -- this expresion goes to SQLite; SQLite does the addition</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- CQL tries to do most things the same as SQLite in the C context</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- but some things are exceedingly hard to emulate correctly.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Even simple looking things such as:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">set rr := (select cast(&quot;1.23&quot; as real));   --&gt;  rr := 1.23</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">set rr := cast(&quot;1.23&quot; as real);            --&gt;  error (not safe to emulate SQLite)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- In general, numeric/text conversions have to happen in SQLite context</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- because the specific library that does the conversion could be and usually</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- is different than the one CQL would use.  It would not do to give different answers</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- in one context or another so those conversions are simply not supported.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Loose concatenation is not supported because of the implied conversions.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Loose means &quot;not in the context of a SQL statement&quot;.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">set r := 1.23;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">set r := (select cast(&quot;100&quot;||r as real));  --&gt; 1001.23 (a number)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">set r := cast(&quot;100&quot;||r as real);  --&gt; error, concat not supported in loose expr</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- A simple insertion</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">insert into T1 values (1, &quot;foo&quot;, 3.14);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Finally, reading from the database</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">set r := (select r from T1 where id = 1);  --&gt; r = 3.14</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- The (select ...) form requires the result to have at least one row.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- You can use IF NOTHING forms to handle other cases such as:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">set r := (select r from T1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          where id = 2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          if nothing -1);  --&gt; r = -1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- If the SELECT statement might return a null result you can handle that as well</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">set r := (select r from T1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          where id = 2</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">          if nothing or null -1);  --&gt; r = -1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- With no IF NOTHING clause, lack of a row will cause the SELECT expression to throw</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- an exception.  IF NOTHING THROW merely makes this explicit.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">set r := (select r from T1 where id = 2 if nothing throw);  --&gt; will throw</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">/**********************************************************</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> * 6. Procedures, Results, Exceptions</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> *********************************************************/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Procedures are a list of statements that can be executed, with arguments.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create proc hello()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  call printf(&quot;Hello, world\n&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- IN, OUT, and INOUT parameters are possible</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create proc swizzle(x integer, inout y integer, out z real not null)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  set y := x + y;  -- any computation you like</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -- bizarre way to compute an id but this is just an illustration</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  set z := (select r from T1 where id = x if nothing or null -1);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Procedures like &quot;hello&quot; (above) have a void signature -- they return nothing</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- as nothing can go wrong. Procedures that use the database like &quot;swizzle&quot; (above)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- can return an error code if there is a problem.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- &quot;will_fail&quot; (below)  will always return SQLITE_CONSTRAINT, the second insert</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- is said to &quot;throw&quot;.  In CQL exceptions are just result codes.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create proc will_fail()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   insert into T1 values (1, &quot;x&quot;, 1);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   insert into T1 values (1, &quot;x&quot;, 1);  --&gt; duplicate key</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- DML that fails generates an exception and</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- exceptions can be caught. Here is a example:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create proc upsert_t1(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  id_ integer primary key,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  t_ text,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  r_ real</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  begin try</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    -- try to insert</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    insert into T1(id, t, r) values (id_, t_, r_);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  end try;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  begin catch</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    -- if the insert fails, try to update</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    update T1 set t = t_, r = r_ where id = id_;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  end catch;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Shapes can be very useful in avoiding boilerplate code</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- the following is equivalent to the above.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- More on shapes later.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create proc upsert_t1(LIKE t1) -- my args are the same as the columns of T1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  begin try</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    insert into T1 from arguments</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  end try;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  begin catch</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    update T1 set t = t_, r = r_ where id = id_;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  end catch;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- You can (re)throw an error explicitly.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- If there is no current error you get SQLITE_ERROR</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create proc upsert_wrapper(LIKE t1) -- my args are the same as the columns of T1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  if r_ &gt; 10 then throw end if; -- throw if r_ is too big</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  call upsert_t1(from arguments);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Procedures can also produce a result set.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- The compiler generates the code to create this result set</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- and helper functions to read rows out of it.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create proc get_low_r(r_ real)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   -- optionally insert some rows or do other things</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   select * from T1 where T1.r &lt;= r_;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- A procedure can choose between various results, the choices must be compatible.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- The last &quot;select&quot; to run controls the ultimate result.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create proc get_hi_or_low(r_ real, hi_not_low bool not null)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -- trying to do this with one query would result in a poor plan, so</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -- instead we use two economical queries.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  if hi_not_low then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    select * from T1 where T1.r &gt;= r_;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  else</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    select * from T1 where T1.r &lt;= r_;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  end if;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Using IF to create to nice selects above is a powerful thing.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- SQLite has no IF, if we tried to create a shared query we get</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- something that does not use indices at all.  As in the below.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- The two-headed CQL beast has its advantages!</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">select * from T1 where case hi_not_low then T1.r &gt;= r_ else T1.r &lt;= r_ end;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- You can get the current return code and use it in your CATCH logic.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- This upsert is a bit better than the first:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create proc upsert_t1(LIKE t1) -- my args are the same as the columns of T1</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  begin try</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    insert into T1 from arguments</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  end try;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  begin catch;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if @rc == 19 /* SQLITE_CONSTRAINT */ then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      update T1 set t = t_, r = r_ where id = id_;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    else</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      throw;  -- rethrow, something bad happened.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    end if;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  end catch;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- By convention, you can call a procedure that has an OUT argument</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- as its last argument using function notation.  The out argument</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- is used as the return value.   If the called procedure uses the</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- database then it could throw which causes the caller to throw</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- as usual.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create proc fib(n integer not null, out result integer not null)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   set result := case n &lt;= 2 then 1 else fib(n-1) + fib(n-2) end;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">/**********************************************************</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> * 7. Statement Cursors</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> *********************************************************/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Statement cursors let you iterate over a select result.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Here we introduce cursors, LOOP and FETCH.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create proc count_t1(r_ real, out rows_ integer not null)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  declare rows integer not null;  -- starts at zero guaranteed</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  declare C cursor for select * from T1 where r &lt; r_;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  loop fetch C -- iterate until fetch returns no row</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  begin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    -- goofy code to illustrate you can process the cursor</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    -- in whatever way you deem appropriate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    if C.r &lt; 5 then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      rows := rows + 1; -- count rows with C.r &lt; 5</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    end if;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  end;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  set rows_ := rows;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Cursors can be tested for presence of a row</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- and they can be closed before the enumeration is finished.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- As before the below is somewhat goofy example code.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create proc peek_t1(r_ real, out rows_ integer not null)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   /* rows_ is set to zero for sure! */</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   declare C cursor for select * from T1 where r &lt; r_ limit 2;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   open C;  -- this is no-op, present because other systems have it</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   fetch C;  -- fetch might find a row or not</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   if C then  -- cursor name as bool indicates presence of a row</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     set rows_ = rows_ + (C.r &lt; 5);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     fetch C;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     set rows_ = rows_ + (C and C.r &lt; 5);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   end if;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   close C;  -- cursors auto-closed at end of method but early close possible</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- The FETCH...INTO form can be used to fetch directly into variables</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">fetch C into id_, t_, r_;  --&gt; loads named locals instead of C.id, C.t, C.r</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- A procedure can be the source of a cursor</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare C cursor for call get_low_r(3.2);  -- valid cursor source</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- OUT can be used to create a result set that is just one row</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create proc one_t1(r_ real)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   declare C cursor for select * from T1 where r &lt; r_ limit 1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   fetch C;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   out C;  -- emits a row if we have one, no row is ok too, empty result set.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">/**********************************************************</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> * 8. Value Cursors, Out, and Out Union</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> *********************************************************/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- To consume a procedure that uses &quot;out&quot; you can declare a value cursor.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- By itself such as cursor does not imply use of the database, but often</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- the source of the cursor uses the database.  In this example</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- consume_one_t1 uses the database because of the call to one_t1.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create proc consume_one_t1()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -- a cursor whose shape matches the one_t1 &quot;out&quot; statement</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  declare C cursor like one_t1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -- load it from the call</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  fetch C from call one_t1(7);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  if C.r &gt; 10 then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    -- use values as you see fit</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    call printf(&quot;woohoo&quot;);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  end if;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- You can do the above in one step with the compound form:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare C cursor fetch from call one_t1(7); -- declare and fetch</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Value cursors can come from anywhere and can be a procedure result</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create proc use_t1_a_lot()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -- T1 is the same shape as one_t1, this will work, too</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  declare C cursor like T1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  fetch C from call one_t1(7);  -- load it from the call</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -- some arbitrary logic might be here</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -- load C again with different args</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  fetch C from call one_t1(12);   -- load it again</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -- some arbitrary logic might be here</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -- now load C yet again with explicit args</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  fetch C using</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     1 id,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     &quot;foo&quot; t,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     8.2 r;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -- now return it</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  out C;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Make a complex result set one row at a time</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create proc out_union_example()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -- T1 is the same shape as one_t1, this will work, too</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  declare C cursor like T1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -- load it from the call</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  fetch C from call one_t1(7);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -- note out UNION rather than just out, indicating potentially many rows</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  out union C;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -- load it again with different args</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  fetch C from call one_t1(12);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  out union C;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -- do something, then maybe load it again with explicit args</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  fetch C using</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     1 id,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     &quot;foo&quot; t,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">     8.2 r;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  out union C;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -- we have generated a 3 row result set</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Consume the above</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create proc consume_result()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  declare C cursor for call out_union_example();</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  loop fetch C</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  begin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    -- use builtin cql_cursor_format to make the cursor into a string</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    call printf(&quot;%s\n&quot;, cql_cursor_format(C)); --&gt; prints every column and value</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  end;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">/**********************************************************</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> * 9. Named Types and Enumerations</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> *********************************************************/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Create a simple named types</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare my_type type integer not null;   -- make an alias for integer not null</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare i my_type;  -- use it, &quot;i&quot; is an integer</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Mixing in type kinds is helpful</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare distance type real&lt;meters&gt;;  -- e.g., distances to be measured in meters</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare time type real&lt;seconds&gt;;     -- e.g., time to be measured in seconds</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare job_id type long&lt;job_id&gt;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare person_id type long&lt;person_id&gt;;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- With the above done</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">--  * vars/cols of type &quot;distance&quot; are incompatible with those of type &quot;time&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">--  * vars/cols of types job_id are incompatible with person_id</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- This is true even though the underlying type is the same for both!</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- ENUM declarations can have any numeric type as their base type</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare enum implement integer (</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   pencil,       -- values start at 1 unless you use = to choose something</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   pen,          -- the next enum gets previous + 1 as its value (2)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   brush = 7     -- with = expression you get the indicated value</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- The above also implicitly does this</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare implement type integer&lt;implement&gt; not null;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Using the enum -- simply use dot notation</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare impl implement;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">set impl := implement.pen;  -- value &quot;2&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- You can emit an emum into the current .h file we are going to generate.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Do not put this directive in an include file, you want it to go to one place.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Instead, pick one compiland that will &quot;own&quot; the emission of the enum.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- C code can then #include that one .h file.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">@emit_enums implement;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">/**********************************************************</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> * 10. Shapes and Their Uses</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> *********************************************************/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Shapes first appeared to help define value cursors like so:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- A table or view name defines a shape</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare C cursor like T1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- The result of a proc defines a shape</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare D cursor like one_t1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- A dummy select statement defines a shape (the select does not run)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- this one is the same as (x integer not null, y text not null)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare E cursor like select 1 x, &quot;2&quot; y;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Another cursor defines a shape</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare F cursor like C;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- The arguments of a procedure define a shape. If you have</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- create proc count_t1(r_ real, out rows_ integer not null) ...</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- the shape will be:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">--  (r_ real, rows_ integer not null)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare G cursor like count_t1 arguments;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- A loaded cursor can be used to make a call</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">call count_t1(from G);  -- the args become G.r_, G.rows_</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- A shape can be used to define a procedures args, or some of the args</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- In the following &quot;p&quot; will have arguments:s id_, t_, and r_ with types</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- matching table T1.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Note: To avoid ambiguity, an _ was added to each name!</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create proc p(like T1)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -- do whatever you like</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- The arguments of the current procedure are a synthetic shape</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- called &quot;arguments&quot; and can used where other shapes can appear.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- For instance, you can have &quot;q&quot; shim to &quot;p&quot; using this form:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create proc q(like T1, print bool not null)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -- maybe pre-process, silly example</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  set id_ := id_ + 1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -- shim to p</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  call p(from arguments); -- pass my args through, whatever they are</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -- maybe post-process, silly example</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  set r_ := r_ - 1;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  if print then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    -- convert args to cursor</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    declare C like q arguments;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    fetch C from arguments;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    call printf(&quot;%s\n&quot;, cql_cursor_format(C)); --&gt; prints every column and value</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  end if;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -- insert a row based on the args</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  insert into T1 from arguments;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- You an use a given shape more than once if you name each use.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- This would be more exciting if T1 was like a &quot;person&quot; or something.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create proc r(a like T1, b like T1)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  call p(from a);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  call p(from b);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -- you can refer to a.id, b.id etc.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  declare C like a;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  fetch C from a;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  call printf(&quot;%s\n&quot;, cql_cursor_format(C));</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  fetch C from b;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  call printf(&quot;%s\n&quot;, cql_cursor_format(C));</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Shapes can be subsetted, for instance in the following example</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- only the arguments that match C are used in the FETCH.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">fetch C from arguments(like C);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Fetch the columns of D into C using the cursor D for the data source.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Other columns get default values.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">fetch C(like D) from D;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Use the D shape to load C, dummy values for the others.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- In this example, dummy_seed means use the provided value, 11, for</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- any numerics that are not specified (not in D) and and use</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- &quot;col_name_11&quot; for any strings/blobs.  This pattern is useful in test code</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- to create dummy data, hence the name.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">fetch C(like D) from D @dummy_seed(11);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Use the Z shape to control which fields are copied.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Use the dummy value even if the field is nullable and null would have be ok.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">fetch C(like Z) from D(like Z) @dummy_seed(11) @dummy_nullables;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- The above patterns also work for insert statements</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- The shape constraints are generally useful.  The dummy data</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- sources are useful for inserting test data.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">insert into T1(like Z) from D(like Z) @dummy_seed(11) @dummy_nullables;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- We&#x27;ll need this dummy procedure some_shape so we can use its return</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- value in the examples that follow.  We will never actual create this</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- proc, we only declare it to define the shape, so this is kind of like</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- a typedef.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare proc some_shape() (x integer not null, y integer not null, z integer not null);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- You can make a helper procedure to create test args that are mostly constant</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- or computable.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create get_foo_args(X like some_shape, seed_ integer not null)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  declare C cursor like foo arguments;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  -- any way of loading C could work this is one</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  fetch C(like X) from X @dummy_seed(seed_);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  out C;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Now we can use the &quot;get_foo_args&quot; to get full set of arguments for &quot;foo&quot; and then</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- call &quot;foo&quot; with those arguments.  In this example we&#x27;re providing</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- some of the arguments explicitly, &quot;some_shape&quot; is the part of the args that</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- needs to manually vary in each test iteration, the rest of the arguments will</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- be dummy values.  There could be zillions of args in either category.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- In the below &quot;some_shape&quot; is going to get the manual values 1, 2, 3 while 100</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- will be the seed for the dummy args.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare foo_args cursor fetch from call get_foo_args(1,2,3, 100);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">call foo(from foo_args);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">/**********************************************************</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> * 11. INSERT USING and FETCH USING</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> *********************************************************/</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> -- This kind of thing is a pain</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> insert into foo(a, b, c, d, e, f, g)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    values(1, 2, 3, null, null, 5, null);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- Instead, write this form:</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">insert into foo USING</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    1 a, 2 b, 3 c, null d, null e, 5 f, null g;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- The FETCH statement can also be &quot;fetch using&quot;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">declare C cursor like foo;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">fetch C USING</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    1 a, 2 b, 3 c, null d, null e, 5 f, null g;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If you&#x27;ve read this far you know more than most now.  :)</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="appendix-7-cql-anti-patterns">Appendix 7: CQL Anti-patterns<a class="hash-link" href="#appendix-7-cql-anti-patterns" title="Direct link to heading">​</a></h2><p>These are a few of the antipatterns I&#x27;ve seen while travelling through various CQL source files.  They are in various categories.</p><p>Refer also to Appendix 8: CQL Best Practices.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="common-schema">Common Schema<a class="hash-link" href="#common-schema" title="Direct link to heading">​</a></h3><p>For these examples let&#x27;s create a couple of tables we might need for examples</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> foo </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">primary</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    name </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">CREATE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> bar </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">primary</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    rate </span><span class="token keyword" style="font-style:italic">real</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="declarations">Declarations<a class="hash-link" href="#declarations" title="Direct link to heading">​</a></h3><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> v LONG </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">SET</span><span class="token plain"> v :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>better</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">LET v :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain">L</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- long literals have the L suffix like in C</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Similarly</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">DECLARE</span><span class="token plain"> v </span><span class="token keyword" style="font-style:italic">REAL</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">SET</span><span class="token plain"> v :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>better</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">LET v :</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1.0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- use scientific notation or add .0 to make a real literal</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="casts">Casts<a class="hash-link" href="#casts" title="Direct link to heading">​</a></h3><p>Redundant casts fatten the code and don&#x27;t really add anything to readability.  Sometimems it&#x27;s necessary to cast NULL to
a  particular type so that you can be sure that generated result set has the right data type, but most of the casts
below are not necessary.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    CAST</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    CAST</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">name </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    CAST</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">REAL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> rate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> foo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">UNION</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">ALL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    CAST</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    CAST</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    CAST</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">rate </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">REAL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> rate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> bar</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Better</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    CAST</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">REAL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> rate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> foo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">UNION</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">ALL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    CAST</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">rate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> bar</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>It&#x27;s possible to do the following to make this even cleaner:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- somewhere central</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#define NULL_TEXT CAST(NULL as TEXT)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#define NULL_REAL CAST(NULL as REAL)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#define NULL_INT CAST(NULL as INTEGER)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">#define NULL_LONG CAST(NULL as LONG)</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Then you can write</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    NULL_REAL </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> rate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> foo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">UNION</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">ALL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    NULL_TEXT </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">rate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> bar</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="booleans">Booleans<a class="hash-link" href="#booleans" title="Direct link to heading">​</a></h4><p>TRUE and FALSE can be used as boolean literals.</p><p>SQLite doesn&#x27;t care about the type but CQL will get the type information it needs to make the columns of type BOOL</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    NULL_REAL </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> rate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token boolean" style="color:rgb(255, 88, 116)">TRUE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> has_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- this is a bit artificial but you get the idea</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token boolean" style="color:rgb(255, 88, 116)">FALSE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> has_rate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> foo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">UNION</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">ALL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    NULL_TEXT </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">rate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token boolean" style="color:rgb(255, 88, 116)">FALSE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> has_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token boolean" style="color:rgb(255, 88, 116)">TRUE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> has_rate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> bar</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="boolean-expressions-and-casewhen">Boolean expressions and CASE/WHEN<a class="hash-link" href="#boolean-expressions-and-casewhen" title="Direct link to heading">​</a></h3><p>It&#x27;s easy to get carried away with the power of <code>CASE</code> expressions, I&#x27;ve seen this kind of thing:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">CAST</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">CASE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">WHEN</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">name </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">ELSE</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">BOOL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>But this is simply</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">name </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In general, if your case alternates are booleans a direct boolean expression would have served you better.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="case-and-cast-and-null">CASE and CAST and NULL<a class="hash-link" href="#case-and-cast-and-null" title="Direct link to heading">​</a></h3><p>Somtimes there&#x27;s clamping or filtering going on in a case statement</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">CAST</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">CASE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">WHEN</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">name </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;m&#x27;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">name </span><span class="token keyword" style="font-style:italic">ELSE</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">END</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">TEXT</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here the <code>CAST</code> is not needed at all so we could go to</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CASE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">WHEN</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">name </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;m&#x27;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">name </span><span class="token keyword" style="font-style:italic">ELSE</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">END</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>NULL</code> is already the default value for the <code>ELSE</code> clause so you never need <code>ELSE NULL</code></p><p>So better:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">CASE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">WHEN</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">name </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;m&#x27;</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">THEN</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">name </span><span class="token keyword" style="font-style:italic">END</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="filtering-out-nulls">Filtering out NULLs<a class="hash-link" href="#filtering-out-nulls" title="Direct link to heading">​</a></h3><p>Consider</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> foo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">name </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">name </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;m&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>There&#x27;s no need to test for <code>NOT NULL</code> here, the boolean will result in <code>NULL</code> if <code>foo.name</code> is null
which is not true so the <code>WHERE</code> test will fail.</p><p>Better:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> foo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">name </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;m&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="not-null-boolean-expressions">Not null boolean expressions<a class="hash-link" href="#not-null-boolean-expressions" title="Direct link to heading">​</a></h3><p>In this statement we do not want to have a null result for the boolean expression</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    CAST</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">IFNULL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">name </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;m&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">BOOL</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> name_bigger_than_m</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> FOO</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>So now we&#x27;ve made several mistakes.  We could have used the usual <code>FALSE</code> defintion to avoid the cast.
But even that would have left us with an IFNULL that&#x27;s harder to read.  Here&#x27;s a much simpler formulation:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    name </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;m&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">TRUE</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">AS</span><span class="token plain"> name_bigger_than_m</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> FOO</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Even without the <code>TRUE</code> macro you could do <code>IS 1</code> above and still get a result of type <code>BOOL NOT NULL</code></p><h3 class="anchor anchorWithStickyNavbar_mojV" id="using-is-when-it-makes-sense-to-do-so">Using <code>IS</code> when it makes sense to do so<a class="hash-link" href="#using-is-when-it-makes-sense-to-do-so" title="Direct link to heading">​</a></h3><p>This kind of boolean expression is also verbose for no reason</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    rate </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">NOT</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">NULL</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">AND</span><span class="token plain"> rate </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">20</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In a <code>WHERE</code> clause probably <code>rate = 20</code> suffices but even if you really need a <code>NOT NULL BOOL</code>
result the expression above is exactly what the <code>IS</code> operator is for.  e.g.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">    rate </span><span class="token operator" style="color:rgb(137, 221, 255)">IS</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">20</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The <code>IS</code> operator is frequently avoided except for <code>IS NULL</code> and <code>IS NOT NULL</code> but it&#x27;s a general equality operator
with the added semantic that it never returns <code>NULL</code>.   <code>NULL IS NULL</code> is true.  <code>NULL IS [anything not null]</code> is false.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="left-joins-that-are-not-left-joins">Left joins that are not left joins<a class="hash-link" href="#left-joins-that-are-not-left-joins" title="Direct link to heading">​</a></h3><p>Consider</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">rate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> foo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">LEFT</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">JOIN</span><span class="token plain"> bar </span><span class="token keyword" style="font-style:italic">ON</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"> bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">rate </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This is no longer a left join because the <code>WHERE</code> clause demands a value for at least one column from <code>bar</code>.</p><p>Better:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">SELECT</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">         bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">rate</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">FROM</span><span class="token plain"> foo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">INNER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">JOIN</span><span class="token plain"> bar </span><span class="token keyword" style="font-style:italic">ON</span><span class="token plain"> foo</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">WHERE</span><span class="token plain"> bar</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">rate </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="appendix-8-cql-best-practices">Appendix 8: CQL Best Practices<a class="hash-link" href="#appendix-8-cql-best-practices" title="Direct link to heading">​</a></h2><p>This is a brief discussion of every statement type and some general best practices for that statement.
The statements are in mostly alphabetical order except related statements were moved up in the order
to make logical groups.</p><p>Refer also to Appendix 7: CQL Anti-patterns.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="data-definition-language-ddl">Data Definition Language (DDL)<a class="hash-link" href="#data-definition-language-ddl" title="Direct link to heading">​</a></h3><ul><li><code>ALTER TABLE ADD COLUMN</code></li><li><code>CREATE INDEX</code></li><li><code>CREATE PROC</code></li><li><code>CREATE TABLE</code></li><li><code>CREATE TRIGGER</code></li><li><code>CREATE VIEW</code></li><li><code>CREATE VIRTUAL TABLE</code></li><li><code>DROP INDEX</code></li><li><code>DROP TABLE</code></li><li><code>DROP TRIGGER</code></li><li><code>DROP VIEW</code></li></ul><p>These statements almost never appear in normal procedures and generally should be avoided.  The normal way of handling schema in CQL
is to have one or more files declare all the schema you need and then let CQL create a schema upgrader for you.  This means you&#x27;ll
never manually drop tables or indices etc.  The <code>create</code> declarations with their annotations will totally drive the schema.</p><p>Any ad hoc DDL is usually a very bad sign.  Test code is an obvious exception to this as it often does setup and teardown
of schema to set up things for the test.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="ad-hoc-migrations-1">Ad Hoc Migrations<a class="hash-link" href="#ad-hoc-migrations-1" title="Direct link to heading">​</a></h3><ul><li><code>@SCHEMA_AD_HOC_MIGRATION</code></li></ul><p>This is a special upgrade step that should be taken at the version indicated in the statement.  These can be quite complex and even super important
but should not be used lightly.  Any migration procedure has to be highly tolerant of a variety of incoming schema versions and previous partial successes.
In any case this directive should not appear in normal code.  It should be part of the schema DDL declarations.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="transactions">Transactions<a class="hash-link" href="#transactions" title="Direct link to heading">​</a></h3><ul><li><code>BEGIN TRANSACTION</code></li><li><code>COMMIT TRANSACTION</code></li><li><code>ROLLBACK TRANSACTION</code></li></ul><p>Transactions do not nest and most procedures do not know the context in which they will be called, so the vast majority of
procedures will not and should not actually start transactions.  You can only do this if you know, somehow, for sure, that
the procedure in question is somehow a &quot;top level&quot; procedure.  So generally, don&#x27;t use these statements.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="savepoints">Savepoints<a class="hash-link" href="#savepoints" title="Direct link to heading">​</a></h3><ul><li><code>SAVEPOINT</code></li><li><code>ROLLBACK TO SAVEPOINT</code></li><li><code>RELEASE SAVEPOINT</code></li><li><code>PROC SAVEPOINT</code></li><li><code>COMMIT RETURN</code></li><li><code>ROLLBACK RETURN</code></li></ul><p>Savepoints are the preferred tool for having interim state that can be rolled back if needed.  You can use ad hoc
savepoints, just give your save point and name then use <code>RELEASE SAVEPOINT</code> to commit it, or else <code>ROLLBACK TO SAVEPOINT</code>
followed by a <code>RELEASE</code> to abort it.  Note that you always <code>RELEASE</code> savepoints in both the rollback and the commit case.</p><p>Managing savepoints can be tricky, especially given the various error cases.  They combine nicely with <code>TRY CATCH</code> to do
this job.  However, even that is a lot of boilerplate.  The best way to use savepoints is with <code>PROC SAVEPOINT BEGIN</code> .. <code>END</code>;</p><p>When you use <code>PROC SAVEPOINT</code>, a savepoint is created for you with the name of your procedure.  When the block exits
the savepoint is released (committed).  However you also get an automatically generated try/catch block which will
rollback the savepoint if anything inside the block were to invoke <code>THROW</code>.  Also, you may not use a regular <code>RETURN</code>
inside this block, you must use either <code>ROLLBACK RETURN</code> or <code>COMMIT RETURN</code>.  Both of these directly indicate the fate
of the automatically generated statement when they run.  This gives you useful options to early-out (with no error)
while keeping or abandoning any work in progress.  Of course you can use <code>THROW</code> to return an error and
abandon the work in progress.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="compilation-options">Compilation options<a class="hash-link" href="#compilation-options" title="Direct link to heading">​</a></h3><ul><li><code>@ENFORCE_NORMAL</code></li><li><code>@ENFORCE_POP</code></li><li><code>@ENFORCE_PUSH</code></li><li><code>@ENFORCE_RESET</code></li><li><code>@ENFORCE_STRICT</code></li></ul><p>CQL allows you to specify a number of useful options such as &quot;do not allow Window Functions&quot; or &quot;all foreign keys must choose some update or delete strategy&quot;.
These additional enforcements are designed to prevent errors.  Because of this they should be established once, somewhere central and they should be rarely
if ever overridden.  For instance <code>@ENFORCE_NORMAL WINDOW FUNCTION</code> would allow you to use window functions again, but this is probably a bad idea. If
strict mode is on, disallowing them, that probably means your project is expected to target versions of SQLite that do not have window functions.  Overriding
that setting is likely to lead to runtime errors.</p><p>In general you don&#x27;t want to see these options in most code.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="previous-schema">Previous Schema<a class="hash-link" href="#previous-schema" title="Direct link to heading">​</a></h3><ul><li><code>@PREVIOUS_SCHEMA</code></li></ul><p>CQL can ensure that the current schema is compatible with the previous schema, meaning that an upgrade script could reasonably be generated to go from the
previous to the current.  This directive demarks the start of the previous schema section when that validation happens.  This directive is useless except
for creating that schema validation so it should never appear in normal procedures.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="schema-regions-1">Schema Regions<a class="hash-link" href="#schema-regions-1" title="Direct link to heading">​</a></h3><ul><li><code>@BEGIN_SCHEMA_REGION</code></li><li><code>@DECLARE_DEPLOYABLE_REGION</code></li><li><code>@DECLARE_SCHEMA_REGION</code></li><li><code>@END_SCHEMA_REGION</code></li></ul><p>CQL allows you to declare arbitrary schema regions and limit what parts of the schema any given region may consume.  This helps you to prevent schema from getting
entangled.  There is never a reason to use this directives inside normal procedures;  They should appear only in your schema declaration files.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="schema-version">Schema Version<a class="hash-link" href="#schema-version" title="Direct link to heading">​</a></h3><ul><li><code>@SCHEMA_UPGRADE_SCRIPT</code></li><li><code>@SCHEMA_UPGRADE_VERSION</code></li></ul><p>The <code>@SCHEMA_UPGRADE_SCRIPT</code> directive is only used by CQL itself to declare that the incoming file is an autogenerated schema upgrade script.
These scripts have slightly different rules for schema declaration that are not useful outside of such scripts.  So you should never use this.</p><p><code>@SCHEMA_UPGRADE_VERSION</code> on the other hand is used if you are creating a manual migration script.  You need this script to run in the context
of the schema version that it affects.  Use this directive at the start of the file to do so.  Generally manual migration scripts are to be
avoided so hopefully this directive is rarely if ever used.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="c-text-echo">C Text Echo<a class="hash-link" href="#c-text-echo" title="Direct link to heading">​</a></h3><ul><li><code>@ECHO</code></li></ul><p>This directive emits plain text directly into the compiler&#x27;s output stream.  It can be invaluable for adding new runtime features and for ensuring that
(e.g.) additional <code>#include</code> or <code>#define</code> directives are present in the output but you can really break things by over-using this feature.  Most parts
of the CQL output are subject to change so any use of this should be super clean.  The intended use was, as mentioned, to allow an extra <code>#include</code> in your code
so that CQL could call into some library.  Most uses of this combine with <code>DECLARE FUNCTION</code> or <code>DECLARE PROCEDURE</code> to declare an external entity.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="enumerations">Enumerations<a class="hash-link" href="#enumerations" title="Direct link to heading">​</a></h3><ul><li><code>DECLARE ENUM</code></li><li><code>@EMIT_ENUMS</code></li></ul><p>Avoid embedded constants whenever possible.  Instead declare a suitable enumeration.   Use <code>@EMIT_ENUMS Some_Enum</code> to get the enumeration
constants into the generated .h file for C. But be sure to do this only from one compiland.  You do not want the enumerations in every .h file.
Choose a single .sql file (not included by lots of other things) to place the <code>@EMIT_ENUMS</code> directive. You can make a file specifically for this
purpose if nothing else is serviceable.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="cursor-lifetime">Cursor Lifetime<a class="hash-link" href="#cursor-lifetime" title="Direct link to heading">​</a></h3><ul><li><code>CLOSE</code></li><li><code>OPEN</code></li></ul><p>The <code>OPEN</code> statement is a no-op, SQLite has no such notion.  It was included because it is present in <code>MYSQL</code> and other variants and its inclusion can
ease readability sometimes.  But it does nothing.   The <code>CLOSE</code> statement is normally not necessary because all cursors are closed at the end of the
procedure they are declared in (unless they are boxed, see below).  You only need <code>CLOSE</code> if you want to close a global cursor (which has no scope)
or if you want to close a local cursor &quot;sooner&quot; because waiting to the end of the procedure might be a very long time.  Using close more than once
is safe, the second and later close operations do nothing.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="procedure-calls-and-exceptions">Procedure Calls and Exceptions<a class="hash-link" href="#procedure-calls-and-exceptions" title="Direct link to heading">​</a></h3><ul><li><code>CALL</code></li><li><code>THROW</code></li><li><code>TRY CATCH</code></li></ul><p>Remember that if you call a procedure and it uses <code>THROW</code> or else uses some SQL that failed, this return code will cause your
code to <code>THROW</code> when the procedure returns.  Normally that&#x27;s exactly what you want, the error will ripple out and some top-level
<code>CATCH</code> will cause a <code>ROLLBACK</code> and the top level callers sees the error.  If you have your own rollback needs be sure to install
your own <code>TRY</code>/<code>CATCH</code> block or else use <code>PROC SAVEPOINT</code> as above to do it for you.</p><p>Inside of a <code>CATCH</code> block you can use the special variable <code>@RC</code> to see the most recent return code from SQLite.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="control-flow-with-big-moves">Control Flow with &quot;Big Moves&quot;<a class="hash-link" href="#control-flow-with-big-moves" title="Direct link to heading">​</a></h3><ul><li><code>CONTINUE</code></li><li><code>LEAVE</code></li><li><code>RETURN</code></li></ul><p>These work as usual but beware, you can easily use any of these to accidentally leave a block with a savepoint or transaction
and you might skip over the <code>ROLLBACK</code> or <code>COMMIT</code> portions of the logic.  Avoid this problem by using <code>PROC SAVEPOINT</code>.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="getting-access-to-external-code">Getting access to external code<a class="hash-link" href="#getting-access-to-external-code" title="Direct link to heading">​</a></h3><ul><li><code>DECLARE FUNCTION</code></li><li><code>DECLARE SELECT FUNCTION</code></li><li><code>DECLARE PROCEDURE</code></li></ul><p>The best practice is to put any declarations into a shared header file which you can <code>#include</code> in all the places it is needed.
This is especially important should you have to forward declare a procedure.  CQL normally provides exports for all procedures
so you basically get an automatically generated and certain-to-be-correct <code>#include</code> file.  But, if the procedures are being compiled
together then an export file won&#x27;t have been generated yet at the time you need it;  To work around this you use the <code>DECLARE PROCEDURE</code>
form.  However, procedure declarations are tricky;  they include not just the type of the arguments but the types of any/all of the
columns in any result set the procedure might have.  This must not be wrong or callers will get unpredictable failures.</p><p>The easiest way to ensure it is correct is to use the same trick as you would in C -- make sure that you <code>#include</code> the declaration
the in the translation unit with the definition.  If they don&#x27;t match there will be an error.</p><p>A very useful trick: the error will include the exact text of the correct declaration.  So if you don&#x27;t know it, or are too lazy to
figure it out; simply put <code>ANY</code> declaration in the shared header file and then paste in the correct declaration from the error.  should
the definition ever change you will get a compilation error which you can again harvest to get the correct declaration.</p><p>In this way you can be sure the declarations are correct.</p><p>Functions have no CQL equivalent, but they generally don&#x27;t change very often.  Use <code>DECLARE FUNCTION</code> to allow access to some C code
that returns a result of some kind.   Be sure to add the <code>CREATE</code> option if the function returns a reference that the caller owns.</p><p>Use <code>DECLARE SELECT FUNCTION</code> to tell CQL about any User Defined Functions you have added to SQLite so that it knows how to call them.
Note that CQL does not register those UDFs, it couldn&#x27;t make that call lacking the essential C information required to do so.  If you
find that you are getting errors when calling a UDF the most likely reason for the failure is that the UDF was declared but never
registered with SQLite at runtime.  This happens in test code a lot -- product code tends to have some central place to register the
UDFs and it normally runs at startup, e.g. right after the schema is upgraded.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="regular-data-manipulation-language-dml">Regular Data Manipulation Language (DML)<a class="hash-link" href="#regular-data-manipulation-language-dml" title="Direct link to heading">​</a></h3><ul><li><code>DELETE</code></li><li><code>INSERT</code></li><li><code>SELECT</code></li><li><code>UPDATE</code></li><li><code>UPSERT</code></li></ul><p>These statements are the most essential and they&#x27;ll appear in almost every procedure. There are a few general best practices we can go over.</p><ul><li><p>Try to do as much as you can in one batch rather than iterating;  e.g.</p><ul><li>don&#x27;t write a loop with a <code>DELETE</code> statement that deletes one row if you can avoid it, write a delete statement that deletes all you need to delete</li><li>don&#x27;t write a loop with of <code>SELECT</code> statement that fetches one row, try to fetch all the rows you need with one select</li></ul></li><li><p>Make sure <code>UPSERT</code> is supported on the SQLite system you are using, older versions do not support it</p></li><li><p>Don&#x27;t put unnecessary casts in your <code>SELECT</code> statements, they just add fat</p></li><li><p>Don&#x27;t use <code>CASE</code>/<code>WHEN</code> to compute a boolean, the boolean operations are more economical (e.g. use <code>IS</code>)</p></li><li><p>Don&#x27;t use <code>COUNT</code> if all you need to know is whether a row exists or not, use <code>EXISTS</code></p></li><li><p>Don&#x27;t use <code>GROUP BY</code>, <code>ORDER BY</code>, or <code>DISTINCT</code> on large rowsets, the sort is expensive and it will make your <code>SELECT</code> statements write to disk rather than just read</p></li><li><p>Always use the <code>INSERT INTO FOO USING</code> form of the <code>INSERT</code> statement, it&#x27;s much easier to read than the standard form and compiles to the same thing</p></li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="variable-and-cursor-declarations">Variable and Cursor declarations<a class="hash-link" href="#variable-and-cursor-declarations" title="Direct link to heading">​</a></h3><ul><li><code>DECLARE OUT CALL</code></li><li><code>DECLARE</code></li><li><code>LET</code></li><li><code>SET</code></li></ul><p>These are likely to appear all over as well.  If you can avoid a variable declaration by using <code>LET</code> then do so;  The code will be more concise and you&#x27;ll
get the exact variable type you need.  This is the same as <code>var x = foo();</code> in other languages.  Once the variable is declared use <code>SET</code>.</p><p>You can save yourself a lot of declarations of <code>OUT</code> variables with <code>DECLARE OUT CALL</code>.  That declaration form automatically declares the <code>OUT</code> variables used
in the call you are about to make with the correct type.  If the number of arguments changes you just have to add the args you don&#x27;t have to also add
new declarations.</p><p>The <code>LIKE</code> construct can be used to let you declare things whose type is the same as another thing.  Patterns like <code>DECLARE ARGS CURSOR LIKE FOO ARGUMENTS</code>
save you a lot of typing and also enhance correctness.  There&#x27;s a whole chapter dedicated to &quot;shapes&quot; defined by <code>LIKE</code>.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="query-plans">Query Plans<a class="hash-link" href="#query-plans" title="Direct link to heading">​</a></h3><ul><li><code>EXPLAIN</code></li></ul><p>Explain can be used in front of other queries to generate a plan.  The way SQLite handles this is that you fetch the rows of the plan as usual.  So basically
<code>EXPLAIN</code> is kind of like <code>SELECT QUERY PLAN OF</code>.  This hardly ever comes up in normal coding.  CQL has an output option where it will generate code that gives you
the query plan for a procedures queries rather than the normal body of the procedure.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="fetching-data-from-a-cursor-or-from-loose-data">Fetching Data from a Cursor or from Loose Data<a class="hash-link" href="#fetching-data-from-a-cursor-or-from-loose-data" title="Direct link to heading">​</a></h3><ul><li><code>FETCH</code></li><li><code>UPDATE CURSOR</code></li></ul><p>The <code>FETCH</code> statement has many variations, all are useful at some time or another. There are a few helpful guidelines.</p><ul><li>If fetching from loose values into a cursor use the <code>FETCH USING</code> form (as you would with <code>INSERT INTO USING</code>) because it is less error prone</li><li><code>FETCH INTO</code> is generally a bad idea, you&#x27;ll have to declare a lot of variables, instead just rely on automatic storage in the cursor e.g.
<code>fetch my_cursor</code> rather than <code>fetch my_cursor into a, b, c</code></li><li>If you have data already in a cursor you can mutate some of the columns using <code>UPDATE CURSOR</code>, this can let you adjust values or apply defaults</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="control-flow">Control Flow<a class="hash-link" href="#control-flow" title="Direct link to heading">​</a></h3><ul><li><code>IF</code></li><li><code>LOOP</code></li><li><code>SWITCH</code></li><li><code>WHILE</code></li></ul><p>These are your bread and butter and they will appear all over.  One tip: Use the <code>ALL VALUES</code> variant of switch whenever possible to ensure that you haven&#x27;t missed any cases.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="manual-control-of-results">Manual Control of Results<a class="hash-link" href="#manual-control-of-results" title="Direct link to heading">​</a></h3><ul><li><p><code>OUT</code></p></li><li><p><code>OUT UNION</code></p></li><li><p>If you know you are producing exactly one row <code>OUT</code> is more economical than <code>SELECT</code></p></li><li><p>If you need complete flexibility on what rows to produce (e.g. skip some, add extras, mutate some) then <code>OUT UNION</code> will give you that, use it only when needed, it&#x27;s more expensive than just <code>SELECT</code></p></li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="ctes-and-shared-fragments">CTEs and Shared Fragments<a class="hash-link" href="#ctes-and-shared-fragments" title="Direct link to heading">​</a></h3><p>To understand what kinds of things you can reasonably do with fragments, really you
just have to understand the things that you can do with common table expressions or
CTEs.  For those who don&#x27;t know, CTEs are the things you declare
in the WITH clause of a SELECT statement.  They&#x27;re kind of like local views.  Well,
actually, they are exactly like local views.</p><p>Query fragments help you to define useful CTEs so basically what you can do
economically in a CTE directly determines what you can do economically in a fragment.</p><p>To demonstrate some things that happen with CTEs we&#x27;re going to use these three
boring tables.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> A</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">primary</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   this </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> B</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">primary</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   that </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">table</span><span class="token plain"> C</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   id </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">primary</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">key</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   other </span><span class="token keyword" style="font-style:italic">text</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let&#x27;s start with a very simple example, the first few examples are like control cases.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">explain</span><span class="token plain"> query </span><span class="token keyword" style="font-style:italic">plan</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> A</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">inner</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">join</span><span class="token plain"> B </span><span class="token keyword" style="font-style:italic">on</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> A</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">QUERY </span><span class="token keyword" style="font-style:italic">PLAN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">--SCAN TABLE A</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">\</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">SEARCH </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> B </span><span class="token keyword" style="font-style:italic">USING</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">rowid</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">?</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>OK as we can see <code>A</code> is not constrained so it has to be scanned but <code>B</code> isn&#x27;t scanned,
we use its primary key for the join.  This is the most common kind of join: a search
based on a key of the table you are joining to.</p><p>Let&#x27;s make it a bit more realistic.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">explain</span><span class="token plain"> query </span><span class="token keyword" style="font-style:italic">plan</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> A</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">inner</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">join</span><span class="token plain"> B </span><span class="token keyword" style="font-style:italic">on</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> A</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> A</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">QUERY </span><span class="token keyword" style="font-style:italic">PLAN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">--SEARCH TABLE B USING INTEGER PRIMARY KEY (rowid=?)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">\</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">SEARCH </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> A </span><span class="token keyword" style="font-style:italic">USING</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">rowid</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">?</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now <code>A</code> is constrained by the <code>WHERE</code> clause so we can use its index and then use the <code>B</code> index.
So we get a nice economical join from <code>A</code> to <code>B</code> and no scans at all.</p><p>Now suppose we try this with some CTE replacements for <code>A</code> and <code>B</code>.  Does this make it worse?</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">explain</span><span class="token plain"> query </span><span class="token keyword" style="font-style:italic">plan</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  AA</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> A</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  BB</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> that</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> AA</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">left</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">join</span><span class="token plain"> BB </span><span class="token keyword" style="font-style:italic">on</span><span class="token plain"> BB</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> AA</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> AA</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">QUERY </span><span class="token keyword" style="font-style:italic">PLAN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">--SEARCH TABLE A USING INTEGER PRIMARY KEY (rowid=?)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">\</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">SEARCH </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> B </span><span class="token keyword" style="font-style:italic">USING</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">rowid</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">?</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The answer is a resounding no.  The CTE <code>AA</code> was not materialized it was expanded in place,
as was the CTE <code>BB</code>.  We get <em>exactly</em> the same query plan.  Now this means that the
inner expressions like <code>select * from A</code> could have been fragments such as:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token variable" style="color:rgb(191, 199, 213)">@attribute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cql:shared_fragment</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> A_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> A</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@attribute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cql:shared_fragment</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> B_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">explain</span><span class="token plain"> query </span><span class="token keyword" style="font-style:italic">plan</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> A_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- short for A_(*) AS (call A_())</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> B_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain">     </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- short for B_(*) AS (call B_())</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> A_</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">left</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">join</span><span class="token plain"> B_ </span><span class="token keyword" style="font-style:italic">on</span><span class="token plain"> B_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> A_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> A_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><em>Note:</em> I&#x27;ll use the convention that <code>A_</code> is the fragment proc that could have generated the CTE <code>AA</code>,
likewise with <code>B_</code> and so forth.</p><p>The above will expand into exactly what we had before and hence will have the exactly
same good query plan.  Of course this is totally goofy, why make a fragment like that --
it&#x27;s just more typing.  Well now lets generalize the fragments just a bit.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token variable" style="color:rgb(191, 199, 213)">@attribute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cql:shared_fragment</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> A_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">experiment </span><span class="token keyword" style="font-style:italic">bool</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- data source might come from somewhere else due to an experiment</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> experiment </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> A</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> this </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> somewhere_else</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@attribute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cql:shared_fragment</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> B_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- we don&#x27;t actually refer to &quot;B&quot; if the filter is null</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> b_filter </span><span class="token operator" style="color:rgb(137, 221, 255)">is</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- applies b_filter if specified</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> B </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">other </span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> b_filter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- generates the correct shape but zero rows of it</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> that </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">false</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">end</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">if</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> getAB</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    id_ </span><span class="token keyword" style="font-style:italic">integer</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    experiment </span><span class="token keyword" style="font-style:italic">bool</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">not</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    b_filter </span><span class="token keyword" style="font-style:italic">text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> A_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">experiment</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> B_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">b_filter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> A_</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">left</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">join</span><span class="token plain"> B_ </span><span class="token keyword" style="font-style:italic">on</span><span class="token plain"> B_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> A_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> A_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> id_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The above now has 4 combos economically encoded and all of them have a good plan.
Importantly though, if <code>b_filter</code> is not specified then we don&#x27;t actually join to <code>B</code>.
The <code>B_</code> CTE will have no reference to <code>B</code>, it just has zero rows.</p><p>Now lets look at some things you don&#x27;t want to do.</p><p>Consider this form:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">explain</span><span class="token plain"> query </span><span class="token keyword" style="font-style:italic">plan</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  AA</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> A</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  BB</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> that</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> A</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">that </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> A </span><span class="token keyword" style="font-style:italic">left</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">join</span><span class="token plain"> B </span><span class="token keyword" style="font-style:italic">on</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> A</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> AA</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">left</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">join</span><span class="token plain"> BB </span><span class="token keyword" style="font-style:italic">on</span><span class="token plain"> BB</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> AA</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> AA</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">QUERY </span><span class="token keyword" style="font-style:italic">PLAN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">--SEARCH TABLE A USING INTEGER PRIMARY KEY (rowid=?)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">--SEARCH TABLE A USING INTEGER PRIMARY KEY (rowid=?)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">\</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">SEARCH </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> B </span><span class="token keyword" style="font-style:italic">USING</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">rowid</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">?</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note that here we get 3 joins.  Now a pretty cool thing happened here -- even though the expression
for <code>BB</code> does not include a <code>WHERE</code> clause SQLite has figured out the <code>AA.id</code> being 5 forces <code>A.id</code> to be 5
which in turn gives a constraint on <code>BB</code>. Nice job SQLite.  If it hadn&#x27;t been able to figure that out
then the expansion of <code>BB</code> would have resulted in a table scan.</p><p>Still, 3 joins is bad when we only need 2 joins to do the job.  What happened?  Well, when we did
the original fragments with extensions and stuff we saw this same pattern in fragment code.
Basically the fragment for <code>BB</code> isn&#x27;t just doing the <code>B</code> things it&#x27;s restarting from <code>A</code> and doing its
own join to get <code>B</code>. This results in a wasted join.  And it might result in a lot of work on the <code>A</code> table
as well if the filtering was more complex and couldn&#x27;t be perfectly inferred.</p><p>You might think, &quot;oh, no problem, I can save this, I&#x27;ll just refer to <code>AA</code> instead of <code>A</code> in the second query.&quot;</p><p>This does not help (but it&#x27;s going in the right direction):</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">explain</span><span class="token plain"> query </span><span class="token keyword" style="font-style:italic">plan</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  AA</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> A</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  BB</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> that</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> AA</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">that </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> AA </span><span class="token keyword" style="font-style:italic">left</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">join</span><span class="token plain"> B </span><span class="token keyword" style="font-style:italic">on</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> AA</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> AA</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">left</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">join</span><span class="token plain"> BB </span><span class="token keyword" style="font-style:italic">on</span><span class="token plain"> BB</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> AA</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> AA</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">QUERY </span><span class="token keyword" style="font-style:italic">PLAN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">--SEARCH TABLE A USING INTEGER PRIMARY KEY (rowid=?)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">--SEARCH TABLE A USING INTEGER PRIMARY KEY (rowid=?)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">\</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">SEARCH </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> B </span><span class="token keyword" style="font-style:italic">USING</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">rowid</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">?</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>In terms of fragments the anti-pattern is this.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token variable" style="color:rgb(191, 199, 213)">@attribute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cql:shared_fragment</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> B_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> A </span><span class="token keyword" style="font-style:italic">left</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">join</span><span class="token plain"> B </span><span class="token keyword" style="font-style:italic">on</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> A</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The above starts the query for <code>B</code> again from the root.  You can save this, the trick is to not
try to generate just the <code>B</code> columns and then join them later.  You can get a nice data
flow going with chain of CTEs.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">explain</span><span class="token plain"> query </span><span class="token keyword" style="font-style:italic">plan</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  AA</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> A</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  AB</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> that</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> AA</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">that </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> AA </span><span class="token keyword" style="font-style:italic">left</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">join</span><span class="token plain"> B </span><span class="token keyword" style="font-style:italic">on</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> AA</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> AB</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> AB</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">QUERY </span><span class="token keyword" style="font-style:italic">PLAN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">--SEARCH TABLE A USING INTEGER PRIMARY KEY (rowid=?)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">\</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">SEARCH </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> B </span><span class="token keyword" style="font-style:italic">USING</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">rowid</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">?</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And we&#x27;re right back to the perfect plan.  The good form creates a CTE chain
where we only need the result of the final CTE.  A straight line of CTEs
each depending on the previous one results in a excellent data flow.</p><p>In terms of fragments this is now:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token variable" style="color:rgb(191, 199, 213)">@attribute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cql:shared_fragment</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> A_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> A</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@attribute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cql:shared_fragment</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> AB_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> A_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> A_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">that </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> A_ </span><span class="token keyword" style="font-style:italic">left</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">join</span><span class="token plain"> B </span><span class="token keyword" style="font-style:italic">on</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> A_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">with</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> AB_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> AB_ </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> AB_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>For brevity I didn&#x27;t include the possibility of using IF and such.  Another option
that makes the same good query plan.  We can generalize <code>AB_</code> so that it doesn&#x27;t know
where the base data is coming from and can be used in more cases.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token variable" style="color:rgb(191, 199, 213)">@attribute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cql:shared_fragment</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> A_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> A</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token variable" style="color:rgb(191, 199, 213)">@attribute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cql:shared_fragment</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> AB_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  source</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">like</span><span class="token plain"> A </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">-- you must provide some source that is the same shape as A</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> source</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">that </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> source </span><span class="token keyword" style="font-style:italic">left</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">join</span><span class="token plain"> B </span><span class="token keyword" style="font-style:italic">on</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> source</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> A_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">call</span><span class="token plain"> AB_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">using</span><span class="token plain"> A_ </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> source</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> AB_ </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> AB_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Again this results in a nice straight chain of CTEs and even though the where
clause is last the A table is constrained properly.</p><p>It&#x27;s important not to fork the chain... if you do that then whatever
came before the fork must be materialized for use in both branches.
That can be quite bad because then the filtering might come after the
materialization.  This is an example that is quite bad.</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">explain</span><span class="token plain"> query </span><span class="token keyword" style="font-style:italic">plan</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  AA</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> A</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  BB</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> that</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> AA</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">that </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> AA </span><span class="token keyword" style="font-style:italic">left</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">join</span><span class="token plain"> B </span><span class="token keyword" style="font-style:italic">on</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> AA</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  CC</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> other</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> AA</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">other </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> AA </span><span class="token keyword" style="font-style:italic">left</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">join</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">on</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> AA</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> AA</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">left</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">join</span><span class="token plain"> BB </span><span class="token keyword" style="font-style:italic">on</span><span class="token plain"> BB</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> AA</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">left</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">join</span><span class="token plain"> CC </span><span class="token keyword" style="font-style:italic">on</span><span class="token plain"> CC</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> AA</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> AA</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">QUERY </span><span class="token keyword" style="font-style:italic">PLAN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">--MATERIALIZE 2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">--SCAN TABLE A</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain">  \</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">SEARCH </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> B </span><span class="token keyword" style="font-style:italic">USING</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">rowid</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">?</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">--MATERIALIZE 3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain">  </span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">--SCAN TABLE A</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token plain">  \</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">SEARCH </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">USING</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">rowid</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">?</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">--SEARCH TABLE A USING INTEGER PRIMARY KEY (rowid=?)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">--SCAN SUBQUERY 2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">\</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">SEARCH SUBQUERY </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">USING</span><span class="token plain"> AUTOMATIC COVERING </span><span class="token keyword" style="font-style:italic">INDEX</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">?</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Things have gone way of the rails here. As you can see <code>A</code> is now
scanned twice. and there are many more joins.  We could make this
a lot better by moving the A condition all the way up into the first
CTE.  With fragments that would just mean creating something like</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token variable" style="color:rgb(191, 199, 213)">@attribute</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cql:shared_fragment</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">create</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">proc</span><span class="token plain"> A_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">begin</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> A </span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> A</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> id_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">end</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>At least then if we have to materialize we&#x27;ll get only one row.  This could be
a good thing to do universally, but it&#x27;s especially important if you know that
forking in the query shape is mandatory for some reason.</p><p>A better pattern might be this:</p><div class="language-sql codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sql codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">explain</span><span class="token plain"> query </span><span class="token keyword" style="font-style:italic">plan</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  AA</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> A</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  AB</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> that</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> AA</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">that </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> AA </span><span class="token keyword" style="font-style:italic">left</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">join</span><span class="token plain"> B </span><span class="token keyword" style="font-style:italic">on</span><span class="token plain"> B</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> AA</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  ABC</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> that</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> other</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">as</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> AB</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">other </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> AB </span><span class="token keyword" style="font-style:italic">left</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">join</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">on</span><span class="token plain"> C</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> AB</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> ABC</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> ABC</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">QUERY </span><span class="token keyword" style="font-style:italic">PLAN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">--SEARCH TABLE A USING INTEGER PRIMARY KEY (rowid=?)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">|</span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">--SEARCH TABLE B USING INTEGER PRIMARY KEY (rowid=?)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">\</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token operator" style="color:rgb(137, 221, 255)">-</span><span class="token plain">SEARCH </span><span class="token keyword" style="font-style:italic">TABLE</span><span class="token plain"> C </span><span class="token keyword" style="font-style:italic">USING</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">INTEGER</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">PRIMARY</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">KEY</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">rowid</span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain">?</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Here we&#x27;ve just extended the chain.  With shared fragments you could easily build an
<code>AB_</code> proc as before and then build an <code>ABC_</code> proc either by calling <code>AB_</code> directly or by
having a table parameter that is <code>LIKE AB_</code>.</p><p>Both cases will give you a great plan.</p><p>So the most important things are:</p><ul><li>Avoid forking the chain of CTEs/fragments, a straight chain works great.</li><li>Avoid re-joining to tables, even unconstrained CTEs result in great plans if they don&#x27;t have to be materialized.</li><li>If you do need to fork in your CTE chain, because of your desired shape, be sure to move as many filters as you can further upstream so that by the time you materialize only a very small number of rows need to be materialiized.</li></ul><p>These few rules will go far in helping you to create shapes.</p><p>One last thing, without shared fragments, if you wanted to create a large 10 way join or something you had to type that
join into your file and it would be very much in your face.  Now that join might be hidden from you in a nice easy-to-use
fragment.  Which you might then decide you want to use 3 times... And now with a tiny amount of code you have 30 joins.</p><p>The thing is shared fragments make it easy to generate a lot of SQL.  It&#x27;s not bad that shared fragments make things easy,
but with great power comes great responsibility, so give a care as to what it is you are assembling.  Understanding
your fragments, especially any big ones, will help you to create great code.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="appendix-9-using-the-cql-amalgam">Appendix 9: Using the CQL Amalgam<a class="hash-link" href="#appendix-9-using-the-cql-amalgam" title="Direct link to heading">​</a></h2><p>This is a brief discussion of the CQL Amalgam and its normal usage patterns.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="building-the-amalgam">Building the Amalgam<a class="hash-link" href="#building-the-amalgam" title="Direct link to heading">​</a></h3><p>The amalgam has to include the results of bison and flex, so a normal build must run first.  The simplest
way to build it starting from the <code>sources</code> directory is:</p><div class="language-bash codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-bash codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">make</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">./make_amalgam.sh</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The result goes in <code>out/cql_amalgam.c</code>.  It can then be built using <code>cc</code> with whatever flags you might
desire.  With a few <code>-D</code> directives it can readily be compiled with Microsoft C and it also works with
Emscripten (<code>emcc</code>) basically unchanged.  Clang and Gcc of course also work.</p><p>The standard test script <code>test.sh</code> builds the amalgam and attempts to compile it as well, which ensures
that the amalgam can at least compile at all times.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="testing-the-amalgam">Testing the Amalgam<a class="hash-link" href="#testing-the-amalgam" title="Direct link to heading">​</a></h3><p>Of course you can do whatever tests you might like by simply compiling the amalgam as is and then using
it to compile things.  But importantly the test script <code>test.sh</code> can test the amalgam build like so:</p><div class="language-bash codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-bash codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">test.sh --use_amalgam</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This runs all the normal tests using the binary built from the amalgam rather than the normal binary.</p><p>Normal CQL development practices result in this happening pretty often so the amalgam tends to stay
in good shape. The code largely works in either form with very few affordances for the amalgam build needed.
Most developers don&#x27;t even think about the amalgam build flavor; to a first approximation &quot;it just works&quot;.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="using-the-amalgam">Using the Amalgam<a class="hash-link" href="#using-the-amalgam" title="Direct link to heading">​</a></h3><p>To use the amalgam you&#x27;ll want to do something like this:</p><div class="language-c codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-c codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">define</span><span class="token macro property"> </span><span class="token macro property macro-name">CQL_IS_NOT_MAIN</span><span class="token macro property"> </span><span class="token macro property expression number" style="color:rgb(247, 140, 108)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Suppresses a bunch of warnings because the code</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// is in an #include context</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// PR&#x27;s to remove these are welcome :D</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">pragma</span><span class="token macro property"> </span><span class="token macro property expression">clang diagnostic ignored </span><span class="token macro property string" style="color:rgb(195, 232, 141)">&quot;-Wnullability-completeness&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(195, 232, 141)">&quot;cql_amalgam.c&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">go_for_it</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">char</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">your_buffer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  YY_BUFFER_STATE my_string_buffer </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">yy_scan_string</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">your_buffer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Note: &quot;--in&quot; is irrelevant because the scanner is</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// going to read from the buffer above.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// If you don&#x27;t use yy_scan_string, you could use &quot;--in&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// to get data from a file.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> argc </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">char</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">argv</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;cql&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;--cg&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;foo.h&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;foo.c&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">cql_main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">argc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> argv</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">yy_delete_buffer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">my_string_buffer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>So the general pattern is:</p><ul><li>predefine the options you want to use (see below)</li><li>include the amalgam</li><li>add any functions you want that will call the amalgam</li></ul><p>Most amalgam functions are <code>static</code> to avoid name conflicts. You will want to create your own public functions such as <code>go_for_it</code> above that use the amalgam in all the ways you desire.</p><p>You&#x27;ll want to avoid calling any internal functions other than <code>cql_main</code> because they are liable to change.</p><p>NOTE: The amalgam is C code not C++ code.  Do not attempt to use it inside of an <code>extern &quot;C&quot;</code> block in a C++ file.  It won&#x27;t build.  If you want a C++ API, expose the C functions you need and write a wrapper class.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="cql-amalgam-options">CQL Amalgam Options<a class="hash-link" href="#cql-amalgam-options" title="Direct link to heading">​</a></h3><p>The amalgam includes the following useful <code>#ifdef</code> options to allow you to customize it.</p><ul><li>CQL_IS_NOT_MAIN</li><li>CQL_NO_SYSTEM_HEADERS</li><li>CQL_NO_DIAGNOSTIC_BLOCK</li><li>cql_emit_error</li><li>cql_emit_output</li><li>cql_open_file_for_write</li><li>cql_write_file</li></ul><h4 class="anchor anchorWithStickyNavbar_mojV" id="cql_is_not_main">CQL_IS_NOT_MAIN<a class="hash-link" href="#cql_is_not_main" title="Direct link to heading">​</a></h4><p>If this symbol is defined then <code>cql_main</code> will not be redefined to be <code>main</code>.</p><p>As the comments in the source say:</p><div class="language-c codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-c codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">ifndef</span><span class="token macro property"> </span><span class="token macro property expression">CQL_IS_NOT_MAIN</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Normally CQL is the main entry point.  If you are using CQL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// in an embedded fashion then you want to invoke its main at</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// some other time. If you define CQL_IS_NOT_MAIN then cql_main</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// is not renamed to main.  You call cql_main when you want.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">define</span><span class="token macro property"> </span><span class="token macro property macro-name">cql_main</span><span class="token macro property"> </span><span class="token macro property expression">main</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">endif</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Set this symbol so that you own main and cql_main is called at your pleasure.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="cql_no_system_headers">CQL_NO_SYSTEM_HEADERS<a class="hash-link" href="#cql_no_system_headers" title="Direct link to heading">​</a></h4><p>The amalgam includes the normal <code>#include</code> directives needed to make it compile, things like stdio and such.
In your situation these headers may not be appropriate.  If <code>CQL_NO_SYSTEM_HEADERS</code> is defined then the amalgam
will not include anything; you can then add whatever headers you need before you include the amalgam.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="cql_no_diagnostic_block">CQL_NO_DIAGNOSTIC_BLOCK<a class="hash-link" href="#cql_no_diagnostic_block" title="Direct link to heading">​</a></h4><p>The amalgam includes a set of recommended directives for warnings to suppress and include.  If you want
to make other choices for these you can suppress the defaults by defining <code>CQL_NO_DIAGNOSTIC_BLOCK</code>;
you can then add whatever diagnostic pragmas you want/need.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="cql_emit_error">cql_emit_error<a class="hash-link" href="#cql_emit_error" title="Direct link to heading">​</a></h4><p>The amalgam uses <code>cql_emit_error</code> to write its messages to stderr.  The documentation is included in the
code which is attached here.  If you want the error messages to go somewhere else, define <code>cql_emit_error</code>
as the name of your error handling function.  It should accept a <code>const char *</code> and record that string
however you deem appropriate.</p><div class="language-c codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-c codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">ifndef</span><span class="token macro property"> </span><span class="token macro property expression">cql_emit_error</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// CQL &quot;stderr&quot; outputs are emitted with this API.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// You can define it to be a method of your choice with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// &quot;#define cql_emit_error your_method&quot; and then your method</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// will get the data instead. This will be whatever output the</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// compiler would have emitted to stderr.  This includes</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// semantic errors or invalid argument combinations.  Note that</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// CQL never emits error fragments with this API; you always</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// get all the text of one error.  This is important if you</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// are filtering or looking for particular errors in a test</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// harness or some such.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// You must copy the memory if you intend to keep it. &quot;data&quot; will</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// be freed.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Note: you may use cql_cleanup_and_exit to force a failure from</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// within this API but doing so might result in unexpected cleanup</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// paths that have not been tested.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">cql_emit_error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">char</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">err</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">fprintf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token constant" style="color:rgb(130, 170, 255)">stderr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;%s&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">error_capture</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">bprintf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">error_capture</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;%s&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">endif</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Typically you would <code>#define cql_emit_error your_error_function</code> before you include the amalgam and then
define your_error_function elsewhere in that file (before or after the amalgam is included are both fine).</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="cql_emit_output">cql_emit_output<a class="hash-link" href="#cql_emit_output" title="Direct link to heading">​</a></h4><p>The amalgam uses <code>cql_emit_output</code> to write its messages to stdout.  The documentation is included in the
code which is attached here.  If you want the standard output to go somewhere else, define <code>cql_emit_output</code>
as the name of your output handling function.  It should accept a <code>const char *</code> and record that string
however you deem appropriate.</p><div class="language-c codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-c codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">ifndef</span><span class="token macro property"> </span><span class="token macro property expression">cql_emit_output</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// CQL &quot;stdout&quot; outputs are emitted (in arbitrarily small pieces)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// with this API.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// You can define it to be a method of your choice with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// &quot;#define cql_emit_output your_method&quot; and then your method will</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// get the data instead. This will be whatever output the</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// compiler would have emitted to stdout.  This is usually</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// reformated CQL or semantic trees and such -- not the normal</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// compiler output.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// You must copy the memory if you intend to keep it. &quot;data&quot; will</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// be freed.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Note: you may use cql_cleanup_and_exit to force a failure from</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// within this API but doing so might result in unexpected cleanup</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// paths that have not been tested.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">cql_emit_output</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">char</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">msg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;%s&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> msg</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">endif</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Typically you would <code>#define cql_emit_output your_output_function</code> before you include the amalgam and then
define your_error_function elsewhere in that file (before or after the amalgam is included are both fine).</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="cql_open_file_for_write">cql_open_file_for_write<a class="hash-link" href="#cql_open_file_for_write" title="Direct link to heading">​</a></h4><p>If you still want normal file i/o for your output but you simply want to control the placement of the output
(such as forcing it to be on some virtual drive) you can replace this function by defining <code>cql_open_file_for_write</code>.</p><p>If all you need to do is control the origin of the <code>FILE *</code> that is written to, you can replace just this function.</p><div class="language-c codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-c codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">ifndef</span><span class="token macro property"> </span><span class="token macro property expression">cql_open_file_for_write</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Not a normal integration point, the normal thing to do is</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// replace cql_write_file but if all you need to do is adjust</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// the path or something like that you could replace</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// this method instead.  This presumes that a FILE * is still ok</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// for your scenario.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">FILE </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">_Nonnull </span><span class="token function" style="color:rgb(130, 170, 255)">cql_open_file_for_write</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">char</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">_Nonnull file_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  FILE </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">file</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">!</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">file </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">fopen</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">file_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;w&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">cql_error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;unable to open %s for write\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> file_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">cql_cleanup_and_exit</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">return</span><span class="token plain"> file</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">endif</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Typically you would <code>#define cql_open_file_for_write your_open_function</code> before you include the amalgam and then
define your_open_function elsewhere in that file (before or after the amalgam is included are both fine).</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="cql_write_file">cql_write_file<a class="hash-link" href="#cql_write_file" title="Direct link to heading">​</a></h4><p>The amalgam uses <code>cql_write_file</code> to write its compilation outputs to the file system.  The documentation is included in the
code which is attached here.  If you want the compilation output to go somewhere else, define <code>cql_write_file</code>
as the name of your output handling function.  It should accept a <code>const char *</code> for the file name and another
for the data to be written.  You can then store those compilation results however you deem appropriate.</p><div class="language-c codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-c codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">ifndef</span><span class="token macro property"> </span><span class="token macro property expression">cql_write_file</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// CQL code generation outputs are emitted in one &quot;gulp&quot; with this</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// API. You can define it to be a method of your choice with</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// &quot;#define cql_write_file your_method&quot; and then your method will</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// get the filename and the data. This will be whatever output the</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// compiler would have emitted to one of it&#x27;s --cg arguments.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// You can then write it to a location of your choice.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// You must copy the memory if you intend to keep it. &quot;data&quot; will</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// be freed.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Note: you *may* use cql_cleanup_and_exit to force a failure</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// from within this API.  That&#x27;s a normal failure mode that is</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// well-tested.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">cql_write_file</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">char</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">_Nonnull file_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">char</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">_Nonnull data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  FILE </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">file </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">cql_open_file_for_write</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">file_name</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">fprintf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">file</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;%s&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">fclose</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">file</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">endif</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Typically you would <code>#define cql_write_file your_write_function</code> before you include the amalgam and then
define your_write_function elsewhere in that file (before or after the amalgam is included are both fine).</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="amalgam-lean-choices">Amalgam LEAN choices<a class="hash-link" href="#amalgam-lean-choices" title="Direct link to heading">​</a></h3><p>When you include the amalgam, you get everything by default. You may, however, only want some
limited subset of the compiler&#x27;s functions in your build.</p><p>To customize the amalgam, there are a set of configuration pre-processor options.  To opt-in to
configuration, first define <code>CQL_AMALGAM_LEAN</code>. You then have to opt-in to the various pieces
you might want. The system is useless without the parser, so you can&#x27;t remove that; but you can
choose from the list below.</p><p>The options are:</p><ul><li>CQL_AMALGAM_LEAN` : enable lean mode; this must be set or you get everything</li><li><code>CQL_AMALGAM_CG_C</code> : C codegen</li><li><code>CQL_AMALGAM_CG_COMMON</code> : common code generator pieces</li><li><code>CQL_AMALGAM_GEN_SQL</code> : the echoing features</li><li><code>CQL_AMALGAM_JAVA</code> : Java code gen</li><li><code>CQL_AMALGAM_JSON</code> : JSON schema output</li><li><code>CQL_AMALGAM_OBJC</code> : Objective-C code gen</li><li><code>CQL_AMALGAM_QUERY_PLAN</code> : the query plan creator</li><li><code>CQL_AMALGAM_SCHEMA</code> : the assorted schema output types</li><li><code>CQL_AMALGAM_SEM</code> : semantic analysis (needed by most things)</li><li><code>CQL_AMALGAM_TEST_HELPERS</code> : test helper output</li><li><code>CQL_AMALGAM_UDF</code> : the UDF stubs used by the query plan output</li><li><code>CQL_AMALGAM_UNIT_TESTS</code> : some internal unit tests, which are pretty much needed by nobody</li></ul><p>Note that <code>CQL_AMALGAM_SEM</code> is necessary for any of the code generation
features to work. Likewise, several generators require <code>CQL_AMALGAM_CG_COMMON</code> (e.g., C does).</p><p>Pick what you want; stubs are created for what you omit to avoid linkage errors.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="other-notes">Other Notes<a class="hash-link" href="#other-notes" title="Direct link to heading">​</a></h3><p>The amalgam will use malloc/calloc for its allocations and it is designed to release all memory it
has allocated when cql_main returns control to you, even in the face of error.</p><p>Internal compilation errors result in an <code>assert</code> failure leading to an abort.  This is not supposed
to ever happen but there can always be bugs.  Normal errors just prevent later phases of the compiler
from running so you might not see file output, but rather just error output.  In all cases things
should be cleaned up.</p><p>The compiler can be called repeatedly with no troubles; it re-initializes on each use. The compiler is
not multi-threaded so if there is threading you should use some mutex arrangement to keep it safe.
A thread-safe version would require extensive modifications.</p><h2 class="anchor anchorWithStickyNavbar_mojV" id="appendix-10-cql-working-example">Appendix 10: CQL Working Example<a class="hash-link" href="#appendix-10-cql-working-example" title="Direct link to heading">​</a></h2><p>This is a working example that shows all of the basic DML statements and the call patterns
to access them. The code also includes the various helpers you can use to convert C types to
CQL types.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="todosql"><code>todo.sql</code><a class="hash-link" href="#todosql" title="Direct link to heading">​</a></h4><div class="language-SQL codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-SQL codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- This is a simple schema for keeping track of tasks and whether or not they have been completed</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- this serves to both declare the table and create the schema</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create proc todo_create_tables()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  create table if not exists tasks(</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    description text not null,</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    done bool default false not null</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  );</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- adds a new not-done task</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create proc todo_add(task TEXT NOT null)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  insert into tasks values(task, false);</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- gets the tasks in inserted order</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create proc todo_tasks()</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  select rowid, description, done from tasks order by rowid;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- updates a given task by rowid</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create proc todo_setdone_(rowid_ integer not null, done_ bool not null)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  update tasks set done = done_ where rowid == rowid_;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">-- deletes a given task by rowid</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">create proc todo_delete(rowid_ integer not null)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">begin</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  delete from tasks where rowid == rowid_;</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">end;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_mojV" id="mainc"><code>main.c</code><a class="hash-link" href="#mainc" title="Direct link to heading">​</a></h4><div class="language-c codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-c codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;stdlib.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(195, 232, 141)">&lt;sqlite3.h&gt;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(195, 232, 141)">&quot;todo.h&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> argc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">char</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">argv</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* Note: not exactly world class error handling but that isn&#x27;t the point */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// create a db</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  sqlite3 </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">db</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> rc </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">sqlite3_open</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;:memory:&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">db</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">rc </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> SQLITE_OK</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">exit</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// make schema if needed (in memory databases always begin empty)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  rc </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">todo_create_tables</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">db</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">   </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">rc </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> SQLITE_OK</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">exit</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// add some tasks</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">char</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">const</span><span class="token plain"> default_tasks</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Buy milk&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Walk dog&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Write code&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// note we make a string reference from a c string here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    cql_string_ref dtask </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">cql_string_ref_new</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">default_tasks</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    rc </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">todo_add</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">db</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> dtask</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">cql_string_release</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">dtask</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// and then dispose of the reference</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">rc </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> SQLITE_OK</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token function" style="color:rgb(130, 170, 255)">exit</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">3</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// mark a task as done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  rc </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">todo_setdone_</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">db</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">rc </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> SQLITE_OK</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">exit</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// delete a row in the middle, rowid = 2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  rc </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">todo_delete</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">db</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">2</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">rc </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> SQLITE_OK</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">exit</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">5</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// select out some results</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  todo_tasks_result_set_ref result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  rc </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">todo_tasks_fetch_results</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">db</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">rc </span><span class="token operator" style="color:rgb(137, 221, 255)">!=</span><span class="token plain"> SQLITE_OK</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;error: %d\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> rc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">exit</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">6</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// get result count</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  cql_int32 result_count </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">todo_tasks_result_count</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// loop to print</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">cql_int32 row </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> row </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> result_count</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> row</span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// note &quot;get&quot; semantics mean that a ref count is not added</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// if you want to keep the string you must &quot;retain&quot; it</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    cql_string_ref text </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">todo_tasks_get_description</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    cql_bool done </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">todo_tasks_get_done</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    cql_int32 rowid </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">todo_tasks_get_rowid</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// convert to c string format</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">cql_alloc_cstr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ctext</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">printf</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;%d: rowid:%d %s (%s)\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">      row</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> rowid</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> ctext</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> done </span><span class="token operator" style="color:rgb(137, 221, 255)">?</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;done&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;not done&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">cql_free_cstr</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ctext</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> text</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// done with results, free the lot</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">cql_result_set_release</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">result_set</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// and close the database</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">sqlite3_close</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">db</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="build-steps">Build Steps<a class="hash-link" href="#build-steps" title="Direct link to heading">​</a></h3><div class="language-sh codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-sh codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain"># ${cgsql} refers to the root of the CG/SQL repo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">% cql --in todo.sql --cg todo.h todo.c</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">% cc -o todo -I${cqsql}/sources main.c todo.c ${cgsql}/sources/cqlrt.c -lsqlite3</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="results">Results<a class="hash-link" href="#results" title="Direct link to heading">​</a></h3><p>Note that rowid 2 has been deleted, the leading number is the index in
the result set. The rowid is of course the database rowid.</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">% ./todo</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">0: rowid:1 Buy milk (done)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">1: rowid:3 Write code (not done)</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_mojV" id="appendix-11-production-considerations">Appendix 11: Production Considerations<a class="hash-link" href="#appendix-11-production-considerations" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_mojV" id="production-considerations">Production Considerations<a class="hash-link" href="#production-considerations" title="Direct link to heading">​</a></h3><p>This system as it appears in the sources here is designed to get some basic SQLite scenarios working but
the runtime systems that are packaged here are basic, if only for clarity.  There are some important
things you should think about improving or customizing for your production environment. Here&#x27;s a brief list.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="concurrency">Concurrency<a class="hash-link" href="#concurrency" title="Direct link to heading">​</a></h4><p>The reference counting solution in the stock <code>CQLRT</code> implementation is single threaded.  This might be ok,
in many environments only one thread is doing all the data access.  But if you plan to share objects
between threads this is something you&#x27;ll want to address.  <code>CQLRT</code> is designed to be replacable.  In fact
there is another version included in the distribution <code>cqlrt_cf</code> that is more friendly to iOS and CoreFoundation.
This alternate version is an excellent demonstration of what is possible.  There are more details
in <a href="https://cgsql.dev/cql-guide/int05" target="_blank" rel="noopener noreferrer">Internals Part 5: CQL Runtime</a>.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="statement-caching">Statement Caching<a class="hash-link" href="#statement-caching" title="Direct link to heading">​</a></h4><p>SQLite statement management includes the ability to reset and re-prepare statements.  This is an
important performance optimization but the stock <code>CQLRT</code> does not take advantage of this.  This is
for two reasons:  first, simplicity, and secondly (though more importantly), any kind of statement cache would require
a caching policy and this simple <code>CQLRT</code> cannot possibly know what might consitute a good policy
for your application.</p><p>The following three macros can be defined in your <code>cqlrt.h</code> and they can be directed at a version that
keeps a cache of your choice.</p><div class="language-c codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-c codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">ifndef</span><span class="token macro property"> </span><span class="token macro property expression">cql_sqlite3_exec</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">define</span><span class="token macro property"> </span><span class="token macro property macro-name function" style="color:rgb(130, 170, 255)">cql_sqlite3_exec</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token macro property expression">db</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token macro property expression"> sql</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token macro property expression"> </span><span class="token macro property expression function" style="color:rgb(130, 170, 255)">sqlite3_exec</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token macro property expression">db</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token macro property expression"> </span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token macro property expression">sql</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token macro property expression"> </span><span class="token macro property expression constant" style="color:rgb(130, 170, 255)">NULL</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token macro property expression"> </span><span class="token macro property expression constant" style="color:rgb(130, 170, 255)">NULL</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token macro property expression"> </span><span class="token macro property expression constant" style="color:rgb(130, 170, 255)">NULL</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">endif</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">ifndef</span><span class="token macro property"> </span><span class="token macro property expression">cql_sqlite3_prepare_v2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">define</span><span class="token macro property"> </span><span class="token macro property macro-name function" style="color:rgb(130, 170, 255)">cql_sqlite3_prepare_v2</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token macro property expression">db</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token macro property expression"> sql</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token macro property expression"> len</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token macro property expression"> stmt</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token macro property expression"> tail</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token macro property expression"> </span><span class="token macro property expression function" style="color:rgb(130, 170, 255)">sqlite3_prepare_v2</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token macro property expression">db</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token macro property expression"> </span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token macro property expression">sql</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token macro property expression"> </span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token macro property expression">len</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token macro property expression"> </span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token macro property expression">stmt</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token macro property expression"> </span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token macro property expression">tail</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">endif</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">ifndef</span><span class="token macro property"> </span><span class="token macro property expression">cql_sqlite3_finalize</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">define</span><span class="token macro property"> </span><span class="token macro property macro-name function" style="color:rgb(130, 170, 255)">cql_sqlite3_finalize</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token macro property expression">stmt</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token macro property expression"> </span><span class="token macro property expression function" style="color:rgb(130, 170, 255)">sqlite3_finalize</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token macro property expression">stmt</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token macro property expression punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">endif</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>As you might expect, <code>prepare</code> creates a statement or else returns one from the cache.
When the <code>finalize</code> API is called the indicated statement can be returned to the cache or discarded.
The <code>exec</code> API does both of these operations, but also, recall that <code>exec</code> can get a semicolon
separated list of statements. Your <code>exec</code> implementation will have to use SQLite&#x27;s prepare functions
to split the list and get prepared statements for part of the string.  Alternately, you could choose
not to cache in the <code>exec</code> case.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="your-underlying-runtime">Your Underlying Runtime<a class="hash-link" href="#your-underlying-runtime" title="Direct link to heading">​</a></h4><p>As you can see in <code>cqlrt_cf</code>, there is considerable ability to define what the basic data types mean.  Importantly,
the reference types <code>text</code>, <code>blob</code>, and <code>object</code> can become something different (e.g., something
already supported by your environment).  For instance, on Windows you could use COM or .NET types
for your objects.  All object references are substantially opaque to <code>CQLRT</code>; they have comparatively
few APIs that are defined in the runtime:  things like getting the text out of the string reference
and so forth.</p><p>In addition to the basic types and operations you can also define a few helper functions that
allow you to create some more complex object types.  For instance, list, set, and dictionary
creation and management functions can be readily created and then you can declare them using
the <code>DECLARE FUNCTION</code> language features.  These objects will then be whatever list, set, or
dictionary they need to be in order to interoperate with the rest of your environment.  You can
define all the data types you might need in your <code>CQLRT</code> and you can employ whatever
threading model and locking primitives you need for correctness.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="debugging-and-tracing">Debugging and Tracing<a class="hash-link" href="#debugging-and-tracing" title="Direct link to heading">​</a></h4><p>The <code>CQLRT</code> interface includes some helper macros for logging.  These are defined
as no-ops by default but, of course, they can be changed.</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">#define cql_contract assert</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#define cql_invariant assert</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#define cql_tripwire assert</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#define cql_log_database_error(...)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">#define cql_error_trace()</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>cql_contract</code> and <code>cql_invariant</code> are for fatal errors. They both assert something
that is expected to always be true (like <code>assert</code>) with the only difference being that
the former is conventionally used to validate preconditions of functions.</p><p><code>cql_tripwire</code> is a slightly softer form of assert that should crash in debug
builds but only log an error in production builds. It is generally used to enforce
a new condition that may not always hold with the goal of eventually transitioning
over to <code>cql_contract</code> or <code>cql_invariant</code> once logging has demonstrated that the
tripwire is never hit.
When a <code>fetch_results</code> method is called, a failure results in a call to <code>cql_log_database_error</code>.
Presently the log format is very simple.  The invocation looks like this:</p><div class="language-c codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-c codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">cql_log_database_error</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">info</span><span class="token operator" style="color:rgb(137, 221, 255)">-&gt;</span><span class="token plain">db</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;cql&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;database error&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The logging facility is expected to send the message to wherever is appropriate for your environment.
Additionally it will typically get the failing result code and error message from SQLite, however
these are likely to be stale. Failed queries usually still require cleanup and so the SQLite error
codes be lost because (e.g.) a <code>finalize</code> has happened, clearing the code. You can do better if,
for instance, your runtime caches the results of recent failed <code>prepare</code> calls. In any case,
what you log and where you log it is entirely up to you.</p><p>The <code>cql_error_trace</code> macro is described in <a href="https://cgsql.dev/cql-guide/int03#cleanup-and-errors" target="_blank" rel="noopener noreferrer">Internals Chapter 3</a>.
It will typically invoke <code>printf</code> or <code>fprintf</code> or something like that to trace the origin of thrown
exceptions and to get the error text from SQLite as soon as possible.</p><p>An example might be:</p><div class="codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-text codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token plain">#define cql_error_trace() fprintf(stderr, &quot;error %d in %s %s:%d\n&quot;, _rc_, _PROC_, __FILE__, __LINE_)</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Typically the cost of all these diagnostics is too high to include in production code so this is
turned on when debugging failures.  But you can make that choice for yourself.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="customizing-code-generation">Customizing Code Generation<a class="hash-link" href="#customizing-code-generation" title="Direct link to heading">​</a></h4><p>The file <code>rt_common.c</code> defines the common result types, but the skeleton file <code>rt.c</code>
includes affordances to add your own types without having to worry about conflicts with the
common types.  These macros define</p><div class="language-c codeBlockContainer_MPoW theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_B9tL"><pre tabindex="0" class="prism-code language-c codeBlock__0OG thin-scrollbar"><code class="codeBlockLines_gEuF"><span class="token-line" style="color:#bfc7d5"><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">define</span><span class="token macro property"> </span><span class="token macro property macro-name">RT_EXTRAS</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">define</span><span class="token macro property"> </span><span class="token macro property macro-name">RT_EXTRA_CLEANUP</span><br></span></code></pre><div class="buttonGroup_hRr1"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_W9eQ" aria-hidden="true"><svg class="copyButtonIcon_XEyF" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_i9w9" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Simply define these two to create whatever <code>rt_</code> data structures you want and add any
cleanup function that might be needed to release resources.  The other cleanup
functions should provide a good template for you to make your own.</p><p>The C data type <code>rtdata</code> includes many text fragments that directly control the
code generation.  If you want to make your generated code look more like say
CoreFoundation you can define an <code>rtdata</code> that will do the job.  This will mean
a lot of your generated code won&#x27;t require the <code>#defines</code> for the CQL types,
it can use your runtime directly.  You can also enable things like Pascal casing
for procedure names and a common prefix on procedure names if those are useful
in your environment.  However, the system is designed so that such changes
aren&#x27;t necessary.  The data types in <code>cqlrt.h</code> are enough for any remapping,
additional changes with <code>rtdata</code> are merely cosmetic.</p><h4 class="anchor anchorWithStickyNavbar_mojV" id="summary-1">Summary<a class="hash-link" href="#summary-1" title="Direct link to heading">​</a></h4><p>The <code>CQLRT</code> macros are very powerful, they allow you to target almost any
runtime with a C API.  The <code>cqlrt_cf</code> version is a good example of the
sorts of changes you can make.</p><p>Concurrency and Statement Caching are not supported in the basic version
for <code>cqlrt.h</code>.  If this is important to you you might want to customize for that.</p><p>Helper functions for additional data types can be added, and they can be
unique to your runtime.</p><p>There are tracing macros to help with debugability.  Providing some
useful versions of those can be of great help in production environments.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"></div><div class="col lastUpdated_foO9"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2022-06-09T23:03:46.000Z">6/9/2022</time></b> by <b>Tim Cheung</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#chapter-1-introduction" class="table-of-contents__link toc-highlight">Chapter 1: Introduction</a><ul><li><a href="#getting-started" class="table-of-contents__link toc-highlight">Getting Started</a></li><li><a href="#why-did-this-work" class="table-of-contents__link toc-highlight">Why did this work?</a></li><li><a href="#variables-and-arithmetic" class="table-of-contents__link toc-highlight">Variables and Arithmetic</a></li><li><a href="#basic-conversion-rules" class="table-of-contents__link toc-highlight">Basic Conversion Rules</a></li><li><a href="#preprocessing-features" class="table-of-contents__link toc-highlight">Preprocessing Features</a></li></ul></li><li><a href="#chapter-2-using-data" class="table-of-contents__link toc-highlight">Chapter 2: Using Data</a><ul><li><a href="#a-sample-program" class="table-of-contents__link toc-highlight">A Sample Program</a></li><li><a href="#providing-a-suitable-database" class="table-of-contents__link toc-highlight">Providing a Suitable Database</a></li><li><a href="#declaring-schema" class="table-of-contents__link toc-highlight">Declaring Schema</a></li><li><a href="#explaining-the-new-hello-world" class="table-of-contents__link toc-highlight">Explaining The New Hello World</a></li><li><a href="#introducing-cursors" class="table-of-contents__link toc-highlight">Introducing Cursors</a></li><li><a href="#going-crazy" class="table-of-contents__link toc-highlight">Going Crazy</a></li></ul></li><li><a href="#chapter-3-expressions-literals-nullability-sensitivity" class="table-of-contents__link toc-highlight">Chapter 3: Expressions, Literals, Nullability, Sensitivity</a><ul><li><a href="#expression-examples" class="table-of-contents__link toc-highlight">Expression Examples</a></li><li><a href="#operator-precedence" class="table-of-contents__link toc-highlight">Operator Precedence</a></li><li><a href="#order-of-evaluation" class="table-of-contents__link toc-highlight">Order of Evaluation</a></li><li><a href="#variables-columns-basic-types-and-nullability" class="table-of-contents__link toc-highlight">Variables, Columns, Basic Types and Nullability</a></li><li><a href="#types-of-literals" class="table-of-contents__link toc-highlight">Types of Literals</a></li><li><a href="#const-and-enumerations" class="table-of-contents__link toc-highlight">Const and Enumerations</a></li><li><a href="#named-types" class="table-of-contents__link toc-highlight">Named Types</a></li><li><a href="#type-kinds" class="table-of-contents__link toc-highlight">Type Kinds</a></li><li><a href="#nullability" class="table-of-contents__link toc-highlight">Nullability</a></li><li><a href="#expression-types" class="table-of-contents__link toc-highlight">Expression Types</a></li><li><a href="#case-expressions" class="table-of-contents__link toc-highlight">CASE Expressions</a></li><li><a href="#marking-data-as-sensitive" class="table-of-contents__link toc-highlight">Marking Data as Sensitive</a></li><li><a href="#reference-semantics" class="table-of-contents__link toc-highlight">Reference Semantics</a></li><li><a href="#function-return-values" class="table-of-contents__link toc-highlight">Function Return Values</a></li><li><a href="#comparison" class="table-of-contents__link toc-highlight">Comparison</a></li><li><a href="#object" class="table-of-contents__link toc-highlight"><code>OBJECT</code></a></li><li><a href="#text" class="table-of-contents__link toc-highlight"><code>TEXT</code></a></li><li><a href="#blob" class="table-of-contents__link toc-highlight"><code>BLOB</code></a></li><li><a href="#sample-code" class="table-of-contents__link toc-highlight">Sample Code</a></li></ul></li><li><a href="#chapter-4-procedures-functions-and-control-flow" class="table-of-contents__link toc-highlight">Chapter 4: Procedures, Functions, and Control Flow</a><ul><li><a href="#out-parameters" class="table-of-contents__link toc-highlight">Out Parameters</a></li><li><a href="#procedure-calls" class="table-of-contents__link toc-highlight">Procedure Calls</a></li><li><a href="#the-if-statement" class="table-of-contents__link toc-highlight">The IF statement</a></li><li><a href="#the-while-statement" class="table-of-contents__link toc-highlight">The WHILE statement</a></li><li><a href="#the-switch-statement" class="table-of-contents__link toc-highlight">The SWITCH Statement</a></li><li><a href="#the-try-catch-and-throw-statements" class="table-of-contents__link toc-highlight">The TRY, CATCH, and THROW Statements</a></li><li><a href="#procedures-as-functions-motivation-and-example" class="table-of-contents__link toc-highlight">Procedures as Functions: Motivation and Example</a></li></ul></li><li><a href="#chapter-5-types-of-cursors-shapes-out-and-out-union-and-fetch" class="table-of-contents__link toc-highlight">Chapter 5: Types of Cursors, Shapes, OUT and OUT UNION, and FETCH</a><ul><li><a href="#statement-cursors" class="table-of-contents__link toc-highlight">Statement Cursors</a></li><li><a href="#value-cursors" class="table-of-contents__link toc-highlight">Value Cursors</a></li><li><a href="#out-statement" class="table-of-contents__link toc-highlight">OUT Statement</a></li><li><a href="#out-union-statement" class="table-of-contents__link toc-highlight">OUT UNION Statement</a></li><li><a href="#result-set-cursors" class="table-of-contents__link toc-highlight">Result Set Cursors</a></li><li><a href="#reshaping-data-cursor-like-forms" class="table-of-contents__link toc-highlight">Reshaping Data, Cursor <code>LIKE</code> forms</a></li><li><a href="#fetch-statement-specifics" class="table-of-contents__link toc-highlight">Fetch Statement Specifics</a></li><li><a href="#calling-procedures-with-argument-bundles" class="table-of-contents__link toc-highlight">Calling Procedures with Argument Bundles</a></li><li><a href="#using-named-argument-bundles" class="table-of-contents__link toc-highlight">Using Named Argument Bundles</a></li><li><a href="#the-columnslike-construct-in-the-select-statement" class="table-of-contents__link toc-highlight">The COLUMNS/LIKE construct in the SELECT statement</a></li><li><a href="#missing-data-columns-nulls-and-dummy-data" class="table-of-contents__link toc-highlight">Missing Data Columns, Nulls and Dummy Data</a></li><li><a href="#generalized-cursor-lifetimes-aka-cursor-boxing" class="table-of-contents__link toc-highlight">Generalized Cursor Lifetimes aka Cursor &quot;Boxing&quot;</a></li></ul></li><li><a href="#chapter-6-calling-procedures-defined-elsewhere" class="table-of-contents__link toc-highlight">Chapter 6: Calling Procedures Defined Elsewhere</a><ul><li><a href="#declaring-procedures-defined-elsewhere" class="table-of-contents__link toc-highlight">Declaring Procedures Defined Elsewhere</a></li><li><a href="#simple-procedures-database-free" class="table-of-contents__link toc-highlight">Simple Procedures (database free):</a></li><li><a href="#procedures-that-use-the-database" class="table-of-contents__link toc-highlight">Procedures that use the database</a></li><li><a href="#procedures-that-create-a-result-set" class="table-of-contents__link toc-highlight">Procedures that create a result set</a></li><li><a href="#procedures-that-return-a-single-row-with-a-value-cursor" class="table-of-contents__link toc-highlight">Procedures that return a single row with a value cursor</a></li><li><a href="#procedures-that-return-a-full-result-set" class="table-of-contents__link toc-highlight">Procedures that return a full result set</a></li><li><a href="#exporting-declared-symbols-automatically" class="table-of-contents__link toc-highlight">Exporting Declared Symbols Automatically</a></li><li><a href="#declaration-examples" class="table-of-contents__link toc-highlight">Declaration Examples</a></li></ul></li><li><a href="#chapter-7-cql-result-sets" class="table-of-contents__link toc-highlight">Chapter 7: CQL Result Sets</a><ul><li><a href="#results-sets-from-out-union" class="table-of-contents__link toc-highlight">Results Sets From <code>OUT UNION</code></a></li><li><a href="#a-working-example" class="table-of-contents__link toc-highlight">A Working Example</a></li></ul></li><li><a href="#chapter-8-functions" class="table-of-contents__link toc-highlight">Chapter 8: Functions</a><ul><li><a href="#function-types" class="table-of-contents__link toc-highlight">Function Types</a></li><li><a href="#sql-functions-with-unchecked-parameter-types" class="table-of-contents__link toc-highlight">SQL Functions with Unchecked Parameter Types</a></li><li><a href="#notes-on-builtin-functions" class="table-of-contents__link toc-highlight">Notes on Builtin Functions</a></li></ul></li><li><a href="#chapter-9-statements-summary-and-error-checking" class="table-of-contents__link toc-highlight">Chapter 9: Statements Summary and Error Checking</a><ul><li><a href="#the-primary-sql-statements" class="table-of-contents__link toc-highlight">The Primary SQL Statements</a></li><li><a href="#the-primary-procedure-statements" class="table-of-contents__link toc-highlight">The Primary Procedure Statements</a></li><li><a href="#the-meta-statements" class="table-of-contents__link toc-highlight">The &quot;Meta&quot; Statements</a></li><li><a href="#important-program-fragments" class="table-of-contents__link toc-highlight">Important Program Fragments</a></li><li><a href="#special-note-on-the-joinusing-form" class="table-of-contents__link toc-highlight">Special Note on the JOIN...USING form</a></li></ul></li><li><a href="#chapter-10-schema-management-features" class="table-of-contents__link toc-highlight">Chapter 10: Schema Management Features</a><ul><li><a href="#annotations" class="table-of-contents__link toc-highlight">Annotations</a></li><li><a href="#semantics" class="table-of-contents__link toc-highlight">Semantics</a></li><li><a href="#allowable-changes" class="table-of-contents__link toc-highlight">Allowable changes</a></li><li><a href="#prosecution" class="table-of-contents__link toc-highlight">Prosecution</a></li><li><a href="#example-migration" class="table-of-contents__link toc-highlight">Example Migration</a></li><li><a href="#sample-upgrade-script" class="table-of-contents__link toc-highlight">Sample Upgrade Script</a></li><li><a href="#schema-regions" class="table-of-contents__link toc-highlight">Schema Regions</a></li><li><a href="#unsubscription-and-resubscription-features" class="table-of-contents__link toc-highlight">Unsubscription and Resubscription Features</a></li></ul></li><li><a href="#chapter-11-previous-schema-validation" class="table-of-contents__link toc-highlight">Chapter 11: Previous Schema Validation</a><ul><li><a href="#basic-usage" class="table-of-contents__link toc-highlight">Basic Usage</a></li></ul></li><li><a href="#chapter-12-testability-features" class="table-of-contents__link toc-highlight">Chapter 12: Testability Features</a><ul><li><a href="#dummy-data" class="table-of-contents__link toc-highlight">Dummy Data</a></li><li><a href="#autotest-attributes" class="table-of-contents__link toc-highlight">Autotest Attributes</a></li></ul></li><li><a href="#chapter-13-json-output" class="table-of-contents__link toc-highlight">Chapter 13: JSON Output</a></li><li><a href="#chapter-14-cql-query-fragments" class="table-of-contents__link toc-highlight">Chapter 14: CQL Query Fragments</a><ul><li><a href="#base-query-fragments" class="table-of-contents__link toc-highlight">Base Query Fragments</a></li><li><a href="#extension-query-fragments" class="table-of-contents__link toc-highlight">Extension Query Fragments</a></li><li><a href="#shared-fragments" class="table-of-contents__link toc-highlight">Shared Fragments</a></li><li><a href="#shared-fragments-with-conditionals" class="table-of-contents__link toc-highlight">Shared Fragments with Conditionals</a></li></ul></li><li><a href="#appendix-1-command-line-options" class="table-of-contents__link toc-highlight">Appendix 1: Command Line Options</a><ul><li><a href="#with-no-options" class="table-of-contents__link toc-highlight">With No Options</a></li><li><a href="#--in-file" class="table-of-contents__link toc-highlight">--in file</a></li><li><a href="#--sem" class="table-of-contents__link toc-highlight">--sem</a></li><li><a href="#--ast" class="table-of-contents__link toc-highlight">--ast</a></li><li><a href="#--echo" class="table-of-contents__link toc-highlight">--echo</a></li><li><a href="#--dot" class="table-of-contents__link toc-highlight">--dot</a></li><li><a href="#--cg-output1-output2-" class="table-of-contents__link toc-highlight">--cg output1 output2 ...</a></li><li><a href="#--nolines" class="table-of-contents__link toc-highlight">--nolines</a></li><li><a href="#--global_proc-name" class="table-of-contents__link toc-highlight">--global_proc name</a></li><li><a href="#--compress" class="table-of-contents__link toc-highlight">--compress</a></li><li><a href="#--test" class="table-of-contents__link toc-highlight">--test</a></li><li><a href="#--dev" class="table-of-contents__link toc-highlight">--dev</a></li><li><a href="#--java_package_name-name" class="table-of-contents__link toc-highlight">--java_package_name name</a></li><li><a href="#--java_fragment_interface_mode" class="table-of-contents__link toc-highlight">--java_fragment_interface_mode</a></li><li><a href="#--java_imports-name" class="table-of-contents__link toc-highlight">--java_imports name</a></li><li><a href="#--c_include_namespace" class="table-of-contents__link toc-highlight">--c_include_namespace</a></li><li><a href="#--c_include_path" class="table-of-contents__link toc-highlight">--c_include_path</a></li><li><a href="#--objc_c_include_path" class="table-of-contents__link toc-highlight">--objc_c_include_path</a></li><li><a href="#result-types---rt-" class="table-of-contents__link toc-highlight">Result Types (--rt *)</a></li></ul></li><li><a href="#appendix-2-cql-grammar" class="table-of-contents__link toc-highlight">Appendix 2: CQL Grammar</a><ul><li><a href="#operators-and-literals" class="table-of-contents__link toc-highlight">Operators and Literals</a></li><li><a href="#statementtype-keywords" class="table-of-contents__link toc-highlight">Statement/Type Keywords</a></li><li><a href="#rules" class="table-of-contents__link toc-highlight">Rules</a></li></ul></li><li><a href="#appendix-3-control-directives" class="table-of-contents__link toc-highlight">Appendix 3: Control Directives</a></li><li><a href="#appendix-4-cql-error-codes" class="table-of-contents__link toc-highlight">Appendix 4: CQL Error Codes</a><ul><li><a href="#cql0001-operands-must-be-an-integer-type-not-real" class="table-of-contents__link toc-highlight">CQL0001: operands must be an integer type, not real</a></li><li><a href="#cql0002-left-operand-cannot-be-an-object-in-operator" class="table-of-contents__link toc-highlight">CQL0002: left operand cannot be an object in &#39;operator&#39;</a></li><li><a href="#cql0003-left-operand-cannot-be-an-object-in-operator" class="table-of-contents__link toc-highlight">CQL0003: left operand cannot be an object in &#39;operator&#39;</a></li><li><a href="#cql0004-left-operand-cannot-be-a-blob-in-operator" class="table-of-contents__link toc-highlight">CQL0004: left operand cannot be a blob in &#39;operator&#39;</a></li><li><a href="#cql0005-right-operand-cannot-be-a-blob-in-operator" class="table-of-contents__link toc-highlight">CQL0005: right operand cannot be a blob in &#39;operator&#39;</a></li><li><a href="#cql0007-left-operand-cannot-be-a-string-in-operator" class="table-of-contents__link toc-highlight">CQL0007: left operand cannot be a string in &#39;operator&#39;</a></li><li><a href="#cql0008-right-operand-cannot-be-a-string-in-operator" class="table-of-contents__link toc-highlight">CQL0008: right operand cannot be a string in &#39;operator&#39;</a></li><li><a href="#cql0009-incompatible-types-in-expression-subject" class="table-of-contents__link toc-highlight">CQL0009: incompatible types in expression &#39;subject&#39;</a></li><li><a href="#cql0010-incompatible-types-in-expression-subject" class="table-of-contents__link toc-highlight">CQL0010: incompatible types in expression &#39;subject&#39;</a></li><li><a href="#cql0011-incompatible-types-in-expression-subject" class="table-of-contents__link toc-highlight">CQL0011: incompatible types in expression &#39;subject&#39;</a></li><li><a href="#cql0012-incompatible-types-in-expression-subject" class="table-of-contents__link toc-highlight">CQL0012: incompatible types in expression &#39;subject&#39;</a></li><li><a href="#cql0013-cannot-assigncopy-possibly-null-expression-to-not-null-target-target" class="table-of-contents__link toc-highlight">CQL0013: cannot assign/copy possibly null expression to not null target &#39;target&#39;</a></li><li><a href="#cql0014-cannot-assigncopy-sensitive-expression-to-not-null-target-target" class="table-of-contents__link toc-highlight">CQL0014: cannot assign/copy sensitive expression to not null target &#39;target&#39;</a></li><li><a href="#cql0015-expected-numeric-expression-context" class="table-of-contents__link toc-highlight">CQL0015: expected numeric expression &#39;context&#39;</a></li><li><a href="#cql0016-duplicate-table-name-in-join-table" class="table-of-contents__link toc-highlight">CQL0016: duplicate table name in join &#39;table&#39;</a></li><li><a href="#cql0017-index-was-present-but-now-it-does-not-exist-use-delete-instead-index" class="table-of-contents__link toc-highlight">CQL0017: index was present but now it does not exist (use <code>@delete</code> instead) &#39;index&#39;</a></li><li><a href="#cql0018-duplicate-index-name-index" class="table-of-contents__link toc-highlight">CQL0018: duplicate index name &#39;index&#39;</a></li><li><a href="#cql0019-create-index-table-name-not-found-table_name" class="table-of-contents__link toc-highlight">CQL0019: create index table name not found &#39;table_name&#39;</a></li><li><a href="#cql0020-duplicate-constraint-name-in-table-constraint_name" class="table-of-contents__link toc-highlight">CQL0020: duplicate constraint name in table &#39;constraint_name&#39;</a></li><li><a href="#cql0021-foreign-key-refers-to-non-existent-table-table_name" class="table-of-contents__link toc-highlight">CQL0021: foreign key refers to non-existent table &#39;table_name&#39;</a></li><li><a href="#cql0022-exact-type-of-both-sides-of-a-foreign-key-must-match-expected-expected_type-found-actual_type-key_name" class="table-of-contents__link toc-highlight">CQL0022: exact type of both sides of a foreign key must match (expected expected_type; found actual_type) &#39;key_name&#39;</a></li><li><a href="#cql0023-number-of-columns-on-both-sides-of-a-foreign-key-must-match" class="table-of-contents__link toc-highlight">CQL0023: number of columns on both sides of a foreign key must match</a></li><li><a href="#cql0025-version-number-in-annotation-must-be-positive" class="table-of-contents__link toc-highlight">CQL0025: version number in annotation must be positive</a></li><li><a href="#cql0026-duplicate-version-annotation" class="table-of-contents__link toc-highlight">CQL0026: duplicate version annotation</a></li><li><a href="#cql0027-a-procedure-can-appear-in-only-one-annotation-procedure_name" class="table-of-contents__link toc-highlight">CQL0027: a procedure can appear in only one annotation &#39;procedure_name&#39;</a></li><li><a href="#cql0028-fk-reference-must-be-exactly-one-column-with-the-correct-type-column_name" class="table-of-contents__link toc-highlight">CQL0028: FK reference must be exactly one column with the correct type &#39;column_name&#39;</a></li><li><a href="#cql0029-autoincrement-column-must-be-long_integer-primary-key-column-name" class="table-of-contents__link toc-highlight">CQL0029: autoincrement column must be LONG_INTEGER PRIMARY KEY &#39;column name&#39;</a></li><li><a href="#cql0030-a-column-attribute-was-specified-twice-on-the-same-column-column_name" class="table-of-contents__link toc-highlight">CQL0030: a column attribute was specified twice on the same column &#39;column_name&#39;</a></li><li><a href="#cql0031-column-cant-be-primary-key-and-also-unique-key-column" class="table-of-contents__link toc-highlight">CQL0031: column can&#39;t be primary key and also unique key &#39;column&#39;</a></li><li><a href="#cql0032-created-columns-must-be-at-the-end-and-must-be-in-version-order-column" class="table-of-contents__link toc-highlight">CQL0032: created columns must be at the end and must be in version order&quot;, &#39;column&#39;</a></li><li><a href="#cql0033-columns-in-a-table-marked-recreate-cannot-have-create-or-delete-column" class="table-of-contents__link toc-highlight">CQL0033: columns in a table marked @recreate cannot have @create or <code>@delete</code>, &#39;column&#39;</a></li><li><a href="#cql0034-createdelete-version-numbers-can-only-be-applied-to-columns-that-are-nullable-or-have-a-default-value-column" class="table-of-contents__link toc-highlight">CQL0034: create/delete version numbers can only be applied to columns that are nullable or have a default value &#39;column&#39;</a></li><li><a href="#cql0035-column-delete-version-cant-be--column-create-version-column" class="table-of-contents__link toc-highlight">CQL0035: column delete version can&#39;t be &lt;= column create version&quot;, &#39;column&#39;</a></li><li><a href="#cql0036-column-delete-version-cant-be--the-table-create-version-column" class="table-of-contents__link toc-highlight">CQL0036: column delete version can&#39;t be &lt;= the table create version &#39;column&#39;</a></li><li><a href="#cql0037-column-delete-version-cant-be--the-table-delete-version" class="table-of-contents__link toc-highlight">CQL0037: column delete version can&#39;t be &gt;= the table delete version</a></li><li><a href="#cql0038-column-create-version-cant-be--the-table-create-version-column" class="table-of-contents__link toc-highlight">CQL0038: column create version can&#39;t be <code>&lt;=</code> the table create version &#39;column&#39;</a></li><li><a href="#cql0039-column-create-version-cant-be--the-table-delete-version-column" class="table-of-contents__link toc-highlight">CQL0039: column create version can&#39;t be <code>&gt;=</code> the table delete version &#39;column&#39;</a></li><li><a href="#cql0040-table-can-only-have-one-autoinc-column-column" class="table-of-contents__link toc-highlight">CQL0040: table can only have one autoinc column &#39;column&#39;</a></li><li><a href="#cql0041-tables-cannot-have-object-columns-column" class="table-of-contents__link toc-highlight">CQL0041: tables cannot have object columns &#39;column&#39;</a></li><li><a href="#cql0042-left-operand-must-be-a-string-in-likematchglob" class="table-of-contents__link toc-highlight">CQL0042: left operand must be a string in &#39;LIKE/MATCH/GLOB&#39;</a></li><li><a href="#cql0043-right-operand-must-be-a-string-in-likematchglob" class="table-of-contents__link toc-highlight">CQL0043: right operand must be a string in &#39;LIKE/MATCH/GLOB&#39;</a></li><li><a href="#cql0044-operator-may-only-appear-in-the-context-of-a-sql-statement-match" class="table-of-contents__link toc-highlight">CQL0044: operator may only appear in the context of a SQL statement &#39;MATCH&#39;</a></li><li><a href="#cql0045-blob-operand-not-allowed-in-operator" class="table-of-contents__link toc-highlight">CQL0045: blob operand not allowed in &#39;operator&#39;</a></li><li><a href="#cql0046-object-operand-not-allowed-in-operator" class="table-of-contents__link toc-highlight">CQL0046: object operand not allowed in &#39;operator&#39;</a></li><li><a href="#cql0047-string-operand-not-allowed-in-operator" class="table-of-contents__link toc-highlight">CQL0047: string operand not allowed in &#39;operator&#39;</a></li><li><a href="#cql0051-argument-can-only-be-used-in-count-" class="table-of-contents__link toc-highlight">CQL0051: argument can only be used in count(<em>) &#39;</em>&#39;</a></li><li><a href="#cql0052-select--cannot-be-used-with-no-from-clause" class="table-of-contents__link toc-highlight">CQL0052: select * cannot be used with no FROM clause</a></li><li><a href="#cql0053-select-table-cannot-be-used-with-no-from-clause" class="table-of-contents__link toc-highlight">CQL0053: select table.* cannot be used with no FROM clause</a></li><li><a href="#cql0054-table-not-found-table" class="table-of-contents__link toc-highlight">CQL0054: table not found &#39;table&#39;</a></li><li><a href="#cql0055-all-columns-in-the-select-must-have-a-name" class="table-of-contents__link toc-highlight">CQL0055: all columns in the select must have a name</a></li><li><a href="#cql0056-null-expression-has-no-type-to-imply-a-needed-type-variable" class="table-of-contents__link toc-highlight">CQL0056: NULL expression has no type to imply a needed type &#39;variable&#39;</a></li><li><a href="#cql0057-if-multiple-selects-all-must-have-the-same-column-count" class="table-of-contents__link toc-highlight">CQL0057: if multiple selects, all must have the same column count</a></li><li><a href="#cql0058-if-multiple-selects-all-column-names-must-be-identical-so-they-have-unambiguous-names-error-in-column-n-x-vs-y" class="table-of-contents__link toc-highlight">CQL0058: if multiple selects, all column names must be identical so they have unambiguous names; error in column N: &#39;X&#39; vs. &#39;Y&#39;</a></li><li><a href="#cql0059-a-variable-name-might-be-ambiguous-with-a-column-name-this-is-an-anti-pattern-name" class="table-of-contents__link toc-highlight">CQL0059: a variable name might be ambiguous with a column name, this is an anti-pattern &#39;name&#39;</a></li><li><a href="#cql0060-referenced-table-can-be-independently-recreated-so-it-cannot-be-used-in-a-foreign-key-referenced_table" class="table-of-contents__link toc-highlight">CQL0060: referenced table can be independently recreated so it cannot be used in a foreign key, &#39;referenced_table&#39;</a></li><li><a href="#cql0061-if-multiple-selects-all-columns-must-be-an-exact-type-match-expected-expected_type-found-actual_type-column" class="table-of-contents__link toc-highlight">CQL0061: if multiple selects, all columns must be an exact type match (expected expected_type; found actual_type) &#39;column&#39;</a></li><li><a href="#cql0062-if-multiple-selects-all-columns-must-be-an-exact-type-match-including-nullability-expected-expected_type-found-actual_type-column" class="table-of-contents__link toc-highlight">CQL0062: if multiple selects, all columns must be an exact type match (including nullability) (expected expected_type; found actual_type) &#39;column&#39;</a></li><li><a href="#cql0063-cant-mix-and-match-out-statement-with-selectcall-for-return-values-procedure_name" class="table-of-contents__link toc-highlight">CQL0063: can&#39;t mix and match out statement with select/call for return values &#39;procedure_name&#39;</a></li><li><a href="#cql0064-object-variables-may-not-appear-in-the-context-of-a-sql-statement" class="table-of-contents__link toc-highlight">CQL0064: object variables may not appear in the context of a SQL statement</a></li><li><a href="#cql0065-identifier-is-ambiguous-name" class="table-of-contents__link toc-highlight">CQL0065: identifier is ambiguous &#39;name&#39;</a></li><li><a href="#cql0066-if-a-table-is-marked-recreate-its-indices-must-be-in-its-schema-region-index_name" class="table-of-contents__link toc-highlight">CQL0066: if a table is marked <code>@recreate</code>, its indices must be in its schema region &#39;index_name&#39;</a></li><li><a href="#cql0067-cursor-was-not-used-with-fetch-cursor--cursor_name" class="table-of-contents__link toc-highlight">CQL0067: cursor was not used with &#39;fetch cursor&#39;  &#39;cursor_name&#39;</a></li><li><a href="#cql0068-field-not-found-in-cursor-field" class="table-of-contents__link toc-highlight">CQL0068: field not found in cursor &#39;field&#39;</a></li><li><a href="#cql0069-name-not-found-name" class="table-of-contents__link toc-highlight">CQL0069: name not found &#39;name&#39;</a></li><li><a href="#cql0070-incompatible-object-type-incompatible_type" class="table-of-contents__link toc-highlight">CQL0070: incompatible object type &#39;incompatible_type&#39;</a></li><li><a href="#cql0071-first-operand-cannot-be-a-blob-in-betweennot-between" class="table-of-contents__link toc-highlight">CQL0071: first operand cannot be a blob in &#39;BETWEEN/NOT BETWEEN&#39;</a></li><li><a href="#cql0072-first-operand-cannot-be-a-blob-in-betweennot-between" class="table-of-contents__link toc-highlight">CQL0072: first operand cannot be a blob in &#39;BETWEEN/NOT BETWEEN&#39;</a></li><li><a href="#cql0073-cast-may-only-appear-in-the-context-of-sql-statement" class="table-of-contents__link toc-highlight">CQL0073: CAST may only appear in the context of SQL statement</a></li><li><a href="#cql0074-too-few-arguments-provided-coalesce" class="table-of-contents__link toc-highlight">CQL0074: too few arguments provided &#39;coalesce&#39;</a></li><li><a href="#cql0075-incorrect-number-of-arguments-ifnull" class="table-of-contents__link toc-highlight">CQL0075: incorrect number of arguments &#39;ifnull&#39;</a></li><li><a href="#cql0076-null-literal-is-useless-in-function-ifnullcoalesce" class="table-of-contents__link toc-highlight">CQL0076: NULL literal is useless in function &#39;ifnull/coalesce&#39;</a></li><li><a href="#cql0077-encountered-arg-known-to-be-not-null-before-the-end-of-the-list-rendering-the-rest-useless-expression" class="table-of-contents__link toc-highlight">CQL0077: encountered arg known to be not null before the end of the list, rendering the rest useless &#39;expression&#39;</a></li><li><a href="#cql0078-not-in-select--is-only-allowed-inside-of-select-lists-where-on-and-having-clauses" class="table-of-contents__link toc-highlight">CQL0078: not in (select ...) is only allowed inside of select lists, where, on, and having clauses</a></li><li><a href="#cql0079-function-got-incorrect-number-of-arguments-name" class="table-of-contents__link toc-highlight">CQL0079: function got incorrect number of arguments &#39;name&#39;</a></li><li><a href="#cql0080-function-may-not-appear-in-this-context-name" class="table-of-contents__link toc-highlight">CQL0080: function may not appear in this context &#39;name&#39;</a></li><li><a href="#cql0081-aggregates-only-make-sense-if-there-is-a-from-clause-name" class="table-of-contents__link toc-highlight">CQL0081: aggregates only make sense if there is a FROM clause &#39;name&#39;</a></li><li><a href="#cql0082-argument-must-be-numeric-average" class="table-of-contents__link toc-highlight">CQL0082: argument must be numeric &#39;AVERAGE&#39;</a></li><li><a href="#cql0083-argument-must-be-numeric-sum" class="table-of-contents__link toc-highlight">CQL0083: argument must be numeric &#39;SUM&#39;</a></li><li><a href="#cql0084-second-argument-must-be-a-string-in-function-group_concat" class="table-of-contents__link toc-highlight">CQL0084: second argument must be a string in function &#39;group_concat&#39;</a></li><li><a href="#cql0085-all-arguments-must-be-strings-strftime" class="table-of-contents__link toc-highlight">CQL0085: all arguments must be strings &#39;strftime&#39;</a></li><li><a href="#cql0086-first-argument-must-be-a-string-in-function-function" class="table-of-contents__link toc-highlight">CQL0086: first argument must be a string in function &#39;function&#39;</a></li><li><a href="#cql0087-first-argument-must-be-of-type-real-function" class="table-of-contents__link toc-highlight">CQL0087: first argument must be of type real &#39;function&#39;</a></li><li><a href="#cql0088-user-function-may-not-appear-in-the-context-of-a-sql-statement-function_name" class="table-of-contents__link toc-highlight">CQL0088: user function may not appear in the context of a SQL statement &#39;function_name&#39;</a></li><li><a href="#cql0089-user-function-may-only-appear-in-the-context-of-a-sql-statement-function_name" class="table-of-contents__link toc-highlight">CQL0089: user function may only appear in the context of a SQL statement &#39;function_name&#39;</a></li><li><a href="#cql0091-stored-procs-that-deal-with-result-sets-or-cursors-cannot-be-invoked-as-functions-name" class="table-of-contents__link toc-highlight">CQL0091: stored procs that deal with result sets or cursors cannot be invoked as functions &#39;name&#39;</a></li><li><a href="#cql0092-raise-may-only-be-used-in-a-trigger-statement" class="table-of-contents__link toc-highlight">CQL0092: RAISE may only be used in a trigger statement</a></li><li><a href="#cql0093-raise-2nd-argument-must-be-a-string" class="table-of-contents__link toc-highlight">CQL0093: RAISE 2nd argument must be a string</a></li><li><a href="#cql0094-function-not-yet-implemented-function" class="table-of-contents__link toc-highlight">CQL0094: function not yet implemented &#39;function&#39;</a></li><li><a href="#cql0095-tableview-not-defined-name" class="table-of-contents__link toc-highlight">CQL0095: table/view not defined &#39;name&#39;</a></li><li><a href="#cql0096-join-using-column-not-found-on-the-left-side-of-the-join-column_name" class="table-of-contents__link toc-highlight">CQL0096: join using column not found on the left side of the join &#39;column_name&#39;</a></li><li><a href="#cql0097-join-using-column-not-found-on-the-right-side-of-the-join-column_name" class="table-of-contents__link toc-highlight">CQL0097: join using column not found on the right side of the join &#39;column_name&#39;</a></li><li><a href="#cql0098-leftright-column-types-in-join-using-do-not-match-exactly-column_name" class="table-of-contents__link toc-highlight">CQL0098: left/right column types in join USING(...) do not match exactly &#39;column_name&#39;</a></li><li><a href="#cql0099-having-clause-requires-group-by-clause" class="table-of-contents__link toc-highlight">CQL0099: HAVING clause requires GROUP BY clause</a></li><li><a href="#cql0100-duplicate-common-table-name-name" class="table-of-contents__link toc-highlight">CQL0100: duplicate common table name &#39;name&#39;</a></li><li><a href="#cql0101-too-few-column-names-specified-in-common-table-expression-name" class="table-of-contents__link toc-highlight">CQL0101: too few column names specified in common table expression &#39;name&#39;</a></li><li><a href="#cql0102-too-many-column-names-specified-in-common-table-expression-name" class="table-of-contents__link toc-highlight">CQL0102: too many column names specified in common table expression &#39;name&#39;</a></li><li><a href="#cql0103-duplicate-tableview-name-name" class="table-of-contents__link toc-highlight">CQL0103: duplicate table/view name &#39;name&#39;</a></li><li><a href="#cql0104-view-was-present-but-now-it-does-not-exist-use-delete-instead-name" class="table-of-contents__link toc-highlight">CQL0104: view was present but now it does not exist (use <code>@delete</code> instead) &#39;name&#39;</a></li><li><a href="#cql0105-object-was-a-view-but-is-now-a-table-name" class="table-of-contents__link toc-highlight">CQL0105: object was a view but is now a table &#39;name&#39;</a></li><li><a href="#cql0106-trigger-was-present-but-now-it-does-not-exist-use-delete-instead-name" class="table-of-contents__link toc-highlight">CQL0106: trigger was present but now it does not exist (use <code>@delete</code> instead) &#39;name&#39;</a></li><li><a href="#cql0107-delete-version-cant-be--create-version-name" class="table-of-contents__link toc-highlight">CQL0107: delete version can&#39;t be &lt;= create version &#39;name&#39;</a></li><li><a href="#cql0108-table-in-drop-statement-does-not-exist-table_name" class="table-of-contents__link toc-highlight">CQL0108: table in drop statement does not exist &#39;table_name&#39;</a></li><li><a href="#cql0109-cannot-drop-a-view-with-drop-table-view_name" class="table-of-contents__link toc-highlight">CQL0109: cannot drop a view with drop table &#39;view_name&#39;</a></li><li><a href="#cql0110-view-in-drop-statement-does-not-exist-view_name" class="table-of-contents__link toc-highlight">CQL0110: view in drop statement does not exist &#39;view_name&#39;</a></li><li><a href="#cql0111-cannot-drop-a-table-with-drop-view-name" class="table-of-contents__link toc-highlight">CQL0111: cannot drop a table with drop view &#39;name&#39;</a></li><li><a href="#cql0112-index-in-drop-statement-was-not-declared-index_name" class="table-of-contents__link toc-highlight">CQL0112: index in drop statement was not declared &#39;index_name&#39;</a></li><li><a href="#cql0113-trigger-in-drop-statement-was-not-declared-name" class="table-of-contents__link toc-highlight">CQL0113: trigger in drop statement was not declared &#39;name&#39;</a></li><li><a href="#cql0114-current-schema-cant-go-back-to-recreate-semantics-for-table_name" class="table-of-contents__link toc-highlight">CQL0114: current schema can&#39;t go back to recreate semantics for &#39;table_name&#39;</a></li><li><a href="#cql0115-current-create-version-not-equal-to-previous-create-version-for-table" class="table-of-contents__link toc-highlight">CQL0115: current create version not equal to previous create version for &#39;table&#39;</a></li><li><a href="#cql0116-current-delete-version-not-equal-to-previous-delete-version-for-table" class="table-of-contents__link toc-highlight">CQL0116: current delete version not equal to previous delete version for &#39;table&#39;</a></li><li><a href="#cql0117-delete-procedure-changed-in-object-table_name" class="table-of-contents__link toc-highlight">CQL0117: <code>@delete</code> procedure changed in object &#39;table_name&#39;</a></li><li><a href="#cql0118-create-procedure-changed-in-object-table_name" class="table-of-contents__link toc-highlight">CQL0118: <code>@create</code> procedure changed in object &#39;table_name&#39;</a></li><li><a href="#cql0119-column-name-is-different-between-previous-and-current-schema-name" class="table-of-contents__link toc-highlight">CQL0119: column name is different between previous and current schema &#39;name&#39;</a></li><li><a href="#cql0120-column-type-is-different-between-previous-and-current-schema-name" class="table-of-contents__link toc-highlight">CQL0120: column type is different between previous and current schema &#39;name&#39;</a></li><li><a href="#cql0121-column-current-create-version-not-equal-to-previous-create-version-name" class="table-of-contents__link toc-highlight">CQL0121: column current create version not equal to previous create version &#39;name&#39;</a></li><li><a href="#cql0122-column-current-delete-version-not-equal-to-previous-delete-version-name" class="table-of-contents__link toc-highlight">CQL0122: column current delete version not equal to previous delete version &#39;name&#39;</a></li><li><a href="#cql0123-column-delete-procedure-changed-name" class="table-of-contents__link toc-highlight">CQL0123: column <code>@delete</code> procedure changed &#39;name&#39;</a></li><li><a href="#cql0124-column-create-procedure-changed-name" class="table-of-contents__link toc-highlight">CQL0124: column <code>@create</code> procedure changed &#39;name&#39;</a></li><li><a href="#cql0125-column-current-default-value-not-equal-to-previous-default-value-column" class="table-of-contents__link toc-highlight">CQL0125: column current default value not equal to previous default value &#39;column&#39;</a></li><li><a href="#cql0126-table-was-present-but-now-it-does-not-exist-use-delete-instead-table" class="table-of-contents__link toc-highlight">CQL0126: table was present but now it does not exist (use <code>@delete</code> instead) &#39;table&#39;</a></li><li><a href="#cql0127-object-was-a-table-but-is-now-a-view-name" class="table-of-contents__link toc-highlight">CQL0127: object was a table but is now a view &#39;name&#39;</a></li><li><a href="#cql0128-table-has-a-column-that-is-different-in-the-previous-and-current-schema-column" class="table-of-contents__link toc-highlight">CQL0128: table has a column that is different in the previous and current schema &#39;column&#39;</a></li><li><a href="#cql0129-a-column-was-removed-from-the-table-rather-than-marked-with-delete-column_name" class="table-of-contents__link toc-highlight">CQL0129: a column was removed from the table rather than marked with <code>@delete</code> &#39;column_name&#39;</a></li><li><a href="#cql0130-table-has-columns-added-without-marking-them-create-column_name" class="table-of-contents__link toc-highlight">CQL0130: table has columns added without marking them <code>@create</code> &#39;column_name&#39;</a></li><li><a href="#cql0131-table-has-newly-added-columns-that-are-marked-both-create-and-delete-column_name" class="table-of-contents__link toc-highlight">CQL0131: table has newly added columns that are marked both <code>@create</code> and <code>@delete</code> &#39;column_name&#39;</a></li><li><a href="#cql0132-table-has-a-facet-that-is-different-in-the-previous-and-current-schema-table_name" class="table-of-contents__link toc-highlight">CQL0132: table has a facet that is different in the previous and current schema &#39;table_name&#39;</a></li><li><a href="#cql0133-non-column-facets-have-been-removed-from-the-table-name" class="table-of-contents__link toc-highlight">CQL0133: non-column facets have been removed from the table &#39;name&#39;</a></li><li><a href="#cql0134-table-has-a-new-non-column-facet-in-the-current-schema-table_name" class="table-of-contents__link toc-highlight">CQL0134: table has a new non-column facet in the current schema &#39;table_name&#39;</a></li><li><a href="#cql0135-table-create-statement-attributes-different-than-previous-version-table_name" class="table-of-contents__link toc-highlight">CQL0135: table create statement attributes different than previous version &#39;table_name&#39;</a></li><li><a href="#cql0136-trigger-already-exists-trigger_name" class="table-of-contents__link toc-highlight">CQL0136: trigger already exists &#39;trigger_name&#39;</a></li><li><a href="#cql0137-tableview-not-found-name" class="table-of-contents__link toc-highlight">CQL0137: table/view not found &#39;name&#39;</a></li><li><a href="#cql0138-a-trigger-on-a-view-must-be-the-instead-of-form-name" class="table-of-contents__link toc-highlight">CQL0138: a trigger on a view must be the INSTEAD OF form &#39;name&#39;</a></li><li><a href="#cql0139-temp-objects-may-not-have-versioning-annotations-object_name" class="table-of-contents__link toc-highlight">CQL0139: temp objects may not have versioning annotations &#39;object_name&#39;</a></li><li><a href="#cql0140-columns-in-a-temp-table-may-not-have-versioning-attributes-column_name" class="table-of-contents__link toc-highlight">CQL0140: columns in a temp table may not have versioning attributes &#39;column_name&#39;</a></li><li><a href="#cql0141-table-has-an-autoincrement-column-it-cannot-also-be-without-rowid-table_name" class="table-of-contents__link toc-highlight">CQL0141: table has an AUTOINCREMENT column; it cannot also be WITHOUT ROWID &#39;table_name&#39;</a></li><li><a href="#cql0142-duplicate-column-name-column_name" class="table-of-contents__link toc-highlight">CQL0142: duplicate column name &#39;column_name&#39;</a></li><li><a href="#cql0143-more-than-one-primary-key-in-table-table_name" class="table-of-contents__link toc-highlight">CQL0143: more than one primary key in table &#39;table_name&#39;</a></li><li><a href="#cql0144-cannot-alter-a-view-view_name" class="table-of-contents__link toc-highlight">CQL0144: cannot alter a view &#39;view_name&#39;</a></li><li><a href="#cql0144-table-in-alter-statement-does-not-exist-table_name" class="table-of-contents__link toc-highlight">CQL0144: table in alter statement does not exist &#39;table_name&#39;</a></li><li><a href="#cql0145-version-annotations-not-valid-in-alter-statement-column_name" class="table-of-contents__link toc-highlight">CQL0145: version annotations not valid in alter statement &#39;column_name&#39;</a></li><li><a href="#cql0146-adding-an-auto-increment-column-is-not-allowed-column_name" class="table-of-contents__link toc-highlight">CQL0146: adding an auto increment column is not allowed &#39;column_name&#39;</a></li><li><a href="#cql0147-adding-a-not-nullable-column-with-no-default-value-is-not-allowed-column_name" class="table-of-contents__link toc-highlight">CQL0147: adding a not nullable column with no default value is not allowed &#39;column_name&#39;</a></li><li><a href="#cql0148-added-column-must-already-be-reflected-in-declared-schema-with-create-exact-name-match-required-column_name" class="table-of-contents__link toc-highlight">CQL0148: added column must already be reflected in declared schema, with <code>@create</code>, exact name match required &#39;column_name&#39;</a></li><li><a href="#cql0149-added-column-must-be-an-exact-match-for-the-column-type-declared-in-the-table-column_name" class="table-of-contents__link toc-highlight">CQL0149: added column must be an exact match for the column type declared in the table &#39;column_name&#39;</a></li><li><a href="#cql0150-expected-numeric-expression-in-if-predicate" class="table-of-contents__link toc-highlight">CQL0150: expected numeric expression in IF predicate</a></li><li><a href="#cql0151-table-in-delete-statement-does-not-exist-table_name" class="table-of-contents__link toc-highlight">CQL0151: table in delete statement does not exist &#39;table_name&#39;</a></li><li><a href="#cql0152-cannot-delete-from-a-view-view_name" class="table-of-contents__link toc-highlight">CQL0152: cannot delete from a view &#39;view_name&#39;</a></li><li><a href="#cql0153-duplicate-target-column-name-in-update-statement-column_name" class="table-of-contents__link toc-highlight">CQL0153: duplicate target column name in update statement &#39;column_name&#39;</a></li><li><a href="#cql0154-table-in-update-statement-does-not-exist-table_name" class="table-of-contents__link toc-highlight">CQL0154: table in update statement does not exist &#39;table_name&#39;</a></li><li><a href="#cql0155-cannot-update-a-view-view_name" class="table-of-contents__link toc-highlight">CQL0155: cannot update a view &#39;view_name&#39;</a></li><li><a href="#cql0156-seed-expression-must-be-a-non-nullable-integer" class="table-of-contents__link toc-highlight">CQL0156: seed expression must be a non-nullable integer</a></li><li><a href="#cql0157-count-of-columns-differs-from-count-of-values" class="table-of-contents__link toc-highlight">CQL0157: count of columns differs from count of values</a></li><li><a href="#cql0158-required-column-missing-in-insert-statement-column_name" class="table-of-contents__link toc-highlight">CQL0158: required column missing in INSERT statement &#39;column_name&#39;</a></li><li><a href="#cql0159-cannot-add-an-index-to-a-virtual-table-table_name" class="table-of-contents__link toc-highlight">CQL0159: cannot add an index to a virtual table &#39;table_name&#39;</a></li><li><a href="#cql0160-table-in-insert-statement-does-not-exist-table_name" class="table-of-contents__link toc-highlight">CQL0160: table in insert statement does not exist &#39;table_name&#39;</a></li><li><a href="#cql0161-cannot-insert-into-a-view-view_name" class="table-of-contents__link toc-highlight">CQL0161: cannot insert into a view &#39;view_name&#39;</a></li><li><a href="#cql0162-cannot-add-a-trigger-to-a-virtual-table-table_name" class="table-of-contents__link toc-highlight">CQL0162: cannot add a trigger to a virtual table &#39;table_name&#39;</a></li><li><a href="#cql0163-from-arguments-construct-is-only-valid-inside-a-procedure" class="table-of-contents__link toc-highlight">CQL0163: FROM ARGUMENTS construct is only valid inside a procedure</a></li><li><a href="#cql0164-cannot-use-alter-table-on-a-virtual-table-table_name" class="table-of-contents__link toc-highlight">CQL0164: cannot use ALTER TABLE on a virtual table &#39;table_name&#39;</a></li><li><a href="#cql0165-fetch-values-is-only-for-value-cursors-not-for-sqlite-cursors-cursor_name" class="table-of-contents__link toc-highlight">CQL0165: fetch values is only for value cursors, not for sqlite cursors &#39;cursor_name&#39;</a></li><li><a href="#cql0166-count-of-columns-differs-from-count-of-values" class="table-of-contents__link toc-highlight">CQL0166: count of columns differs from count of values</a></li><li><a href="#cql0167-required-column-missing-in-fetch-statement-column_name" class="table-of-contents__link toc-highlight">CQL0167: required column missing in FETCH statement &#39;column_name&#39;</a></li><li><a href="#cql0168-cql-has-no-good-way-to-generate-dummy-blobs-not-supported-for-now" class="table-of-contents__link toc-highlight">CQL0168: CQL has no good way to generate dummy blobs; not supported for now</a></li><li><a href="#cql0169-enum-not-found-enum_name" class="table-of-contents__link toc-highlight">CQL0169: enum not found &#39;enum_name&#39;</a></li><li><a href="#cql0170-cast-is-redundant-remove-to-reduce-code-size-expression" class="table-of-contents__link toc-highlight">CQL0170: cast is redundant, remove to reduce code size &#39;expression&#39;</a></li><li><a href="#cql0171-name-not-found-name" class="table-of-contents__link toc-highlight">CQL0171: name not found &#39;name&#39;</a></li><li><a href="#cql0172-name-list-has-duplicate-name-name" class="table-of-contents__link toc-highlight">CQL0172: name list has duplicate name &#39;name&#39;</a></li><li><a href="#cql0173-variable-not-found-variable_name" class="table-of-contents__link toc-highlight">CQL0173: variable not found &#39;variable_name&#39;</a></li><li><a href="#cql0174-cannot-set-a-cursor-cursor_name" class="table-of-contents__link toc-highlight">CQL0174: cannot set a cursor &#39;cursor_name&#39;</a></li><li><a href="#cql0175-duplicate-parameter-name-parameter_name" class="table-of-contents__link toc-highlight">CQL0175: duplicate parameter name &#39;parameter_name&#39;</a></li><li><a href="#cql0176-indicated-procedure-or-group-already-has-a-recreate-action-name" class="table-of-contents__link toc-highlight">CQL0176: indicated procedure or group already has a recreate action &#39;name&#39;</a></li><li><a href="#cql0177-global-constants-must-be-either-constant-numeric-expressions-or-string-literals-constant_definition" class="table-of-contents__link toc-highlight">CQL0177: global constants must be either constant numeric expressions or string literals &#39;constant_definition&#39;</a></li><li><a href="#cql0178-proc-has-no-result-like_name" class="table-of-contents__link toc-highlight">CQL0178: proc has no result &#39;like_name&#39;</a></li><li><a href="#cql0179-shared-fragments-must-consist-of-exactly-one-top-level-statement-procedure_name" class="table-of-contents__link toc-highlight">CQL0179: shared fragments must consist of exactly one top level statement &#39;procedure_name&#39;</a></li><li><a href="#cql0180-duplicate-column-name-in-result-not-allowed-column_name" class="table-of-contents__link toc-highlight">CQL0180: duplicate column name in result not allowed &#39;column_name&#39;</a></li><li><a href="#cql0181-autodrop-temp-table-does-not-exist-name" class="table-of-contents__link toc-highlight">CQL0181: autodrop temp table does not exist &#39;name&#39;</a></li><li><a href="#cql0182-autodrop-target-is-not-a-table-name" class="table-of-contents__link toc-highlight">CQL0182: autodrop target is not a table &#39;name&#39;</a></li><li><a href="#cql0183-autodrop-target-must-be-a-temporary-table-name" class="table-of-contents__link toc-highlight">CQL0183: autodrop target must be a temporary table &#39;name&#39;</a></li><li><a href="#cql0184-stored-procedures-cannot-be-nested-name" class="table-of-contents__link toc-highlight">CQL0184: stored procedures cannot be nested &#39;name&#39;</a></li><li><a href="#cql0185-proc-name-conflicts-with-func-name-name" class="table-of-contents__link toc-highlight">CQL0185: proc name conflicts with func name &#39;name&#39;</a></li><li><a href="#cql0186-duplicate-stored-proc-name-name" class="table-of-contents__link toc-highlight">CQL0186: duplicate stored proc name &#39;name&#39;</a></li><li><a href="#cql0187-schema_upgrade_version-not-declared-or-doesnt-match-upgrade-version-n-for-proc-name" class="table-of-contents__link toc-highlight">CQL0187: @schema_upgrade_version not declared or doesn&#39;t match upgrade version <code>N</code> for proc &#39;name&#39;</a></li><li><a href="#cql0188-procedure-is-supposed-to-do-schema-migration-but-it-doesnt-have-any-dml-name" class="table-of-contents__link toc-highlight">CQL0188: procedure is supposed to do schema migration but it doesn&#39;t have any DML &#39;name&#39;</a></li><li><a href="#cql0189-procedure-declarationsdefinitions-do-not-match-name" class="table-of-contents__link toc-highlight">CQL0189: procedure declarations/definitions do not match &#39;name&#39;</a></li><li><a href="#cql0190-duplicate-column-name-name" class="table-of-contents__link toc-highlight">CQL0190: duplicate column name &#39;name&#39;</a></li><li><a href="#cql0191-declared-functions-must-be-top-level-function_name" class="table-of-contents__link toc-highlight">CQL0191: declared functions must be top level &#39;function_name&#39;</a></li><li><a href="#cql0192-func-name-conflicts-with-proc-name-name" class="table-of-contents__link toc-highlight">CQL0192: func name conflicts with proc name &#39;name&#39;</a></li><li><a href="#cql0193-duplicate-function-name-name" class="table-of-contents__link toc-highlight">CQL0193: duplicate function name &#39;name&#39;</a></li><li><a href="#cql0194-declared-procedures-must-be-top-level-name" class="table-of-contents__link toc-highlight">CQL0194: declared procedures must be top level &#39;name&#39;</a></li><li><a href="#cql0195-proc-name-conflicts-with-func-name-name" class="table-of-contents__link toc-highlight">CQL0195: proc name conflicts with func name &#39;name&#39;</a></li><li><a href="#cql0196-procedure-declarationsdefinitions-do-not-match-name" class="table-of-contents__link toc-highlight">CQL0196: procedure declarations/definitions do not match &#39;name&#39;</a></li><li><a href="#cql0197-duplicate-variable-name-in-the-same-scope-name" class="table-of-contents__link toc-highlight">CQL0197: duplicate variable name in the same scope &#39;name&#39;</a></li><li><a href="#cql0198-global-variable-hides-tableview-name-name" class="table-of-contents__link toc-highlight">CQL0198: global variable hides table/view name &#39;name&#39;</a></li><li><a href="#cql0199-cursor-requires-a-procedure-that-returns-a-result-set-via-select-procedure_name" class="table-of-contents__link toc-highlight">CQL0199: cursor requires a procedure that returns a result set via select &#39;procedure_name&#39;</a></li><li><a href="#cql0200-variable-is-not-a-cursor-another_cursor" class="table-of-contents__link toc-highlight">CQL0200: variable is not a cursor &#39;another_cursor&#39;</a></li><li><a href="#cql0201-expanding-from-arguments-there-is-no-argument-matching-required_arg" class="table-of-contents__link toc-highlight">CQL0201: expanding FROM ARGUMENTS, there is no argument matching &#39;required_arg&#39;</a></li><li><a href="#cql0202-must-be-a-cursor-proc-table-or-view-like_name" class="table-of-contents__link toc-highlight">CQL0202: must be a cursor, proc, table, or view &#39;like_name&#39;</a></li><li><a href="#cql0203-cursor-requires-a-procedure-that-returns-a-cursor-with-out-cursor_name" class="table-of-contents__link toc-highlight">CQL0203: cursor requires a procedure that returns a cursor with OUT &#39;cursor_name&#39;</a></li><li><a href="#cql0205-not-a-cursor-name" class="table-of-contents__link toc-highlight">CQL0205: not a cursor &#39;name&#39;</a></li><li><a href="#cql0206-duplicate-name-in-list-name" class="table-of-contents__link toc-highlight">CQL0206: duplicate name in list &#39;name&#39;</a></li><li><a href="#cql0207-expected-a-variable-name-for-out-or-inout-argument-param_name" class="table-of-contents__link toc-highlight">CQL0207: expected a variable name for OUT or INOUT argument &#39;param_name&#39;</a></li><li><a href="#cql0208-shared-fragments-cannot-have-any-out-or-inout-parameters-param_name" class="table-of-contents__link toc-highlight">CQL0208: shared fragments cannot have any out or in/out parameters &#39;param_name&#39;</a></li><li><a href="#cql0209-proc-out-parameter-arg-must-be-an-exact-type-match-expected-expected_type-found-actual_type-param_name" class="table-of-contents__link toc-highlight">CQL0209: proc out parameter: arg must be an exact type match (expected expected_type; found actual_type) &#39;param_name&#39;</a></li><li><a href="#cql0210-proc-out-parameter-arg-must-be-an-exact-type-match-even-nullability" class="table-of-contents__link toc-highlight">CQL0210: proc out parameter: arg must be an exact type match (even nullability)</a></li><li><a href="#cql0211-procedure-without-trailing-out-parameter-used-as-function-procedure_name" class="table-of-contents__link toc-highlight">CQL0211: procedure without trailing OUT parameter used as function &#39;procedure_name&#39;</a></li><li><a href="#cql0212-too-few-arguments-provided-to-procedure-name" class="table-of-contents__link toc-highlight">CQL0212: too few arguments provided to procedure &#39;name&#39;</a></li><li><a href="#cql0213-procedure-had-errors-cant-call-procedure_name" class="table-of-contents__link toc-highlight">CQL0213: procedure had errors, can&#39;t call. &#39;procedure_name&#39;</a></li><li><a href="#cql0214-procedures-with-results-can-only-be-called-using-a-cursor-in-global-context-name" class="table-of-contents__link toc-highlight">CQL0214: procedures with results can only be called using a cursor in global context &#39;name&#39;</a></li><li><a href="#cql0215-value-cursors-are-not-used-with-fetch-c-or-fetch-c-into-cursor_name" class="table-of-contents__link toc-highlight">CQL0215: value cursors are not used with FETCH C, or FETCH C INTO &#39;cursor_name&#39;</a></li><li><a href="#cql0216-fetch-variable-not-found-cursor_name" class="table-of-contents__link toc-highlight">CQL0216: FETCH variable not found &#39;cursor_name&#39;</a></li><li><a href="#cql0217-number-of-variables-did-not-match-count-of-columns-in-cursor-cursor_name" class="table-of-contents__link toc-highlight">CQL0217: number of variables did not match count of columns in cursor &#39;cursor_name&#39;</a></li><li><a href="#cql0218-continue-must-be-inside-of-a-loop-or-while-statement" class="table-of-contents__link toc-highlight">CQL0218: continue must be inside of a &#39;loop&#39; or &#39;while&#39; statement</a></li><li><a href="#cql0219-leave-must-be-inside-of-a-loop-while-or-switch-statement" class="table-of-contents__link toc-highlight">CQL0219: leave must be inside of a &#39;loop&#39;, &#39;while&#39;, or &#39;switch&#39; statement</a></li><li><a href="#cql0220-savepoint-has-not-been-mentioned-yet-probably-wrong-name" class="table-of-contents__link toc-highlight">CQL0220: savepoint has not been mentioned yet, probably wrong &#39;name&#39;</a></li><li><a href="#cql0221-savepoint-has-not-been-mentioned-yet-probably-wrong-name" class="table-of-contents__link toc-highlight">CQL0221: savepoint has not been mentioned yet, probably wrong &#39;name&#39;</a></li><li><a href="#cql0222-out-cursor-statement-only-makes-sense-inside-of-a-procedure" class="table-of-contents__link toc-highlight">CQL0222: out cursor statement only makes sense inside of a procedure</a></li><li><a href="#cql0223-cursor-was-not-fetched-with-the-auto-fetch-syntax-fetch-cursor-cursor_name" class="table-of-contents__link toc-highlight">CQL0223: cursor was not fetched with the auto-fetch syntax &#39;fetch cursor&#39; &#39;cursor_name&#39;</a></li><li><a href="#cql0224-a-call-statement-inside-sql-may-call-only-a-shared-fragment-ie-attributecqlshared_fragment" class="table-of-contents__link toc-highlight">CQL0224: a CALL statement inside SQL may call only a shared fragment i.e. @attribute(cql:shared_fragment)</a></li><li><a href="#cql0225-switching-to-previous-schema-validation-mode-must-be-outside-of-any-proc" class="table-of-contents__link toc-highlight">CQL0225: switching to previous schema validation mode must be outside of any proc</a></li><li><a href="#cql0226-schema-upgrade-declaration-must-be-outside-of-any-proc" class="table-of-contents__link toc-highlight">CQL0226: schema upgrade declaration must be outside of any proc</a></li><li><a href="#cql0227-schema-upgrade-declaration-must-come-before-any-tables-are-declared" class="table-of-contents__link toc-highlight">CQL0227: schema upgrade declaration must come before any tables are declared</a></li><li><a href="#cql0228-schema-upgrade-version-must-be-a-positive-integer" class="table-of-contents__link toc-highlight">CQL0228: schema upgrade version must be a positive integer</a></li><li><a href="#cql0229-schema-upgrade-version-declaration-may-only-appear-once" class="table-of-contents__link toc-highlight">CQL0229: schema upgrade version declaration may only appear once</a></li><li><a href="#cql0230-schema-upgrade-version-declaration-must-be-outside-of-any-proc" class="table-of-contents__link toc-highlight">CQL0230: schema upgrade version declaration must be outside of any proc</a></li><li><a href="#cql0231-schema-upgrade-version-declaration-must-come-before-any-tables-are-declared" class="table-of-contents__link toc-highlight">CQL0231: schema upgrade version declaration must come before any tables are declared</a></li><li><a href="#cql0232-nested-select-expression-must-return-exactly-one-column" class="table-of-contents__link toc-highlight">CQL0232: nested select expression must return exactly one column</a></li><li><a href="#cql0233-procedure-previously-declared-as-schema-upgrade-proc-it-can-have-no-args-procedure_name" class="table-of-contents__link toc-highlight">CQL0233: procedure previously declared as schema upgrade proc, it can have no args &#39;procedure_name&#39;</a></li><li><a href="#cql0234-autodrop-annotation-can-only-go-on-a-procedure-that-returns-a-result-set-procedure_name" class="table-of-contents__link toc-highlight">CQL0234: autodrop annotation can only go on a procedure that returns a result set &#39;procedure_name&#39;</a></li><li><a href="#cql0235-too-many-arguments-provided-to-procedure-procedure_name" class="table-of-contents__link toc-highlight">CQL0235: too many arguments provided to procedure &#39;procedure_name&#39;</a></li><li><a href="#cql0236-autodrop-annotation-can-only-go-on-a-procedure-that-uses-the-database-name" class="table-of-contents__link toc-highlight">CQL0236: autodrop annotation can only go on a procedure that uses the database &#39;name&#39;</a></li><li><a href="#cql0237-strict-fk-validation-requires-that-some-on-update-option-be-selected-for-every-foreign-key" class="table-of-contents__link toc-highlight">CQL0237: strict FK validation requires that some ON UPDATE option be selected for every foreign key</a></li><li><a href="#cql0238-strict-fk-validation-requires-that-some-on-delete-option-be-selected-for-every-foreign-key" class="table-of-contents__link toc-highlight">CQL0238: strict FK validation requires that some ON DELETE option be selected for every foreign key</a></li><li><a href="#cql0239-annotation-column-does-not-exist-in-result-set-column_name" class="table-of-contents__link toc-highlight">CQL0239: &#39;annotation&#39; column does not exist in result set &#39;column_name&#39;</a></li><li><a href="#cql0240-identity-annotation-can-only-go-on-a-procedure-that-returns-a-result-set-procedure_name" class="table-of-contents__link toc-highlight">CQL0240: identity annotation can only go on a procedure that returns a result set &#39;procedure_name&#39;</a></li><li><a href="#cql0241-concat-may-only-appear-in-the-context-of-sql-statement" class="table-of-contents__link toc-highlight">CQL0241: CONCAT may only appear in the context of SQL statement</a></li><li><a href="#cql0242-lossy-conversion-from-type-type" class="table-of-contents__link toc-highlight">CQL0242: lossy conversion from type &#39;type&#39;</a></li><li><a href="#cql0243-blob-operand-must-be-converted-to-string-first-in-" class="table-of-contents__link toc-highlight">CQL0243: blob operand must be converted to string first in &#39;||&#39;</a></li><li><a href="#cql0244-unknown-schema-region-region" class="table-of-contents__link toc-highlight">CQL0244: unknown schema region &#39;region&#39;</a></li><li><a href="#cql0245-schema-region-already-defined-region" class="table-of-contents__link toc-highlight">CQL0245: schema region already defined &#39;region&#39;</a></li><li><a href="#cql0246-schema-regions-do-not-nest-end-the-current-region-before-starting-a-new-one" class="table-of-contents__link toc-highlight">CQL0246: schema regions do not nest; end the current region before starting a new one</a></li><li><a href="#cql0247-you-must-begin-a-schema-region-before-you-can-end-one" class="table-of-contents__link toc-highlight">CQL0247: you must begin a schema region before you can end one</a></li><li><a href="#cql0248-schema-region-directives-may-not-appear-inside-of-a-procedure" class="table-of-contents__link toc-highlight">CQL0248: schema region directives may not appear inside of a procedure</a></li><li><a href="#cql0249-function-is-not-a-table-valued-function-function_name" class="table-of-contents__link toc-highlight">CQL0249: function is not a table-valued-function &#39;function_name&#39;</a></li><li><a href="#cql0250-table-valued-function-not-declared-function_name" class="table-of-contents__link toc-highlight">CQL0250: table-valued function not declared &#39;function_name&#39;</a></li><li><a href="#cql0251-fragment-must-end-with-exactly-select--from-cte" class="table-of-contents__link toc-highlight">CQL0251: fragment must end with exactly &#39;SELECT * FROM CTE&#39;</a></li><li><a href="#cql0252-proc-literal-can-only-appear-inside-of-procedures" class="table-of-contents__link toc-highlight">CQL0252: @PROC literal can only appear inside of procedures</a></li><li><a href="#cql0253-base-fragment-must-have-only-a-single-cte-named-the-same-as-the-fragment-name" class="table-of-contents__link toc-highlight">CQL0253: base fragment must have only a single CTE named the same as the fragment &#39;name&#39;</a></li><li><a href="#cql0254-switching-to-previous-schema-validation-mode-not-allowed-if-schema_upgrade_version-was-used" class="table-of-contents__link toc-highlight">CQL0254: switching to previous schema validation mode not allowed if <code>@schema_upgrade_version</code> was used</a></li><li><a href="#cql0255-fragment-name-is-not-a-previously-declared-base-fragment-bad_fragment_name" class="table-of-contents__link toc-highlight">CQL0255: fragment name is not a previously declared base fragment &#39;bad_fragment_name&#39;</a></li><li><a href="#cql0256-fragment-name-conflicts-with-existing-base-fragment-name" class="table-of-contents__link toc-highlight">CQL0256: fragment name conflicts with existing base fragment &#39;NAME&#39;</a></li><li><a href="#cql0257-argument-must-be-a-string-or-numeric-in-function" class="table-of-contents__link toc-highlight">CQL0257: argument must be a string or numeric in &#39;function&#39;</a></li><li><a href="#cql0258-extension-fragment-must-add-exactly-one-cte-found-extra-named-name" class="table-of-contents__link toc-highlight">CQL0258: extension fragment must add exactly one CTE; found extra named &#39;name&#39;</a></li><li><a href="#cql0259-extension-fragment-cte-must-select-t-from-base-cte" class="table-of-contents__link toc-highlight">CQL0259: extension fragment CTE must select T.* from base CTE</a></li><li><a href="#cql0260-extension-fragment-cte-must-be-a-simple-left-outer-join-from-table_name" class="table-of-contents__link toc-highlight">CQL0260: extension fragment CTE must be a simple left outer join from &#39;table_name&#39;</a></li><li><a href="#cql0261-cursor-did-not-originate-from-a-sqlite-statement-it-only-has-values-cursor_name" class="table-of-contents__link toc-highlight">CQL0261: cursor did not originate from a SQLite statement, it only has values &#39;cursor_name&#39;</a></li><li><a href="#cql0262-like--arguments-used-on-a-procedure-with-no-arguments-procedure_name" class="table-of-contents__link toc-highlight">CQL0262: LIKE ... ARGUMENTS used on a procedure with no arguments &#39;procedure_name&#39;</a></li><li><a href="#cql0263-non-ansi-joins-are-forbidden-if-strict-join-mode-is-enabled" class="table-of-contents__link toc-highlight">CQL0263: non-ANSI joins are forbidden if strict join mode is enabled.</a></li><li><a href="#cql0264-duplicate-assembly-fragments-of-base-fragment" class="table-of-contents__link toc-highlight">CQL0264: duplicate assembly fragments of base fragment</a></li><li><a href="#cql0265-assembly-fragment-can-only-have-one-cte" class="table-of-contents__link toc-highlight">CQL0265: assembly fragment can only have one CTE</a></li><li><a href="#cql0266-extension-fragment-name-conflicts-with-existing-fragment" class="table-of-contents__link toc-highlight">CQL0266: extension fragment name conflicts with existing fragment</a></li><li><a href="#cql0267-extension-fragments-of-same-base-fragment-share-the-same-cte-column" class="table-of-contents__link toc-highlight">CQL0267: extension fragments of same base fragment share the same cte column</a></li><li><a href="#cql0268-extensionassembly-fragment-must-have-the-cte-columns-same-as-the-base-fragment" class="table-of-contents__link toc-highlight">CQL0268: extension/assembly fragment must have the CTE columns same as the base fragment</a></li><li><a href="#cql0269-at-least-part-of-this-unique-key-is-redundant-with-previous-unique-keys" class="table-of-contents__link toc-highlight">CQL0269: at least part of this unique key is redundant with previous unique keys</a></li><li><a href="#cql0270-use-fetch-from-for-procedures-that-returns-a-cursor-with-out-cursor" class="table-of-contents__link toc-highlight">CQL0270: use FETCH FROM for procedures that returns a cursor with OUT &#39;cursor&#39;</a></li><li><a href="#cql0271-offset-clause-may-only-be-used-if-limit-is-also-present" class="table-of-contents__link toc-highlight">CQL0271: OFFSET clause may only be used if LIMIT is also present</a></li><li><a href="#cql0272-columns-referenced-in-the-foreign-key-statement-should-match-exactly-a-unique-key-in-parent-table" class="table-of-contents__link toc-highlight">CQL0272: columns referenced in the foreign key statement should match exactly a unique key in parent table</a></li><li><a href="#cql0273-autotest-attribute-has-incorrect-format--in-dummy_test" class="table-of-contents__link toc-highlight">CQL0273: autotest attribute has incorrect format (...) in &#39;dummy_test&#39;</a></li><li><a href="#cql0274-autotest-attribute-dummy_test-has-non-existent-table" class="table-of-contents__link toc-highlight">CQL0274: autotest attribute &#39;dummy_test&#39; has non existent table</a></li><li><a href="#cql0275-autotest-attribute-dummy_test-has-non-existent-column" class="table-of-contents__link toc-highlight">CQL0275: autotest attribute &#39;dummy_test&#39; has non existent column</a></li><li><a href="#cql0276-autotest-attribute-dummy_test-has-invalid-value-type-in" class="table-of-contents__link toc-highlight">CQL0276: autotest attribute &#39;dummy_test&#39; has invalid value type in</a></li><li><a href="#cql0277-autotest-has-incorrect-format" class="table-of-contents__link toc-highlight">CQL0277: autotest has incorrect format</a></li><li><a href="#cql0278-autotest-attribute-name-is-not-valid" class="table-of-contents__link toc-highlight">CQL0278: autotest attribute name is not valid</a></li><li><a href="#cql0279-columns-referenced-in-an-upsert-conflict-target-must-exactly-match-a-unique-key-the-target-table" class="table-of-contents__link toc-highlight">CQL0279: columns referenced in an UPSERT conflict target must exactly match a unique key the target table</a></li><li><a href="#cql0280-upsert-statement-requires-a-where-clause-if-the-insert-clause-uses-select" class="table-of-contents__link toc-highlight">CQL0280: upsert statement requires a where clause if the insert clause uses select</a></li><li><a href="#cql0281-upsert-statement-does-not-include-table-name-in-the-update-statement" class="table-of-contents__link toc-highlight">CQL0281: upsert statement does not include table name in the update statement</a></li><li><a href="#cql0282-update-statement-require-table-name" class="table-of-contents__link toc-highlight">CQL0282: update statement require table name</a></li><li><a href="#cql0283-upsert-syntax-only-support-insert-into" class="table-of-contents__link toc-highlight">CQL0283: upsert syntax only support INSERT INTO</a></li><li><a href="#cql0284-ad-hoc-schema-migration-directive-must-provide-a-procedure-to-run" class="table-of-contents__link toc-highlight">CQL0284: ad hoc schema migration directive must provide a procedure to run</a></li><li><a href="#cql0285-ad-hoc-schema-migration-directive-version-number-changed-procedure_name" class="table-of-contents__link toc-highlight">CQL0285: ad hoc schema migration directive version number changed &#39;procedure_name&#39;</a></li><li><a href="#cql0286-ad-hoc-schema-migration-directive-was-removed-this-is-not-allowed-procedure_name" class="table-of-contents__link toc-highlight">CQL0286: ad hoc schema migration directive was removed; this is not allowed &#39;procedure_name&#39;</a></li><li><a href="#cql0287-extensionassembly-fragment-must-add-stub-" class="table-of-contents__link toc-highlight">CQL0287: extension/assembly fragment must add stub &quot;</a></li><li><a href="#cql0288-extensionassembly-fragment-stub-for-base-cte-column-must-be-" class="table-of-contents__link toc-highlight">CQL0288: extension/assembly fragment stub for base CTE column must be &quot;</a></li><li><a href="#cql0289-upsert-statement-are-forbidden-if-strict-upsert-statement-mode-is-enabled" class="table-of-contents__link toc-highlight">CQL0289: upsert statement are forbidden if strict upsert statement mode is enabled</a></li><li><a href="#cql0290-fragments-can-only-have-one-statement-in-the-statement-list-and-it-must-be-a-withselect" class="table-of-contents__link toc-highlight">CQL0290: fragments can only have one statement in the statement list and it must be a WITH...SELECT</a></li><li><a href="#cql0291-region-links-into-the-middle-of-a-deployable-region-you-must-point-to-the-root-of-deployable_region-not-into-the-middle-error_region" class="table-of-contents__link toc-highlight">CQL0291: region links into the middle of a deployable region; you must point to the root of <code>&lt;deployable_region&gt;</code> not into the middle: <code>&lt;error_region&gt;</code></a></li><li><a href="#cql0292-explain-statement-is-only-available-in-dev-mode-because-its-result-set-may-vary-between-sqlite-versions" class="table-of-contents__link toc-highlight">CQL0292: explain statement is only available in dev mode because its result set may vary between sqlite versions</a></li><li><a href="#cql0293-only-explain-query-plan--statement-is-supported" class="table-of-contents__link toc-highlight">CQL0293: only EXPLAIN QUERY PLAN ... statement is supported</a></li><li><a href="#cql0294-window-function-invocations-can-only-appear-in-the-select-list-of-a-select-statement" class="table-of-contents__link toc-highlight">CQL0294: window function invocations can only appear in the select list of a select statement</a></li><li><a href="#cql0295-window-name-is-not-defined" class="table-of-contents__link toc-highlight">CQL0295: window name is not defined</a></li><li><a href="#cql0296-window-name-definition-is-not-used" class="table-of-contents__link toc-highlight">CQL0296: window name definition is not used</a></li><li><a href="#cql0297-from-shape-is-redundant-if-column-list-is-empty" class="table-of-contents__link toc-highlight">CQL0297: FROM shape is redundant if column list is empty</a></li><li><a href="#cql0298-cannot-read-from-a-cursor-without-fields-cursor_name" class="table-of-contents__link toc-highlight">CQL0298: cannot read from a cursor without fields &#39;cursor_name&#39;</a></li><li><a href="#cql0299-cursor-has-too-few-fields-shape_name" class="table-of-contents__link toc-highlight">CQL0299: cursor has too few fields, &#39;shape_name&#39;</a></li><li><a href="#cql0300-argument-must-be-an-integer-between-1-and-max-integer-in-function-function_name" class="table-of-contents__link toc-highlight">CQL0300: argument must be an integer (between 1 and max integer) in function &#39;function_name&#39;</a></li><li><a href="#cql0301-second-argument-must-be-an-integer-between-0-and-max-integer-in-function-function_name" class="table-of-contents__link toc-highlight">CQL0301: second argument must be an integer (between 0 and max integer) in function &#39;function_name&#39;</a></li><li><a href="#cql0302-first-and-third-arguments-must-be-compatible-in-function-function_name" class="table-of-contents__link toc-highlight">CQL0302: first and third arguments must be compatible in function &#39;function_name&#39;</a></li><li><a href="#cql0303-second-argument-must-be-an-integer-between-1-and-max-integer-in-function-function_name" class="table-of-contents__link toc-highlight">CQL0303: second argument must be an integer between 1 and max integer in function &#39;function_name&#39;</a></li><li><a href="#cql0304-distinct-may-only-be-used-with-one-explicit-argument-in-an-aggregate-function" class="table-of-contents__link toc-highlight">CQL0304: DISTINCT may only be used with one explicit argument in an aggregate function</a></li><li><a href="#cql0305-distinct-may-only-be-used-in-function-that-are-aggregated-or-user-defined" class="table-of-contents__link toc-highlight">CQL0305: DISTINCT may only be used in function that are aggregated or user defined</a></li><li><a href="#cql0306-filter-clause-may-only-be-used-in-function-that-are-aggregated-or-user-defined" class="table-of-contents__link toc-highlight">CQL0306: FILTER clause may only be used in function that are aggregated or user defined</a></li><li><a href="#cql0307-return-statement-should-be-in-a-procedure-and-not-at-the-top-level" class="table-of-contents__link toc-highlight">CQL0307: return statement should be in a procedure and not at the top level</a></li><li><a href="#cql0308-statement-should-be-the-last-thing-in-a-statement-list" class="table-of-contents__link toc-highlight">CQL0308: statement should be the last thing in a statement list</a></li><li><a href="#cql0309-new-table-must-be-added-with-createnumber-or-later-table_name" class="table-of-contents__link toc-highlight">CQL0309: new table must be added with @create(number) or later &#39;table_name&#39;</a></li><li><a href="#cql0310-new-column-must-be-added-with-createnumber-or-later-column_name" class="table-of-contents__link toc-highlight">CQL0310: new column must be added with @create(number) or later&quot; &#39;column_name&#39;</a></li><li><a href="#cql0311-objects-deployment-region-changed-from-previous_region-to-current_region-object_name" class="table-of-contents__link toc-highlight">CQL0311: object&#39;s deployment region changed from &#39;&lt;previous_region&gt;&#39; to &#39;&lt;current_region&gt;&#39; &#39;object_name&#39;</a></li><li><a href="#cql0312-window-function-invocation-are-forbidden-if-strict-window-function-mode-is-enabled" class="table-of-contents__link toc-highlight">CQL0312: window function invocation are forbidden if strict window function mode is enabled</a></li><li><a href="#cql0313-blob-literals-may-only-appear-in-the-context-of-a-sql-statement" class="table-of-contents__link toc-highlight">CQL0313: blob literals may only appear in the context of a SQL statement</a></li><li><a href="#cql0314-select-function-does-not-require-a-declaration-it-is-a-cql-built-in" class="table-of-contents__link toc-highlight">CQL0314: select function does not require a declaration, it is a CQL built-in</a></li><li><a href="#cql0315-mandatory-column-with-no-default-value-in-insert-into-name-default-values-statement" class="table-of-contents__link toc-highlight">CQL0315: mandatory column with no default value in INSERT INTO name DEFAULT VALUES statement.</a></li><li><a href="#cql0316-upsert-clause-is-not-compatible-with-default-values" class="table-of-contents__link toc-highlight">CQL0316: upsert-clause is not compatible with DEFAULT VALUES</a></li><li><a href="#cql0317-char-function-arguments-must-be-integer" class="table-of-contents__link toc-highlight">CQL0317: char function arguments must be integer</a></li><li><a href="#cql0318-more-than-one-fragment-annotation-on-procedure-procedure_name" class="table-of-contents__link toc-highlight">CQL0318: more than one fragment annotation on procedure &#39;procedure_name&#39;</a></li><li><a href="#cql0319-name-of-the-assembly-procedure-must-match-the-name-of-the-base-fragment-procedure_name" class="table-of-contents__link toc-highlight">CQL0319: name of the assembly procedure must match the name of the base fragment &#39;procedure_name&#39;</a></li><li><a href="#cql0320-extension-fragment-cte-must-have-a-from-clause-and-no-other-top-level-clauses-frag_name" class="table-of-contents__link toc-highlight">CQL0320: extension fragment CTE must have a FROM clause and no other top level clauses &#39;frag_name&#39;</a></li><li><a href="#cql0321-migration-proc-not-allowed-on-object-object_name" class="table-of-contents__link toc-highlight">CQL0321: migration proc not allowed on object &#39;object_name&#39;</a></li><li><a href="#cql0322-fragment-parameters-must-be-exactly-arguments-procedure_name" class="table-of-contents__link toc-highlight">CQL0322: fragment parameters must be exactly &#39;arguments&#39; &#39;procedure_name&#39;</a></li><li><a href="#cql0323-calls-to-undeclared-procedures-are-forbidden-declaration-missing-or-typo-procedure" class="table-of-contents__link toc-highlight">CQL0323: calls to undeclared procedures are forbidden; declaration missing or typo &#39;procedure&#39;</a></li><li><a href="#cql0324-referenced-table-was-created-in-a-later-version-so-it-cannot-be-used-in-a-foreign-key-referenced_table" class="table-of-contents__link toc-highlight">CQL0324: referenced table was created in a later version so it cannot be used in a foreign key &#39;referenced_table&#39;</a></li><li><a href="#cql0325-ok_table_scan-attribute-must-be-a-name" class="table-of-contents__link toc-highlight">CQL0325: ok_table_scan attribute must be a name</a></li><li><a href="#cql0326-table-name-in-ok_table_scan-does-not-exist-table_name" class="table-of-contents__link toc-highlight">CQL0326: table name in ok_table_scan does not exist &#39;table_name&#39;</a></li><li><a href="#cql0327-a-value-should-not-be-assigned-to-attribute_name-attribute" class="table-of-contents__link toc-highlight">CQL0327: a value should not be assigned to &#39;attribute_name&#39; attribute</a></li><li><a href="#cql0328-attribute_name-attribute-may-only-be-added-to-a-statement_name" class="table-of-contents__link toc-highlight">CQL0328: &#39;attribute_name&#39; attribute may only be added to a &#39;statement_name&#39;</a></li><li><a href="#cql0329-ok_table_scan-attribute-can-only-be-used-in-a-create-procedure-statement" class="table-of-contents__link toc-highlight">CQL0329: ok_table_scan attribute can only be used in a create procedure statement</a></li><li><a href="#cql0330-fragment-must-start-with-exactly-select--from-cte" class="table-of-contents__link toc-highlight">CQL0330: fragment must start with exactly &#39;SELECT * FROM CTE&#39;</a></li><li><a href="#cql0331-extension-fragment-cte-must-have-not-have-order-by-or-limit-clauses-frag_name" class="table-of-contents__link toc-highlight">CQL0331: extension fragment CTE must have not have ORDER BY or LIMIT clauses &#39;frag_name&#39;</a></li><li><a href="#cql0332-all-extension-fragments-that-use-union-all-must-come-before-those-that-use-left-outer-join-frag_name" class="table-of-contents__link toc-highlight">CQL0332: all extension fragments that use UNION ALL must come before those that use LEFT OUTER JOIN &#39;frag_name&#39;</a></li><li><a href="#cql0333-all-the-compound-operators-in-this-cte-must-be-union-all" class="table-of-contents__link toc-highlight">CQL0333: all the compound operators in this CTE must be UNION ALL</a></li><li><a href="#cql0334-dummy_seed-dummy_nullables-dummy_defaults-many-only-be-used-with-a-single-values-row" class="table-of-contents__link toc-highlight">CQL0334: @dummy_seed @dummy_nullables @dummy_defaults many only be used with a single VALUES row</a></li><li><a href="#cql0336-select-statement-with-values-clause-requires-a-non-empty-list-of-values" class="table-of-contents__link toc-highlight">CQL0336: select statement with VALUES clause requires a non empty list of values</a></li><li><a href="#cql0337-number-of-columns-values-for-each-row-should-be-identical-in-values-clause" class="table-of-contents__link toc-highlight">CQL0337: number of columns values for each row should be identical in VALUES clause</a></li><li><a href="#cql0338-name-of-a-migration-procedure-may-not-end-in-_crc-procedure_name" class="table-of-contents__link toc-highlight">CQL0338: name of a migration procedure may not end in &#39;_crc&#39; &#39;procedure_name&#39;</a></li><li><a href="#cql0339-without-rowid-tables-are-forbidden-if-strict-without-rowid-mode-is-enabled" class="table-of-contents__link toc-highlight">CQL0339: WITHOUT ROWID tables are forbidden if strict without rowid mode is enabled</a></li><li><a href="#cql0340-from-arguments-used-in-a-procedure-with-no-arguments-procedure_name" class="table-of-contents__link toc-highlight">CQL0340: FROM ARGUMENTS used in a procedure with no arguments &#39;procedure_name&#39;</a></li><li><a href="#cql0341-argument-must-be-a-variable-in-function-function_name" class="table-of-contents__link toc-highlight">CQL0341: argument must be a variable in function &#39;function_name&#39;</a></li><li><a href="#cql0342-cursor-arguments-must-have-identical-column-count-function_name" class="table-of-contents__link toc-highlight">CQL0342: cursor arguments must have identical column count &#39;function_name&#39;</a></li><li><a href="#cql0343-all-arguments-must-be-blob-cql_get_blob_size" class="table-of-contents__link toc-highlight">CQL0343: all arguments must be blob &#39;cql_get_blob_size&#39;</a></li><li><a href="#cql0344-argument-must-be-a-nullable-type-but-not-constant-null-in-function" class="table-of-contents__link toc-highlight">CQL0344: argument must be a nullable type (but not constant NULL) in &#39;function&#39;</a></li><li><a href="#cql0345-arguments-must-be-of-type-blob-function_name" class="table-of-contents__link toc-highlight">CQL0345: arguments must be of type blob &#39;function_name&#39;</a></li><li><a href="#cql0346-expression-must-be-of-type-objectt-cursor-where-t-is-a-valid-shape-name-variable" class="table-of-contents__link toc-highlight">CQL0346: expression must be of type <code>object&lt;T cursor&gt;</code> where T is a valid shape name &#39;variable&#39;</a></li><li><a href="#cql0347-select-function-may-not-return-type-object-function_name" class="table-of-contents__link toc-highlight">CQL0347: select function may not return type OBJECT &#39;function_name&#39;</a></li><li><a href="#cql0348-collate-applied-to-a-non-text-column-column_name" class="table-of-contents__link toc-highlight">CQL0348: collate applied to a non-text column &#39;column_name&#39;</a></li><li><a href="#cql0349-column-definitions-may-not-come-after-constraints-column_name" class="table-of-contents__link toc-highlight">CQL0349: column definitions may not come after constraints &#39;column_name&#39;</a></li><li><a href="#cql0350-statement-must-appear-inside-of-a-proc-savepoint-block" class="table-of-contents__link toc-highlight">CQL0350: statement must appear inside of a PROC SAVEPOINT block</a></li><li><a href="#cql0351-statement-should-be-in-a-procedure-and-at-the-top-level" class="table-of-contents__link toc-highlight">CQL0351: statement should be in a procedure and at the top level</a></li><li><a href="#cql0352-use-commit-return-or-rollback-return-in-within-a-proc-savepoint-block" class="table-of-contents__link toc-highlight">CQL0352: use COMMIT RETURN or ROLLBACK RETURN in within a proc savepoint block</a></li><li><a href="#cql0353-evaluation-of-constant-failed" class="table-of-contents__link toc-highlight">CQL0353: evaluation of constant failed</a></li><li><a href="#cql0354-duplicate-enum-member-enum_name" class="table-of-contents__link toc-highlight">CQL0354: duplicate enum member &#39;enum_name&#39;</a></li><li><a href="#cql0355-evaluation-failed-enum_name" class="table-of-contents__link toc-highlight">CQL0355: evaluation failed &#39;enum_name&#39;</a></li><li><a href="#cql0356-enum-definitions-do-not-match-name" class="table-of-contents__link toc-highlight">CQL0356: enum definitions do not match &#39;name&#39;</a></li><li><a href="#cql0357-enum-does-not-contain-enum_name" class="table-of-contents__link toc-highlight">CQL0357: enum does not contain &#39;enum_name&#39;</a></li><li><a href="#cql0358-declared-enums-must-be-top-level-enum" class="table-of-contents__link toc-highlight">CQL0358: declared enums must be top level &#39;enum&#39;</a></li><li><a href="#cql0359-duplicate-type-declaration-type_name" class="table-of-contents__link toc-highlight">CQL0359: duplicate type declaration &#39;type_name&#39;</a></li><li><a href="#cql0360-unknown-type-type_name" class="table-of-contents__link toc-highlight">CQL0360: unknown type &#39;type_name&#39;</a></li><li><a href="#cql0361-return-data-type-in-a-create-function-declaration-can-only-be-text-blob-or-object" class="table-of-contents__link toc-highlight">CQL0361: return data type in a create function declaration can only be Text, Blob or Object</a></li><li><a href="#cql0362-hidden-column-attribute-must-be-the-first-attribute-if-present" class="table-of-contents__link toc-highlight">CQL0362: HIDDEN column attribute must be the first attribute if present</a></li><li><a href="#cql0363-all-arguments-must-be-names-vault_sensitive" class="table-of-contents__link toc-highlight">CQL0363: all arguments must be names &#39;vault_sensitive&#39;</a></li><li><a href="#cql0364-vault_sensitive-annotation-can-only-go-on-a-procedure-that-uses-the-database" class="table-of-contents__link toc-highlight">CQL0364: vault_sensitive annotation can only go on a procedure that uses the database</a></li><li><a href="#cql0365-enforce_pop-used-but-there-is-nothing-to-pop" class="table-of-contents__link toc-highlight">CQL0365: @enforce_pop used but there is nothing to pop</a></li><li><a href="#cql0366-transaction-operations-disallowed-while-strict-transaction-enforcement-is-on" class="table-of-contents__link toc-highlight">CQL0366: transaction operations disallowed while STRICT TRANSACTION enforcement is on</a></li><li><a href="#cql0367-an-attribute-was-specified-twice-attribute_name" class="table-of-contents__link toc-highlight">CQL0367: an attribute was specified twice &#39;attribute_name&#39;</a></li><li><a href="#cql0368-strict-select-if-nothing-requires-that-all-select--expressions-include-if-nothing" class="table-of-contents__link toc-highlight">CQL0368: strict select if nothing requires that all (select ...) expressions include &#39;if nothing&#39;</a></li><li><a href="#cql0369-select--if-nothing-construct-is-for-use-in-top-level-expressions-not-inside-of-other-dml" class="table-of-contents__link toc-highlight">CQL0369: (SELECT ... IF NOTHING) construct is for use in top level expressions, not inside of other DML</a></li><li><a href="#cql0370-due-to-a-memory-leak-bug-in-old-sqlite-versions-the-select-part-of-an-insert-must-not-have-a-top-level-join-or-compound-operator-use-with-and-a-cte-or-a-nested-select-to-work-around-this" class="table-of-contents__link toc-highlight">CQL0370: due to a memory leak bug in old SQLite versions, the select part of an insert must not have a top level join or compound operator. Use WITH and a CTE, or a nested select to work around this.</a></li><li><a href="#cql0371-table-valued-function-used-in-a-leftrightcross-context-this-would-hit-a-sqlite-bug--wrap-it-in-a-cte-instead" class="table-of-contents__link toc-highlight">CQL0371: table valued function used in a left/right/cross context; this would hit a SQLite bug.  Wrap it in a CTE instead.</a></li><li><a href="#cql0372-select--if-nothing-or-null-null-is-redundant-use-select--if-nothing-null-instead" class="table-of-contents__link toc-highlight">CQL0372: SELECT ... IF NOTHING OR NULL NULL is redundant; use SELECT ... IF NOTHING NULL instead.</a></li><li><a href="#cql0373-comparing-against-null-always-yields-null-use-is-and-is-not-instead" class="table-of-contents__link toc-highlight">CQL0373: comparing against NULL always yields NULL; use IS and IS NOT instead.</a></li><li><a href="#cql0374-select-expression-is-equivalent-to-null" class="table-of-contents__link toc-highlight">CQL0374: SELECT expression is equivalent to NULL.</a></li><li><a href="#cql0377-table-transitioning-from-recreate-to-create-must-use-createnncqlfrom_recreate-table-name" class="table-of-contents__link toc-highlight">CQL0377: table transitioning from <code>@recreate</code> to <code>@create</code> must use <code>@create(nn,cql:from_recreate)</code> &#39;table name&#39;</a></li><li><a href="#cql0378-built-in-migration-procedure-not-valid-in-this-context-name" class="table-of-contents__link toc-highlight">CQL0378: built-in migration procedure not valid in this context &#39;name&#39;</a></li><li><a href="#cql0379-unknown-built-in-migration-procedure-name" class="table-of-contents__link toc-highlight">CQL0379: unknown built-in migration procedure &#39;name&#39;</a></li><li><a href="#cql0380-when-expression-cannot-be-evaluated-to-a-constant" class="table-of-contents__link toc-highlight">CQL0380: WHEN expression cannot be evaluated to a constant</a></li><li><a href="#cql0381-case-expression-must-be-a-not-null-integral-type" class="table-of-contents__link toc-highlight">CQL0381: case expression must be a not-null integral type</a></li><li><a href="#cql0382-type-of-a-when-expression-is-bigger-than-the-type-of-the-switch-expression" class="table-of-contents__link toc-highlight">CQL0382: type of a WHEN expression is bigger than the type of the SWITCH expression</a></li><li><a href="#cql0383-switch--all-values-is-useless-with-an-else-clause" class="table-of-contents__link toc-highlight">CQL0383: switch ... ALL VALUES is useless with an ELSE clause</a></li><li><a href="#cql0384-switch-statement-did-not-have-any-actual-statements-in-it" class="table-of-contents__link toc-highlight">CQL0384: switch statement did not have any actual statements in it</a></li><li><a href="#cql0385-when-clauses-contain-duplicate-values-value" class="table-of-contents__link toc-highlight">CQL0385: WHEN clauses contain duplicate values &#39;value&#39;</a></li><li><a href="#cql0386-switch--all-values-is-used-but-the-switch-expression-is-not-an-enum-type" class="table-of-contents__link toc-highlight">CQL0386: SWITCH ... ALL VALUES is used but the switch expression is not an enum type</a></li><li><a href="#cql0387-a-value-exists-in-the-enum-that-is-not-present-in-the-switch-enum_member" class="table-of-contents__link toc-highlight">CQL0387: a value exists in the enum that is not present in the switch &#39;enum_member&#39;</a></li><li><a href="#cql0388-a-value-exists-in-the-switch-that-is-not-present-in-the-enum-numeric_value" class="table-of-contents__link toc-highlight">CQL0388: a value exists in the switch that is not present in the enum &#39;numeric_value&#39;</a></li><li><a href="#cql0389-declare-out-requires-that-the-procedure-be-already-declared" class="table-of-contents__link toc-highlight">CQL0389: DECLARE OUT requires that the procedure be already declared</a></li><li><a href="#cql0390-declare-out-call-used-on-a-procedure-with-no-missing-out-arguments" class="table-of-contents__link toc-highlight">CQL0390: DECLARE OUT CALL used on a procedure with no missing OUT arguments</a></li><li><a href="#cql0391-close-cannot-be-used-on-a-boxed-cursor" class="table-of-contents__link toc-highlight">CQL0391: CLOSE cannot be used on a boxed cursor</a></li><li><a href="#cql0392-when-deleting-a-virtual-table-you-must-specify-deletenn-cqlmodule_must_not_be_deleted_see_docs_for_cql0392-as-a-reminder-not-to-delete-the-module-for-this-virtual-table" class="table-of-contents__link toc-highlight">CQL0392: when deleting a virtual table you must specify @delete(nn, cql:module_must_not_be_deleted_see_docs_for_CQL0392) as a reminder not to delete the module for this virtual table</a></li><li><a href="#cql0393-user-function-cannot-appear-in-a-constraint-expression-function_name" class="table-of-contents__link toc-highlight">CQL0393: user function cannot appear in a constraint expression &#39;function_name&#39;</a></li><li><a href="#cql0394-nested-select-expressions-may-not-appear-inside-of-a-constraint-expression" class="table-of-contents__link toc-highlight">CQL0394: nested select expressions may not appear inside of a constraint expression</a></li><li><a href="#cql0395-table-valued-functions-may-not-be-used-in-an-expression-context-function_name" class="table-of-contents__link toc-highlight">CQL0395: table valued functions may not be used in an expression context &#39;function_name&#39;</a></li><li><a href="#cql0396-versioning-attributes-may-not-be-used-on-ddl-inside-a-procedure" class="table-of-contents__link toc-highlight">CQL0396: versioning attributes may not be used on DDL inside a procedure</a></li><li><a href="#cql0397-object-is-an-orphan-because-its-table-is-deleted-remove-rather-than-delete-object_name" class="table-of-contents__link toc-highlight">CQL0397: object is an orphan because its table is deleted. Remove rather than @delete &#39;object_name&#39;</a></li><li><a href="#cql0398-a-compound-select-cannot-be-ordered-by-the-result-of-an-expression" class="table-of-contents__link toc-highlight">CQL0398: a compound select cannot be ordered by the result of an expression</a></li><li><a href="#cql0399-table-must-leave-recreate-management-with-createnn-or-later-table_name" class="table-of-contents__link toc-highlight">CQL0399: table must leave @recreate management with @create(nn) or later &#39;table_name&#39;</a></li><li><a href="#cql0400-encode-context-column-cant-be-sensitive" class="table-of-contents__link toc-highlight">CQL0400: encode context column can&#39;t be sensitive</a></li><li><a href="#cql0401-encode-context-column-must-be-specified-if-strict-encode-context-column-mode-is-enabled" class="table-of-contents__link toc-highlight">CQL0401: encode context column must be specified if strict encode context column mode is enabled</a></li><li><a href="#cql0402-encode-context-column-in-vault_sensitive-attribute-must-match-the-specified-type-in-strict-mode" class="table-of-contents__link toc-highlight">CQL0402: encode context column in vault_sensitive attribute must match the specified type in strict mode</a></li><li><a href="#cql0403-operator-may-not-be-used-because-it-is-not-supported-on-old-versions-of-sqlite-operator" class="table-of-contents__link toc-highlight">CQL0403: operator may not be used because it is not supported on old versions of SQLite, &#39;operator&#39;</a></li><li><a href="#cql0404-procedure-cannot-be-both-a-normal-procedure-and-an-unchecked-procedure-procedure_name" class="table-of-contents__link toc-highlight">CQL0404: procedure cannot be both a normal procedure and an unchecked procedure, &#39;procedure_name&#39;</a></li><li><a href="#cql0405-procedure-of-an-unknown-type-used-in-an-expression-procedure_name" class="table-of-contents__link toc-highlight">CQL0405: procedure of an unknown type used in an expression &#39;procedure_name&#39;</a></li><li><a href="#cql0406-substr-uses-1-based-indices-the-2nd-argument-of-substr-may-not-be-zero" class="table-of-contents__link toc-highlight">CQL0406: substr uses 1 based indices, the 2nd argument of substr may not be zero&quot;</a></li><li><a href="#cql0408-encode-context-column-can-be-only-specified-once" class="table-of-contents__link toc-highlight">CQL0408: encode context column can be only specified once</a></li><li><a href="#cql0409-cannot-use-is-null-or-is-not-null-on-a-value-of-a-not-null-type-nonnull_expr" class="table-of-contents__link toc-highlight">CQL0409: cannot use IS NULL or IS NOT NULL on a value of a NOT NULL type &#39;nonnull_expr&#39;</a></li><li><a href="#cql0411-duplicate-flag-in-substitution-flag" class="table-of-contents__link toc-highlight">CQL0411: duplicate flag in substitution &#39;flag&#39;</a></li><li><a href="#cql0412-cannot-combine--flag-with-space-flag" class="table-of-contents__link toc-highlight">CQL0412: cannot combine &#39;+&#39; flag with space flag</a></li><li><a href="#cql0413-width-required-when-using-flag-in-substitution-flag" class="table-of-contents__link toc-highlight">CQL0413: width required when using flag in substitution &#39;flag&#39;</a></li><li><a href="#cql0414-l-length-specifier-has-no-effect-consider-ll-instead" class="table-of-contents__link toc-highlight">CQL0414: &#39;l&#39; length specifier has no effect; consider &#39;ll&#39; instead</a></li><li><a href="#cql0415-length-specifier-cannot-be-combined-with--flag" class="table-of-contents__link toc-highlight">CQL0415: length specifier cannot be combined with &#39;!&#39; flag</a></li><li><a href="#cql0416-type-specifier-not-allowed-in-cql-type_specifier" class="table-of-contents__link toc-highlight">CQL0416: type specifier not allowed in CQL &#39;type_specifier&#39;</a></li><li><a href="#cql0417-unrecognized-type-specifier-type_specifier" class="table-of-contents__link toc-highlight">CQL0417: unrecognized type specifier &#39;type_specifier&#39;</a></li><li><a href="#cql0418-type-specifier-combined-with-inappropriate-flags-type_specifier" class="table-of-contents__link toc-highlight">CQL0418: type specifier combined with inappropriate flags &#39;type_specifier&#39;</a></li><li><a href="#cql0419-type-specifier-cannot-be-combined-with-length-specifier-type_specifier" class="table-of-contents__link toc-highlight">CQL0419: type specifier cannot be combined with length specifier &#39;type_specifier&#39;</a></li><li><a href="#cql0420-incomplete-substitution-in-format-string" class="table-of-contents__link toc-highlight">CQL0420: incomplete substitution in format string</a></li><li><a href="#cql0421-first-argument-must-be-a-string-literal-function" class="table-of-contents__link toc-highlight">CQL0421: first argument must be a string literal &#39;function&#39;</a></li><li><a href="#cql0422-more-arguments-provided-than-expected-by-format-string-function" class="table-of-contents__link toc-highlight">CQL0422: more arguments provided than expected by format string &#39;function&#39;</a></li><li><a href="#cql0423-fewer-arguments-provided-than-expected-by-format-string-function" class="table-of-contents__link toc-highlight">CQL0423: fewer arguments provided than expected by format string &#39;function&#39;</a></li><li><a href="#cql0424-procedure-with-inout-parameter-used-as-function-procedure_name" class="table-of-contents__link toc-highlight">CQL0424: procedure with INOUT parameter used as function &#39;procedure_name&#39;</a></li><li><a href="#cql0425-procedure-with-non-trailing-out-parameter-used-as-function-procedure_name" class="table-of-contents__link toc-highlight">CQL0425: procedure with non-trailing OUT parameter used as function &#39;procedure_name&#39;</a></li><li><a href="#cql0426-out-or-inout-argument-cannot-be-used-again-in-same-call-variable" class="table-of-contents__link toc-highlight">CQL0426: OUT or INOUT argument cannot be used again in same call &#39;variable&#39;</a></li><li><a href="#cql0427-like-cte-form-may-only-be-used-inside-a-shared-fragment-at-the-top-level-ie-attributecqlshared_fragment-procedure_name" class="table-of-contents__link toc-highlight">CQL0427: LIKE CTE form may only be used inside a shared fragment at the top level i.e. @attribute(cql:shared_fragment) &#39;procedure_name&#39;</a></li><li><a href="#cql0428-duplicate-binding-of-table-in-callusing-clause-table_name" class="table-of-contents__link toc-highlight">CQL0428: duplicate binding of table in CALL/USING clause &#39;table_name&#39;</a></li><li><a href="#cql0429-called-procedure-has-no-table-arguments-but-a-using-clause-is-present-procedure_name" class="table-of-contents__link toc-highlight">CQL0429: called procedure has no table arguments but a USING clause is present &#39;procedure_name&#39;</a></li><li><a href="#cql0430-no-actual-table-was-provided-for-the-table-parameter-table_name" class="table-of-contents__link toc-highlight">CQL0430: no actual table was provided for the table parameter &#39;table_name&#39;</a></li><li><a href="#cql0431-an-actual-table-was-provided-for-a-table-parameter-that-does-not-exist-table_name" class="table-of-contents__link toc-highlight">CQL0431: an actual table was provided for a table parameter that does not exist &#39;table_name&#39;</a></li><li><a href="#cql0432-table-provided-must-have-the-same-number-of-columns-as-the-table-parameter-table_name" class="table-of-contents__link toc-highlight">CQL0432: table provided must have the same number of columns as the table parameter &#39;table_name&#39;</a></li><li><a href="#cql0433-table-argument-formal_name-requires-column-column_name-but-it-is-missing-in-provided-table-actual_name" class="table-of-contents__link toc-highlight">CQL0433: table argument &#39;formal_name&#39; requires column &#39;column_name&#39; but it is missing in provided table &#39;actual_name&#39;</a></li><li><a href="#cql0434-shared-fragments-may-not-be-called-outside-of-a-sql-statement-procedure_name" class="table-of-contents__link toc-highlight">CQL0434: shared fragments may not be called outside of a SQL statement &#39;procedure_name&#39;</a></li><li><a href="#cql0435-must-use-qualified-form-to-avoid-ambiguity-with-alias-column" class="table-of-contents__link toc-highlight">CQL0435: must use qualified form to avoid ambiguity with alias &#39;column&#39;</a></li><li><a href="#cql0436-alias-referenced-from-where-group-by-having-or-window-clause" class="table-of-contents__link toc-highlight">CQL0436: alias referenced from WHERE, GROUP BY, HAVING, or WINDOW clause</a></li><li><a href="#cql0437-common-table-name-shadows-previously-declared-table-or-view-name" class="table-of-contents__link toc-highlight">CQL0437: common table name shadows previously declared table or view &#39;name&#39;</a></li><li><a href="#cql0438-variable-possibly-used-before-initialization-name" class="table-of-contents__link toc-highlight">CQL0438: variable possibly used before initialization &#39;name&#39;</a></li><li><a href="#cql0439-nonnull-reference-out-parameter-possibly-not-always-initialized-name" class="table-of-contents__link toc-highlight">CQL0439: nonnull reference OUT parameter possibly not always initialized &#39;name&#39;</a></li><li><a href="#cql0440-fragments-may-not-have-an-empty-body-procedure_name" class="table-of-contents__link toc-highlight">CQL0440: fragments may not have an empty body &#39;procedure_name&#39;</a></li><li><a href="#cql0441-shared-fragments-may-only-have-if-select-or--withselect-at-the-top-level-procedure_name" class="table-of-contents__link toc-highlight">CQL0441: shared fragments may only have IF, SELECT, or  WITH...SELECT at the top level &#39;procedure_name&#39;</a></li><li><a href="#cql0442-shared-fragments-with-conditionals-must-include-an-else-clause-procedure_name" class="table-of-contents__link toc-highlight">CQL0442: shared fragments with conditionals must include an else clause &#39;procedure_name&#39;</a></li><li><a href="#cql0443-shared-fragments-with-conditionals-must-have-exactly-one-select-or-withselect-in-each-statement-list-procedure_name" class="table-of-contents__link toc-highlight">CQL0443: shared fragments with conditionals must have exactly one SELECT or WITH...SELECT in each statement list &#39;procedure_name&#39;</a></li><li><a href="#cql0444-this-use-of-the-named-shared-fragment-is-not-legal-because-of-name-conflict-procedure_name" class="table-of-contents__link toc-highlight">CQL0444: this use of the named shared fragment is not legal because of name conflict &#39;procedure_name&#39;</a></li><li><a href="#cql0445-attributecqltry_is_proc_body-accepts-no-values" class="table-of-contents__link toc-highlight">CQL0445: @attribute(cql:try_is_proc_body) accepts no values</a></li><li><a href="#cql0446-attributecqltry_is_proc_body-cannot-be-used-more-than-once-per-procedure" class="table-of-contents__link toc-highlight">CQL0446: @attribute(cql:try_is_proc_body) cannot be used more than once per procedure</a></li><li><a href="#cql0447-virtual-table-table-claims-to-be-eponymous-but-its-module-name-module-differs-from-its-table-name" class="table-of-contents__link toc-highlight">CQL0447: virtual table &#39;table&#39; claims to be eponymous but its module name &#39;module&#39; differs from its table name</a></li><li><a href="#cql0448-table-was-marked-delete-but-it-needs-to-be-marked-recreate-delete-table" class="table-of-contents__link toc-highlight">CQL0448: table was marked @delete but it needs to be marked @recreate @delete &#39;table&#39;</a></li><li><a href="#cql0449-recreate-group-annotation-changed-in-table-table_name" class="table-of-contents__link toc-highlight">CQL0449: recreate group annotation changed in table &#39;table_name&#39;</a></li><li><a href="#cql0450-a-shared-fragment-used-like-a-function-must-be-a-simple-select-with-no-from-clause" class="table-of-contents__link toc-highlight">CQL0450: a shared fragment used like a function must be a simple SELECT with no FROM clause</a></li><li><a href="#cql0451-procedure-as-function-call-is-not-compatible-with-distinct-or-filter-clauses" class="table-of-contents__link toc-highlight">CQL0451: procedure as function call is not compatible with DISTINCT or filter clauses</a></li><li><a href="#cql0452-function-may-not-be-used-in-sql-because-it-is-not-supported-on-old-versions-of-sqlite-function" class="table-of-contents__link toc-highlight">CQL0452: function may not be used in SQL because it is not supported on old versions of SQLite &#39;function&#39;</a></li><li><a href="#cql0453-blob-type-is-not-a-valid-table-table_name" class="table-of-contents__link toc-highlight">CQL0453: blob type is not a valid table &#39;table_name&#39;</a></li><li><a href="#cql0454-cursor-was-not-declared-for-storage-cursor_name" class="table-of-contents__link toc-highlight">CQL0454: cursor was not declared for storage &#39;cursor_name&#39;</a></li><li><a href="#cql0455-blob-variable-must-have-a-type-kind-for-type-safety-blob_name" class="table-of-contents__link toc-highlight">CQL0455: blob variable must have a type kind for type safety, &#39;blob_name&#39;</a></li><li><a href="#cql0456-blob-type-is-a-view-not-a-table-view_name" class="table-of-contents__link toc-highlight">CQL0456: blob type is a view, not a table &#39;view_name&#39;</a></li><li><a href="#cql0457-the-indicated-table-is-not-marked-with-attributecqlblob_storage-table_name" class="table-of-contents__link toc-highlight">CQL0457: the indicated table is not marked with @attribute(cql:blob_storage) &#39;table_name&#39;</a></li><li><a href="#cql0458-the-indicated-table-may-only-be-used-for-blob-storage-table_name" class="table-of-contents__link toc-highlight">CQL0458: the indicated table may only be used for blob storage &#39;table_name&#39;</a></li><li><a href="#cql0459-table-is-not-suitable-for-use-as-blob-storage-reason-table_name" class="table-of-contents__link toc-highlight">CQL0459: table is not suitable for use as blob storage: reason &#39;table_name&#39;</a></li><li><a href="#cql0460-field-of-a-nonnull-reference-type-accessed-before-verifying-that-the-cursor-has-a-row-cursorfield" class="table-of-contents__link toc-highlight">CQL0460: field of a nonnull reference type accessed before verifying that the cursor has a row &#39;cursor.field&#39;</a></li><li><a href="#cql0461-fetch-from-blob-operand-is-not-a-blob" class="table-of-contents__link toc-highlight">CQL0461: fetch from blob operand is not a blob</a></li><li><a href="#cql0462-group-declared-variables-must-be-top-level-name" class="table-of-contents__link toc-highlight">CQL0462: group declared variables must be top level &#39;name&#39;</a></li><li><a href="#cql0464-group-not-found-group_name" class="table-of-contents__link toc-highlight">CQL0464: group not found &#39;group_name&#39;</a></li><li><a href="#cql0465-unsubresub-directive-must-provide-a-table-or-view-name" class="table-of-contents__link toc-highlight">CQL0465: @unsub/@resub directive must provide a table or view name</a></li><li><a href="#cql0466-the-tableview-named-in-an-unsubresub-directive-does-not-exist-name" class="table-of-contents__link toc-highlight">CQL0466: the table/view named in an @unsub/@resub directive does not exist &#39;name&#39;</a></li><li><a href="#cql0467-unsubresub-versions-must-be-in-non-decreasing-order" class="table-of-contents__link toc-highlight">CQL0467: @unsub/@resub versions must be in non-decreasing order</a></li><li><a href="#cql0468-attributecqlshared_fragment-may-only-be-placed-on-a-create-proc-statement-proc_name" class="table-of-contents__link toc-highlight">CQL0468: @attribute(cql:shared_fragment) may only be placed on a CREATE PROC statement &#39;proc_name&#39;</a></li><li><a href="#cql0469-tableview-is-already-deleted-name" class="table-of-contents__link toc-highlight">CQL0469: table/view is already deleted &#39;name&#39;</a></li><li><a href="#cql0470-tableview-not-yet-created-at-indicated-version-name" class="table-of-contents__link toc-highlight">CQL0470: table/view not yet created at indicated version &#39;name&#39;</a></li><li><a href="#cql0471-tableview-has-another-unsubresub-at-this-version-number-name" class="table-of-contents__link toc-highlight">CQL0471: table/view has another @unsub/@resub at this version number &#39;name&#39;</a></li><li><a href="#cql0472-tableview-is-already-unsubscribed-name" class="table-of-contents__link toc-highlight">CQL0472: table/view is already unsubscribed &#39;name&#39;</a></li><li><a href="#cql0473-unsub-is-invalid-because-the-tableview-is-still-used-by-name" class="table-of-contents__link toc-highlight">CQL0473: @unsub is invalid because the table/view is still used by &#39;name&#39;</a></li><li><a href="#cql0474-resub-is-invalid-because-the-tableview-references-name" class="table-of-contents__link toc-highlight">CQL0474: @resub is invalid because the table/view references &#39;name&#39;</a></li><li><a href="#cql0475-unsubresub-directives-did-not-match-between-current-and-previous-schema" class="table-of-contents__link toc-highlight">CQL0475: @unsub/@resub directives did not match between current and previous schema</a></li><li><a href="#cql0476-previous-schema-had-more-unsubresub-directives-than-the-current-schema" class="table-of-contents__link toc-highlight">CQL0476: previous schema had more unsub/resub directives than the current schema</a></li><li><a href="#cql0477-interface-name-conflicts-with-func-name-name" class="table-of-contents__link toc-highlight">CQL0477: interface name conflicts with func name &#39;name&#39;</a></li><li><a href="#cql0478-interface-name-conflicts-with-procedure-name-name" class="table-of-contents__link toc-highlight">CQL0478: interface name conflicts with procedure name &#39;name&#39;</a></li><li><a href="#cql0479-interface-declarations-do-not-match-name" class="table-of-contents__link toc-highlight">CQL0479: interface declarations do not match &#39;name&#39;</a></li><li><a href="#cql0480-declared-interface-must-be-top-level-name" class="table-of-contents__link toc-highlight">CQL0480: declared interface must be top level &#39;name&#39;</a></li><li><a href="#cql0481-proc-name-conflicts-with-interface-name-name" class="table-of-contents__link toc-highlight">CQL0481: proc name conflicts with interface name &#39;name&#39;</a></li><li><a href="#cql0482-interface-not-found-name" class="table-of-contents__link toc-highlight">CQL0482: interface not found &#39;name&#39;</a></li><li><a href="#cql0483-procedure-results-should-include-all-columns-defined-by-the-interface-name" class="table-of-contents__link toc-highlight">CQL0483: procedure results should include all columns defined by the interface &#39;name&#39;</a></li><li><a href="#cql0484-name-of-the-column-must-match-the-name-of-the-column-defined-by-interface" class="table-of-contents__link toc-highlight">CQL0484: name of the column must match the name of the column defined by interface</a></li><li><a href="#cql0485-column-types-returned-by-proc-need-to-be-the-same-as-defined-on-the-interface" class="table-of-contents__link toc-highlight">CQL0485: column types returned by proc need to be the same as defined on the interface</a></li><li><a href="#cql0486-function-cannot-be-both-a-normal-function-and-an-unchecked-function-function_name" class="table-of-contents__link toc-highlight">CQL0486: function cannot be both a normal function and an unchecked function, &#39;function_name&#39;</a></li></ul></li><li><a href="#appendix-5-json-schema-grammar" class="table-of-contents__link toc-highlight">Appendix 5: JSON Schema Grammar</a><ul><li><a href="#rules-1" class="table-of-contents__link toc-highlight">Rules</a></li></ul></li><li><a href="#appendix-6-cql-in-20-minutes" class="table-of-contents__link toc-highlight">Appendix 6: CQL In 20 Minutes</a></li><li><a href="#appendix-7-cql-anti-patterns" class="table-of-contents__link toc-highlight">Appendix 7: CQL Anti-patterns</a><ul><li><a href="#common-schema" class="table-of-contents__link toc-highlight">Common Schema</a></li><li><a href="#declarations" class="table-of-contents__link toc-highlight">Declarations</a></li><li><a href="#casts" class="table-of-contents__link toc-highlight">Casts</a></li><li><a href="#boolean-expressions-and-casewhen" class="table-of-contents__link toc-highlight">Boolean expressions and CASE/WHEN</a></li><li><a href="#case-and-cast-and-null" class="table-of-contents__link toc-highlight">CASE and CAST and NULL</a></li><li><a href="#filtering-out-nulls" class="table-of-contents__link toc-highlight">Filtering out NULLs</a></li><li><a href="#not-null-boolean-expressions" class="table-of-contents__link toc-highlight">Not null boolean expressions</a></li><li><a href="#using-is-when-it-makes-sense-to-do-so" class="table-of-contents__link toc-highlight">Using <code>IS</code> when it makes sense to do so</a></li><li><a href="#left-joins-that-are-not-left-joins" class="table-of-contents__link toc-highlight">Left joins that are not left joins</a></li></ul></li><li><a href="#appendix-8-cql-best-practices" class="table-of-contents__link toc-highlight">Appendix 8: CQL Best Practices</a><ul><li><a href="#data-definition-language-ddl" class="table-of-contents__link toc-highlight">Data Definition Language (DDL)</a></li><li><a href="#ad-hoc-migrations-1" class="table-of-contents__link toc-highlight">Ad Hoc Migrations</a></li><li><a href="#transactions" class="table-of-contents__link toc-highlight">Transactions</a></li><li><a href="#savepoints" class="table-of-contents__link toc-highlight">Savepoints</a></li><li><a href="#compilation-options" class="table-of-contents__link toc-highlight">Compilation options</a></li><li><a href="#previous-schema" class="table-of-contents__link toc-highlight">Previous Schema</a></li><li><a href="#schema-regions-1" class="table-of-contents__link toc-highlight">Schema Regions</a></li><li><a href="#schema-version" class="table-of-contents__link toc-highlight">Schema Version</a></li><li><a href="#c-text-echo" class="table-of-contents__link toc-highlight">C Text Echo</a></li><li><a href="#enumerations" class="table-of-contents__link toc-highlight">Enumerations</a></li><li><a href="#cursor-lifetime" class="table-of-contents__link toc-highlight">Cursor Lifetime</a></li><li><a href="#procedure-calls-and-exceptions" class="table-of-contents__link toc-highlight">Procedure Calls and Exceptions</a></li><li><a href="#control-flow-with-big-moves" class="table-of-contents__link toc-highlight">Control Flow with &quot;Big Moves&quot;</a></li><li><a href="#getting-access-to-external-code" class="table-of-contents__link toc-highlight">Getting access to external code</a></li><li><a href="#regular-data-manipulation-language-dml" class="table-of-contents__link toc-highlight">Regular Data Manipulation Language (DML)</a></li><li><a href="#variable-and-cursor-declarations" class="table-of-contents__link toc-highlight">Variable and Cursor declarations</a></li><li><a href="#query-plans" class="table-of-contents__link toc-highlight">Query Plans</a></li><li><a href="#fetching-data-from-a-cursor-or-from-loose-data" class="table-of-contents__link toc-highlight">Fetching Data from a Cursor or from Loose Data</a></li><li><a href="#control-flow" class="table-of-contents__link toc-highlight">Control Flow</a></li><li><a href="#manual-control-of-results" class="table-of-contents__link toc-highlight">Manual Control of Results</a></li><li><a href="#ctes-and-shared-fragments" class="table-of-contents__link toc-highlight">CTEs and Shared Fragments</a></li></ul></li><li><a href="#appendix-9-using-the-cql-amalgam" class="table-of-contents__link toc-highlight">Appendix 9: Using the CQL Amalgam</a><ul><li><a href="#building-the-amalgam" class="table-of-contents__link toc-highlight">Building the Amalgam</a></li><li><a href="#testing-the-amalgam" class="table-of-contents__link toc-highlight">Testing the Amalgam</a></li><li><a href="#using-the-amalgam" class="table-of-contents__link toc-highlight">Using the Amalgam</a></li><li><a href="#cql-amalgam-options" class="table-of-contents__link toc-highlight">CQL Amalgam Options</a></li><li><a href="#amalgam-lean-choices" class="table-of-contents__link toc-highlight">Amalgam LEAN choices</a></li><li><a href="#other-notes" class="table-of-contents__link toc-highlight">Other Notes</a></li></ul></li><li><a href="#appendix-10-cql-working-example" class="table-of-contents__link toc-highlight">Appendix 10: CQL Working Example</a><ul><li><a href="#build-steps" class="table-of-contents__link toc-highlight">Build Steps</a></li><li><a href="#results" class="table-of-contents__link toc-highlight">Results</a></li></ul></li><li><a href="#appendix-11-production-considerations" class="table-of-contents__link toc-highlight">Appendix 11: Production Considerations</a><ul><li><a href="#production-considerations" class="table-of-contents__link toc-highlight">Production Considerations</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Learn</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/introduction">Getting Started</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.youtube.com/channel/UC2lTapw2Um90sZpGQVaynEg" target="_blank" rel="noopener noreferrer" class="footer__link-item">Youtube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/metaOpenSource" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/facebookincubator/CG-SQL" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://opensource.facebook.com/legal/privacy/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Privacy<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://opensource.facebook.com/legal/terms/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Terms<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com" target="_blank" rel="noopener noreferrer" class="footerLogoLink_gHmE"><img src="/img/oss_logo.png" alt="Meta Platforms Open Source Logo" class="themedImage_W2Cr themedImage--light_TfLj footer__logo"><img src="/img/oss_logo.png" alt="Meta Platforms Open Source Logo" class="themedImage_W2Cr themedImage--dark_oUvU footer__logo"></a></div><div class="footer__copyright">Copyright © 2022 Meta Platforms, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.07cf15f3.js"></script>
<script src="/assets/js/main.79429da8.js"></script>
</body>
</html>